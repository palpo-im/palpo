null
null
2025/02/23 07:08:22 config: &{BaseImageURI:complement-palpo-test DebugLoggingEnabled:false AlwaysPrintServerLogs:true EnvVarsPropagatePrefix: SpawnHSTimeout:30s KeepBlueprints:[] HostMounts:[] BaseImageURIs:map[] PackageNamespace:csapi CACertificate:0xc000b2c008 CAPrivateKey:0xc000091280 BestEffort:false HostnameRunningComplement:host.docker.internal EnableDirtyRuns:false HSPortBindingIP:127.0.0.1 PostTestScript:}\n
null
=== RUN   TestChangePasswordPushers\n
2025/02/23 07:08:23 config: &{BaseImageURI:complement-palpo-test DebugLoggingEnabled:false AlwaysPrintServerLogs:true EnvVarsPropagatePrefix: SpawnHSTimeout:30s KeepBlueprints:[] HostMounts:[] BaseImageURIs:map[] PackageNamespace:fed CACertificate:0xc000982c08 CAPrivateKey:0xc0003db280 BestEffort:false HostnameRunningComplement:host.docker.internal EnableDirtyRuns:false HSPortBindingIP:127.0.0.1 PostTestScript:}\n
null
=== RUN   TestWriteMDirectAccountData\n
    account_change_password_pushers_test.go:19: Deploy times: 28.805738519s blueprints, 16.156071032s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (638.094338ms)\n
null
=== RUN   TestChangePasswordPushers/Pushers_created_with_a_different_access_token_are_deleted_on_password_change\n
    direct_messaging_test.go:25: Deploy times: 29.039536822s blueprints, 16.317996947s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (582.087236ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/pushers/set => 200 OK (15.099469ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (578.873208ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (570.449758ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/account/password => 200 OK (1.115179754s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/pushers => 200 OK (4.736442ms)\n
--- PASS: TestChangePasswordPushers/Pushers_created_with_a_different_access_token_are_deleted_on_password_change (1.72s)\n
null
null
=== RUN   TestChangePasswordPushers/Pushers_created_with_the_same_access_token_are_not_deleted_on_password_change\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/pushers/set => 200 OK (8.929328ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (501.404018ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/user/@user-1:hs1/account_data/m.direct => 200 OK (6.340015ms)\n
    direct_messaging_test.go:49: 2025-02-23 07:09:10.239741236 +0800 CST m=+47.964699592: global account data set; syncing until it arrives\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (134.356311ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (453.591442ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/user/@user-1:hs1/account_data/m.direct => 200 OK (7.235237ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (88.816853ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/user/@user-1:hs1/account_data/m.direct => 200 OK (5.045295ms)\n
    direct_messaging_test.go:28: 2025-02-23 07:09:10.930194446 +0800 CST m=+48.655152812: TestWriteMDirectAccountData complete: destroying HS deployment\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/account/password => 200 OK (1.088007745s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/pushers => 200 OK (4.803863ms)\n
--- PASS: TestChangePasswordPushers/Pushers_created_with_the_same_access_token_are_not_deleted_on_password_change (1.10s)\n
null
2025/02/23 07:09:12 ============================================\n
\n
\n
2025/02/23 07:09:12 5f9c8334234ca192ba9afb8f70f090c0a3bb716a077fc853810ec7ce92c381f7 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=5f9c8334234c\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 5f9c8334234c 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265745.5017195,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265745.5066004,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265745.5066295,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
2025/02/23 07:09:12 ============== 5f9c8334234ca192ba9afb8f70f090c0a3bb716a077fc853810ec7ce92c381f7 : END LOGS ==============\n
\n
\n
--- PASS: TestWriteMDirectAccountData (49.22s)\n
null
null
=== RUN   TestIsDirectFlagLocal\n
2025/02/23 07:09:12 ============================================\n
\n
\n
2025/02/23 07:09:12 7e030b9f9496cbd4c83ba7c7f5b6b71ea2270f1760a1e1d5dd9db4a0556b8a8f : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=7e030b9f9496\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 7e030b9f9496 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265744.7043247,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265744.7131395,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265744.7131758,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:09:12 ============== 7e030b9f9496cbd4c83ba7c7f5b6b71ea2270f1760a1e1d5dd9db4a0556b8a8f : END LOGS ==============\n
\n
\n
--- PASS: TestChangePasswordPushers (50.22s)\n
null
null
=== RUN   TestChangePassword\n
    direct_messaging_test.go:73: Deploy times: 21.118964ms blueprints, 14.208784488s containers\n
    account_change_password_test.go:17: Deploy times: 9.05847ms blueprints, 13.859078804s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (575.795853ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (550.79602ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (578.640038ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (521.129922ms)\n
null
=== RUN   TestChangePassword/After_changing_password,_can't_log_in_with_old_password\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (313.072439ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (16.137946ms)\n
    direct_messaging_test.go:88: Received invite: {"content":{"displayname":"user-2 ⚡️","is_direct":true,"membership":"invite"},"sender":"@user-1:hs1","state_key":"@user-2:hs1","type":"m.room.member"}\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/account/password => 200 OK (1.05107501s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 403 Forbidden (552.195369ms)\n
--- PASS: TestChangePassword/After_changing_password,_can't_log_in_with_old_password (1.60s)\n
null
null
=== RUN   TestChangePassword/After_changing_password,_can_log_in_with_new_password\n
2025/02/23 07:09:29 ============================================\n
\n
\n
2025/02/23 07:09:29 8457cf06f227909a6f41e100e434e722db45f9949c1053820f72cc0c5bcea571 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=8457cf06f227\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 8457cf06f227 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265763.718519,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265763.7265205,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265763.7265534,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:09:29 ============== 8457cf06f227909a6f41e100e434e722db45f9949c1053820f72cc0c5bcea571 : END LOGS ==============\n
\n
\n
--- PASS: TestIsDirectFlagLocal (17.17s)\n
null
null
=== RUN   TestIsDirectFlagFederation\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (568.162429ms)\n
--- PASS: TestChangePassword/After_changing_password,_can_log_in_with_new_password (0.57s)\n
null
null
=== RUN   TestChangePassword/After_changing_password,_existing_session_still_works\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/account/whoami => 200 OK (3.600819ms)\n
--- PASS: TestChangePassword/After_changing_password,_existing_session_still_works (0.00s)\n
null
null
=== RUN   TestChangePassword/After_changing_password,_a_different_session_no_longer_works_by_default\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/account/whoami => 401 Unauthorized (4.075761ms)\n
--- PASS: TestChangePassword/After_changing_password,_a_different_session_no_longer_works_by_default (0.00s)\n
null
null
=== RUN   TestChangePassword/After_changing_password,_different_sessions_can_optionally_be_kept\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (543.846772ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/account/password => 200 OK (1.082512744s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/account/whoami => 200 OK (2.905026ms)\n
--- PASS: TestChangePassword/After_changing_password,_different_sessions_can_optionally_be_kept (1.63s)\n
null
2025/02/23 07:09:33 ============================================\n
\n
\n
2025/02/23 07:09:33 b1ad1ad9309605a38bec7a80f8d624fb6ea4fa52111e7e16100406d56e4c6631 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=b1ad1ad93096\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux b1ad1ad93096 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265763.8315883,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265763.8390296,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265763.8390656,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:09:33 ============== b1ad1ad9309605a38bec7a80f8d624fb6ea4fa52111e7e16100406d56e4c6631 : END LOGS ==============\n
\n
\n
--- PASS: TestChangePassword (20.25s)\n
null
null
=== RUN   TestAddAccountData\n
    direct_messaging_test.go:106: Deploy times: 15.951076ms blueprints, 12.179150153s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (647.245928ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/capabilities => 200 OK (8.893464ms)\n
    server.go:185: Creating room !0-FkoyrW6pNgP9WaAKFM:host.docker.internal:40223 with version 10\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (41.711698ms)\n
    direct_messaging_test.go:138: failed to send invite v2: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 73 78 86 65 76 73 68 95 80 65 82 65 77 34 44 34 101 114 114 111 114 34 58 34 73 110 118 97 108 105 100 32 105 110 118 105 116 101 32 101 118 101 110 116 46 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/invite/!0-FkoyrW6pNgP9WaAKFM:host.docker.internal:40223/$Y9YuTdsD-Mxkm-SRtJuyWctsNx0fv3gRO-8RLX2Fv10") code=400 wrapped=M_INVALID_PARAM: Invalid invite event.\n
2025/02/23 07:09:45 ============================================\n
\n
\n
2025/02/23 07:09:45 5517f0da667ca9fd2729d7950c0eea7cd9d346bcc997ec2d39670d7c73bcfb29 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=5517f0da667c\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 5517f0da667c 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265778.826952,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265778.8307886,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265778.830822,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
  \u001b[2m2025-02-22T23:09:43.909140Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::routing::federation::membership\u001b[0m\u001b[33m: \u001b[33mInvalid invite event: missing field `event_sn`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/routing/federation/membership.rs:165\n
\n
2025/02/23 07:09:45 ============== 5517f0da667ca9fd2729d7950c0eea7cd9d346bcc997ec2d39670d7c73bcfb29 : END LOGS ==============\n
\n
\n
--- FAIL: TestIsDirectFlagFederation (15.69s)\n
null
null
=== RUN   TestACLs\n
    federation_acl_test.go:18: WARNING: TestACLs called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    account_data_test.go:13: Deploy times: 7.588606ms blueprints, 12.890050817s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (592.257863ms)\n
null
=== RUN   TestAddAccountData/Can_add_global_account_data\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/user/@user-1:hs1/account_data/test.key => 200 OK (12.545749ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/user/@user-1:hs1/account_data/test.key => 200 OK (6.525404ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/user/@user-1:hs1/account_data/test.key => 200 OK (8.851661ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/user/@user-1:hs1/account_data/test.key => 200 OK (8.369088ms)\n
--- PASS: TestAddAccountData/Can_add_global_account_data (0.04s)\n
null
null
=== RUN   TestAddAccountData/Can_add_room_account_data\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (330.387851ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/user/@user-1:hs1/rooms/!jwMsIuSSlWKy8JuJQ3:hs1/account_data/test.key => 200 OK (8.961696ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/user/@user-1:hs1/rooms/!jwMsIuSSlWKy8JuJQ3:hs1/account_data/test.key => 200 OK (4.033888ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/user/@user-1:hs1/rooms/!jwMsIuSSlWKy8JuJQ3:hs1/account_data/test.key => 200 OK (4.035911ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/user/@user-1:hs1/rooms/!jwMsIuSSlWKy8JuJQ3:hs1/account_data/test.key => 200 OK (5.606587ms)\n
--- PASS: TestAddAccountData/Can_add_room_account_data (0.35s)\n
null
2025/02/23 07:09:48 ============================================\n
\n
\n
2025/02/23 07:09:48 a0b09bca01ae889a956e82027d4aa471a20a349f024c3214a8f134433ff76b89 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=a0b09bca01ae\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux a0b09bca01ae 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265783.083258,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265783.0907664,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265783.090789,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:09:48 ============== a0b09bca01ae889a956e82027d4aa471a20a349f024c3214a8f134433ff76b89 : END LOGS ==============\n
\n
\n
--- PASS: TestAddAccountData (15.37s)\n
null
null
=== RUN   TestDeactivateAccount\n
    account_deactivate_test.go:17: Deploy times: 11.302006ms blueprints, 13.955897296s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (857.324076ms)\n
null
=== RUN   TestDeactivateAccount/Password_flow_is_available\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/account/deactivate => 401 Unauthorized (25.746442ms)\n
    account_deactivate_test.go:37: Received JSON {"flows":[{"stages":["m.login.password"]}],"params":null,"session":"EGxVuEq0o3ENnX8d7biWC1gl1GvNrDd8"}\n
--- PASS: TestDeactivateAccount/Password_flow_is_available (0.03s)\n
null
null
=== RUN   TestDeactivateAccount/Can't_deactivate_account_with_wrong_password\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/account/deactivate => 401 Unauthorized (769.252302ms)\n
--- PASS: TestDeactivateAccount/Can't_deactivate_account_with_wrong_password (0.77s)\n
null
null
=== RUN   TestDeactivateAccount/Can_deactivate_account\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/account/deactivate => 200 OK (696.14394ms)\n
--- PASS: TestDeactivateAccount/Can_deactivate_account (0.70s)\n
null
null
=== RUN   TestDeactivateAccount/After_deactivating_account,_can't_log_in_with_password\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 403 Forbidden (9.460114ms)\n
--- PASS: TestDeactivateAccount/After_deactivating_account,_can't_log_in_with_password (0.01s)\n
null
2025/02/23 07:10:06 ============================================\n
\n
\n
2025/02/23 07:10:06 55b0fea29fa09f217e7163d2996ea250cebe3840daa925b90d63eeec775b655e : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=55b0fea29fa0\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 55b0fea29fa0 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265799.0159843,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265799.0203543,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265799.0205514,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:10:06 ============== 55b0fea29fa09f217e7163d2996ea250cebe3840daa925b90d63eeec775b655e : END LOGS ==============\n
\n
\n
--- PASS: TestDeactivateAccount (18.09s)\n
null
null
=== RUN   TestCanRegisterAdmin\n
    admin_test.go:20: Deploy times: 10.772341ms blueprints, 18.955496049s containers\n
    client.go:706: [CSAPI] GET hs1/_synapse/admin/v1/register => 404 Not Found (3.699738ms)\n
    auth.go:130: Homeserver image does not support shared secret registration, /_synapse/admin/v1/register returned HTTP 404\n
2025/02/23 07:10:26 ============================================\n
\n
\n
2025/02/23 07:10:26 472847f1eabb6ea28aeb6129fab6ae4a8cf7f2e1a8d08594ea3e8acd9d0c24c0 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=472847f1eabb\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 472847f1eabb 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265822.3839104,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265822.3882174,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265822.3882396,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:10:26 ============== 472847f1eabb6ea28aeb6129fab6ae4a8cf7f2e1a8d08594ea3e8acd9d0c24c0 : END LOGS ==============\n
\n
\n
--- SKIP: TestCanRegisterAdmin (20.46s)\n
null
null
=== RUN   TestServerNotices\n
    admin_test.go:29: Deploy times: 10.872932ms blueprints, 14.437489405s containers\n
    client.go:706: [CSAPI] GET hs1/_synapse/admin/v1/register => 404 Not Found (2.391035ms)\n
    auth.go:130: Homeserver image does not support shared secret registration, /_synapse/admin/v1/register returned HTTP 404\n
2025/02/23 07:10:43 ============================================\n
\n
\n
2025/02/23 07:10:43 9b91dcefd96461b6800a7c08c60eef04a10c742bfd0d4955b51ef162282263d8 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=9b91dcefd964\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 9b91dcefd964 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265838.4020908,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265838.4071267,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265838.407154,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:10:43 ============== 9b91dcefd96461b6800a7c08c60eef04a10c742bfd0d4955b51ef162282263d8 : END LOGS ==============\n
\n
\n
--- SKIP: TestServerNotices (16.06s)\n
null
null
=== RUN   TestContent\n
    apidoc_content_test.go:16: WARNING: TestContent called runtime.SkipIf([synapse]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    apidoc_content_test.go:18: Deploy times: 9.323038ms blueprints, 15.227671315s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (625.270316ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (7.241037ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/media/v3/download/hs1/EHSDX0KTY11A57TYK4WJPAYFV8 => 200 OK (6.241177ms)\n
2025/02/23 07:11:00 ============================================\n
\n
\n
2025/02/23 07:11:00 e8267de2cbf8bbe24a3546584ecd1cc5f3c6c5c5b9b5713959d5c8411e9806c0 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=e8267de2cbf8\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux e8267de2cbf8 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265855.2449505,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265855.2515426,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265855.2515833,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:11:00 ============== e8267de2cbf8bbe24a3546584ecd1cc5f3c6c5c5b9b5713959d5c8411e9806c0 : END LOGS ==============\n
\n
\n
--- PASS: TestContent (17.53s)\n
null
null
=== RUN   TestContentCSAPIMediaV1\n
    apidoc_content_test.go:38: Deploy times: 12.678569ms blueprints, 15.866031077s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (640.112147ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (10.54544ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/media/download/hs1/MZZ26ZPCAX793A1A28NH9D538R => 200 OK (9.040434ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/media/download/hs1/mxc://hs1/MZZ26ZPCAX793A1A28NH9D538R => 401 Unauthorized (1.118977ms)\n
2025/02/23 07:11:18 ============================================\n
\n
\n
2025/02/23 07:11:18 1fb2ab87c056db9ae3f80a74ac777db31297a35a48124ef9b6963cf3e20108f9 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=1fb2ab87c056\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 1fb2ab87c056 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265873.4612153,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265873.4743552,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265873.4743888,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:11:18 ============== 1fb2ab87c056db9ae3f80a74ac777db31297a35a48124ef9b6963cf3e20108f9 : END LOGS ==============\n
\n
\n
--- PASS: TestContentCSAPIMediaV1 (18.08s)\n
null
null
=== RUN   TestDeviceManagement\n
    federation_acl_test.go:20: Deploy times: 1m32.871288916s blueprints, 18.497273219s containers\n
    apidoc_device_management_test.go:16: Deploy times: 30.064024ms blueprints, 18.063533446s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (619.616358ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (644.114988ms)\n
null
=== RUN   TestDeviceManagement/GET_/device/{deviceId}\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (638.103675ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (581.541121ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/devices/login_device => 200 OK (10.593092ms)\n
--- PASS: TestDeviceManagement/GET_/device/{deviceId} (0.59s)\n
null
null
=== RUN   TestDeviceManagement/GET_/device/{deviceId}_gives_a_404_for_unknown_devices\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/devices/unknown_device => 404 Not Found (17.916462ms)\n
--- PASS: TestDeviceManagement/GET_/device/{deviceId}_gives_a_404_for_unknown_devices (0.02s)\n
null
null
=== RUN   TestDeviceManagement/GET_/devices\n
    client.go:706: [CSAPI] POST hs3/_matrix/client/v3/register => 200 OK (624.060561ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (613.612967ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/devices => 200 OK (13.105078ms)\n
--- PASS: TestDeviceManagement/GET_/devices (0.63s)\n
null
null
=== RUN   TestDeviceManagement/PUT_/device/{deviceId}_updates_device_fields\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/devices/login_device => 200 OK (10.185911ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/devices/login_device => 200 OK (6.825514ms)\n
--- PASS: TestDeviceManagement/PUT_/device/{deviceId}_updates_device_fields (0.02s)\n
null
null
=== RUN   TestDeviceManagement/PUT_/device/{deviceId}_gives_a_404_for_unknown_devices\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/devices/unknown_device => 404 Not Found (4.431865ms)\n
--- PASS: TestDeviceManagement/PUT_/device/{deviceId}_gives_a_404_for_unknown_devices (0.00s)\n
null
null
=== RUN   TestDeviceManagement/DELETE_/device/{deviceId}\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (454.250845ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (138.123477ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (625.038697ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (20.256951ms)\n
    client.go:706: [CSAPI] DELETE hs1/_matrix/client/v3/devices/Qvu5XKIreU => 401 Unauthorized (4.487448ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!jPZPzb7yWhagICOCL6:hs1 => 200 OK (780.556495ms)\n
    client.go:706: [CSAPI] DELETE hs1/_matrix/client/v3/devices/Qvu5XKIreU => 401 Unauthorized (529.433748ms)\n
    apidoc_device_management_test.go:156: \u001b[31mMatchResponse key 'error' missing - http://127.0.0.1:32844/_matrix/client/v3/devices/Qvu5XKIreU => {"flows":[{"stages":["m.login.password"]}],"params":null,"session":"5KDbu2neFS3rhVFBcvXBqW5EQ0IjR5KU"}\u001b[39m\n
--- FAIL: TestDeviceManagement/DELETE_/device/{deviceId} (1.18s)\n
null
null
=== RUN   TestDeviceManagement/DELETE_/device/{deviceId}_requires_UI_auth_user_to_match_device_owner\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (600.017983ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.025884131s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (590.625973ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (23.069509ms)\n
    client.go:706: [CSAPI] DELETE hs1/_matrix/client/v3/devices/94sAUwpvHF => 403 Forbidden (6.744452ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/devices/94sAUwpvHF => 200 OK (4.945304ms)\n
    client.go:706: [CSAPI] DELETE hs1/_matrix/client/v3/devices/94sAUwpvHF => 200 OK (563.888294ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/devices/94sAUwpvHF => 404 Not Found (5.538113ms)\n
--- PASS: TestDeviceManagement/DELETE_/device/{deviceId}_requires_UI_auth_user_to_match_device_owner (1.80s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.063236064s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.033856145s)\n
2025/02/23 07:11:43 ============================================\n
\n
\n
2025/02/23 07:11:43 cbce3b8cd642d0e4af52d3048f74ed661f4aa27292e7d4ec8d03846a11d265b1 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=cbce3b8cd642\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux cbce3b8cd642 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265893.3858156,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265893.3923182,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265893.3945932,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
  \u001b[2m2025-02-22T23:11:38.134208Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::error\u001b[0m\u001b[31m: \u001b[31mdiesel db error., \u001b[1;31merror\u001b[0m\u001b[31m: NotFound\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/error.rs:120\n
\n
  \u001b[2m2025-02-22T23:11:38.786465Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::error\u001b[0m\u001b[31m: \u001b[31mdiesel db error., \u001b[1;31merror\u001b[0m\u001b[31m: NotFound\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/error.rs:120\n
\n
  \u001b[2m2025-02-22T23:11:41.762952Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::error\u001b[0m\u001b[31m: \u001b[31mdiesel db error., \u001b[1;31merror\u001b[0m\u001b[31m: NotFound\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/error.rs:120\n
\n
2025/02/23 07:11:43 ============== cbce3b8cd642d0e4af52d3048f74ed661f4aa27292e7d4ec8d03846a11d265b1 : END LOGS ==============\n
\n
\n
--- FAIL: TestDeviceManagement (24.43s)\n
null
null
=== RUN   TestLogin\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.031413563s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.039284844s)\n
    federation_acl_test.go:33: \u001b[31m@user-1:hs1 MustSyncUntil: timed out after 5.194923448s. Seen 5 /sync responses. Checkers:\n
        [t=1.02603604s] Response #1: SyncJoinedTo(!jPZPzb7yWhagICOCL6:hs1): Key rooms.join.!jPZPzb7yWhagICOCL6:hs1.timeline.events does not exist & Key rooms.join.!jPZPzb7yWhagICOCL6:hs1.state.events does not exist\n
        [t=2.089445815s] Response #2: SyncJoinedTo(!jPZPzb7yWhagICOCL6:hs1): Key rooms.join.!jPZPzb7yWhagICOCL6:hs1.timeline.events does not exist & Key rooms.join.!jPZPzb7yWhagICOCL6:hs1.state.events does not exist\n
        [t=3.123479395s] Response #3: SyncJoinedTo(!jPZPzb7yWhagICOCL6:hs1): Key rooms.join.!jPZPzb7yWhagICOCL6:hs1.timeline.events does not exist & Key rooms.join.!jPZPzb7yWhagICOCL6:hs1.state.events does not exist\n
        [t=4.155039928s] Response #4: SyncJoinedTo(!jPZPzb7yWhagICOCL6:hs1): Key rooms.join.!jPZPzb7yWhagICOCL6:hs1.timeline.events does not exist & Key rooms.join.!jPZPzb7yWhagICOCL6:hs1.state.events does not exist\n
        [t=5.194920203s] Response #5: SyncJoinedTo(!jPZPzb7yWhagICOCL6:hs1): Key rooms.join.!jPZPzb7yWhagICOCL6:hs1.timeline.events does not exist & Key rooms.join.!jPZPzb7yWhagICOCL6:hs1.state.events does not exist, \n
        \u001b[39m\n
2025/02/23 07:11:46 ============================================\n
\n
\n
2025/02/23 07:11:46 c80ca354ddee7df8e1d2ec5b0f5d1b19b75b7efb91a7d608d65032d79d869a9c : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=c80ca354ddee\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux c80ca354ddee 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265893.2384748,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265893.2458315,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265893.2458923,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs1:8448/_matrix/federation/v1/make_join/!jPZPzb7yWhagICOCL6:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "895", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:11:38 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$mfadtlHlpoKJlgfbqGPwsFZUbjulUlpw1q7cyqWXX8g","$GRlWA3VOoWa4D14AWVlWYY1VaqNIZ2FELlalo3csqCQ","$kBP71D7oeskSswZylrEgB9wX0YjZgkLYqt2ZNsiQKx4"],"content":{"membership":"join"},"depth":7,"event_sn":11,"hashes":{"sha256":"8e3SEMxFkaOxE9WJ2UwwdkqzvEpq1dj+8K2ELW+X3S0"},"origin":"hs1","origin_server_ts":1740265899506,"prev_events":["$FnHn5XtmGST1F1RixQ--dTT3Kli1AEhHObC6vWxeURc","$GRlWA3VOoWa4D14AWVlWYY1VaqNIZ2FELlalo3csqCQ","$SRf4ivZuNx3Xv8mw67nD0lt_5Ui2ZdOgnFqpgbgZErQ","$g2OWxdN7x4Ey4EA-koGHiEP9r-ilCCSsbmq78S8Zt5M","$kBP71D7oeskSswZylrEgB9wX0YjZgkLYqt2ZNsiQKx4","$mfadtlHlpoKJlgfbqGPwsFZUbjulUlpw1q7cyqWXX8g"],"room_id":"!jPZPzb7yWhagICOCL6:hs1","sender":"@user-2:hs2","signatures":{"hs1":{"ed25519:FDGzD7pi":"QshZsaa+5p89la/170TcVBC2CZ2odrdZybLgLDy+iZ20dLAl/V/42zISmJH5VeL+yxr/B13agatCLV0ycZMFBw"}},"state_key":"@user-2:hs2","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:11:39.807567Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
2025/02/23 07:11:46 ============== c80ca354ddee7df8e1d2ec5b0f5d1b19b75b7efb91a7d608d65032d79d869a9c : END LOGS ==============\n
\n
\n
2025/02/23 07:11:48 ============================================\n
\n
\n
2025/02/23 07:11:48 08af9cd580f3a0a353ca5904cc38be9c086c2f72edd585d472c7c48ae33e2350 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=08af9cd580f3\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 08af9cd580f3 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265893.2807522,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265893.2925785,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265893.2926164,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:11:48 ============== 08af9cd580f3a0a353ca5904cc38be9c086c2f72edd585d472c7c48ae33e2350 : END LOGS ==============\n
\n
\n
2025/02/23 07:11:49 ============================================\n
\n
\n
2025/02/23 07:11:49 80b13760439eefd813982c165f8be2fa881575a12ad172b585542d78cffc9357 : Server logs:\n
SERVER_NAME=hs3\n
HOSTNAME=80b13760439e\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 80b13760439e 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265893.2664368,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265893.27141,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265893.271439,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:11:49 ============== 80b13760439eefd813982c165f8be2fa881575a12ad172b585542d78cffc9357 : END LOGS ==============\n
\n
\n
--- FAIL: TestACLs (124.62s)\n
null
null
=== RUN   TestDeviceListsUpdateOverFederation\n
    apidoc_login_test.go:20: Deploy times: 30.185236ms blueprints, 15.144825778s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (687.525762ms)\n
null
=== RUN   TestLogin/parallel\n
null
=== RUN   TestLogin/parallel/GET_/login_yields_a_set_of_flows\n
=== PAUSE TestLogin/parallel/GET_/login_yields_a_set_of_flows\n
null
null
=== RUN   TestLogin/parallel/POST_/login_can_login_as_user\n
=== PAUSE TestLogin/parallel/POST_/login_can_login_as_user\n
null
null
=== RUN   TestLogin/parallel/POST_/login_returns_the_same_device_id_as_that_in_the_request\n
=== PAUSE TestLogin/parallel/POST_/login_returns_the_same_device_id_as_that_in_the_request\n
null
null
=== RUN   TestLogin/parallel/POST_/login_can_log_in_as_a_user_with_just_the_local_part_of_the_id\n
=== PAUSE TestLogin/parallel/POST_/login_can_log_in_as_a_user_with_just_the_local_part_of_the_id\n
null
null
=== RUN   TestLogin/parallel/POST_/login_as_non-existing_user_is_rejected\n
=== PAUSE TestLogin/parallel/POST_/login_as_non-existing_user_is_rejected\n
null
null
=== RUN   TestLogin/parallel/POST_/login_wrong_password_is_rejected\n
=== PAUSE TestLogin/parallel/POST_/login_wrong_password_is_rejected\n
null
null
=== RUN   TestLogin/parallel/Login_with_uppercase_username_works_and_GET_/whoami_afterwards_also\n
=== PAUSE TestLogin/parallel/Login_with_uppercase_username_works_and_GET_/whoami_afterwards_also\n
null
null
=== CONT  TestLogin/parallel/POST_/login_as_non-existing_user_is_rejected\n
null
=== CONT  TestLogin/parallel/Login_with_uppercase_username_works_and_GET_/whoami_afterwards_also\n
null
=== CONT  TestLogin/parallel/POST_/login_wrong_password_is_rejected\n
null
=== CONT  TestLogin/parallel/POST_/login_returns_the_same_device_id_as_that_in_the_request\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 403 Forbidden (6.409349ms)\n
--- PASS: TestLogin/parallel/POST_/login_as_non-existing_user_is_rejected (0.01s)\n
null
null
=== CONT  TestLogin/parallel/POST_/login_can_log_in_as_a_user_with_just_the_local_part_of_the_id\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (624.127791ms)\n
--- PASS: TestLogin/parallel/POST_/login_can_log_in_as_a_user_with_just_the_local_part_of_the_id (0.62s)\n
null
null
=== CONT  TestLogin/parallel/POST_/login_can_login_as_user\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 403 Forbidden (648.216035ms)\n
--- PASS: TestLogin/parallel/POST_/login_wrong_password_is_rejected (0.65s)\n
null
null
=== CONT  TestLogin/parallel/GET_/login_yields_a_set_of_flows\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/login => 200 OK (1.546378ms)\n
--- PASS: TestLogin/parallel/GET_/login_yields_a_set_of_flows (0.00s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (730.579003ms)\n
--- PASS: TestLogin/parallel/POST_/login_returns_the_same_device_id_as_that_in_the_request (0.73s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (753.602069ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/account/whoami => 200 OK (15.922121ms)\n
--- PASS: TestLogin/parallel/Login_with_uppercase_username_works_and_GET_/whoami_afterwards_also (0.77s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (601.170482ms)\n
--- PASS: TestLogin/parallel/POST_/login_can_login_as_user (0.60s)\n
null
--- PASS: TestLogin/parallel (0.00s)\n
null
2025/02/23 07:12:01 ============================================\n
\n
\n
2025/02/23 07:12:01 e983f7f20ce23b5387af79781c3c113be9e4786ab9c4f4b726ef4a1b193daf1d : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=e983f7f20ce2\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux e983f7f20ce2 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265915.1183167,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265915.1231184,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265915.12339,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:12:01 ============== e983f7f20ce23b5387af79781c3c113be9e4786ab9c4f4b726ef4a1b193daf1d : END LOGS ==============\n
\n
\n
--- PASS: TestLogin (18.96s)\n
null
null
=== RUN   TestLogout\n
    apidoc_logout_test.go:17: Deploy times: 13.210607ms blueprints, 16.3683352s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (606.451037ms)\n
null
=== RUN   TestLogout/Can_logout_current_device\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (625.814909ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/devices => 200 OK (11.141224ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/logout => 200 OK (11.19832ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 401 Unauthorized (3.89557ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/devices => 200 OK (5.734628ms)\n
--- PASS: TestLogout/Can_logout_current_device (0.66s)\n
null
null
=== RUN   TestLogout/Can_logout_all_devices\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (557.268648ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/devices => 200 OK (4.759005ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/logout/all => 200 OK (7.498803ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 401 Unauthorized (1.825457ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 401 Unauthorized (1.844325ms)\n
--- PASS: TestLogout/Can_logout_all_devices (0.57s)\n
null
null
=== RUN   TestLogout/Request_to_logout_with_invalid_an_access_token_is_rejected\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (627.059736ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/logout => 401 Unauthorized (3.963883ms)\n
--- PASS: TestLogout/Request_to_logout_with_invalid_an_access_token_is_rejected (0.63s)\n
null
null
=== RUN   TestLogout/Request_to_logout_without_an_access_token_is_rejected\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (577.329304ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/logout => 401 Unauthorized (4.762561ms)\n
--- PASS: TestLogout/Request_to_logout_without_an_access_token_is_rejected (0.58s)\n
null
2025/02/23 07:12:22 ============================================\n
\n
\n
2025/02/23 07:12:22 6f2cfec506123bdd7c81cfb1ba31a8e3ed25b38f47a3b90d654c706c053da2d3 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=6f2cfec50612\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 6f2cfec50612 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265935.70642,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265935.7143676,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265935.7144067,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:12:22 ============== 6f2cfec506123bdd7c81cfb1ba31a8e3ed25b38f47a3b90d654c706c053da2d3 : END LOGS ==============\n
\n
\n
--- PASS: TestLogout (20.88s)\n
null
null
=== RUN   TestPresence\n
    apidoc_presence_test.go:22: Deploy times: 9.399242ms blueprints, 14.081104521s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (656.30243ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (627.308016ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (362.249889ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!zVJ6cCvTchtUjCuDhW:hs1 => 200 OK (150.91172ms)\n
null
=== RUN   TestPresence/GET_/presence/:user_id/status_fetches_initial_status\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/presence/@user-1:hs1/status => 200 OK (9.300855ms)\n
--- PASS: TestPresence/GET_/presence/:user_id/status_fetches_initial_status (0.01s)\n
null
null
=== RUN   TestPresence/PUT_/presence/:user_id/status_updates_my_presence\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/presence/@user-1:hs1/status => 200 OK (11.118751ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/presence/@user-1:hs1/status => 200 OK (8.465792ms)\n
--- PASS: TestPresence/PUT_/presence/:user_id/status_updates_my_presence (0.02s)\n
null
null
=== RUN   TestPresence/Presence_can_be_set_from_sync\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (170.884094ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (119.259573ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (44.739838ms)\n
--- PASS: TestPresence/Presence_can_be_set_from_sync (0.34s)\n
null
null
=== RUN   TestPresence/Presence_changes_are_reported_to_local_room_members\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (152.784077ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/presence/@user-1:hs1/status => 200 OK (12.837367ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (56.229235ms)\n
--- PASS: TestPresence/Presence_changes_are_reported_to_local_room_members (0.23s)\n
null
null
=== RUN   TestPresence/Presence_changes_to_UNAVAILABLE_are_reported_to_local_room_members\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (118.507357ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/presence/@user-1:hs1/status => 200 OK (7.988497ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (30.319819ms)\n
--- PASS: TestPresence/Presence_changes_to_UNAVAILABLE_are_reported_to_local_room_members (0.16s)\n
null
2025/02/23 07:12:41 ============================================\n
\n
\n
2025/02/23 07:12:41 78870690c95e9db0b590351092d803983c9ea725a4ebc660a02570c6cff883fc : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=78870690c95e\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 78870690c95e 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265954.1794083,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265954.1885998,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265954.1886294,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:12:41 ============== 78870690c95e9db0b590351092d803983c9ea725a4ebc660a02570c6cff883fc : END LOGS ==============\n
\n
\n
--- PASS: TestPresence (18.08s)\n
null
null
=== RUN   TestProfileAvatarURL\n
    apidoc_profile_avatar_url_test.go:14: Deploy times: 10.862607ms blueprints, 16.539963652s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (726.541916ms)\n
null
=== RUN   TestProfileAvatarURL/PUT_/profile/:user_id/avatar_url_sets_my_avatar\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/profile/@user-1:hs1/avatar_url => 200 OK (22.125733ms)\n
--- PASS: TestProfileAvatarURL/PUT_/profile/:user_id/avatar_url_sets_my_avatar (0.02s)\n
null
null
=== RUN   TestProfileAvatarURL/GET_/profile/:user_id/avatar_url_publicly_accessible\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/profile/@user-1:hs1/avatar_url => 200 OK (5.780716ms)\n
--- PASS: TestProfileAvatarURL/GET_/profile/:user_id/avatar_url_publicly_accessible (0.01s)\n
null
2025/02/23 07:12:59 ============================================\n
\n
\n
2025/02/23 07:12:59 9ff0d6636ad9b84251c4a134ef30171f18d002df40fb7b983404b5c56423cce5 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=9ff0d6636ad9\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 9ff0d6636ad9 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265974.2255325,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265974.2330003,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265974.2330258,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:12:59 ============== 9ff0d6636ad9b84251c4a134ef30171f18d002df40fb7b983404b5c56423cce5 : END LOGS ==============\n
\n
\n
--- PASS: TestProfileAvatarURL (18.92s)\n
null
null
=== RUN   TestProfileDisplayName\n
    federation_device_list_update_test.go:24: Deploy times: 57.734147824s blueprints, 21.106395034s containers\n
null
=== RUN   TestDeviceListsUpdateOverFederation/good_connectivity\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (772.329095ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (740.306584ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.916173916s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (165.506091ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (29.967501ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!FyYhzlecXZgucfZk5s:hs1 => 403 Forbidden (21.125773ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:32861/_matrix/client/v3/join/%21FyYhzlecXZgucfZk5s:hs1?server_name=hs1 returned non-2xx code: 403 Forbidden - body: {"errcode":"M_FORBIDDEN","error":"Event is not authorized."}\u001b[39m\n
--- FAIL: TestDeviceListsUpdateOverFederation/good_connectivity (4.65s)\n
null
null
=== RUN   TestDeviceListsUpdateOverFederation/interrupted_connectivity\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (566.982641ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (656.834024ms)\n
    apidoc_profile_displayname_test.go:12: Deploy times: 13.162915ms blueprints, 16.561690278s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.340984853s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (113.692929ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (55.01976ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!LyWW4jCnruoufWoMk5:hs1 => 403 Forbidden (15.022843ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:32861/_matrix/client/v3/join/%21LyWW4jCnruoufWoMk5:hs1?server_name=hs1 returned non-2xx code: 403 Forbidden - body: {"errcode":"M_FORBIDDEN","error":"Event is not authorized."}\u001b[39m\n
--- FAIL: TestDeviceListsUpdateOverFederation/interrupted_connectivity (3.75s)\n
null
null
=== RUN   TestDeviceListsUpdateOverFederation/stopped_server\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (582.324012ms)\n
null
=== RUN   TestProfileDisplayName/PUT_/profile/:user_id/displayname_sets_my_name\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/profile/@user-1:hs1/displayname => 200 OK (9.461976ms)\n
--- PASS: TestProfileDisplayName/PUT_/profile/:user_id/displayname_sets_my_name (0.01s)\n
null
null
=== RUN   TestProfileDisplayName/GET_/profile/:user_id/displayname_publicly_accessible\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/profile/@user-1:hs1/displayname => 200 OK (3.510242ms)\n
--- PASS: TestProfileDisplayName/GET_/profile/:user_id/displayname_publicly_accessible (0.00s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (538.536903ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (618.732358ms)\n
2025/02/23 07:13:18 ============================================\n
\n
\n
2025/02/23 07:13:18 700f22c15dc3f03f0495509bdb71ba1866af3562737a9951ba26f885b966dbbc : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=700f22c15dc3\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 700f22c15dc3 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265993.577153,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265993.58394,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265993.5839703,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:13:18 ============== 700f22c15dc3f03f0495509bdb71ba1866af3562737a9951ba26f885b966dbbc : END LOGS ==============\n
\n
\n
--- PASS: TestProfileDisplayName (18.62s)\n
null
null
=== RUN   TestRegistration\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.585084837s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (178.732281ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (64.269209ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!SNvwoZn0Pd7p2wXRVk:hs1 => 403 Forbidden (9.77118ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:32861/_matrix/client/v3/join/%21SNvwoZn0Pd7p2wXRVk:hs1?server_name=hs1 returned non-2xx code: 403 Forbidden - body: {"errcode":"M_FORBIDDEN","error":"Event is not authorized."}\u001b[39m\n
--- FAIL: TestDeviceListsUpdateOverFederation/stopped_server (4.00s)\n
null
2025/02/23 07:13:22 ============================================\n
\n
\n
2025/02/23 07:13:22 d003ff9bce63b17b8519d3d2b14a6dd7e78122a94f44e6a29c34f35a39db3d8b : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=d003ff9bce63\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux d003ff9bce63 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265985.2583807,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265985.2705126,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265985.2705507,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 9\n
To many layers, we have to go deeper frame_id: 10\n
To many layers, we have to go deeper frame_id: 28\n
To many layers, we have to go deeper frame_id: 32\n
To many layers, we have to go deeper frame_id: 33\n
To many layers, we have to go deeper frame_id: 51\n
To many layers, we have to go deeper frame_id: 55\n
To many layers, we have to go deeper frame_id: 56\n
2025/02/23 07:13:22 ============== d003ff9bce63b17b8519d3d2b14a6dd7e78122a94f44e6a29c34f35a39db3d8b : END LOGS ==============\n
\n
\n
2025/02/23 07:13:24 ============================================\n
\n
\n
2025/02/23 07:13:24 2e26e99438d1a98401722393701ac3ac8756d20e541956fc8faf93defa96c973 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=2e26e99438d1\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 2e26e99438d1 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740265985.3162968,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740265985.3218637,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740265985.3218942,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
  \u001b[2m2025-02-22T23:13:13.414491Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:13:17.164706Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:13:21.165601Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:13:22.267886Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $kNd4Yi_fGO8BqAtotYXIlIWoHODXdx3S_UFYvJE1f3w failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
To many layers, we have to go deeper frame_id: 8\n
To many layers, we have to go deeper frame_id: 9\n
2025/02/23 07:13:24 ============== 2e26e99438d1a98401722393701ac3ac8756d20e541956fc8faf93defa96c973 : END LOGS ==============\n
\n
\n
--- FAIL: TestDeviceListsUpdateOverFederation (94.55s)\n
null
null
=== RUN   TestDeviceListsUpdateOverFederationOnRoomJoin\n
    federation_device_list_update_test.go:175: WARNING: TestDeviceListsUpdateOverFederationOnRoomJoin called runtime.SkipIf([dendrite synapse]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    apidoc_register_test.go:39: Deploy times: 12.140491ms blueprints, 14.482162915s containers\n
null
=== RUN   TestRegistration/parallel\n
null
=== RUN   TestRegistration/parallel/POST_{}_returns_a_set_of_flows\n
=== PAUSE TestRegistration/parallel/POST_{}_returns_a_set_of_flows\n
null
null
=== RUN   TestRegistration/parallel/POST_/register_can_create_a_user\n
=== PAUSE TestRegistration/parallel/POST_/register_can_create_a_user\n
null
null
=== RUN   TestRegistration/parallel/POST_/register_downcases_capitals_in_usernames\n
=== PAUSE TestRegistration/parallel/POST_/register_downcases_capitals_in_usernames\n
null
null
=== RUN   TestRegistration/parallel/POST_/register_returns_the_same_device_id_as_that_in_the_request\n
=== PAUSE TestRegistration/parallel/POST_/register_returns_the_same_device_id_as_that_in_the_request\n
null
null
=== RUN   TestRegistration/parallel/POST_/register_rejects_usernames_with_special_characters\n
=== PAUSE TestRegistration/parallel/POST_/register_rejects_usernames_with_special_characters\n
null
null
=== RUN   TestRegistration/parallel/POST_/register_rejects_if_user_already_exists\n
=== PAUSE TestRegistration/parallel/POST_/register_rejects_if_user_already_exists\n
null
null
=== RUN   TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_\n
null
=== RUN   TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_/q\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (642.071169ms)\n
--- PASS: TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_/q (0.64s)\n
null
null
=== RUN   TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_/3\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (616.04621ms)\n
--- PASS: TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_/3 (0.62s)\n
null
null
=== RUN   TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_/.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (579.644724ms)\n
--- PASS: TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_/. (0.58s)\n
null
null
=== RUN   TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_/_\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (624.113526ms)\n
--- PASS: TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_/_ (0.62s)\n
null
null
=== RUN   TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_/=\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (661.379198ms)\n
--- PASS: TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_/= (0.66s)\n
null
null
=== RUN   TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_/-\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (606.105526ms)\n
--- PASS: TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_/- (0.61s)\n
null
null
=== RUN   TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_//\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (551.96828ms)\n
--- PASS: TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_// (0.55s)\n
null
--- PASS: TestRegistration/parallel/POST_/register_allows_registration_of_usernames_with_ (4.28s)\n
null
null
=== RUN   TestRegistration/parallel/POST_/_synapse/admin/v1/register_admin_with_shared_secret\n
    client.go:706: [CSAPI] GET hs1/_synapse/admin/v1/register => 404 Not Found (1.818587ms)\n
    apidoc_register_test.go:318: Homeserver image does not support shared secret registration, /_synapse/admin/v1/register returned HTTP 404\n
--- SKIP: TestRegistration/parallel/POST_/_synapse/admin/v1/register_admin_with_shared_secret (0.00s)\n
null
null
=== RUN   TestRegistration/parallel/POST_/_synapse/admin/v1/register_with_shared_secret\n
    client.go:706: [CSAPI] GET hs1/_synapse/admin/v1/register => 404 Not Found (2.369533ms)\n
    apidoc_register_test.go:318: Homeserver image does not support shared secret registration, /_synapse/admin/v1/register returned HTTP 404\n
--- SKIP: TestRegistration/parallel/POST_/_synapse/admin/v1/register_with_shared_secret (0.00s)\n
null
null
=== RUN   TestRegistration/parallel/POST_/_synapse/admin/v1/register_with_shared_secret_disallows_symbols\n
    client.go:706: [CSAPI] GET hs1/_synapse/admin/v1/register => 404 Not Found (4.396611ms)\n
    apidoc_register_test.go:318: Homeserver image does not support shared secret registration, /_synapse/admin/v1/register returned HTTP 404\n
--- SKIP: TestRegistration/parallel/POST_/_synapse/admin/v1/register_with_shared_secret_disallows_symbols (0.00s)\n
null
null
=== RUN   TestRegistration/parallel/POST_/_synapse/admin/v1/register_with_shared_secret_downcases_capitals\n
    client.go:706: [CSAPI] GET hs1/_synapse/admin/v1/register => 404 Not Found (2.613528ms)\n
    apidoc_register_test.go:318: Homeserver image does not support shared secret registration, /_synapse/admin/v1/register returned HTTP 404\n
--- SKIP: TestRegistration/parallel/POST_/_synapse/admin/v1/register_with_shared_secret_downcases_capitals (0.00s)\n
null
null
=== RUN   TestRegistration/parallel/Registration_accepts_non-ascii_passwords\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 401 Unauthorized (6.281507ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (585.708185ms)\n
--- PASS: TestRegistration/parallel/Registration_accepts_non-ascii_passwords (0.59s)\n
null
null
=== RUN   TestRegistration/parallel/GET_/register/available_returns_available_for_unregistered_user_name\n
=== PAUSE TestRegistration/parallel/GET_/register/available_returns_available_for_unregistered_user_name\n
null
null
=== RUN   TestRegistration/parallel/GET_/register/available_returns_M_USER_IN_USE_for_registered_user_name\n
=== PAUSE TestRegistration/parallel/GET_/register/available_returns_M_USER_IN_USE_for_registered_user_name\n
null
null
=== RUN   TestRegistration/parallel/GET_/register/available_returns_M_INVALID_USERNAME_for_invalid_user_name\n
=== PAUSE TestRegistration/parallel/GET_/register/available_returns_M_INVALID_USERNAME_for_invalid_user_name\n
null
null
=== CONT  TestRegistration/parallel/POST_{}_returns_a_set_of_flows\n
null
=== CONT  TestRegistration/parallel/POST_/register_returns_the_same_device_id_as_that_in_the_request\n
null
=== CONT  TestRegistration/parallel/POST_/register_rejects_usernames_with_special_characters\n
null
=== CONT  TestRegistration/parallel/GET_/register/available_returns_M_USER_IN_USE_for_registered_user_name\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 401 Unauthorized (8.785102ms)\n
--- PASS: TestRegistration/parallel/POST_{}_returns_a_set_of_flows (0.01s)\n
null
null
=== CONT  TestRegistration/parallel/GET_/register/available_returns_M_INVALID_USERNAME_for_invalid_user_name\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/register/available => 400 Bad Request (1.595232ms)\n
--- PASS: TestRegistration/parallel/GET_/register/available_returns_M_INVALID_USERNAME_for_invalid_user_name (0.00s)\n
null
null
=== CONT  TestRegistration/parallel/POST_/register_can_create_a_user\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (10.55182ms)\n
    federation_device_list_update_test.go:176: Deploy times: 10.747193ms blueprints, 13.927499132s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (583.239505ms)\n
--- PASS: TestRegistration/parallel/POST_/register_can_create_a_user (0.58s)\n
null
null
=== CONT  TestRegistration/parallel/POST_/register_downcases_capitals_in_usernames\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (583.851951ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (2.350244ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (1.403615ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (4.182911ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (2.50774ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (5.057502ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (7.174906ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (1.436444ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (3.269281ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (1.002773ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (3.38165ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (1.089332ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (5.214629ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (1.083875ms)\n
--- PASS: TestRegistration/parallel/POST_/register_rejects_usernames_with_special_characters (0.64s)\n
null
null
=== CONT  TestRegistration/parallel/GET_/register/available_returns_available_for_unregistered_user_name\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/register/available => 200 OK (5.162751ms)\n
--- PASS: TestRegistration/parallel/GET_/register/available_returns_available_for_unregistered_user_name (0.01s)\n
null
null
=== CONT  TestRegistration/parallel/POST_/register_rejects_if_user_already_exists\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (670.828715ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (674.207512ms)\n
--- PASS: TestRegistration/parallel/POST_/register_returns_the_same_device_id_as_that_in_the_request (0.67s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/register/available => 400 Bad Request (4.664233ms)\n
--- PASS: TestRegistration/parallel/GET_/register/available_returns_M_USER_IN_USE_for_registered_user_name (0.68s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (604.964656ms)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (596.379064ms)\n
--- PASS: TestRegistration/parallel/POST_/register_downcases_capitals_in_usernames (0.60s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (577.34169ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 400 Bad Request (5.447697ms)\n
--- PASS: TestRegistration/parallel/POST_/register_rejects_if_user_already_exists (0.58s)\n
null
--- PASS: TestRegistration/parallel (4.89s)\n
null
2025/02/23 07:13:40 ============================================\n
\n
\n
2025/02/23 07:13:40 603ccc6e24a8c09448cab23bf9864e7bd7273d4d55563ec09e831386c433d516 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=603ccc6e24a8\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 603ccc6e24a8 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266010.3413913,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266010.345701,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266010.345728,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:13:40 ============== 603ccc6e24a8c09448cab23bf9864e7bd7273d4d55563ec09e831386c433d516 : END LOGS ==============\n
\n
\n
--- PASS: TestRegistration (22.07s)\n
null
null
=== RUN   TestRequestEncodingFails\n
    server.go:185: Creating room !0-0kdb2oSOPbT2EUHNYA:host.docker.internal:33915 with version 10\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!0-0kdb2oSOPbT2EUHNYA:host.docker.internal:33915 => 400 Bad Request (127.115512ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:32867/_matrix/client/v3/join/%210-0kdb2oSOPbT2EUHNYA:host.docker.internal:33915?server_name=host.docker.internal%3A33915 returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Answer from host.docker.internal:33915: complement: HandleMakeSendJoinRequests send_join cannot parse event JSON: eventauth: invalid ID: \\"\\""}\u001b[39m\n
2025/02/23 07:13:44 ============================================\n
\n
\n
2025/02/23 07:13:44 af3393ea12adcc42037a9bedeac6d4a428c7f5a372c941bb2b9e850cb93758e4 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=af3393ea12ad\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux af3393ea12ad 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266015.1788342,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266015.1830754,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266015.1831,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "host.docker.internal:33915"  servername:"hs1"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://host.docker.internal:33915/_matrix/federation/v1/make_join/!0-0kdb2oSOPbT2EUHNYA:host.docker.internal:33915/@user-1-alice:hs1?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"content-type": "application/json", "date": "Sat, 22 Feb 2025 23:13:43 GMT", "content-length": "438"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"sender":"@user-1-alice:hs1","room_id":"!0-0kdb2oSOPbT2EUHNYA:host.docker.internal:33915","type":"m.room.member","state_key":"@user-1-alice:hs1","prev_events":["$uEruBE-cjU-EerU1fo8GijCuZ8Dt9vBAQFvOLJUr1F4"],"auth_events":["$Wt70PZXfXAlpF8MKSW22Dz1EOG0qr8aghAELnEnORxE","$uEruBE-cjU-EerU1fo8GijCuZ8Dt9vBAQFvOLJUr1F4","$fomrvocnAIxps2ppHr51pFNW29VaumLzoGSWWpCu0DU"],"depth":5,"content":{"membership":"join"}}) })\n
  \u001b[2m2025-02-22T23:13:43.333549Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://host.docker.internal:33915/_matrix/federation/v2/send_join/!0-0kdb2oSOPbT2EUHNYA:host.docker.internal:33915/$IJ1y_AEfXD3_TWzQyJvLPTR7l7N3C_lsbOmxx4jHhV0?omit_members=false 500 Internal Server Error: complement: HandleMakeSendJoinRequests send_join cannot parse event JSON: eventauth: invalid ID: ""\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
2025/02/23 07:13:44 ============== af3393ea12adcc42037a9bedeac6d4a428c7f5a372c941bb2b9e850cb93758e4 : END LOGS ==============\n
\n
\n
--- FAIL: TestDeviceListsUpdateOverFederationOnRoomJoin (20.43s)\n
null
null
=== RUN   TestUserAppearsInChangedDeviceListOnJoinOverFederation\n
    apidoc_request_encoding_test.go:15: Deploy times: 15.405858ms blueprints, 15.149045026s containers\n
null
=== RUN   TestRequestEncodingFails/POST_rejects_invalid_utf-8_in_JSON\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 401 Unauthorized (11.97173ms)\n
    apidoc_request_encoding_test.go:22: \u001b[31mMatchResponse got status 401 want 400 - http://127.0.0.1:32869/_matrix/client/v3/register => {"flows":[{"stages":["m.login.dummy"]}],"params":null,"session":"IADDaBc3uapdYGg46Sjs2TTIH7bnN3vd"}\u001b[39m\n
--- FAIL: TestRequestEncodingFails/POST_rejects_invalid_utf-8_in_JSON (0.01s)\n
null
2025/02/23 07:13:57 ============================================\n
\n
\n
2025/02/23 07:13:57 dfbb372d48a02cffd630111f9a27aaee03747d4e9cae801443a3a3a41512758f : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=dfbb372d48a0\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux dfbb372d48a0 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266032.7283356,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266032.7329807,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266032.7330065,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:13:57 ============== dfbb372d48a02cffd630111f9a27aaee03747d4e9cae801443a3a3a41512758f : END LOGS ==============\n
\n
\n
--- FAIL: TestRequestEncodingFails (16.68s)\n
null
null
=== RUN   TestRoomAlias\n
    federation_device_list_update_test.go:225: Deploy times: 19.159806ms blueprints, 16.528198749s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (843.42705ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (825.196145ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (98.398848ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/createRoom => 200 OK (575.057786ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (166.135373ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!GeWO8ezwTqlayfOxbF:hs2 => 200 OK (1.305316953s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.024087389s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.047814795s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.026512255s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.024962882s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.032749977s)\n
    federation_device_list_update_test.go:262: \u001b[31m@user-2-joinee:hs2 MustSyncUntil: timed out after 5.157412024s. Seen 5 /sync responses. Checkers:\n
        [t=1.024285035s] Response #1: did not see joiner's user ID in device_lists.changed: \n
        [t=2.072240761s] Response #2: did not see joiner's user ID in device_lists.changed: \n
        [t=3.098910793s] Response #3: did not see joiner's user ID in device_lists.changed: \n
        [t=4.124026815s] Response #4: did not see joiner's user ID in device_lists.changed: \n
        [t=5.157405835s] Response #5: did not see joiner's user ID in device_lists.changed: , \n
        \u001b[39m\n
2025/02/23 07:14:11 ============================================\n
\n
\n
2025/02/23 07:14:11 d94e4eacd0e544abc8ea22f2e0c60496f13a67868d845c49e91cd40f43bcda40 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=d94e4eacd0e5\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux d94e4eacd0e5 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266038.018038,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266038.0245833,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266038.0248883,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:14:11 ============== d94e4eacd0e544abc8ea22f2e0c60496f13a67868d845c49e91cd40f43bcda40 : END LOGS ==============\n
\n
\n
2025/02/23 07:14:13 ============================================\n
\n
\n
2025/02/23 07:14:13 3a049b32977dc74c0839d369edad08adbe4e113e92a32faa4fad1d862ce0266d : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=3a049b32977d\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 3a049b32977d 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266038.1013277,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266038.1100943,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266038.1103666,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs2"  servername:"hs1"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs2:8448/_matrix/federation/v1/make_join/!GeWO8ezwTqlayfOxbF:hs2/@user-1-joiner:hs1?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "956", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:14:03 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$wAvbWGlpXK_j3HBabqaSB_1JLE29zUbKKCHULL7SmSg","$ZDn8dkUoOzvANhNfGo4CThdktIXVLqrN1BEYlp9GQaM","$-wpgvYdFiBEgjOOKJClajF0K4jljzov9G77FmaVU8ik"],"content":{"membership":"join"},"depth":8,"event_sn":12,"hashes":{"sha256":"yLPBQ9JVnm230m24oqsLDAZYjZgbiKNEEiLLT9WiKoE"},"origin":"hs2","origin_server_ts":1740266044316,"prev_events":["$-wpgvYdFiBEgjOOKJClajF0K4jljzov9G77FmaVU8ik","$0SXxYu_ZbHlcWaoJ3Tf9bWKRkHti_l-aqlrn8vC25UM","$GW8YzBARJnjT9SS3s-M8x8JL-Cf48LqeC84iJmVybuE","$OYA0UVz8x3NJ9fpWWzXzi5MTOL3JTwW91j5Bv3tUNwE","$ZDn8dkUoOzvANhNfGo4CThdktIXVLqrN1BEYlp9GQaM","$c_iFlAJW63ka1IUXn8xiLy6gMu-AH9ZPJ3wCdzCW8BU","$wAvbWGlpXK_j3HBabqaSB_1JLE29zUbKKCHULL7SmSg"],"room_id":"!GeWO8ezwTqlayfOxbF:hs2","sender":"@user-1-joiner:hs1","signatures":{"hs2":{"ed25519:LnOeuHdk":"lAQ7iEPYdt3Tvy5mgwuo7v4NcxHVZwFPOIE0sc73IwTh/jHDsv4yzll3zPeIe+cxOb7p7fmCkZxbcoCb2GsWAA"}},"state_key":"@user-1-joiner:hs1","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:14:04.882289Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
2025/02/23 07:14:13 ============== 3a049b32977dc74c0839d369edad08adbe4e113e92a32faa4fad1d862ce0266d : END LOGS ==============\n
\n
\n
--- FAIL: TestUserAppearsInChangedDeviceListOnJoinOverFederation (28.49s)\n
null
null
=== RUN   TestEventAuth\n
    apidoc_room_alias_test.go:64: Deploy times: 13.860742ms blueprints, 16.021459473s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (613.877468ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (632.262202ms)\n
null
=== RUN   TestRoomAlias/Parallel\n
null
=== RUN   TestRoomAlias/Parallel/PUT_/directory/room/:room_alias_creates_alias\n
=== PAUSE TestRoomAlias/Parallel/PUT_/directory/room/:room_alias_creates_alias\n
null
null
=== RUN   TestRoomAlias/Parallel/GET_/rooms/:room_id/aliases_lists_aliases\n
=== PAUSE TestRoomAlias/Parallel/GET_/rooms/:room_id/aliases_lists_aliases\n
null
null
=== RUN   TestRoomAlias/Parallel/Only_room_members_can_list_aliases_of_a_room\n
=== PAUSE TestRoomAlias/Parallel/Only_room_members_can_list_aliases_of_a_room\n
null
null
=== RUN   TestRoomAlias/Parallel/Room_aliases_can_contain_Unicode\n
=== PAUSE TestRoomAlias/Parallel/Room_aliases_can_contain_Unicode\n
null
null
=== CONT  TestRoomAlias/Parallel/PUT_/directory/room/:room_alias_creates_alias\n
null
=== CONT  TestRoomAlias/Parallel/Only_room_members_can_list_aliases_of_a_room\n
null
=== CONT  TestRoomAlias/Parallel/GET_/rooms/:room_id/aliases_lists_aliases\n
null
=== CONT  TestRoomAlias/Parallel/Room_aliases_can_contain_Unicode\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (452.206747ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#creates_alias:hs1 => 200 OK (29.667921ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/directory/room/#creates_alias:hs1 => 200 OK (10.140373ms)\n
--- PASS: TestRoomAlias/Parallel/PUT_/directory/room/:room_alias_creates_alias (0.49s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.868294407s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.889127492s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#老虎Â£я🤨👉ඞ:hs1 => 200 OK (22.023681ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/directory/room/#老虎Â£я🤨👉ඞ:hs1 => 200 OK (3.946377ms)\n
--- PASS: TestRoomAlias/Parallel/Room_aliases_can_contain_Unicode (1.90s)\n
null
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#room_members_list:hs1 => 200 OK (10.693523ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/directory/room/#room_members_list:hs1 => 200 OK (4.896011ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.906346768s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!gBzpyNHKz5eq7pyLZ9:hs1/aliases => 403 Forbidden (7.015819ms)\n
--- PASS: TestRoomAlias/Parallel/Only_room_members_can_list_aliases_of_a_room (1.91s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!9j7NzkmFeSc9pme8CS:hs1/aliases => 200 OK (7.274085ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#lists_aliases:hs1 => 200 OK (4.666767ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!9j7NzkmFeSc9pme8CS:hs1/aliases => 200 OK (5.787276ms)\n
--- PASS: TestRoomAlias/Parallel/GET_/rooms/:room_id/aliases_lists_aliases (1.92s)\n
null
--- PASS: TestRoomAlias/Parallel (0.00s)\n
null
2025/02/23 07:14:18 ============================================\n
\n
\n
2025/02/23 07:14:18 1e59bcae375afceae7ab4f839f4e01bccb73516bc3cdaef63e87e581e257fd8f : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=1e59bcae375a\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 1e59bcae375a 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266050.530876,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266050.5362704,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266050.5362961,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 19\n
To many layers, we have to go deeper frame_id: 20\n
To many layers, we have to go deeper frame_id: 21\n
2025/02/23 07:14:18 ============== 1e59bcae375afceae7ab4f839f4e01bccb73516bc3cdaef63e87e581e257fd8f : END LOGS ==============\n
\n
\n
--- PASS: TestRoomAlias (20.69s)\n
null
null
=== RUN   TestRoomDeleteAlias\n
    federation_event_auth_test.go:32: Deploy times: 9.959513ms blueprints, 15.225072247s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (562.837774ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (352.867048ms)\n
    federation_event_auth_test.go:63: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 49 52 52 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!BKCowQpLtuBeXLVtrM:hs1/$bO7PkvNljvOcU-V-PbamtPeDtWD6euhrT1YcnY6rR-E") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1144\u001b[39m\n
    apidoc_room_alias_test.go:190: Deploy times: 8.354865ms blueprints, 14.611857743s containers\n
2025/02/23 07:14:33 ============================================\n
\n
\n
2025/02/23 07:14:33 c5d7c14fe1326740d1ca385ddacb9951d85de3aafeff32c78ddde0318b30e5f0 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=c5d7c14fe132\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux c5d7c14fe132 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266065.6204545,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266065.6249278,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266065.6249583,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:14:33 ============== c5d7c14fe1326740d1ca385ddacb9951d85de3aafeff32c78ddde0318b30e5f0 : END LOGS ==============\n
\n
\n
--- FAIL: TestEventAuth (19.72s)\n
null
null
=== RUN   TestInboundFederationKeys\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (589.281561ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (626.801133ms)\n
null
=== RUN   TestRoomDeleteAlias/Parallel\n
null
=== RUN   TestRoomDeleteAlias/Parallel/Alias_creators_can_delete_alias_with_no_ops\n
=== PAUSE TestRoomDeleteAlias/Parallel/Alias_creators_can_delete_alias_with_no_ops\n
null
null
=== RUN   TestRoomDeleteAlias/Parallel/Alias_creators_can_delete_canonical_alias_with_no_ops\n
=== PAUSE TestRoomDeleteAlias/Parallel/Alias_creators_can_delete_canonical_alias_with_no_ops\n
null
null
=== RUN   TestRoomDeleteAlias/Parallel/Deleting_a_non-existent_alias_should_return_a_404\n
=== PAUSE TestRoomDeleteAlias/Parallel/Deleting_a_non-existent_alias_should_return_a_404\n
null
null
=== RUN   TestRoomDeleteAlias/Parallel/Can_delete_canonical_alias\n
=== PAUSE TestRoomDeleteAlias/Parallel/Can_delete_canonical_alias\n
null
null
=== RUN   TestRoomDeleteAlias/Parallel/Regular_users_can_add_and_delete_aliases_in_the_default_room_configuration\n
=== PAUSE TestRoomDeleteAlias/Parallel/Regular_users_can_add_and_delete_aliases_in_the_default_room_configuration\n
null
null
=== RUN   TestRoomDeleteAlias/Parallel/Regular_users_can_add_and_delete_aliases_when_m.room.aliases_is_restricted\n
=== PAUSE TestRoomDeleteAlias/Parallel/Regular_users_can_add_and_delete_aliases_when_m.room.aliases_is_restricted\n
null
null
=== RUN   TestRoomDeleteAlias/Parallel/Users_can't_delete_other's_aliases\n
=== PAUSE TestRoomDeleteAlias/Parallel/Users_can't_delete_other's_aliases\n
null
null
=== RUN   TestRoomDeleteAlias/Parallel/Users_with_sufficient_power-level_can_delete_other's_aliases\n
=== PAUSE TestRoomDeleteAlias/Parallel/Users_with_sufficient_power-level_can_delete_other's_aliases\n
null
null
=== CONT  TestRoomDeleteAlias/Parallel/Alias_creators_can_delete_alias_with_no_ops\n
null
=== CONT  TestRoomDeleteAlias/Parallel/Regular_users_can_add_and_delete_aliases_in_the_default_room_configuration\n
null
=== CONT  TestRoomDeleteAlias/Parallel/Users_with_sufficient_power-level_can_delete_other's_aliases\n
null
=== CONT  TestRoomDeleteAlias/Parallel/Users_can't_delete_other's_aliases\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.798463941s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.807426248s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.820975533s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.851422672s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!MhYmIfyEwWAVRLliuu:hs1/invite => 200 OK (518.225527ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!DO21hF6Apy6lFNXFfa:hs1/invite => 200 OK (526.760533ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!nJ9NrKdnBdnY4k58DQ:hs1/invite => 200 OK (519.805747ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!FyiJZbxzbA6gyCyrOK:hs1 => 200 OK (498.646412ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!MhYmIfyEwWAVRLliuu:hs1 => 200 OK (516.704957ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!DO21hF6Apy6lFNXFfa:hs1 => 200 OK (518.025348ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#random_alias_4:hs1 => 200 OK (19.844623ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/directory/room/#random_alias_4:hs1 => 200 OK (6.27634ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!nJ9NrKdnBdnY4k58DQ:hs1 => 200 OK (548.514419ms)\n
    client.go:706: [CSAPI] DELETE hs1/_matrix/client/v3/directory/room/#random_alias_4:hs1 => 403 Forbidden (47.018494ms)\n
--- PASS: TestRoomDeleteAlias/Parallel/Users_can't_delete_other's_aliases (2.92s)\n
null
null
=== CONT  TestRoomDeleteAlias/Parallel/Regular_users_can_add_and_delete_aliases_when_m.room.aliases_is_restricted\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (656.054674ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#no_ops_delete:hs1 => 200 OK (22.13008ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/directory/room/#no_ops_delete:hs1 => 200 OK (7.747095ms)\n
    client.go:706: [CSAPI] DELETE hs1/_matrix/client/v3/directory/room/#no_ops_delete:hs1 => 200 OK (48.345424ms)\n
--- PASS: TestRoomDeleteAlias/Parallel/Alias_creators_can_delete_alias_with_no_ops (3.09s)\n
null
null
=== CONT  TestRoomDeleteAlias/Parallel/Deleting_a_non-existent_alias_should_return_a_404\n
    client.go:706: [CSAPI] DELETE hs1/_matrix/client/v3/directory/room/#scatman_portal:hs1 => 404 Not Found (19.394519ms)\n
--- PASS: TestRoomDeleteAlias/Parallel/Deleting_a_non-existent_alias_should_return_a_404 (0.02s)\n
null
null
=== CONT  TestRoomDeleteAlias/Parallel/Can_delete_canonical_alias\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!MhYmIfyEwWAVRLliuu:hs1/state/m.room.power_levels/ => 200 OK (441.085874ms)\n
    apidoc_room_alias_test.go:428: SendEventSynced waiting for event ID $IQIV1mb5zNaOpRGXX2Qn4bK6a74vie6cpAoH913tc2I\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.862364235s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.856525s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#random_alias:hs1 => 200 OK (47.704783ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!W4EqGqsAwvrdihFnIB:hs1/state/m.room.canonical_alias/ => 200 OK (391.948913ms)\n
    apidoc_room_alias_test.go:56: SendEventSynced waiting for event ID $82gRo3LSmsoZyXSIzuD1Qj36Dp8YdlN-NKFAzZ_Vo5U\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!YXZXgTts1nKlbK8umc:hs1/invite => 200 OK (671.454832ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.907455124s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#random_alias_2:hs1 => 200 OK (40.191308ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/directory/room/#random_alias_2:hs1 => 200 OK (9.167634ms)\n
    client.go:706: [CSAPI] DELETE hs1/_matrix/client/v3/directory/room/#random_alias_2:hs1 => 200 OK (72.955842ms)\n
--- PASS: TestRoomDeleteAlias/Parallel/Regular_users_can_add_and_delete_aliases_in_the_default_room_configuration (5.92s)\n
null
null
=== CONT  TestRoomDeleteAlias/Parallel/Alias_creators_can_delete_canonical_alias_with_no_ops\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!YXZXgTts1nKlbK8umc:hs1 => 200 OK (607.031333ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.165640367s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#random_alias_5:hs1 => 200 OK (30.284114ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/directory/room/#random_alias_5:hs1 => 200 OK (8.002748ms)\n
    client.go:706: [CSAPI] DELETE hs1/_matrix/client/v3/directory/room/#random_alias_5:hs1 => 200 OK (75.23551ms)\n
--- PASS: TestRoomDeleteAlias/Parallel/Users_with_sufficient_power-level_can_delete_other's_aliases (6.56s)\n
null
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!YXZXgTts1nKlbK8umc:hs1/state/m.room.power_levels/ => 200 OK (651.610059ms)\n
    apidoc_room_alias_test.go:352: SendEventSynced waiting for event ID $NlZlfu6QhLVgOlN7oEcJKCKlB_DhtpoOTGUBTppYUaY\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.744385019s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!aaZ1NOCSUDDgmtqKps:hs1 => 200 OK (394.940849ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.505464139s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.261708298s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#random_alias_3:hs1 => 200 OK (15.712048ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/directory/room/#random_alias_3:hs1 => 200 OK (4.955519ms)\n
    client.go:706: [CSAPI] DELETE hs1/_matrix/client/v3/directory/room/#random_alias_3:hs1 => 200 OK (34.128939ms)\n
--- PASS: TestRoomDeleteAlias/Parallel/Regular_users_can_add_and_delete_aliases_when_m.room.aliases_is_restricted (7.11s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.383763149s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#no_ops_delete_canonical:hs1 => 200 OK (10.573563ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/directory/room/#no_ops_delete_canonical:hs1 => 200 OK (3.374599ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!aaZ1NOCSUDDgmtqKps:hs1/state/m.room.canonical_alias/ => 200 OK (162.943519ms)\n
    apidoc_room_alias_test.go:56: SendEventSynced waiting for event ID $ldVkkwyXXlzck9zD3aAQ0lGni7OBSL6ybRjmk56stOk\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.619788298s)\n
    client.go:706: [CSAPI] DELETE hs1/_matrix/client/v3/directory/room/#random_alias:hs1 => 200 OK (209.504348ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (542.774454ms)\n
--- PASS: TestRoomDeleteAlias/Parallel/Can_delete_canonical_alias (9.18s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.90205386s)\n
    client.go:706: [CSAPI] DELETE hs1/_matrix/client/v3/directory/room/#no_ops_delete_canonical:hs1 => 200 OK (47.388177ms)\n
--- PASS: TestRoomDeleteAlias/Parallel/Alias_creators_can_delete_canonical_alias_with_no_ops (6.65s)\n
null
--- PASS: TestRoomDeleteAlias/Parallel (0.00s)\n
null
2025/02/23 07:14:47 ============================================\n
\n
\n
2025/02/23 07:14:47 ca769e551bbb4d061085ca1ca8f1a4073c92e184ea033ff7cd70ef8780550dfb : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=ca769e551bbb\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux ca769e551bbb 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266069.7878933,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266069.7943182,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266069.794348,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 17\n
To many layers, we have to go deeper frame_id: 18\n
To many layers, we have to go deeper frame_id: 19\n
To many layers, we have to go deeper frame_id: 20\n
To many layers, we have to go deeper frame_id: 41\n
To many layers, we have to go deeper frame_id: 42\n
To many layers, we have to go deeper frame_id: 53\n
  \u001b[2m2025-02-22T23:14:46.541252Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33muser cannot send event\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:380\n
\n
2025/02/23 07:14:47 ============== ca769e551bbb4d061085ca1ca8f1a4073c92e184ea033ff7cd70ef8780550dfb : END LOGS ==============\n
\n
\n
--- PASS: TestRoomDeleteAlias (29.84s)\n
null
null
=== RUN   TestRoomCanonicalAlias\n
    federation_keys_test.go:29: Deploy times: 8.954164ms blueprints, 15.794971432s containers\n
2025/02/23 07:14:50 ============================================\n
\n
\n
2025/02/23 07:14:50 89443c72e5e4c675a0923f050a1b9d3c8c72ae89e2f1585615fd9fd6435b7dee : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=89443c72e5e4\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 89443c72e5e4 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266085.7541974,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266085.7586863,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266085.7587192,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:14:50 ============== 89443c72e5e4c675a0923f050a1b9d3c8c72ae89e2f1585615fd9fd6435b7dee : END LOGS ==============\n
\n
\n
--- PASS: TestInboundFederationKeys (17.61s)\n
null
null
=== RUN   TestContentMediaV1\n
    apidoc_room_alias_test.go:461: Deploy times: 9.069988ms blueprints, 19.640848592s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (764.723688ms)\n
null
=== RUN   TestRoomCanonicalAlias/Parallel\n
null
=== RUN   TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_accepts_present_aliases\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (819.835505ms)\n
=== PAUSE TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_accepts_present_aliases\n
null
null
=== RUN   TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_missing_aliases\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (993.252867ms)\n
=== PAUSE TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_missing_aliases\n
null
null
=== RUN   TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_invalid_aliases\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.016980973s)\n
=== PAUSE TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_invalid_aliases\n
null
null
=== RUN   TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_setting_rejects_deleted_aliases\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.091780058s)\n
=== PAUSE TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_setting_rejects_deleted_aliases\n
null
null
=== RUN   TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_alias_pointing_to_different_local_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (874.812322ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (670.788492ms)\n
=== PAUSE TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_alias_pointing_to_different_local_room\n
null
null
=== RUN   TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_accepts_present_alt_aliases\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (519.492257ms)\n
=== PAUSE TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_accepts_present_alt_aliases\n
null
null
=== RUN   TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_missing_aliases#01\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (701.278133ms)\n
=== PAUSE TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_missing_aliases#01\n
null
null
=== RUN   TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_invalid_aliases#01\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (407.516002ms)\n
=== PAUSE TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_invalid_aliases#01\n
null
null
=== RUN   TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_alt_alias_pointing_to_different_local_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (513.071689ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (478.488239ms)\n
=== PAUSE TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_alt_alias_pointing_to_different_local_room\n
null
null
=== CONT  TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_accepts_present_aliases\n
null
=== CONT  TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_alt_alias_pointing_to_different_local_room\n
null
=== CONT  TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_invalid_aliases#01\n
null
=== CONT  TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_missing_aliases#01\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#accepts_present_aliases:hs1 => 200 OK (9.488586ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#alt_room1:hs1 => 200 OK (27.026641ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#alt_missing:hs1 => 200 OK (35.265963ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#alt_invalid:hs1 => 200 OK (44.065107ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#alt_room2:hs1 => 200 OK (41.962805ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!M9OV2ti7pEgWfK4o8C:hs1/state/m.room.canonical_alias => 400 Bad Request (31.541449ms)\n
--- PASS: TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_invalid_aliases#01 (0.48s)\n
null
null
=== CONT  TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_missing_aliases\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!nhmMLMUTUVzxy8zBvR:hs1/state/m.room.canonical_alias => 400 Bad Request (21.062388ms)\n
--- PASS: TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_alt_alias_pointing_to_different_local_room (1.09s)\n
null
null
=== CONT  TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_accepts_present_alt_aliases\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!09IDRl8g0cDdmpgkrT:hs1/state/m.room.canonical_alias => 400 Bad Request (71.386909ms)\n
--- PASS: TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_missing_aliases#01 (0.81s)\n
null
null
=== CONT  TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_alias_pointing_to_different_local_room\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!nAmzXKw0ummSF0abbx:hs1/state/m.room.canonical_alias => 400 Bad Request (30.822692ms)\n
--- PASS: TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_missing_aliases (1.02s)\n
null
null
=== CONT  TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_setting_rejects_deleted_aliases\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#alt_present_alias:hs1 => 200 OK (12.41277ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#deleted_aliases:hs1 => 200 OK (13.316835ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#diffroom1:hs1 => 200 OK (17.612987ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!QF15D37FuFq9rzlsCD:hs1/state/m.room.canonical_alias => 400 Bad Request (18.683652ms)\n
--- PASS: TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_alias_pointing_to_different_local_room (1.58s)\n
null
null
=== CONT  TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_invalid_aliases\n
    client.go:706: [CSAPI] DELETE hs1/_matrix/client/v3/directory/room/#deleted_aliases:hs1 => 200 OK (33.605705ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!hARlTb5wXqoXQW37Zi:hs1/state/m.room.canonical_alias => 400 Bad Request (11.790207ms)\n
--- PASS: TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_rejects_invalid_aliases (1.03s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/directory/room/#deleted_aliases:hs1 => 404 Not Found (12.034343ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!NjlwWVlYQKIB0rpiNr:hs1/state/m.room.canonical_alias => 400 Bad Request (14.404936ms)\n
--- PASS: TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_setting_rejects_deleted_aliases (1.17s)\n
null
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!bpqXBLZxl8OMxygACO:hs1/state/m.room.canonical_alias/ => 200 OK (208.299931ms)\n
    apidoc_room_alias_test.go:56: SendEventSynced waiting for event ID $D-dcnmeWzPorhO4Dk9Bd7QqBggz7mcyZJIpYX6ktUGk\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!TYadzo0rRPvsAe7Db7:hs1/state/m.room.canonical_alias/ => 200 OK (211.342973ms)\n
    apidoc_room_alias_test.go:56: SendEventSynced waiting for event ID $PZh-eXczOOaeeIG1SLz0nAusIM6Aru7yn5R65xy0kGM\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.564887721s)\n
--- PASS: TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_accepts_present_alt_aliases (2.31s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.709719365s)\n
--- PASS: TestRoomCanonicalAlias/Parallel/m.room.canonical_alias_accepts_present_aliases (2.75s)\n
null
--- PASS: TestRoomCanonicalAlias/Parallel (8.09s)\n
null
    federation_media_content_test.go:12: Deploy times: 11.391198ms blueprints, 28.360143933s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (732.021517ms)\n
2025/02/23 07:15:19 ============================================\n
\n
\n
2025/02/23 07:15:19 752227e7b4f3d75e1569993d507b6eacfb4d8b8ad1f575ba403f27f2ea48aa36 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=752227e7b4f3\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 752227e7b4f3 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266103.7296157,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266103.7476554,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266103.7476823,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 11\n
To many layers, we have to go deeper frame_id: 17\n
To many layers, we have to go deeper frame_id: 23\n
To many layers, we have to go deeper frame_id: 29\n
To many layers, we have to go deeper frame_id: 35\n
To many layers, we have to go deeper frame_id: 41\n
To many layers, we have to go deeper frame_id: 47\n
To many layers, we have to go deeper frame_id: 53\n
To many layers, we have to go deeper frame_id: 59\n
To many layers, we have to go deeper frame_id: 65\n
2025/02/23 07:15:19 ============== 752227e7b4f3d75e1569993d507b6eacfb4d8b8ad1f575ba403f27f2ea48aa36 : END LOGS ==============\n
\n
\n
--- PASS: TestRoomCanonicalAlias (32.14s)\n
null
null
=== RUN   TestRoomCreate\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (763.623077ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (41.767091ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v1/media/download/hs1/Y20BQQJ3P56A3DQEX4BQ1SVDHR => 200 OK (589.180729ms)\n
2025/02/23 07:15:22 ============================================\n
\n
\n
2025/02/23 07:15:22 2858bf59197029ac04c0b42c121d00f09451e0befe2e56d1f0536ebddf5d4757 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=2858bf591970\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 2858bf591970 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266114.9045203,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266114.9152498,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266114.9152882,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:15:22 ============== 2858bf59197029ac04c0b42c121d00f09451e0befe2e56d1f0536ebddf5d4757 : END LOGS ==============\n
\n
\n
2025/02/23 07:15:24 ============================================\n
\n
\n
2025/02/23 07:15:24 a1d7cef4ac97499ece5af0f85819c58a87bf0b06b1f93366d12c999bcb37d30c : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=a1d7cef4ac97\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux a1d7cef4ac97 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266114.982421,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266114.989775,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266114.9899907,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:15:24 ============== a1d7cef4ac97499ece5af0f85819c58a87bf0b06b1f93366d12c999bcb37d30c : END LOGS ==============\n
\n
\n
--- PASS: TestContentMediaV1 (33.69s)\n
null
null
=== RUN   TestRemotePresence\n
    apidoc_room_create_test.go:17: Deploy times: 13.86721ms blueprints, 21.140607015s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (598.389866ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (701.646277ms)\n
null
=== RUN   TestRoomCreate/Parallel\n
null
=== RUN   TestRoomCreate/Parallel/POST_/createRoom_makes_a_public_room\n
=== PAUSE TestRoomCreate/Parallel/POST_/createRoom_makes_a_public_room\n
null
null
=== RUN   TestRoomCreate/Parallel/POST_/createRoom_makes_a_private_room\n
=== PAUSE TestRoomCreate/Parallel/POST_/createRoom_makes_a_private_room\n
null
null
=== RUN   TestRoomCreate/Parallel/POST_/createRoom_makes_a_room_with_a_topic\n
=== PAUSE TestRoomCreate/Parallel/POST_/createRoom_makes_a_room_with_a_topic\n
null
null
=== RUN   TestRoomCreate/Parallel/POST_/createRoom_makes_a_room_with_a_name\n
=== PAUSE TestRoomCreate/Parallel/POST_/createRoom_makes_a_room_with_a_name\n
null
null
=== RUN   TestRoomCreate/Parallel/POST_/createRoom_creates_a_room_with_the_given_version\n
=== PAUSE TestRoomCreate/Parallel/POST_/createRoom_creates_a_room_with_the_given_version\n
null
null
=== RUN   TestRoomCreate/Parallel/POST_/createRoom_makes_a_private_room_with_invites\n
=== PAUSE TestRoomCreate/Parallel/POST_/createRoom_makes_a_private_room_with_invites\n
null
null
=== RUN   TestRoomCreate/Parallel/POST_/createRoom_rejects_attempts_to_create_rooms_with_numeric_versions\n
=== PAUSE TestRoomCreate/Parallel/POST_/createRoom_rejects_attempts_to_create_rooms_with_numeric_versions\n
null
null
=== RUN   TestRoomCreate/Parallel/POST_/createRoom_rejects_attempts_to_create_rooms_with_unknown_versions\n
=== PAUSE TestRoomCreate/Parallel/POST_/createRoom_rejects_attempts_to_create_rooms_with_unknown_versions\n
null
null
=== RUN   TestRoomCreate/Parallel/Rooms_can_be_created_with_an_initial_invite_list_(SYN-205)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (530.718117ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (33.421338ms)\n
--- PASS: TestRoomCreate/Parallel/Rooms_can_be_created_with_an_initial_invite_list_(SYN-205) (0.56s)\n
null
null
=== RUN   TestRoomCreate/Parallel/Can_/sync_newly_created_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (336.465026ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!cBFOPi2jkog8ameoyM:hs1/send/m.room.test/1 => 200 OK (55.650606ms)\n
    apidoc_room_create_test.go:161: SendEventSynced waiting for event ID $aP_TEtNVi5LW6APciTz-MAfMaFMv2ycLA6835MFjreI\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (188.315598ms)\n
--- PASS: TestRoomCreate/Parallel/Can_/sync_newly_created_room (0.58s)\n
null
null
=== RUN   TestRoomCreate/Parallel/POST_/createRoom_ignores_attempts_to_set_the_room_version_via_creation_content\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (619.622839ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (128.719207ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (157.784324ms)\n
--- PASS: TestRoomCreate/Parallel/POST_/createRoom_ignores_attempts_to_set_the_room_version_via_creation_content (0.91s)\n
null
null
=== CONT  TestRoomCreate/Parallel/POST_/createRoom_makes_a_public_room\n
null
=== CONT  TestRoomCreate/Parallel/POST_/createRoom_makes_a_private_room_with_invites\n
null
=== CONT  TestRoomCreate/Parallel/POST_/createRoom_rejects_attempts_to_create_rooms_with_unknown_versions\n
null
=== CONT  TestRoomCreate/Parallel/POST_/createRoom_rejects_attempts_to_create_rooms_with_numeric_versions\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (325.342431ms)\n
--- PASS: TestRoomCreate/Parallel/POST_/createRoom_makes_a_public_room (0.33s)\n
null
null
=== CONT  TestRoomCreate/Parallel/POST_/createRoom_makes_a_room_with_a_name\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 400 Bad Request (333.597857ms)\n
null
=== CONT  TestRoomCreate/Parallel/POST_/createRoom_creates_a_room_with_the_given_version\n
--- PASS: TestRoomCreate/Parallel/POST_/createRoom_rejects_attempts_to_create_rooms_with_unknown_versions (0.33s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 400 Bad Request (336.495792ms)\n
--- PASS: TestRoomCreate/Parallel/POST_/createRoom_rejects_attempts_to_create_rooms_with_numeric_versions (0.34s)\n
null
null
=== CONT  TestRoomCreate/Parallel/POST_/createRoom_makes_a_room_with_a_topic\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 400 Bad Request (13.403075ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:32889/_matrix/client/v3/createRoom returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNSUPPORTED_ROOM_VERSION","error":"This server does not support that room version."}\u001b[39m\n
--- FAIL: TestRoomCreate/Parallel/POST_/createRoom_creates_a_room_with_the_given_version (0.01s)\n
null
null
=== CONT  TestRoomCreate/Parallel/POST_/createRoom_makes_a_private_room\n
    federation_presence_test.go:15: Deploy times: 8.938071ms blueprints, 21.014257017s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (691.099433ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (683.230096ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.070082107s)\n
--- PASS: TestRoomCreate/Parallel/POST_/createRoom_makes_a_private_room (2.07s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.267154314s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.303851154s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!PeyWRgcBky7skdiOCO:hs1/state/m.room.topic => 200 OK (39.668796ms)\n
--- PASS: TestRoomCreate/Parallel/POST_/createRoom_makes_a_room_with_a_topic (2.31s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!thfgupPLTLlHWfZ7lw:hs1/state/m.room.name => 200 OK (27.041474ms)\n
--- PASS: TestRoomCreate/Parallel/POST_/createRoom_makes_a_room_with_a_name (2.33s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.674883114s)\n
--- PASS: TestRoomCreate/Parallel/POST_/createRoom_makes_a_private_room_with_invites (2.68s)\n
null
--- FAIL: TestRoomCreate/Parallel (2.05s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (545.926187ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!PUEmQ6D76vg2ZNz8Vs:hs1 => 200 OK (966.447277ms)\n
null
=== RUN   TestRemotePresence/Presence_changes_are_also_reported_to_remote_room_members\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (81.503596ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/presence/@user-1-alice:hs1/status => 200 OK (9.245321ms)\n
2025/02/23 07:15:48 ============================================\n
\n
\n
2025/02/23 07:15:48 9882639f649ae3a052f7736274f0173ba6903af0d6c38ca45ae025942b8e37fe : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=9882639f649a\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 9882639f649a 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266138.1437967,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266138.1513572,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266138.1514792,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
To many layers, we have to go deeper frame_id: 18\n
To many layers, we have to go deeper frame_id: 24\n
To many layers, we have to go deeper frame_id: 43\n
To many layers, we have to go deeper frame_id: 44\n
To many layers, we have to go deeper frame_id: 45\n
To many layers, we have to go deeper frame_id: 46\n
2025/02/23 07:15:48 ============== 9882639f649ae3a052f7736274f0173ba6903af0d6c38ca45ae025942b8e37fe : END LOGS ==============\n
\n
\n
--- FAIL: TestRoomCreate (28.71s)\n
null
null
=== RUN   TestRoomForget\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.03323434s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.034211312s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.033829703s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.040006631s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.03761745s)\n
    federation_presence_test.go:37: \u001b[31m@user-2-bob:hs2 MustSyncUntil: timed out after 5.180060345s. Seen 5 /sync responses. Checkers:\n
        [t=1.033390703s] Response #1: presence.events does not exist\n
        [t=2.068181866s] Response #2: presence.events does not exist\n
        [t=3.102157967s] Response #3: presence.events does not exist\n
        [t=4.142298699s] Response #4: presence.events does not exist\n
        [t=5.18005724s] Response #5: presence.events does not exist, \n
        \u001b[39m\n
--- FAIL: TestRemotePresence/Presence_changes_are_also_reported_to_remote_room_members (5.27s)\n
null
null
=== RUN   TestRemotePresence/Presence_changes_to_UNAVAILABLE_are_reported_to_remote_room_members\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (48.120395ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/presence/@user-1-alice:hs1/status => 200 OK (15.938757ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.044874582s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.039181244s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.045126339s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.026365983s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.023459063s)\n
    federation_presence_test.go:53: \u001b[31m@user-2-bob:hs2 MustSyncUntil: timed out after 5.1809276s. Seen 5 /sync responses. Checkers:\n
        [t=1.045267272s] Response #1: presence.events does not exist\n
        [t=2.084617279s] Response #2: presence.events does not exist\n
        [t=3.130743957s] Response #3: presence.events does not exist\n
        [t=4.157268578s] Response #4: presence.events does not exist\n
        [t=5.180918707s] Response #5: presence.events does not exist, \n
        \u001b[39m\n
--- FAIL: TestRemotePresence/Presence_changes_to_UNAVAILABLE_are_reported_to_remote_room_members (5.25s)\n
null
2025/02/23 07:16:00 ============================================\n
\n
\n
2025/02/23 07:16:00 dfbc17d994359b9c193611b4b5bf6a89faa32337e4f5a1cf0878213d6268c386 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=dfbc17d99435\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux dfbc17d99435 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266141.9687955,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266141.9762516,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266141.9762936,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs1:8448/_matrix/federation/v1/make_join/!PUEmQ6D76vg2ZNz8Vs:hs1/@user-2-bob:hs2?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "903", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:15:46 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$NtjWx0OWolXez_LD0X92f0iVrXqSyBsBQbrjgVPFmh4","$_fUGPJ7VXiHI8eB37Y7ZlF8ds2i7yrbxdZWaUwr7_I8","$RaudTSdf6jPdk76SvfY4hd4qyUTSZnuuQk0j5730_54"],"content":{"membership":"join"},"depth":7,"event_sn":10,"hashes":{"sha256":"k8zQU7aVB/fl+6VhSKGACt953qkeNHySyehzEFyle5w"},"origin":"hs1","origin_server_ts":1740266147689,"prev_events":["$-pwnmgd9xDYBxliPKf9LUApphyrZwOr7nmkR_cVwEkA","$NtjWx0OWolXez_LD0X92f0iVrXqSyBsBQbrjgVPFmh4","$RaudTSdf6jPdk76SvfY4hd4qyUTSZnuuQk0j5730_54","$_22h2GzTRKV2I5zIfXU_BxRBU6vOydv7gpXmDU4cPAg","$_fUGPJ7VXiHI8eB37Y7ZlF8ds2i7yrbxdZWaUwr7_I8","$pZzRzkMiJlkg_YbIIZgES9ugE-XAcJICLujd2nmV--c"],"room_id":"!PUEmQ6D76vg2ZNz8Vs:hs1","sender":"@user-2-bob:hs2","signatures":{"hs1":{"ed25519:GZPOSwy2":"o3w6If8dMc2EGhqlVNrO4js7bcyqxKlJPZsAM7uwwVRAYmOq+A5dj510zV+XJZWFzcHdj+qr3pNQfbPHoQoNBQ"}},"state_key":"@user-2-bob:hs2","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:15:48.065906Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
2025/02/23 07:16:00 ============== dfbc17d994359b9c193611b4b5bf6a89faa32337e4f5a1cf0878213d6268c386 : END LOGS ==============\n
\n
\n
2025/02/23 07:16:02 ============================================\n
\n
\n
2025/02/23 07:16:02 5503e134832d2778a7ba64eb709650bae6158b4c5be683af2c8a37281ca5e1af : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=5503e134832d\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 5503e134832d 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266141.9781075,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266141.9832368,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266141.983723,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:16:02 ============== 5503e134832d2778a7ba64eb709650bae6158b4c5be683af2c8a37281ca5e1af : END LOGS ==============\n
\n
\n
--- FAIL: TestRemotePresence (38.62s)\n
null
null
=== RUN   TestOutboundFederationProfile\n
    apidoc_room_forget_test.go:21: Deploy times: 8.048297ms blueprints, 15.40948301s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (864.486328ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (743.916682ms)\n
null
=== RUN   TestRoomForget/Parallel\n
null
=== RUN   TestRoomForget/Parallel/Can't_forget_room_you're_still_in\n
=== PAUSE TestRoomForget/Parallel/Can't_forget_room_you're_still_in\n
null
null
=== RUN   TestRoomForget/Parallel/Forgotten_room_messages_cannot_be_paginated\n
=== PAUSE TestRoomForget/Parallel/Forgotten_room_messages_cannot_be_paginated\n
null
null
=== RUN   TestRoomForget/Parallel/Forgetting_room_does_not_show_up_in_v2_initial_/sync\n
=== PAUSE TestRoomForget/Parallel/Forgetting_room_does_not_show_up_in_v2_initial_/sync\n
null
null
=== RUN   TestRoomForget/Parallel/Leave_for_forgotten_room_shows_up_in_v2_incremental_/sync\n
=== PAUSE TestRoomForget/Parallel/Leave_for_forgotten_room_shows_up_in_v2_incremental_/sync\n
null
null
=== RUN   TestRoomForget/Parallel/Can_forget_room_you've_been_kicked_from\n
=== PAUSE TestRoomForget/Parallel/Can_forget_room_you've_been_kicked_from\n
null
null
=== RUN   TestRoomForget/Parallel/Can_re-join_room_if_re-invited\n
=== PAUSE TestRoomForget/Parallel/Can_re-join_room_if_re-invited\n
null
null
=== RUN   TestRoomForget/Parallel/Can_forget_room_we_weren't_an_actual_member\n
=== PAUSE TestRoomForget/Parallel/Can_forget_room_we_weren't_an_actual_member\n
null
null
=== CONT  TestRoomForget/Parallel/Can't_forget_room_you're_still_in\n
null
=== CONT  TestRoomForget/Parallel/Leave_for_forgotten_room_shows_up_in_v2_incremental_/sync\n
null
=== CONT  TestRoomForget/Parallel/Can_forget_room_we_weren't_an_actual_member\n
null
=== CONT  TestRoomForget/Parallel/Can_forget_room_you've_been_kicked_from\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.034091651s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!kUm4IerfVTzs5tjY0C:hs1/forget => 400 Bad Request (26.873ms)\n
--- PASS: TestRoomForget/Parallel/Can't_forget_room_you're_still_in (1.06s)\n
null
null
=== CONT  TestRoomForget/Parallel/Can_re-join_room_if_re-invited\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (3.819420231s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (3.863556003s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.828131211s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (3.890911156s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!9y6wW50cXzFQUBTtcH:hs1 => 200 OK (876.157658ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!9OH1MRkUDesDqHinpD:hs1/invite => 200 OK (861.991409ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!7xuaLf57WJZbmpNRfe:hs1 => 200 OK (890.474712ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!f1UDFj0hYER94fDlwZ:hs1/invite => 200 OK (882.604854ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!9y6wW50cXzFQUBTtcH:hs1/send/m.room.message/1 => 200 OK (438.789678ms)\n
    apidoc_room_forget_test.go:111: SendEventSynced waiting for event ID $1oIpOJQXKKpBi3Fy15lqsMHdCepfJhtZd9GPT3W3Vb8\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!9OH1MRkUDesDqHinpD:hs1/send/m.room.join_rules/2 => 200 OK (430.586591ms)\n
    apidoc_room_forget_test.go:183: SendEventSynced waiting for event ID $uk6y0fjVWDga5dZzB5dUElZmET-ly4_9ShFCa-TJRvM\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!7xuaLf57WJZbmpNRfe:hs1/send/m.room.message/3 => 200 OK (467.876277ms)\n
    apidoc_room_forget_test.go:149: SendEventSynced waiting for event ID $UfD9aHtb-chqwhc1Ahkt1dRJksNC7l1DwTd4eMgzcgY\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!f1UDFj0hYER94fDlwZ:hs1/leave => 200 OK (679.389296ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!f1UDFj0hYER94fDlwZ:hs1/forget => 200 OK (43.662863ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!f1UDFj0hYER94fDlwZ:hs1/leave => 200 OK (623.863857ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!f1UDFj0hYER94fDlwZ:hs1/forget => 200 OK (30.927188ms)\n
--- PASS: TestRoomForget/Parallel/Can_forget_room_we_weren't_an_actual_member (6.15s)\n
null
null
=== CONT  TestRoomForget/Parallel/Forgotten_room_messages_cannot_be_paginated\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.597631169s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.071629387s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.024807197s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!lafmvp5UheBYEEUhiU:hs1 => 200 OK (546.553017ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.196241836s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!lafmvp5UheBYEEUhiU:hs1/send/m.room.message/4 => 200 OK (444.976314ms)\n
    apidoc_room_forget_test.go:44: SendEventSynced waiting for event ID $fNkyQ3E0PonhfIz3ZH1LrkU-81kTabIs56TI6dJQ8ak\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!7xuaLf57WJZbmpNRfe:hs1/kick => 200 OK (612.737276ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!9OH1MRkUDesDqHinpD:hs1 => 200 OK (614.556343ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!9OH1MRkUDesDqHinpD:hs1/send/m.room.message/5 => 200 OK (410.367466ms)\n
    apidoc_room_forget_test.go:191: SendEventSynced waiting for event ID $A5qsb82LM-5Cq7BrOdTIP9my1sE0pPdN3tFFO1rPUBo\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.762174932s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.610245769s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.641477274s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!9y6wW50cXzFQUBTtcH:hs1/leave => 200 OK (645.636881ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!lafmvp5UheBYEEUhiU:hs1/leave => 200 OK (672.610549ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!lafmvp5UheBYEEUhiU:hs1/forget => 200 OK (21.12313ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!lafmvp5UheBYEEUhiU:hs1/messages => 403 Forbidden (17.675691ms)\n
--- PASS: TestRoomForget/Parallel/Forgotten_room_messages_cannot_be_paginated (6.91s)\n
null
null
=== CONT  TestRoomForget/Parallel/Forgetting_room_does_not_show_up_in_v2_initial_/sync\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.984779007s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!9OH1MRkUDesDqHinpD:hs1/leave => 200 OK (442.327834ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.475353388s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.229268728s)\n
--- PASS: TestRoomForget/Parallel/Can_forget_room_you've_been_kicked_from (14.73s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.188238242s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!9y6wW50cXzFQUBTtcH:hs1/forget => 200 OK (13.258698ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!U2ccV9BnPZe0oIFTdZ:hs1 => 200 OK (428.83283ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!9y6wW50cXzFQUBTtcH:hs1/send/m.room.message/1 => 200 OK (278.625578ms)\n
    apidoc_room_forget_test.go:123: SendEventSynced waiting for event ID $ETZZ6GO4SMsMSqbKmFEDMqaSyokfQED83Pdi5h4FSn0\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!U2ccV9BnPZe0oIFTdZ:hs1/send/m.room.message/6 => 200 OK (331.757508ms)\n
    apidoc_room_forget_test.go:66: SendEventSynced waiting for event ID $OXuW3Y2vT8X60FWiPLXzprdeIgsC425iEhnQssI_JJ8\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.257056552s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!9OH1MRkUDesDqHinpD:hs1/forget => 200 OK (22.448036ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!9OH1MRkUDesDqHinpD:hs1 => 403 Forbidden (263.99374ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!9OH1MRkUDesDqHinpD:hs1/invite => 200 OK (345.909786ms)\n
    federation_query_profile_test.go:25: Deploy times: 46.686937ms blueprints, 19.638663979s containers\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.815285433s)\n
null
=== RUN   TestOutboundFederationProfile/Outbound_federation_can_query_profile_data\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/profile/@user:host.docker.internal:41561/displayname => 200 OK (52.058149ms)\n
--- PASS: TestOutboundFederationProfile/Outbound_federation_can_query_profile_data (0.05s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!9OH1MRkUDesDqHinpD:hs1 => 200 OK (491.925074ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.942201486s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!U2ccV9BnPZe0oIFTdZ:hs1/leave => 200 OK (347.244397ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!9OH1MRkUDesDqHinpD:hs1/messages => 200 OK (548.030941ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!9OH1MRkUDesDqHinpD:hs1/send/m.room.message/7 => 200 OK (357.569026ms)\n
    apidoc_room_forget_test.go:229: SendEventSynced waiting for event ID $L-_cG4i4JRR3ID25Uzc3MU9_WFsqJZGJ2nrXP3Jat2Q\n
2025/02/23 07:16:24 ============================================\n
\n
\n
2025/02/23 07:16:24 811fff0a4e5e26b7830e337ce22dcf6b1b2f44c8a5143c67b431892e5e54adc6 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=811fff0a4e5e\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 811fff0a4e5e 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266179.4337318,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266179.43992,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266179.4399521,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:16:24 ============== 811fff0a4e5e26b7830e337ce22dcf6b1b2f44c8a5143c67b431892e5e54adc6 : END LOGS ==============\n
\n
\n
--- PASS: TestOutboundFederationProfile (21.74s)\n
null
null
=== RUN   TestInboundFederationProfile\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.348753088s)\n
--- PASS: TestRoomForget/Parallel/Leave_for_forgotten_room_shows_up_in_v2_incremental_/sync (19.26s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.830747303s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.419798706s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!U2ccV9BnPZe0oIFTdZ:hs1/forget => 200 OK (13.295904ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!9OH1MRkUDesDqHinpD:hs1/messages => 200 OK (264.921533ms)\n
--- PASS: TestRoomForget/Parallel/Can_re-join_room_if_re-invited (19.16s)\n
null
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!U2ccV9BnPZe0oIFTdZ:hs1/send/m.room.message/2 => 200 OK (291.998949ms)\n
    apidoc_room_forget_test.go:77: SendEventSynced waiting for event ID $5FdBK-v_1BnlziW_nklXgxoAbUOnT2fJENCD2SBr6uY\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (642.401059ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (486.430625ms)\n
--- PASS: TestRoomForget/Parallel/Forgetting_room_does_not_show_up_in_v2_initial_/sync (8.38s)\n
null
--- PASS: TestRoomForget/Parallel (0.00s)\n
null
2025/02/23 07:16:28 ============================================\n
\n
\n
2025/02/23 07:16:28 a9fc7457e6597dd391e9ba61d48a045874f61034bb1f6003bdfddfe325b69b29 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=a9fc7457e659\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux a9fc7457e659 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266160.0493064,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266160.0568364,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266160.0568929,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 23\n
To many layers, we have to go deeper frame_id: 24\n
To many layers, we have to go deeper frame_id: 25\n
To many layers, we have to go deeper frame_id: 26\n
To many layers, we have to go deeper frame_id: 41\n
To many layers, we have to go deeper frame_id: 53\n
2025/02/23 07:16:28 ============== a9fc7457e6597dd391e9ba61d48a045874f61034bb1f6003bdfddfe325b69b29 : END LOGS ==============\n
\n
\n
--- PASS: TestRoomForget (40.01s)\n
null
null
=== RUN   TestFetchEvent\n
    federation_query_profile_test.go:69: Deploy times: 26.315143ms blueprints, 17.942590911s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (656.84186ms)\n
null
=== RUN   TestInboundFederationProfile/Non-numeric_ports_in_server_names_are_rejected\n
    server.go:297: [SSAPI] GET hs1/_matrix/federation/v1/query/profile?user_id=@user1:localhost:http&field=displayname => 400 (151.198709ms)\n
--- PASS: TestInboundFederationProfile/Non-numeric_ports_in_server_names_are_rejected (0.15s)\n
null
null
=== RUN   TestInboundFederationProfile/Inbound_federation_can_query_profile_data\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/profile/@user-1:hs1/displayname => 200 OK (14.266861ms)\n
    server.go:297: [SSAPI] GET hs1/_matrix/federation/v1/query/profile?user_id=@user-1:hs1&field=displayname => 200 (23.335226ms)\n
--- PASS: TestInboundFederationProfile/Inbound_federation_can_query_profile_data (0.04s)\n
null
    apidoc_room_history_visibility_test.go:41: Deploy times: 8.75675ms blueprints, 17.44760139s containers\n
2025/02/23 07:16:46 ============================================\n
\n
\n
2025/02/23 07:16:46 2fc65015bf3df27b09a415204db610286b173c7c0b18d730b5315f58dc5f9a67 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=2fc65015bf3d\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 2fc65015bf3d 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266199.4077594,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266199.4203918,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266199.420436,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:16:46 ============== 2fc65015bf3df27b09a415204db610286b173c7c0b18d730b5315f58dc5f9a67 : END LOGS ==============\n
\n
\n
--- PASS: TestInboundFederationProfile (21.76s)\n
null
null
=== RUN   TestFederationRedactSendsWithoutEvent\n
    federation_redaction_test.go:17: WARNING: TestFederationRedactSendsWithoutEvent called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (659.498001ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (577.820655ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (440.147293ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!TdKSC4JnhiIXkGzjc3:hs1 => 200 OK (149.230808ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (168.42074ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!TdKSC4JnhiIXkGzjc3:hs1/send/m.room.message/1 => 200 OK (157.07647ms)\n
    apidoc_room_history_visibility_test.go:53: SendEventSynced waiting for event ID $lom0ib3qSpVtvsEDLOeF0ajRrfqet6HkB3an2m3bUlM\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (104.18365ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!TdKSC4JnhiIXkGzjc3:hs1/event/$lom0ib3qSpVtvsEDLOeF0ajRrfqet6HkB3an2m3bUlM => 200 OK (9.046915ms)\n
2025/02/23 07:16:50 ============================================\n
\n
\n
2025/02/23 07:16:50 386a1983eb74a3050fb3694263762b7d24dea26cfda38cb8a3535b875d275e26 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=386a1983eb74\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 386a1983eb74 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266203.0851214,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266203.090435,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266203.0905323,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:16:50 ============== 386a1983eb74a3050fb3694263762b7d24dea26cfda38cb8a3535b875d275e26 : END LOGS ==============\n
\n
\n
--- PASS: TestFetchEvent (21.33s)\n
null
null
=== RUN   TestFetchHistoricalJoinedEventDenied\n
    federation_redaction_test.go:19: Deploy times: 9.562857ms blueprints, 17.126816858s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (843.502505ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/capabilities => 200 OK (5.038814ms)\n
    server.go:185: Creating room !0-bkw79ctBgaBxArZUg3:host.docker.internal:39565 with version 10\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/#flibble:host.docker.internal:39565 => 400 Bad Request (74.334658ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:32903/_matrix/client/v3/join/%23flibble:host.docker.internal:39565?server_name=host.docker.internal%3A39565 returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Answer from host.docker.internal:39565: {\\n\\t\\t\\t\\t\\"errcode\\": \\"M_NOT_FOUND\\",\\n\\t\\t\\t\\t\\"error\\": \\"Room alias not found.\\"\\n\\t\\t\\t}"}\u001b[39m\n
    apidoc_room_history_visibility_test.go:87: Deploy times: 13.936915ms blueprints, 16.950161228s containers\n
2025/02/23 07:17:07 ============================================\n
\n
\n
2025/02/23 07:17:07 04357593bdb59b9616189fb11d30b9ee5c56a3b76eb73cb9260feb5b204f384f : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=04357593bdb5\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 04357593bdb5 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266219.839605,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266219.8445332,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266219.8445578,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
  \u001b[2m2025-02-22T23:17:05.570708Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://host.docker.internal:39565/_matrix/federation/v1/query/directory?room_alias=#flibble:host.docker.internal:39565 404 Not Found: {\n
\t\t\t\t"errcode": "M_NOT_FOUND",\n
\t\t\t\t"error": "Room alias not found."\n
\t\t\t}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
2025/02/23 07:17:07 ============== 04357593bdb59b9616189fb11d30b9ee5c56a3b76eb73cb9260feb5b204f384f : END LOGS ==============\n
\n
\n
--- FAIL: TestFederationRedactSendsWithoutEvent (20.73s)\n
null
null
=== RUN   TestRemoteAliasRequestsUnderstandUnicode\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (761.848192ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (706.267053ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (696.626397ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!f5ThziG5nCeHvYct1y:hs1/send/m.room.message/1 => 200 OK (132.676319ms)\n
    apidoc_room_history_visibility_test.go:95: SendEventSynced waiting for event ID $yClBdpBFmzdqpi5EZdCuPhVFn7tHh9wJRLXpdzwhIfo\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (242.748568ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!f5ThziG5nCeHvYct1y:hs1 => 200 OK (294.858364ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (181.008442ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!f5ThziG5nCeHvYct1y:hs1/event/$yClBdpBFmzdqpi5EZdCuPhVFn7tHh9wJRLXpdzwhIfo => 404 Not Found (15.568743ms)\n
2025/02/23 07:17:11 ============================================\n
\n
\n
2025/02/23 07:17:11 13a7c0ea1c9693f2c429556269228b92ad1032714d29537a156ca86b1edc8ad6 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=13a7c0ea1c96\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 13a7c0ea1c96 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266223.240093,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266223.245088,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266223.2452896,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:17:11 ============== 13a7c0ea1c9693f2c429556269228b92ad1032714d29537a156ca86b1edc8ad6 : END LOGS ==============\n
\n
\n
--- PASS: TestFetchHistoricalJoinedEventDenied (21.82s)\n
null
null
=== RUN   TestFetchHistoricalSharedEvent\n
    federation_room_alias_test.go:15: Deploy times: 9.609547ms blueprints, 21.937658772s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (640.860118ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (622.437898ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (396.318483ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/room/#老虎Â£я🤨👉ඞ:hs1 => 200 OK (7.491562ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/directory/room/#老虎Â£я🤨👉ඞ:hs1 => 400 Bad Request (121.39139ms)\n
    federation_room_alias_test.go:30: \u001b[31mMatchResponse got status 400 want 200 - http://127.0.0.1:32907/_matrix/client/v3/directory/room/%E8%81%!E(MISSING)8%8E%!C(MISSING)3%C2%!A(MISSING)3%!D(MISSING)1%!F(MISSING)%!F(MISSING)0%!F(MISSING)%!A(MISSING)4%!A(MISSING)8%!F(MISSING)0%!F(MISSING)%89%!E(MISSING)0%!B(MISSING)6%!E(MISSING):hs1 => {"errcode":"M_UNKNOWN","error":"unknown error happened."}\u001b[39m\n
    apidoc_room_history_visibility_test.go:116: Deploy times: 11.734683ms blueprints, 19.600154993s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (643.060297ms)\n
2025/02/23 07:17:32 ============================================\n
\n
\n
2025/02/23 07:17:32 d8fad6c24c766a0b838db18f7a2e169a1ec261d0bc42cb5b00eee01c1d8ada81 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=d8fad6c24c76\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux d8fad6c24c76 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266245.9406781,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266245.9482067,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266245.948307,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:17:32 ============== d8fad6c24c766a0b838db18f7a2e169a1ec261d0bc42cb5b00eee01c1d8ada81 : END LOGS ==============\n
\n
\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (545.874778ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (503.073769ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!d5OzIXgFzEFF5IHIwr:hs1/send/m.room.message/1 => 200 OK (71.293389ms)\n
    apidoc_room_history_visibility_test.go:124: SendEventSynced waiting for event ID $6zxTPIc3PLOciS-W1EoqvUrfHaffhX0hGI_8Ng-n1gE\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (111.021301ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!d5OzIXgFzEFF5IHIwr:hs1 => 200 OK (79.558059ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (94.46498ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!d5OzIXgFzEFF5IHIwr:hs1/event/$6zxTPIc3PLOciS-W1EoqvUrfHaffhX0hGI_8Ng-n1gE => 200 OK (9.463268ms)\n
2025/02/23 07:17:33 ============================================\n
\n
\n
2025/02/23 07:17:33 e94d678be664c18536d8afab41856385231eed709e5c7f2535bb967dbfbae60c : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=e94d678be664\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux e94d678be664 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266245.9827588,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266245.9877157,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266245.9880264,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:17:33 ============== e94d678be664c18536d8afab41856385231eed709e5c7f2535bb967dbfbae60c : END LOGS ==============\n
\n
\n
--- FAIL: TestRemoteAliasRequestsUnderstandUnicode (26.55s)\n
null
null
=== RUN   TestUnbanViaInvite\n
2025/02/23 07:17:35 ============================================\n
\n
\n
2025/02/23 07:17:35 abedc3b17325be8febcbb12a23ed50bed4b35b718735836b080c5d6bb41b1525 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=abedc3b17325\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux abedc3b17325 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266248.4561067,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266248.4614913,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266248.4615254,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:17:35 ============== abedc3b17325be8febcbb12a23ed50bed4b35b718735836b080c5d6bb41b1525 : END LOGS ==============\n
\n
\n
--- PASS: TestFetchHistoricalSharedEvent (23.18s)\n
null
null
=== RUN   TestFetchHistoricalInvitedEventFromBetweenInvite\n
    federation_room_ban_test.go:15: Deploy times: 9.063529ms blueprints, 18.167779908s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (610.499259ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (658.647226ms)\n
    apidoc_room_history_visibility_test.go:160: Deploy times: 11.290767ms blueprints, 18.319252361s containers\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/createRoom => 200 OK (517.74953ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (628.035409ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!Wpq4MJZ9edjm0wcfGR:hs2 => 200 OK (829.181543ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (634.243927ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/rooms/!Wpq4MJZ9edjm0wcfGR:hs2/ban => 200 OK (156.537794ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (80.141274ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (509.823215ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!VeySHJR8nidr7qbXec:hs1/invite => 200 OK (140.595422ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (35.465381ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!VeySHJR8nidr7qbXec:hs1/send/m.room.message/1 => 200 OK (139.594641ms)\n
    apidoc_room_history_visibility_test.go:171: SendEventSynced waiting for event ID $NolTuMEv1a2woUTITs2wR-y79pSFmZ-d8pTvg1-fZbg\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (238.289231ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.102291019s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!VeySHJR8nidr7qbXec:hs1 => 200 OK (159.567426ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (202.834655ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!VeySHJR8nidr7qbXec:hs1/event/$NolTuMEv1a2woUTITs2wR-y79pSFmZ-d8pTvg1-fZbg => 200 OK (21.960936ms)\n
2025/02/23 07:17:57 ============================================\n
\n
\n
2025/02/23 07:17:57 2b56826f10f7a1d61f1875cf145073ea816a8ebd48344b6147091a5511e508a7 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=2b56826f10f7\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 2b56826f10f7 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266270.2924871,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266270.300548,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266270.3010747,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:17:57 ============== 2b56826f10f7a1d61f1875cf145073ea816a8ebd48344b6147091a5511e508a7 : END LOGS ==============\n
\n
\n
--- PASS: TestFetchHistoricalInvitedEventFromBetweenInvite (22.54s)\n
null
null
=== RUN   TestFetchHistoricalInvitedEventFromBeforeInvite\n
    client.go:704: [CSAPI] GET hs1/_matrix/client/v3/sync => error: EOF (1.914871104s)\n
    federation_room_ban_test.go:30: \u001b[31mCSAPI.Do response returned error: Get "http://127.0.0.1:32913/_matrix/client/v3/sync?since=15&timeout=1000": EOF\u001b[39m\n
2025/02/23 07:17:59 ============================================\n
\n
\n
2025/02/23 07:17:59 ffd26191acdf436024d7aeaa853d39e1d068846ab8377e18f7d06e9302b7f891 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=ffd26191acdf\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux ffd26191acdf 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266268.6748724,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266268.6830416,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266268.6830685,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:17:59 ============== ffd26191acdf436024d7aeaa853d39e1d068846ab8377e18f7d06e9302b7f891 : END LOGS ==============\n
\n
\n
2025/02/23 07:18:01 ============================================\n
\n
\n
2025/02/23 07:18:01 adc8129b14810a3ea76833278e57d930248fbf23c9d857c8c49e9201d9750bcf : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=adc8129b1481\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux adc8129b1481 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266268.670759,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266268.6812258,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266268.6819952,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs2"  servername:"hs1"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs2:8448/_matrix/federation/v1/make_join/!Wpq4MJZ9edjm0wcfGR:hs2/@user-1:hs1?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "895", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:17:53 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$LMxTnA4b5kzHDm2QPILAYAPgoq5F8c7dT4432PC3PEs","$4KexIvdb408aUpfbzS4G4HN88dClsHBgnaXWyrQvUqY","$vJFa-pcDs90wA18D6W5zg38AjEOBroTs8vl7NbiQdjw"],"content":{"membership":"join"},"depth":7,"event_sn":10,"hashes":{"sha256":"B85wmdrKqchHDMALmqW+ssYkBaKyNAbZIOThb63w1Wo"},"origin":"hs2","origin_server_ts":1740266274089,"prev_events":["$4KexIvdb408aUpfbzS4G4HN88dClsHBgnaXWyrQvUqY","$AJxjufCFFFhlV8WY26qbA74xZAtjVcD6xbSa8d8l5y8","$GLZ1EslEsuzNgX_B69-acFw0eFIHs03T3HUo0qmOAeY","$LMxTnA4b5kzHDm2QPILAYAPgoq5F8c7dT4432PC3PEs","$tRbX4XSKkPnS2zVcsDUYoGEa3Cg8PvOX0-SMIvrLlvE","$vJFa-pcDs90wA18D6W5zg38AjEOBroTs8vl7NbiQdjw"],"room_id":"!Wpq4MJZ9edjm0wcfGR:hs2","sender":"@user-1:hs1","signatures":{"hs2":{"ed25519:zkw0NoOK":"S7d+li7yObD5BOq9/BGF+CPKumWLBr9UQeOSS6tx/wVHBqNJ/jPyB3z/yXPTVfp489IB8DG5qr430bbF5OzFDg"}},"state_key":"@user-1:hs1","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:17:54.406404Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
  \u001b[2m2025-02-22T23:17:56.437630Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::room::auth_chain\u001b[0m\u001b[33m: \u001b[33mCould not find pdu mentioned in auth events, \u001b[1;33mevent_id\u001b[0m\u001b[33m: "$GLZ1EslEsuzNgX_B69-acFw0eFIHs03T3HUo0qmOAeY"\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/room/auth_chain.rs:106\n
\n
  \u001b[2m2025-02-22T23:17:56.442143Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::room::auth_chain\u001b[0m\u001b[33m: \u001b[33mCould not find pdu mentioned in auth events, \u001b[1;33mevent_id\u001b[0m\u001b[33m: "$vJFa-pcDs90wA18D6W5zg38AjEOBroTs8vl7NbiQdjw"\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/room/auth_chain.rs:106\n
\n
  \u001b[2m2025-02-22T23:17:56.443613Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::room::auth_chain\u001b[0m\u001b[33m: \u001b[33mCould not find pdu mentioned in auth events, \u001b[1;33mevent_id\u001b[0m\u001b[33m: "$LCnaky0NHYplFiJY27SD38E5Pfz-Ix0Dr3Cq5-JeMLg"\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/room/auth_chain.rs:106\n
\n
  \u001b[2m2025-02-22T23:17:56.451269Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::room::auth_chain\u001b[0m\u001b[33m: \u001b[33mCould not find pdu mentioned in auth events, \u001b[1;33mevent_id\u001b[0m\u001b[33m: "$tRbX4XSKkPnS2zVcsDUYoGEa3Cg8PvOX0-SMIvrLlvE"\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/room/auth_chain.rs:106\n
\n
  \u001b[2m2025-02-22T23:17:56.459518Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::room::auth_chain\u001b[0m\u001b[33m: \u001b[33mCould not find pdu mentioned in auth events, \u001b[1;33mevent_id\u001b[0m\u001b[33m: "$AJxjufCFFFhlV8WY26qbA74xZAtjVcD6xbSa8d8l5y8"\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/room/auth_chain.rs:106\n
\n
  \u001b[2m2025-02-22T23:17:56.464689Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::room::auth_chain\u001b[0m\u001b[33m: \u001b[33mCould not find pdu mentioned in auth events, \u001b[1;33mevent_id\u001b[0m\u001b[33m: "$4KexIvdb408aUpfbzS4G4HN88dClsHBgnaXWyrQvUqY"\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/room/auth_chain.rs:106\n
\n
  \u001b[2m2025-02-22T23:17:56.741243Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $tRbX4XSKkPnS2zVcsDUYoGEa3Cg8PvOX0-SMIvrLlvE failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
To many layers, we have to go deeper frame_id: 7\n
To many layers, we have to go deeper frame_id: 8\n
To many layers, we have to go deeper frame_id: 9\n
To many layers, we have to go deeper frame_id: 10\n
To many layers, we have to go deeper frame_id: 11\n
To many layers, we have to go deeper frame_id: 14\n
To many layers, we have to go deeper frame_id: 15\n
\n
thread 'tokio-runtime-worker' panicked at /rustc/4d91de4e48198da2e33413efdcd9cd2cc0c46688/library/core/src/time.rs:1138:31:\n
overflow when subtracting durations\n
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\n
\n
thread 'tokio-runtime-worker' panicked at crates/server/src/routing/client/mod.rs:286:10:\n
When sync channel changes it's always set to some\n
  \u001b[2m2025-02-22T23:17:57.857261Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::routing::client\u001b[0m\u001b[31m: \u001b[31mError waiting for sync: channel closed\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/routing/client/mod.rs:279\n
\n
  \u001b[2m2025-02-22T23:17:57.865285Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::routing::client\u001b[0m\u001b[31m: \u001b[31mError waiting for sync: channel closed\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/routing/client/mod.rs:279\n
\n
\n
thread 'tokio-runtime-worker' panicked at crates/server/src/routing/client/mod.rs:286:10:\n
When sync channel changes it's always set to some\n
2025/02/23 07:18:01 ============== adc8129b14810a3ea76833278e57d930248fbf23c9d857c8c49e9201d9750bcf : END LOGS ==============\n
\n
\n
--- FAIL: TestUnbanViaInvite (27.37s)\n
null
null
=== RUN   TestInboundFederationRejectsEventsWithRejectedAuthEvents\n
    apidoc_room_history_visibility_test.go:207: Deploy times: 10.693683ms blueprints, 22.717081358s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (661.154563ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (590.095959ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (716.159092ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!nijdhqU8F7YG2StD9j:hs1/send/m.room.message/1 => 200 OK (77.832664ms)\n
    apidoc_room_history_visibility_test.go:215: SendEventSynced waiting for event ID $IMQcfkIUsLKi5PNN_Q7NgVgT3gAwuz8GvuC-Cj9_yQw\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (105.176338ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!nijdhqU8F7YG2StD9j:hs1/invite => 200 OK (133.619383ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (25.024078ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!nijdhqU8F7YG2StD9j:hs1 => 200 OK (107.832281ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (139.63979ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!nijdhqU8F7YG2StD9j:hs1/event/$IMQcfkIUsLKi5PNN_Q7NgVgT3gAwuz8GvuC-Cj9_yQw => 404 Not Found (10.749737ms)\n
    federation_room_event_auth_test.go:77: Deploy times: 14.598639ms blueprints, 22.090465494s containers\n
2025/02/23 07:18:24 ============================================\n
\n
\n
2025/02/23 07:18:24 3f5b2b1e55705ceb27fd8a4a571494231061486a812f280f1f67c56541b1f905 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=3f5b2b1e5570\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 3f5b2b1e5570 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266297.2669096,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266297.2729995,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266297.273332,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:18:24 ============== 3f5b2b1e55705ceb27fd8a4a571494231061486a812f280f1f67c56541b1f905 : END LOGS ==============\n
\n
\n
--- PASS: TestFetchHistoricalInvitedEventFromBeforeInvite (26.73s)\n
null
null
=== RUN   TestFetchEventNonWorldReadable\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (674.687183ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (399.188103ms)\n
    federation_room_event_auth_test.go:117: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 49 52 52 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!M7KF2Q7SV31Ui0iHv5:hs1/$e1gKXy_bWE79lHanPW69COM2twNe9dRU2cHqwWsuQAY") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1144\u001b[39m\n
2025/02/23 07:18:27 ============================================\n
\n
\n
2025/02/23 07:18:27 23e20f2424d4cb5425fa15c606652beb3bd8da2c9ea78d1eee9ef8e268874fc7 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=23e20f2424d4\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 23e20f2424d4 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266300.1220276,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266300.132527,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266300.132601,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:18:27 ============== 23e20f2424d4cb5425fa15c606652beb3bd8da2c9ea78d1eee9ef8e268874fc7 : END LOGS ==============\n
\n
\n
--- FAIL: TestInboundFederationRejectsEventsWithRejectedAuthEvents (26.62s)\n
null
null
=== RUN   TestGetMissingEventsGapFilling\n
    apidoc_room_history_visibility_test.go:240: Deploy times: 18.493527ms blueprints, 14.909020883s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (550.977958ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (603.958991ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (443.712077ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!sDGfBppLjHQhIsI84Y:hs1/send/m.room.message/1 => 200 OK (73.972906ms)\n
    apidoc_room_history_visibility_test.go:248: SendEventSynced waiting for event ID $JNIDTZ89bhgNz7z27rRlUivQEydt9yy5o6jh6rvy0LE\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (119.861125ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!sDGfBppLjHQhIsI84Y:hs1/event/$JNIDTZ89bhgNz7z27rRlUivQEydt9yy5o6jh6rvy0LE => 404 Not Found (10.094555ms)\n
    federation_room_get_missing_events_test.go:46: Deploy times: 21.101366ms blueprints, 14.131180715s containers\n
2025/02/23 07:18:42 ============================================\n
\n
\n
2025/02/23 07:18:42 10de8bda1a8438e850fefea91c44ae6bfcf72c1fab06ba200864392eff0e2976 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=10de8bda1a84\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 10de8bda1a84 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266316.3745291,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266316.3806286,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266316.3809404,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:18:42 ============== 10de8bda1a8438e850fefea91c44ae6bfcf72c1fab06ba200864392eff0e2976 : END LOGS ==============\n
\n
\n
--- PASS: TestFetchEventNonWorldReadable (18.30s)\n
null
null
=== RUN   TestFetchEventWorldReadable\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (660.724469ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (484.405618ms)\n
    federation_room_get_missing_events_test.go:71: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 49 51 54 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!GfoAHVqSQjpR01vRm9:hs1/$VH6hUe2KD17Dyx84PFxvvAyipbf0MaVUioKqbalVf3Y") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1136\u001b[39m\n
2025/02/23 07:18:45 ============================================\n
\n
\n
2025/02/23 07:18:45 052ff635e5ea8d30012d05aa252bb296caf74f0d20df0bb688179798ba86c64e : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=052ff635e5ea\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 052ff635e5ea 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266319.0258656,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266319.0312054,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266319.0312295,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:18:45 ============== 052ff635e5ea8d30012d05aa252bb296caf74f0d20df0bb688179798ba86c64e : END LOGS ==============\n
\n
\n
--- FAIL: TestGetMissingEventsGapFilling (17.62s)\n
null
null
=== RUN   TestOutboundFederationIgnoresMissingEventWithBadJSONForRoomVersion6\n
    apidoc_room_history_visibility_test.go:266: Deploy times: 11.416126ms blueprints, 16.349488977s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (677.209764ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (657.606384ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (640.117304ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!MMq1wMNgrpVQfMggXu:hs1/send/m.room.message/1 => 200 OK (90.174536ms)\n
    apidoc_room_history_visibility_test.go:274: SendEventSynced waiting for event ID $XAbUKnVwRheTRB2pko0cAf5OSdRqTeKXUbcE3qC_Uck\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (154.855542ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!MMq1wMNgrpVQfMggXu:hs1/event/$XAbUKnVwRheTRB2pko0cAf5OSdRqTeKXUbcE3qC_Uck => 200 OK (38.82548ms)\n
    federation_room_get_missing_events_test.go:170: Deploy times: 10.746812ms blueprints, 16.014197822s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (935.878291ms)\n
2025/02/23 07:19:03 ============================================\n
\n
\n
2025/02/23 07:19:03 ae800714fe3d7f1deff4f324b88fd88b25bff1887573914140b1cd8be8551ecc : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=ae800714fe3d\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux ae800714fe3d 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266335.8747935,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266335.8790526,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266335.87909,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:19:03 ============== ae800714fe3d7f1deff4f324b88fd88b25bff1887573914140b1cd8be8551ecc : END LOGS ==============\n
\n
\n
--- PASS: TestFetchEventWorldReadable (20.50s)\n
null
null
=== RUN   TestRoomMembers\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/capabilities => 200 OK (10.075506ms)\n
    server.go:185: Creating room !0-p9LE9YOcMhwiVqymDf:host.docker.internal:45005 with version 10\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/#flibble:host.docker.internal:45005 => 400 Bad Request (69.317966ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:32929/_matrix/client/v3/join/%23flibble:host.docker.internal:45005 returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Answer from host.docker.internal:45005: {\\n\\t\\t\\t\\t\\"errcode\\": \\"M_NOT_FOUND\\",\\n\\t\\t\\t\\t\\"error\\": \\"Room alias not found.\\"\\n\\t\\t\\t}"}\u001b[39m\n
2025/02/23 07:19:06 ============================================\n
\n
\n
2025/02/23 07:19:06 2da95cc283ee7b0fbf6585fac5f3317e5862f7944e3e88f189b59a829309f21f : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=2da95cc283ee\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 2da95cc283ee 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266337.9083052,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266337.9151692,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266337.915569,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
  \u001b[2m2025-02-22T23:19:05.163560Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://host.docker.internal:45005/_matrix/federation/v1/query/directory?room_alias=#flibble:host.docker.internal:45005 404 Not Found: {\n
\t\t\t\t"errcode": "M_NOT_FOUND",\n
\t\t\t\t"error": "Room alias not found."\n
\t\t\t}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
2025/02/23 07:19:06 ============== 2da95cc283ee7b0fbf6585fac5f3317e5862f7944e3e88f189b59a829309f21f : END LOGS ==============\n
\n
\n
--- FAIL: TestOutboundFederationIgnoresMissingEventWithBadJSONForRoomVersion6 (21.43s)\n
null
null
=== RUN   TestInboundCanReturnMissingEvents\n
    apidoc_room_members_test.go:17: Deploy times: 32.093266ms blueprints, 17.931382162s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (636.940249ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (618.942427ms)\n
null
=== RUN   TestRoomMembers/Parallel\n
null
=== RUN   TestRoomMembers/Parallel/POST_/rooms/:room_id/join_can_join_a_room\n
=== PAUSE TestRoomMembers/Parallel/POST_/rooms/:room_id/join_can_join_a_room\n
null
null
=== RUN   TestRoomMembers/Parallel/POST_/join/:room_alias_can_join_a_room\n
=== PAUSE TestRoomMembers/Parallel/POST_/join/:room_alias_can_join_a_room\n
null
null
=== RUN   TestRoomMembers/Parallel/POST_/join/:room_id_can_join_a_room\n
=== PAUSE TestRoomMembers/Parallel/POST_/join/:room_id_can_join_a_room\n
null
null
=== RUN   TestRoomMembers/Parallel/Test_that_we_can_be_reinvited_to_a_room_we_created\n
=== PAUSE TestRoomMembers/Parallel/Test_that_we_can_be_reinvited_to_a_room_we_created\n
null
null
=== RUN   TestRoomMembers/Parallel/POST_/join/:room_id_can_join_a_room_with_custom_content\n
=== PAUSE TestRoomMembers/Parallel/POST_/join/:room_id_can_join_a_room_with_custom_content\n
null
null
=== RUN   TestRoomMembers/Parallel/POST_/join/:room_alias_can_join_a_room_with_custom_content\n
=== PAUSE TestRoomMembers/Parallel/POST_/join/:room_alias_can_join_a_room_with_custom_content\n
null
null
=== RUN   TestRoomMembers/Parallel/POST_/rooms/:room_id/ban_can_ban_a_user\n
=== PAUSE TestRoomMembers/Parallel/POST_/rooms/:room_id/ban_can_ban_a_user\n
null
null
=== RUN   TestRoomMembers/Parallel/POST_/rooms/:room_id/invite_can_send_an_invite\n
=== PAUSE TestRoomMembers/Parallel/POST_/rooms/:room_id/invite_can_send_an_invite\n
null
null
=== RUN   TestRoomMembers/Parallel/POST_/rooms/:room_id/leave_can_leave_a_room\n
=== PAUSE TestRoomMembers/Parallel/POST_/rooms/:room_id/leave_can_leave_a_room\n
null
null
=== CONT  TestRoomMembers/Parallel/POST_/rooms/:room_id/join_can_join_a_room\n
null
=== CONT  TestRoomMembers/Parallel/POST_/rooms/:room_id/leave_can_leave_a_room\n
null
=== CONT  TestRoomMembers/Parallel/POST_/rooms/:room_id/invite_can_send_an_invite\n
null
=== CONT  TestRoomMembers/Parallel/POST_/rooms/:room_id/ban_can_ban_a_user\n
    federation_room_get_missing_events_test.go:333: Deploy times: 10.956497ms blueprints, 17.112088274s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.750670228s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.868707227s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.87405823s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.88713133s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (718.819489ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!Esty88dy7ZogWjRqp9:hs1/join => 200 OK (422.671802ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!7Kd8HwPPQYiROWG42t:hs1/invite => 200 OK (545.488806ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!o5OCYLuNxM4W0sNUfr:hs1/invite => 200 OK (485.693028ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!SW1eIwuaog5Q5HWHl6:hs1 => 200 OK (473.271956ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (870.084106ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (949.863267ms)\n
--- PASS: TestRoomMembers/Parallel/POST_/rooms/:room_id/join_can_join_a_room (3.24s)\n
null
null
=== CONT  TestRoomMembers/Parallel/POST_/join/:room_alias_can_join_a_room_with_custom_content\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!o5OCYLuNxM4W0sNUfr:hs1 => 200 OK (462.203901ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/capabilities => 200 OK (5.729359ms)\n
null
=== RUN   TestInboundCanReturnMissingEvents/Inbound_federation_can_return_missing_events_for_world_readable_visibility\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.859905381s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!7Kd8HwPPQYiROWG42t:hs1/state/m.room.member/@user-2:hs1 => 200 OK (25.271929ms)\n
--- PASS: TestRoomMembers/Parallel/POST_/rooms/:room_id/invite_can_send_an_invite (4.18s)\n
null
null
=== CONT  TestRoomMembers/Parallel/POST_/join/:room_id_can_join_a_room_with_custom_content\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.922877083s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (589.677088ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!al1pCLgqjeIgGgfl0A:hs1/state/m.room.history_visibility/ => 200 OK (130.023001ms)\n
    federation_room_get_missing_events_test.go:365: SendEventSynced waiting for event ID $6yAiBoXnN4BdlXBdxI4FlxyzyzcP2oVEDc_HUAUW2Fc\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!SW1eIwuaog5Q5HWHl6:hs1/ban => 200 OK (528.930031ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (123.832209ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!al1pCLgqjeIgGgfl0A:hs1/send/m.room.message/2 => 200 OK (53.899281ms)\n
    federation_room_get_missing_events_test.go:373: SendEventSynced waiting for event ID $ErIBLuT6B57c4iG1P5SXyALjkAlgAPluzDy3aqb9C9I\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (157.993617ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.940068577s)\n
    federation_room_get_missing_events_test.go:382: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 50 51 56 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!al1pCLgqjeIgGgfl0A:hs1/$jVFtvXA-oULJNEUVIeLtD3nBZF6zcF9Ehg2JKnZINhI") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1238\u001b[39m\n
--- FAIL: TestInboundCanReturnMissingEvents/Inbound_federation_can_return_missing_events_for_world_readable_visibility (1.30s)\n
null
null
=== RUN   TestInboundCanReturnMissingEvents/Inbound_federation_can_return_missing_events_for_shared_visibility\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/#room_alias_random2:hs1 => 200 OK (545.881897ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (498.276784ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!3DQlsmO9gmlT3lruXG:hs1/state/m.room.history_visibility/ => 200 OK (58.800229ms)\n
    federation_room_get_missing_events_test.go:365: SendEventSynced waiting for event ID $fh-5Qp7rgVE3BkC4iO4hGOE4Piq8s6Nio9ZBmqEAyP8\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.675916561s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (203.902476ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!3DQlsmO9gmlT3lruXG:hs1/send/m.room.message/4 => 200 OK (78.865371ms)\n
    federation_room_get_missing_events_test.go:373: SendEventSynced waiting for event ID $nwCLTBcEf-XJFHSUwNML8BP4LsLWmaP0osMmJOZ52GY\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!a5LmgOwEjy8BhNWTJ7:hs1 => 200 OK (434.037502ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (212.925204ms)\n
    federation_room_get_missing_events_test.go:382: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 50 51 56 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!3DQlsmO9gmlT3lruXG:hs1/$1SGKWjatLdt1tAL45QaBDtHyveJvKGZQ3EWB6ysWzuM") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1238\u001b[39m\n
--- FAIL: TestInboundCanReturnMissingEvents/Inbound_federation_can_return_missing_events_for_shared_visibility (1.14s)\n
null
null
=== RUN   TestInboundCanReturnMissingEvents/Inbound_federation_can_return_missing_events_for_invited_visibility\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.946543371s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (502.941089ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!jTgTfQzCz2O0Ykpzri:hs1/state/m.room.history_visibility/ => 200 OK (76.39742ms)\n
    federation_room_get_missing_events_test.go:365: SendEventSynced waiting for event ID $Q4vlnNcS77nMJrFkwA_r06lFuvQheFMvf_c57tTVjLs\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!o5OCYLuNxM4W0sNUfr:hs1/leave => 200 OK (475.43547ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (194.987659ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!jTgTfQzCz2O0Ykpzri:hs1/send/m.room.message/6 => 200 OK (77.981304ms)\n
    federation_room_get_missing_events_test.go:373: SendEventSynced waiting for event ID $wpgkK2KzN0luPxv1L-b5K2R93EycPdLjmXQmGqlJjig\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (364.922388ms)\n
    federation_room_get_missing_events_test.go:382: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 50 51 56 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!jTgTfQzCz2O0Ykpzri:hs1/$O2pLyyAu1YRlX4hVhCIwxnptNIczgTjGW7uFyOS5_y8") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1238\u001b[39m\n
--- FAIL: TestInboundCanReturnMissingEvents/Inbound_federation_can_return_missing_events_for_invited_visibility (1.32s)\n
null
null
=== RUN   TestInboundCanReturnMissingEvents/Inbound_federation_can_return_missing_events_for_joined_visibility\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.218622672s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!SW1eIwuaog5Q5HWHl6:hs1/state/m.room.member/@user-2:hs1 => 200 OK (35.465213ms)\n
--- PASS: TestRoomMembers/Parallel/POST_/rooms/:room_id/ban_can_ban_a_user (8.07s)\n
null
null
=== CONT  TestRoomMembers/Parallel/Test_that_we_can_be_reinvited_to_a_room_we_created\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (407.997571ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!sqJneWO2wt9JccbQuY:hs1/state/m.room.history_visibility/ => 200 OK (88.931513ms)\n
    federation_room_get_missing_events_test.go:365: SendEventSynced waiting for event ID $6ipDxKjVuCEQjcWVxj6JKercQq2X2qJTqujeA3Qg_F8\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (674.373442ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.232794451s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!u9A4deUUdIFkaC76tT:hs1/state/m.room.member/@user-2:hs1 => 200 OK (22.453734ms)\n
    apidoc_room_members_test.go:191: \u001b[31mMatchResponse key 'foo' missing - http://127.0.0.1:32931/_matrix/client/v3/rooms/%!u(MISSING)9A4deUUdIFkaC76tT:hs1/state/m.room.member/@user-2:hs1 => {"displayname":"user-2 ⚡️","membership":"join"}\u001b[39m\n
--- FAIL: TestRoomMembers/Parallel/POST_/join/:room_alias_can_join_a_room_with_custom_content (5.74s)\n
null
null
=== CONT  TestRoomMembers/Parallel/POST_/join/:room_id_can_join_a_room\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!sqJneWO2wt9JccbQuY:hs1/send/m.room.message/8 => 200 OK (88.173236ms)\n
    federation_room_get_missing_events_test.go:373: SendEventSynced waiting for event ID $HEAQycWHXtOhOTTnKlzfrXA0ojhBP6gVN4bz6MIFqo8\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (484.314771ms)\n
    federation_room_get_missing_events_test.go:382: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 50 51 56 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!sqJneWO2wt9JccbQuY:hs1/$5avh_ZC3foqPPWHuGMc6U7fsYvpsb1b7VXzUSkBgL-g") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1238\u001b[39m\n
--- FAIL: TestInboundCanReturnMissingEvents/Inbound_federation_can_return_missing_events_for_joined_visibility (1.92s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.657828565s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.928401867s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!a5LmgOwEjy8BhNWTJ7:hs1/state/m.room.member/@user-2:hs1 => 200 OK (49.89188ms)\n
    apidoc_room_members_test.go:162: \u001b[31mMatchResponse key 'foo' missing - http://127.0.0.1:32931/_matrix/client/v3/rooms/%!a(MISSING)5LmgOwEjy8BhNWTJ7:hs1/state/m.room.member/@user-2:hs1 => {"displayname":"user-2 ⚡️","membership":"join"}\u001b[39m\n
--- FAIL: TestRoomMembers/Parallel/POST_/join/:room_id_can_join_a_room_with_custom_content (5.82s)\n
null
null
=== CONT  TestRoomMembers/Parallel/POST_/join/:room_alias_can_join_a_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!lIbYk1Xndcrqju7HtN:hs1/invite => 200 OK (717.789184ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.930163959s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.94677805s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!o5OCYLuNxM4W0sNUfr:hs1/state/m.room.member/@user-2:hs1 => 200 OK (38.803968ms)\n
--- PASS: TestRoomMembers/Parallel/POST_/rooms/:room_id/leave_can_leave_a_room (11.10s)\n
2025/02/23 07:19:33 ============================================\n
\n
\n
2025/02/23 07:19:33 3882846d23347d631a548c9707486294962c2ce2dcfaed6174a7b1a47f0f5ca5 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=3882846d2334\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 3882846d2334 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266360.7103107,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266360.7179964,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266360.718033,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
To many layers, we have to go deeper frame_id: 19\n
To many layers, we have to go deeper frame_id: 26\n
2025/02/23 07:19:33 ============== 3882846d23347d631a548c9707486294962c2ce2dcfaed6174a7b1a47f0f5ca5 : END LOGS ==============\n
\n
\n
--- FAIL: TestInboundCanReturnMissingEvents (26.89s)\n
null
null
=== RUN   TestOutboundFederationEventSizeGetMissingEvents\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!Fo2GJsYtSQMlpnGcA0:hs1 => 200 OK (562.704999ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.873949958s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/#room_alias_random:hs1 => 200 OK (297.737741ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.662834997s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!lIbYk1Xndcrqju7HtN:hs1 => 200 OK (326.125081ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.7675074s)\n
--- PASS: TestRoomMembers/Parallel/POST_/join/:room_id_can_join_a_room (4.26s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.771394849s)\n
--- PASS: TestRoomMembers/Parallel/POST_/join/:room_alias_can_join_a_room (3.94s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.519745878s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!lIbYk1Xndcrqju7HtN:hs1/state/m.room.power_levels/ => 200 OK (97.288883ms)\n
    apidoc_room_members_test.go:109: SendEventSynced waiting for event ID $Zub-qGHzf4-7HPtpY00Pe6Wa7joaKpysOj1m6cSzTRQ\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.193112555s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!lIbYk1Xndcrqju7HtN:hs1/leave => 200 OK (77.435264ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (560.180194ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!lIbYk1Xndcrqju7HtN:hs1/invite => 200 OK (123.13541ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (984.815232ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!lIbYk1Xndcrqju7HtN:hs1 => 200 OK (116.693927ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (198.610637ms)\n
--- PASS: TestRoomMembers/Parallel/Test_that_we_can_be_reinvited_to_a_room_we_created (9.51s)\n
null
--- FAIL: TestRoomMembers/Parallel (0.00s)\n
null
2025/02/23 07:19:41 ============================================\n
\n
\n
2025/02/23 07:19:41 1fa489f94dc4342bfbc4ee45c0721d07cdefdb081df10a6798b2b90d39279a5d : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=1fa489f94dc4\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 1fa489f94dc4 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266358.1818588,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266358.189708,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266358.1897388,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 17\n
To many layers, we have to go deeper frame_id: 18\n
To many layers, we have to go deeper frame_id: 19\n
To many layers, we have to go deeper frame_id: 20\n
To many layers, we have to go deeper frame_id: 35\n
To many layers, we have to go deeper frame_id: 42\n
To many layers, we have to go deeper frame_id: 53\n
To many layers, we have to go deeper frame_id: 58\n
To many layers, we have to go deeper frame_id: 65\n
To many layers, we have to go deeper frame_id: 73\n
2025/02/23 07:19:41 ============== 1fa489f94dc4342bfbc4ee45c0721d07cdefdb081df10a6798b2b90d39279a5d : END LOGS ==============\n
\n
\n
--- FAIL: TestRoomMembers (38.31s)\n
null
null
=== RUN   TestRoomReceipts\n
    federation_room_get_missing_events_test.go:475: Deploy times: 18.703711ms blueprints, 15.5755295s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (635.442908ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/capabilities => 200 OK (7.233621ms)\n
    server.go:185: Creating room !0-3m3DepahnskTwTgWLS:host.docker.internal:43855 with version 10\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/#flibble:host.docker.internal:43855 => 400 Bad Request (59.859691ms)\n
    federation_room_get_missing_events_test.go:541: EventValidationError: gomatrixserverlib: state key is too long, length 280 bytes > maximum 255 bytes\n
    federation_room_get_missing_events_test.go:588: \u001b[31mWait: timed out after 5.000000 seconds.\u001b[39m\n
    apidoc_room_receipts_test.go:40: Deploy times: 10.457356ms blueprints, 14.645062646s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (588.77394ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (358.969007ms)\n
2025/02/23 07:19:57 ============================================\n
\n
\n
2025/02/23 07:19:57 ae0afdd1767055006fd92335116b943e27595238e730c74d7108d5c4afe4ba7f : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=ae0afdd17670\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux ae0afdd17670 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266385.8698754,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266385.8753886,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266385.8754215,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
  \u001b[2m2025-02-22T23:19:50.738239Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://host.docker.internal:43855/_matrix/federation/v1/query/directory?room_alias=#flibble:host.docker.internal:43855 404 Not Found: {\n
\t\t\t\t"errcode": "M_NOT_FOUND",\n
\t\t\t\t"error": "Room alias not found."\n
\t\t\t}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
  \u001b[2m2025-02-22T23:19:50.805895Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::routing::federation::transaction\u001b[0m\u001b[33m: \u001b[33mCould not parse PDU: Matrix error: `[400 / M_INVALID_PARAM]`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/routing/federation/transaction.rs:54\n
\n
2025/02/23 07:19:57 ============== ae0afdd1767055006fd92335116b943e27595238e730c74d7108d5c4afe4ba7f : END LOGS ==============\n
\n
\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (111.349513ms)\n
--- FAIL: TestOutboundFederationEventSizeGetMissingEvents (23.55s)\n
null
null
=== RUN   TestFederationRejectInvite\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!Q4Atjnh3EviQGYaYNN:hs1/send/m.room.message/1 => 200 OK (43.943312ms)\n
    apidoc_room_receipts_test.go:20: SendEventSynced waiting for event ID $2Sz0TLitlOgUWKILGinZuexq6qzSKuqtMqu55GArHR4\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (83.082391ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!Q4Atjnh3EviQGYaYNN:hs1/receipt/m.read/$2Sz0TLitlOgUWKILGinZuexq6qzSKuqtMqu55GArHR4 => 200 OK (9.234125ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (71.605266ms)\n
2025/02/23 07:19:58 ============================================\n
\n
\n
2025/02/23 07:19:58 a5af404f9968b9ab6cbff4353e15c9379b49abc60f62a23de130f6f7515447a1 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=a5af404f9968\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux a5af404f9968 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266393.3336265,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266393.3379073,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266393.3379369,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:19:58 ============== a5af404f9968b9ab6cbff4353e15c9379b49abc60f62a23de130f6f7515447a1 : END LOGS ==============\n
\n
\n
--- PASS: TestRoomReceipts (17.40s)\n
null
null
=== RUN   TestRoomReadMarkers\n
    federation_room_invite_test.go:20: Deploy times: 20.89945ms blueprints, 27.996106366s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (717.754332ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (730.131016ms)\n
    apidoc_room_receipts_test.go:53: Deploy times: 9.933423ms blueprints, 27.950199978s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (698.572044ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (590.051797ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (74.33293ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!DbBZzeWKoLKHxsyAZ3:hs1/send/m.room.message/1 => 200 OK (117.182057ms)\n
    apidoc_room_receipts_test.go:20: SendEventSynced waiting for event ID $r7RMKsoqT5X3lkoGe1mCfAhRi0dFPYOhapaZ9iKAJLQ\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (208.281932ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!DbBZzeWKoLKHxsyAZ3:hs1/read_markers => 200 OK (25.6257ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (82.87525ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (111.569693ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (485.305612ms)\n
    federation_room_invite_test.go:48: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 49 52 48 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!bgLlCQh9nUtXFLLAdL:hs1/$l-1XjyXkSNh-BcbBXaQ9LAcPvpf1I_-VAhcMGFY6BkM") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1140\u001b[39m\n
2025/02/23 07:20:30 ============================================\n
\n
\n
2025/02/23 07:20:30 c015212c5c3eeea154ff923bc83bbe3ad85a81e983d7076fe14a2ba0271924d2 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=c015212c5c3e\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux c015212c5c3e 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266423.2679374,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266423.2767549,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266423.2767894,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:20:30 ============== c015212c5c3eeea154ff923bc83bbe3ad85a81e983d7076fe14a2ba0271924d2 : END LOGS ==============\n
\n
\n
--- PASS: TestRoomReadMarkers (31.45s)\n
null
null
=== RUN   TestRoomState\n
2025/02/23 07:20:30 ============================================\n
\n
\n
2025/02/23 07:20:30 d700439d3de451adec39c8e0edadb854345c4622c4d1f5d35db61b6585007a42 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=d700439d3de4\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux d700439d3de4 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266421.6526425,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266421.6605694,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266421.661234,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:20:30 ============== d700439d3de451adec39c8e0edadb854345c4622c4d1f5d35db61b6585007a42 : END LOGS ==============\n
\n
\n
2025/02/23 07:20:32 ============================================\n
\n
\n
2025/02/23 07:20:32 4d3b39bf5edbd4476bc8c68f185ea415719a87379d55ec8d851e0caef41a444e : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=4d3b39bf5edb\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 4d3b39bf5edb 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266421.7496107,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266421.7557492,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266421.7557795,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:20:32 ============== 4d3b39bf5edbd4476bc8c68f185ea415719a87379d55ec8d851e0caef41a444e : END LOGS ==============\n
\n
\n
--- FAIL: TestFederationRejectInvite (35.16s)\n
null
null
=== RUN   TestJoinViaRoomIDAndServerName\n
    apidoc_room_state_test.go:19: Deploy times: 16.452646ms blueprints, 22.273893031s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (819.247261ms)\n
null
=== RUN   TestRoomState/Parallel\n
null
=== RUN   TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.member/:user_id_fetches_my_membership\n
=== PAUSE TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.member/:user_id_fetches_my_membership\n
null
null
=== RUN   TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.member/:user_id?format=event_fetches_my_membership_event\n
=== PAUSE TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.member/:user_id?format=event_fetches_my_membership_event\n
null
null
=== RUN   TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.power_levels_fetches_powerlevels\n
=== PAUSE TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.power_levels_fetches_powerlevels\n
null
null
=== RUN   TestRoomState/Parallel/GET_/rooms/:room_id/joined_members_fetches_my_membership\n
=== PAUSE TestRoomState/Parallel/GET_/rooms/:room_id/joined_members_fetches_my_membership\n
null
null
=== RUN   TestRoomState/Parallel/GET_/publicRooms_lists_newly-created_room\n
=== PAUSE TestRoomState/Parallel/GET_/publicRooms_lists_newly-created_room\n
null
null
=== RUN   TestRoomState/Parallel/GET_/directory/room/:room_alias_yields_room_ID\n
=== PAUSE TestRoomState/Parallel/GET_/directory/room/:room_alias_yields_room_ID\n
null
null
=== RUN   TestRoomState/Parallel/GET_/joined_rooms_lists_newly-created_room\n
=== PAUSE TestRoomState/Parallel/GET_/joined_rooms_lists_newly-created_room\n
null
null
=== RUN   TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.name_gets_name\n
=== PAUSE TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.name_gets_name\n
null
null
=== RUN   TestRoomState/Parallel/POST_/rooms/:room_id/state/m.room.name_sets_name\n
=== PAUSE TestRoomState/Parallel/POST_/rooms/:room_id/state/m.room.name_sets_name\n
null
null
=== RUN   TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.topic_gets_topic\n
=== PAUSE TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.topic_gets_topic\n
null
null
=== RUN   TestRoomState/Parallel/PUT_/rooms/:room_id/state/m.room.topic_sets_topic\n
=== PAUSE TestRoomState/Parallel/PUT_/rooms/:room_id/state/m.room.topic_sets_topic\n
null
null
=== RUN   TestRoomState/Parallel/GET_/rooms/:room_id/state_fetches_entire_room_state\n
=== PAUSE TestRoomState/Parallel/GET_/rooms/:room_id/state_fetches_entire_room_state\n
null
null
=== RUN   TestRoomState/Parallel/PUT_/createRoom_with_creation_content\n
=== PAUSE TestRoomState/Parallel/PUT_/createRoom_with_creation_content\n
null
null
=== RUN   TestRoomState/Parallel/GET_/rooms/:room_id/joined_members_is_forbidden_after_leaving_room\n
=== PAUSE TestRoomState/Parallel/GET_/rooms/:room_id/joined_members_is_forbidden_after_leaving_room\n
null
null
=== CONT  TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.member/:user_id_fetches_my_membership\n
null
=== CONT  TestRoomState/Parallel/GET_/rooms/:room_id/joined_members_is_forbidden_after_leaving_room\n
null
=== CONT  TestRoomState/Parallel/GET_/joined_rooms_lists_newly-created_room\n
null
=== CONT  TestRoomState/Parallel/PUT_/createRoom_with_creation_content\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.674687385s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.709086043s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.73375385s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!ftvbOdw0HdrU7h1LDZ:hs1/state/m.room.member/@user-1:hs1 => 200 OK (45.396958ms)\n
--- PASS: TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.member/:user_id_fetches_my_membership (1.76s)\n
null
null
=== CONT  TestRoomState/Parallel/GET_/rooms/:room_id/state_fetches_entire_room_state\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/joined_rooms => 200 OK (31.040831ms)\n
--- PASS: TestRoomState/Parallel/GET_/joined_rooms_lists_newly-created_room (1.77s)\n
null
null
=== CONT  TestRoomState/Parallel/PUT_/rooms/:room_id/state/m.room.topic_sets_topic\n
    federation_room_join_test.go:42: Deploy times: 22.033511ms blueprints, 22.803094365s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.794314313s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!Piurc5JCQFidKD59HF:hs1/state/m.room.create => 200 OK (42.532408ms)\n
--- PASS: TestRoomState/Parallel/PUT_/createRoom_with_creation_content (1.84s)\n
null
null
=== CONT  TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.topic_gets_topic\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!2c6fLBeZFGMQe7NMRr:hs1/leave => 200 OK (773.211904ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/r0/rooms/!2c6fLBeZFGMQe7NMRr:hs1/joined_members => 403 Forbidden (102.720643ms)\n
--- PASS: TestRoomState/Parallel/GET_/rooms/:room_id/joined_members_is_forbidden_after_leaving_room (2.55s)\n
null
null
=== CONT  TestRoomState/Parallel/POST_/rooms/:room_id/state/m.room.name_sets_name\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (814.46782ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.14709667s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!7X47JHosBvq5owOg0A:hs1/state/m.room.topic => 200 OK (503.589978ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!7X47JHosBvq5owOg0A:hs1/state/m.room.topic => 200 OK (56.71216ms)\n
--- PASS: TestRoomState/Parallel/PUT_/rooms/:room_id/state/m.room.topic_sets_topic (2.71s)\n
null
null
=== CONT  TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.name_gets_name\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.677758906s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!1UKUHaUlvcVvOrp0Sp:hs1/state/m.room.topic => 200 OK (79.072103ms)\n
--- PASS: TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.topic_gets_topic (2.76s)\n
null
null
=== CONT  TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.power_levels_fetches_powerlevels\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/capabilities => 200 OK (8.541331ms)\n
    server.go:185: Creating room !0-0LThMjaT3U9tB5ToGI:host.docker.internal:45667 with version 10\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.114248107s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!0-0LThMjaT3U9tB5ToGI:host.docker.internal:45667 => 400 Bad Request (323.053332ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:32947/_matrix/client/v3/join/%210-0LThMjaT3U9tB5ToGI:host.docker.internal:45667?server_name=host.docker.internal%3A45667 returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Answer from host.docker.internal:45667: complement: HandleMakeSendJoinRequests send_join cannot parse event JSON: eventauth: invalid ID: \\"\\""}\u001b[39m\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (3.368566574s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!ZyLXd2Dl4IRVieFKhG:hs1/state/m.room.name => 200 OK (765.289139ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!WpRnVRE6RSa9cFbMjT:hs1/state => 200 OK (362.073632ms)\n
--- PASS: TestRoomState/Parallel/GET_/rooms/:room_id/state_fetches_entire_room_state (3.73s)\n
null
null
=== CONT  TestRoomState/Parallel/GET_/directory/room/:room_alias_yields_room_ID\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!ZyLXd2Dl4IRVieFKhG:hs1/state/m.room.name => 200 OK (149.83203ms)\n
--- PASS: TestRoomState/Parallel/POST_/rooms/:room_id/state/m.room.name_sets_name (3.03s)\n
null
null
=== CONT  TestRoomState/Parallel/GET_/publicRooms_lists_newly-created_room\n
2025/02/23 07:21:00 ============================================\n
\n
\n
2025/02/23 07:21:00 2d6c091466c39e6d95f63a16ca8a3e9e5273d17036807add3bada5fa27a42613 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=2d6c091466c3\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 2d6c091466c3 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266451.489512,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266451.4960086,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266451.4960575,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "host.docker.internal:45667"  servername:"hs1"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://host.docker.internal:45667/_matrix/federation/v1/make_join/!0-0LThMjaT3U9tB5ToGI:host.docker.internal:45667/@user-1:hs1?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"content-type": "application/json", "date": "Sat, 22 Feb 2025 23:20:58 GMT", "content-length": "426"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"sender":"@user-1:hs1","room_id":"!0-0LThMjaT3U9tB5ToGI:host.docker.internal:45667","type":"m.room.member","state_key":"@user-1:hs1","prev_events":["$vEIwFd0C3G_7k4bDIk0N5q64vAx3lgIRCRhYKVi9nqA"],"auth_events":["$U3ysEq1Jlb4okfKI6GnOq1EvTwVAt_DQR6a_WyCabTk","$vEIwFd0C3G_7k4bDIk0N5q64vAx3lgIRCRhYKVi9nqA","$xoV8Adw1wNmGBGUkGZM8gc3n5cW_aeQboPWrt7sV5BI"],"depth":5,"content":{"membership":"join"}}) })\n
  \u001b[2m2025-02-22T23:20:58.454631Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://host.docker.internal:45667/_matrix/federation/v2/send_join/!0-0LThMjaT3U9tB5ToGI:host.docker.internal:45667/$sm0Pzxi5Jp1cPzEAEvP_EpDeGPKLPABY06B16gPKhwQ?omit_members=false 500 Internal Server Error: complement: HandleMakeSendJoinRequests send_join cannot parse event JSON: eventauth: invalid ID: ""\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
2025/02/23 07:21:00 ============== 2d6c091466c39e6d95f63a16ca8a3e9e5273d17036807add3bada5fa27a42613 : END LOGS ==============\n
\n
\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (3.633825047s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (3.832354249s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!cdyAKnn2Yn5oj0hmAn:hs1/state/m.room.name => 200 OK (353.246606ms)\n
--- PASS: TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.name_gets_name (3.99s)\n
null
null
=== CONT  TestRoomState/Parallel/GET_/rooms/:room_id/joined_members_fetches_my_membership\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!TaGsvBBFWknBwHLvCL:hs1/state/m.room.power_levels => 200 OK (111.31824ms)\n
--- PASS: TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.power_levels_fetches_powerlevels (3.94s)\n
null
null
=== CONT  TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.member/:user_id?format=event_fetches_my_membership_event\n
2025/02/23 07:21:02 ============================================\n
\n
\n
2025/02/23 07:21:02 84b7f5b80a39fab46f100776ba958bd8e3a463918ade6ae2d51e9e0371b8fc7f : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=84b7f5b80a39\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 84b7f5b80a39 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266451.4878001,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266451.4923244,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266451.492349,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:21:02 ============== 84b7f5b80a39fab46f100776ba958bd8e3a463918ade6ae2d51e9e0371b8fc7f : END LOGS ==============\n
\n
\n
--- FAIL: TestJoinViaRoomIDAndServerName (29.75s)\n
null
null
=== RUN   TestJoinFederatedRoomFailOver\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (3.256438874s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (3.702081616s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/directory/room/#room_new:hs1 => 200 OK (39.315793ms)\n
--- PASS: TestRoomState/Parallel/GET_/directory/room/:room_alias_yields_room_ID (3.75s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/publicRooms => 200 OK (2.189372184s)\n
--- PASS: TestRoomState/Parallel/GET_/publicRooms_lists_newly-created_room (5.45s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.569403599s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!Z2WLySKpfHU6pmRGzm:hs1/joined_members => 200 OK (54.308002ms)\n
--- PASS: TestRoomState/Parallel/GET_/rooms/:room_id/joined_members_fetches_my_membership (2.62s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.636702845s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!DSkHFm3cr1ykoLB0Lj:hs1/state/m.room.member/@user-1:hs1 => 200 OK (20.714017ms)\n
--- PASS: TestRoomState/Parallel/GET_/rooms/:room_id/state/m.room.member/:user_id?format=event_fetches_my_membership_event (2.66s)\n
null
--- PASS: TestRoomState/Parallel (0.00s)\n
null
2025/02/23 07:21:06 ============================================\n
\n
\n
2025/02/23 07:21:06 9684c193c7709618ec1c7f2c26e557fff091625590cfece441c630a741dbc9d7 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=9684c193c770\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 9684c193c770 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266449.5143027,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266449.5199018,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266449.5199394,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 17\n
To many layers, we have to go deeper frame_id: 18\n
To many layers, we have to go deeper frame_id: 19\n
To many layers, we have to go deeper frame_id: 20\n
To many layers, we have to go deeper frame_id: 41\n
To many layers, we have to go deeper frame_id: 42\n
To many layers, we have to go deeper frame_id: 43\n
To many layers, we have to go deeper frame_id: 48\n
To many layers, we have to go deeper frame_id: 69\n
To many layers, we have to go deeper frame_id: 70\n
To many layers, we have to go deeper frame_id: 75\n
To many layers, we have to go deeper frame_id: 76\n
To many layers, we have to go deeper frame_id: 90\n
To many layers, we have to go deeper frame_id: 91\n
2025/02/23 07:21:06 ============== 9684c193c7709618ec1c7f2c26e557fff091625590cfece441c630a741dbc9d7 : END LOGS ==============\n
\n
\n
--- PASS: TestRoomState (36.11s)\n
null
null
=== RUN   TestSearch\n
    federation_room_join_test.go:90: Deploy times: 14.235215ms blueprints, 25.451243575s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (659.117567ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (732.428181ms)\n
    apidoc_search_test.go:22: Deploy times: 14.27144ms blueprints, 23.033791504s containers\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/createRoom => 200 OK (495.852942ms)\n
    federation_room_join_test.go:110: @user-2:hs2 created room !WdWDwIJDJOlhlZ1BXw:hs2.\n
    federation_room_join_test.go:112: @user-1:hs1 joins the room via {complement,hs2}.\n
    federation_room_join_test.go:101: Complement homeserver responds to /make_join with 404, M_NOT_FOUND.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (707.452853ms)\n
null
=== RUN   TestSearch/parallel\n
null
=== RUN   TestSearch/parallel/Can_search_for_an_event_by_body\n
=== PAUSE TestSearch/parallel/Can_search_for_an_event_by_body\n
null
null
=== RUN   TestSearch/parallel/Can_get_context_around_search_results\n
=== PAUSE TestSearch/parallel/Can_get_context_around_search_results\n
null
null
=== RUN   TestSearch/parallel/Can_back-paginate_search_results\n
=== PAUSE TestSearch/parallel/Can_back-paginate_search_results\n
null
null
=== RUN   TestSearch/parallel/Search_works_across_an_upgraded_room_and_its_predecessor\n
=== PAUSE TestSearch/parallel/Search_works_across_an_upgraded_room_and_its_predecessor\n
null
null
=== RUN   TestSearch/parallel/Search_results_with_rank_ordering_do_not_include_redacted_events\n
=== PAUSE TestSearch/parallel/Search_results_with_rank_ordering_do_not_include_redacted_events\n
null
null
=== RUN   TestSearch/parallel/Search_results_with_recent_ordering_do_not_include_redacted_events\n
=== PAUSE TestSearch/parallel/Search_results_with_recent_ordering_do_not_include_redacted_events\n
null
null
=== CONT  TestSearch/parallel/Can_search_for_an_event_by_body\n
null
=== CONT  TestSearch/parallel/Search_results_with_recent_ordering_do_not_include_redacted_events\n
null
=== CONT  TestSearch/parallel/Search_results_with_rank_ordering_do_not_include_redacted_events\n
null
=== CONT  TestSearch/parallel/Search_works_across_an_upgraded_room_and_its_predecessor\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (547.618722ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!WdWDwIJDJOlhlZ1BXw:hs2 => 200 OK (1.185924168s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!PMngbAvJflkkz9OUb4:hs1/send/m.room.message/1 => 200 OK (556.339843ms)\n
    apidoc_search_test.go:34: SendEventSynced waiting for event ID $ysmzBGQrlribaYKx1fcOreXg9ZF9SX_w1rM0mxYYs1s\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (73.714207ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (740.547736ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/search => 200 OK (72.778166ms)\n
--- PASS: TestSearch/parallel/Can_search_for_an_event_by_body (1.92s)\n
null
null
=== CONT  TestSearch/parallel/Can_back-paginate_search_results\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.015110537s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.261474983s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.296786092s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.408587707s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!Hnz1bBVZyO3iGvbtjZ:hs1/send/m.room.message/2 => 200 OK (431.960506ms)\n
    apidoc_search_test.go:285: SendEventSynced waiting for event ID $ORj7OVB8n-KKGWtcCtWg5jITBZkU1XqiAuflXR5dPFQ\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!X0m2FbpUsIFz3BVut8:hs1/send/m.room.message/3 => 200 OK (418.855711ms)\n
    apidoc_search_test.go:285: SendEventSynced waiting for event ID $ZEKuSJIqRoS3OS3cXTxQzjY-_sjoeXDl_Lw5Dri1pSc\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!dcvLTxwm3IprlY340E:hs1/send/m.room.message/4 => 200 OK (409.424668ms)\n
    apidoc_search_test.go:207: SendEventSynced waiting for event ID $X-xrUE_gs2e87utCtAYJRm4QMdvNzz2MBEx3-UprIus\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.032801783s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.771721343s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/5 => 200 OK (251.647136ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $b3_9RHqzvvz-gau6fHL_Ao49cf9FfGuDNp_hmFb7qZw\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.064631882s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.342851394s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.396665102s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.401025684s)\n
    apidoc_search_test.go:214: Sent message before upgrade with event ID $X-xrUE_gs2e87utCtAYJRm4QMdvNzz2MBEx3-UprIus\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!X0m2FbpUsIFz3BVut8:hs1/send/m.room.message/6 => 200 OK (253.955203ms)\n
    apidoc_search_test.go:294: SendEventSynced waiting for event ID $tvS1r4UMTc0K2U3f6i-f6jd-AvcsdxlvdmSL-Dl5rww\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.0766487s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!Hnz1bBVZyO3iGvbtjZ:hs1/send/m.room.message/7 => 200 OK (284.943739ms)\n
    apidoc_search_test.go:294: SendEventSynced waiting for event ID $oXFRpQNMujEfHB68h6Rf7k_9XYNU7fll8CADAJjReLo\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.2086671s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.024789483s)\n
    federation_room_join_test.go:114: \u001b[31m@user-2:hs2 MustSyncUntil: timed out after 5.290142656s. Seen 6 /sync responses. Checkers:\n
        [t=74.749018ms] Response #1: SyncJoinedTo(!WdWDwIJDJOlhlZ1BXw:hs2): check function did not pass while iterating over 6 elements: [{"content":{"creator":"@user-2:hs2","room_version":"10"},"event_id":"$iH45lQ4Gi05NOX5tRdzcTWezTa129w0smJLlpwJQcOc","origin_server_ts":1740266489725,"sender":"@user-2:hs2","state_key":"","type":"m.room.create","unsigned":{"age":1}},{"content":{"displayname":"user-2 ⚡️","is_direct":false,"membership":"join"},"event_id":"$OO-3tzyPHbnXKS7ARzNf8NuSVouxh8hr0tDbdiobulU","origin_server_ts":1740266489811,"sender":"@user-2:hs2","state_key":"@user-2:hs2","type":"m.room.member","unsigned":{"age":1}},{"content":{"ban":50,"events":{},"events_default":0,"invite":0,"kick":50,"notifications":{"room":50},"redact":50,"state_default":50,"users":{"@user-2:hs2":100},"users_default":0},"event_id":"$5zlpvF4pDrOY4hSIyRNB94g9S0Ebvqu3SVcuC2NAeZ8","origin_server_ts":1740266489919,"sender":"@user-2:hs2","state_key":"","type":"m.room.power_levels","unsigned":{"age":1}},{"content":{"join_rule":"publi
c"},"event_id":"$F_KYv-k0rxN3ffzQW4m3VWnpQRzwIH9ooYURz4Ioa_U","origin_server_ts":1740266489985,"sender":"@user-2:hs2","state_key":"","type":"m.room.join_rules","unsigned":{"age":1}},{"content":{"history_visibility":"shared"},"event_id":"$daVhrX4WTtUceVZltVBOHPD6syAnHsqNmOfI5T1myjk","origin_server_ts":1740266490062,"sender":"@user-2:hs2","state_key":"","type":"m.room.history_visibility","unsigned":{"age":1}},{"content":{"guest_access":"forbidden"},"event_id":"$7O7PpvMeDanneO-bk7fqc6PGSA9Rr1YOfPmg3TKxItw","origin_server_ts":1740266490138,"sender":"@user-2:hs2","state_key":"","type":"m.room.guest_access","unsigned":{"age":1}}] & check function did not pass while iterating over 6 elements: [{"content":{"creator":"@user-2:hs2","room_version":"10"},"event_id":"$iH45lQ4Gi05NOX5tRdzcTWezTa129w0smJLlpwJQcOc","origin_server_ts":1740266489725,"sender":"@user-2:hs2","state_key":"","type":"m.room.create","unsigned":{}},{"content":{"history_visibility":"shared"},"event_id":"$daVhrX4WTtUceVZltVBOHPD6syAnHsqNmOfI5T1myjk","or
igin_server_ts":1740266490062,"sender":"@user-2:hs2","state_key":"","type":"m.room.history_visibility","unsigned":{}},{"content":{"displayname":"user-2 ⚡️","is_direct":false,"membership":"join"},"event_id":"$OO-3tzyPHbnXKS7ARzNf8NuSVouxh8hr0tDbdiobulU","origin_server_ts":1740266489811,"sender":"@user-2:hs2","state_key":"@user-2:hs2","type":"m.room.member","unsigned":{}},{"content":{"guest_access":"forbidden"},"event_id":"$7O7PpvMeDanneO-bk7fqc6PGSA9Rr1YOfPmg3TKxItw","origin_server_ts":1740266490138,"sender":"@user-2:hs2","state_key":"","type":"m.room.guest_access","unsigned":{}},{"content":{"ban":50,"events":{},"events_default":0,"invite":0,"kick":50,"notifications":{"room":50},"redact":50,"state_default":50,"users":{"@user-2:hs2":100},"users_default":0},"event_id":"$5zlpvF4pDrOY4hSIyRNB94g9S0Ebvqu3SVcuC2NAeZ8","origin_server_ts":1740266489919,"sender":"@user-2:hs2","state_key":"","type":"m.room.power_levels","unsigned":{}},{"content":{"join_rule":"public"},"event_id":"$F_KYv-k0rxN3ffzQW4m3VWnpQRzwIH9ooYU
Rz4Ioa_U","origin_server_ts":1740266489985,"sender":"@user-2:hs2","state_key":"","type":"m.room.join_rules","unsigned":{}}]\n
        [t=1.090094996s] Response #2: SyncJoinedTo(!WdWDwIJDJOlhlZ1BXw:hs2): Key rooms.join.!WdWDwIJDJOlhlZ1BXw:hs2.timeline.events does not exist & Key rooms.join.!WdWDwIJDJOlhlZ1BXw:hs2.state.events does not exist\n
        [t=2.123041856s] Response #3: SyncJoinedTo(!WdWDwIJDJOlhlZ1BXw:hs2): Key rooms.join.!WdWDwIJDJOlhlZ1BXw:hs2.timeline.events does not exist & Key rooms.join.!WdWDwIJDJOlhlZ1BXw:hs2.state.events does not exist\n
        [t=3.18804914s] Response #4: SyncJoinedTo(!WdWDwIJDJOlhlZ1BXw:hs2): Key rooms.join.!WdWDwIJDJOlhlZ1BXw:hs2.timeline.events does not exist & Key rooms.join.!WdWDwIJDJOlhlZ1BXw:hs2.state.events does not exist\n
        [t=4.265153934s] Response #5: SyncJoinedTo(!WdWDwIJDJOlhlZ1BXw:hs2): Key rooms.join.!WdWDwIJDJOlhlZ1BXw:hs2.timeline.events does not exist & Key rooms.join.!WdWDwIJDJOlhlZ1BXw:hs2.state.events does not exist\n
        [t=5.290139782s] Response #6: SyncJoinedTo(!WdWDwIJDJOlhlZ1BXw:hs2): Key rooms.join.!WdWDwIJDJOlhlZ1BXw:hs2.timeline.events does not exist & Key rooms.join.!WdWDwIJDJOlhlZ1BXw:hs2.state.events does not exist, \n
        \u001b[39m\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/8 => 200 OK (249.330008ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $7tIFJfwGzpOEcxBFBSkZv29-E0MsGqiH3cIthT3a2xA\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!dcvLTxwm3IprlY340E:hs1/upgrade => 200 OK (2.148961606s)\n
    apidoc_search_test.go:222: Replaced room !dcvLTxwm3IprlY340E:hs1 with !MSmppEiA621MNvmRh2:hs1\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!MSmppEiA621MNvmRh2:hs1/send/m.room.message/9 => 200 OK (277.767454ms)\n
    apidoc_search_test.go:224: SendEventSynced waiting for event ID $x_tRw21d-pI-vsHX_qas0DpQRLjsN6FrUDyhVstMpXc\n
2025/02/23 07:21:38 ============================================\n
\n
\n
2025/02/23 07:21:38 dcbe5a7ba0bb3ad8ded8f2d1777c7a1cc6f05f1d089a1f2fb26739e001e7fb6e : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=dcbe5a7ba0bb\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux dcbe5a7ba0bb 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266484.4464586,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266484.4536793,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266484.4537008,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:21:38 ============== dcbe5a7ba0bb3ad8ded8f2d1777c7a1cc6f05f1d089a1f2fb26739e001e7fb6e : END LOGS ==============\n
\n
\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.425663597s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.542835624s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!Hnz1bBVZyO3iGvbtjZ:hs1/redact/$ORj7OVB8n-KKGWtcCtWg5jITBZkU1XqiAuflXR5dPFQ/10 => 200 OK (290.800741ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!X0m2FbpUsIFz3BVut8:hs1/redact/$ZEKuSJIqRoS3OS3cXTxQzjY-_sjoeXDl_Lw5Dri1pSc/11 => 200 OK (345.473475ms)\n
2025/02/23 07:21:39 ============================================\n
\n
\n
2025/02/23 07:21:39 aa1ef4e037a4d8985ab12e4eae0223c9a8df8efc33edf11b68e5b90852cc6f53 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=aa1ef4e037a4\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux aa1ef4e037a4 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266484.3415463,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266484.348196,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266484.3482428,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "host.docker.internal:42595"  servername:"hs1"\n
  \u001b[2m2025-02-22T23:21:30.248466Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://host.docker.internal:42595/_matrix/federation/v1/make_join/!WdWDwIJDJOlhlZ1BXw:hs2/@user-1:hs1?ver=[6,7,8,9,10,11,3,4,5] 404 Not Found: {\n
\t\t\t"errcode": "M_NOT_FOUND",\n
\t\t\t"error": "Unknown room."\n
\t\t}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from host.docker.internal:42595: {\\n\\t\\t\\t\\"errcode\\": \\"M_NOT_FOUND\\",\\n\\t\\t\\t\\"error\\": \\"Unknown room.\\"\\n\\t\\t}")}) }))\n
rrrrrrrrrrrrrrremote_server: "hs2"  servername:"hs1"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs2:8448/_matrix/federation/v1/make_join/!WdWDwIJDJOlhlZ1BXw:hs2/@user-1:hs1?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "895", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:21:30 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$5zlpvF4pDrOY4hSIyRNB94g9S0Ebvqu3SVcuC2NAeZ8","$iH45lQ4Gi05NOX5tRdzcTWezTa129w0smJLlpwJQcOc","$F_KYv-k0rxN3ffzQW4m3VWnpQRzwIH9ooYURz4Ioa_U"],"content":{"membership":"join"},"depth":7,"event_sn":10,"hashes":{"sha256":"SbNmdG502sDEe/nkc40EHGiL2AYBZToSBwdUl7fOlNg"},"origin":"hs2","origin_server_ts":1740266490572,"prev_events":["$5zlpvF4pDrOY4hSIyRNB94g9S0Ebvqu3SVcuC2NAeZ8","$7O7PpvMeDanneO-bk7fqc6PGSA9Rr1YOfPmg3TKxItw","$F_KYv-k0rxN3ffzQW4m3VWnpQRzwIH9ooYURz4Ioa_U","$OO-3tzyPHbnXKS7ARzNf8NuSVouxh8hr0tDbdiobulU","$daVhrX4WTtUceVZltVBOHPD6syAnHsqNmOfI5T1myjk","$iH45lQ4Gi05NOX5tRdzcTWezTa129w0smJLlpwJQcOc"],"room_id":"!WdWDwIJDJOlhlZ1BXw:hs2","sender":"@user-1:hs1","signatures":{"hs2":{"ed25519:ISMNzjdD":"iazlYOE6SFdWIH3MzmGBKLEtZcIP96MY8SrAnDt0hT9hQp/Saf2BaqoUWylAURbteKPHhlB5+D6WiC810XIvBw"}},"state_key":"@user-1:hs1","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:21:30.987198Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
2025/02/23 07:21:39 ============== aa1ef4e037a4d8985ab12e4eae0223c9a8df8efc33edf11b68e5b90852cc6f53 : END LOGS ==============\n
\n
\n
--- FAIL: TestJoinFederatedRoomFailOver (37.41s)\n
null
null
=== RUN   TestJoinFederatedRoomWithUnverifiableEvents\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.11271873s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/12 => 200 OK (164.274256ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $QPmrowRPaAOHflcB59fShHz0Jp7BS0ECIH_13CFNlhk\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.372170295s)\n
    apidoc_search_test.go:231: Sent message after upgrade with event ID $x_tRw21d-pI-vsHX_qas0DpQRLjsN6FrUDyhVstMpXc\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/search => 200 OK (68.570497ms)\n
--- PASS: TestSearch/parallel/Search_works_across_an_upgraded_room_and_its_predecessor (10.09s)\n
null
null
=== CONT  TestSearch/parallel/Can_get_context_around_search_results\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.612161202s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/search => 200 OK (74.018757ms)\n
--- PASS: TestSearch/parallel/Search_results_with_recent_ordering_do_not_include_redacted_events (10.78s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.642411295s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/search => 200 OK (42.514498ms)\n
--- PASS: TestSearch/parallel/Search_results_with_rank_ordering_do_not_include_redacted_events (10.89s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.131115185s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!gzSGEV5v5ygrxUIP9S:hs1/send/m.room.message/13 => 200 OK (150.332728ms)\n
    apidoc_search_test.go:80: SendEventSynced waiting for event ID $PvPXukuOhvr1gxHwdkO3ZHw0FvWo_UcY1azUmTXejfg\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.305041932s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/14 => 200 OK (219.196265ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $09UNNLUtUjrGxeYbGRa8iHEWDZiAiYfAptsIpdt53kQ\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.712268204s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!gzSGEV5v5ygrxUIP9S:hs1/send/m.room.message/15 => 200 OK (244.557296ms)\n
    apidoc_search_test.go:80: SendEventSynced waiting for event ID $aejqUdzgwJZMifBGgh84JA_rlla6OkH2PkL1Zi4sYzw\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.557285996s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/16 => 200 OK (144.308559ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $Typhc4ecsw8bFOukY70eJpAQHDQPO3dhg0CR5yWvOsc\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.912797637s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!gzSGEV5v5ygrxUIP9S:hs1/send/m.room.message/17 => 200 OK (160.974048ms)\n
    apidoc_search_test.go:80: SendEventSynced waiting for event ID $clG3Xk-D9_ryrNkewWDIXnFikQcgnEY-wLSPeNQAiAs\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.830500586s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/18 => 200 OK (161.04979ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $I84OIDK-FtG-iVn0erte_qJm-jLaFmkLAZnddUzrIcM\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.802157308s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!gzSGEV5v5ygrxUIP9S:hs1/send/m.room.message/19 => 200 OK (163.793902ms)\n
    apidoc_search_test.go:80: SendEventSynced waiting for event ID $HImVIzBA9wl5LartWSIRrvbCx09-JbEmMvUbAX4R6x8\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.094417179s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/20 => 200 OK (164.436623ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $aCopKVcLEL5a75SNUXFcVANkCr-jlDrM3Da-TlcvJXI\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.296854107s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!gzSGEV5v5ygrxUIP9S:hs1/send/m.room.message/21 => 200 OK (134.126543ms)\n
    apidoc_search_test.go:80: SendEventSynced waiting for event ID $yHmSKZmaszowMNfCACh2cxlLa99MTUKDx065jNBoEq8\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.183232877s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/22 => 200 OK (148.109605ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $ku8yJYYGinVrIAiBJ3mbkTUR9R1sqS30ypXv8s60MnM\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.451967007s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!gzSGEV5v5ygrxUIP9S:hs1/send/m.room.message/23 => 200 OK (147.279841ms)\n
    apidoc_search_test.go:80: SendEventSynced waiting for event ID $Iz4lc_rSkmn9D8NuigY4ayk04y8TjhIjfm6Pf3rMmwU\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.457420646s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/24 => 200 OK (206.619578ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $K2EyMf1z2fuMhgOxnBCLEe7GMENUYMz1MmlM6jlfBEE\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.092706698s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!gzSGEV5v5ygrxUIP9S:hs1/send/m.room.message/25 => 200 OK (168.442444ms)\n
    apidoc_search_test.go:80: SendEventSynced waiting for event ID $FrQ_DNNXFDdcD0XC_Uwix0mV0UbubLT66FEFlVsOSZM\n
    federation_room_join_test.go:130: Deploy times: 13.634398ms blueprints, 15.464009462s containers\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.070651294s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/26 => 200 OK (203.593648ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $Ot0-t2AHq5uknjFM-0jcIb7yeyrm0zGtiIqzOlX_6O8\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (675.233744ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.045838804s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/search => 200 OK (21.176805ms)\n
    apidoc_search_test.go:112: \u001b[31mMatchResponse key 'search_categories.room_events.results.0.context.events_before.0.content.body' missing - http://127.0.0.1:32955/_matrix/client/v3/search => {"search_categories":{"room_events":{"count":1,"next_batch":"1740266508561-90","results":[{"rank":0.05000000074505806,"result":{"content":{"body":"Message number 4","msgtype":"m.text"},"event_id":"$HImVIzBA9wl5LartWSIRrvbCx09-JbEmMvUbAX4R6x8","origin_server_ts":1740266508561,"room_id":"!gzSGEV5v5ygrxUIP9S:hs1","sender":"@user-1:hs1","type":"m.room.message","unsigned":{"transaction_id":"19"}}}],"highlights":["message","4"]}}}\u001b[39m\n
--- FAIL: TestSearch/parallel/Can_get_context_around_search_results (16.65s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.508250285s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/27 => 200 OK (77.73825ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $XyzWmAiXq_9zbwRmIdusqAyUKYjVJpRJkgjQ554howM\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (647.138894ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/28 => 200 OK (49.859669ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $1LrU0qiUakZgR7r--IpHG3BjvQyaxrl_vP3QnK-_eqA\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (874.895621ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/29 => 200 OK (88.277413ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $tEwzuhaR-lqoNm0zbrMdwiKz096ComM-CMBQZmFnhdw\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/capabilities => 200 OK (4.416034ms)\n
null
=== RUN   TestJoinFederatedRoomWithUnverifiableEvents//send_join_response_missing_signatures_shouldn't_block_room_join\n
    server.go:185: Creating room !0-nPooV2n6Ky6yMmcTGg:host.docker.internal:43321 with version 10\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/#MissingSignatures:host.docker.internal:43321 => 400 Bad Request (60.760574ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:32957/_matrix/client/v3/join/%23MissingSignatures:host.docker.internal:43321 returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Answer from host.docker.internal:43321: {\\n\\t\\t\\t\\t\\"errcode\\": \\"M_NOT_FOUND\\",\\n\\t\\t\\t\\t\\"error\\": \\"Room alias not found.\\"\\n\\t\\t\\t}"}\u001b[39m\n
--- FAIL: TestJoinFederatedRoomWithUnverifiableEvents//send_join_response_missing_signatures_shouldn't_block_room_join (0.06s)\n
null
null
=== RUN   TestJoinFederatedRoomWithUnverifiableEvents//send_join_response_with_bad_signatures_shouldn't_block_room_join\n
    server.go:185: Creating room !1-h86FAktL6GAbaxcg8r:host.docker.internal:43321 with version 10\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/#BadSignatures:host.docker.internal:43321 => 400 Bad Request (19.160244ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:32957/_matrix/client/v3/join/%23BadSignatures:host.docker.internal:43321 returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Answer from host.docker.internal:43321: {\\n\\t\\t\\t\\t\\"errcode\\": \\"M_NOT_FOUND\\",\\n\\t\\t\\t\\t\\"error\\": \\"Room alias not found.\\"\\n\\t\\t\\t}"}\u001b[39m\n
--- FAIL: TestJoinFederatedRoomWithUnverifiableEvents//send_join_response_with_bad_signatures_shouldn't_block_room_join (0.02s)\n
null
null
=== RUN   TestJoinFederatedRoomWithUnverifiableEvents//send_join_response_with_unobtainable_keys_shouldn't_block_room_join\n
    server.go:185: Creating room !2-saphxgWjs4Xz9Jotlg:host.docker.internal:43321 with version 10\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/#UnobtainableKeys:host.docker.internal:43321 => 400 Bad Request (17.619406ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:32957/_matrix/client/v3/join/%23UnobtainableKeys:host.docker.internal:43321 returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Answer from host.docker.internal:43321: {\\n\\t\\t\\t\\t\\"errcode\\": \\"M_NOT_FOUND\\",\\n\\t\\t\\t\\t\\"error\\": \\"Room alias not found.\\"\\n\\t\\t\\t}"}\u001b[39m\n
--- FAIL: TestJoinFederatedRoomWithUnverifiableEvents//send_join_response_with_unobtainable_keys_shouldn't_block_room_join (0.02s)\n
null
null
=== RUN   TestJoinFederatedRoomWithUnverifiableEvents//send_join_response_with_state_with_unverifiable_auth_events_shouldn't_block_room_join\n
    federation_room_join_test.go:237: WARNING: TestJoinFederatedRoomWithUnverifiableEvents//send_join_response_with_state_with_unverifiable_auth_events_shouldn't_block_room_join called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    server.go:185: Creating room !3-2WrZx68QqHtdrGkhiG:host.docker.internal:43321 with version 10\n
    federation_room_join_test.go:265: Created badly signed auth event $nGikqYk7j0JBeL2qw1fDoWOo8PUdPpX3JVhNo5Dl__U\n
    federation_room_join_test.go:288: Created state event $MfvmFg8QIh2hwqFJ2woHwxrhY1vpOCIuPVZHBk6YW24\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/#UnverifiableAuthEvents:host.docker.internal:43321 => 400 Bad Request (18.004804ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:32957/_matrix/client/v3/join/%23UnverifiableAuthEvents:host.docker.internal:43321 returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Answer from host.docker.internal:43321: {\\n\\t\\t\\t\\t\\"errcode\\": \\"M_NOT_FOUND\\",\\n\\t\\t\\t\\t\\"error\\": \\"Room alias not found.\\"\\n\\t\\t\\t}"}\u001b[39m\n
--- FAIL: TestJoinFederatedRoomWithUnverifiableEvents//send_join_response_with_state_with_unverifiable_auth_events_shouldn't_block_room_join (0.02s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (750.746038ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/30 => 200 OK (103.477937ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $ENIuBbAYqn13Mwd9HbGD5us6aatSUY_SwCJCtQtXcR8\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (900.54035ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/31 => 200 OK (106.108357ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $g8tTVT3YbG_mJOSNNWzHG6l1C7inMU4aMU1LrntW2Ao\n
2025/02/23 07:22:00 ============================================\n
\n
\n
2025/02/23 07:22:00 23043edca9ce6f5336b78655489f04788bec299054e629903b2899d1bc6caad6 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=23043edca9ce\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 23043edca9ce 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266511.9224193,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266511.9288645,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266511.9288945,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
  \u001b[2m2025-02-22T23:21:59.393801Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://host.docker.internal:43321/_matrix/federation/v1/query/directory?room_alias=#MissingSignatures:host.docker.internal:43321 404 Not Found: {\n
\t\t\t\t"errcode": "M_NOT_FOUND",\n
\t\t\t\t"error": "Room alias not found."\n
\t\t\t}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
  \u001b[2m2025-02-22T23:21:59.415093Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://host.docker.internal:43321/_matrix/federation/v1/query/directory?room_alias=#BadSignatures:host.docker.internal:43321 404 Not Found: {\n
\t\t\t\t"errcode": "M_NOT_FOUND",\n
\t\t\t\t"error": "Room alias not found."\n
\t\t\t}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
  \u001b[2m2025-02-22T23:21:59.434358Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://host.docker.internal:43321/_matrix/federation/v1/query/directory?room_alias=#UnobtainableKeys:host.docker.internal:43321 404 Not Found: {\n
\t\t\t\t"errcode": "M_NOT_FOUND",\n
\t\t\t\t"error": "Room alias not found."\n
\t\t\t}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
  \u001b[2m2025-02-22T23:21:59.454644Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://host.docker.internal:43321/_matrix/federation/v1/query/directory?room_alias=#UnverifiableAuthEvents:host.docker.internal:43321 404 Not Found: {\n
\t\t\t\t"errcode": "M_NOT_FOUND",\n
\t\t\t\t"error": "Room alias not found."\n
\t\t\t}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
2025/02/23 07:22:00 ============== 23043edca9ce6f5336b78655489f04788bec299054e629903b2899d1bc6caad6 : END LOGS ==============\n
\n
\n
--- FAIL: TestJoinFederatedRoomWithUnverifiableEvents (21.32s)\n
null
null
=== RUN   TestBannedUserCannotSendJoin\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (979.096679ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/32 => 200 OK (181.665773ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $JR1mPTXPVhEUgubC9ccnOGeeHfTC5gaBxnOumR-VCeU\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.209077392s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/33 => 200 OK (184.233267ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $gefw4GwXtLIrv1mQP6eluTlRgTcLaFZgHE1UFd05Gy8\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.741760252s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/34 => 200 OK (102.89082ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $V7som_LODugEMOVISP-L9B8qpLurXs-o173NcanZUUo\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.288035289s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/35 => 200 OK (122.913216ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $xpd9GnD_WNSIoJ-WyZJyUTOXYQZNlGMR4Sb4GmBc0yU\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.226949491s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!z6wuPXUv4krX2P8q96:hs1/send/m.room.message/36 => 200 OK (90.090461ms)\n
    apidoc_search_test.go:140: SendEventSynced waiting for event ID $em0Mx8IRDe4viGSHdTxeKUssvHPEHL-s5BssgaS4D64\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.556141058s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/search => 200 OK (58.968362ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/search => 200 OK (72.566768ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/search => 200 OK (5.845143ms)\n
--- PASS: TestSearch/parallel/Can_back-paginate_search_results (37.45s)\n
null
--- FAIL: TestSearch/parallel (0.00s)\n
null
2025/02/23 07:22:10 ============================================\n
\n
\n
2025/02/23 07:22:10 49d6b1ffdf68dc2889b8803d30e8cc78a4a0716f7728c53850ade4dec8cdd338 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=49d6b1ffdf68\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 49d6b1ffdf68 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266486.2011974,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266486.2091694,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266486.2100189,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 19\n
To many layers, we have to go deeper frame_id: 20\n
To many layers, we have to go deeper frame_id: 21\n
To many layers, we have to go deeper frame_id: 29\n
To many layers, we have to go deeper frame_id: 36\n
To many layers, we have to go deeper frame_id: 43\n
2025/02/23 07:22:10 ============== 49d6b1ffdf68dc2889b8803d30e8cc78a4a0716f7728c53850ade4dec8cdd338 : END LOGS ==============\n
\n
\n
--- FAIL: TestSearch (64.60s)\n
null
null
=== RUN   TestServerCapabilities\n
    federation_room_join_test.go:296: Deploy times: 14.306335ms blueprints, 17.848686913s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (626.723444ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (321.7893ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!fj0dLn2PYOLEhnUBSd:hs1/state/m.room.member/@charlie:host.docker.internal:42167 => 200 OK (73.352527ms)\n
    federation_room_join_test.go:317: SendEventSynced waiting for event ID $QSh4qID2a2ZMxEqmEwGZBsMq32M13t8VAGvaWJGVIns\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (88.884739ms)\n
2025/02/23 07:22:23 complement: Transaction '4ZiInU8SX2IVlEmd7RK9FM5dZcmzzIyIIsjCy2aDR0U': Failed to find local room: !fj0dLn2PYOLEhnUBSd:hs1\n
    federation_room_join_test.go:345: SendJoin => 400/{"errcode":"M_BAD_JSON","error":"serde json error: missing field `pdu` at line 1 column 1191"}\n
    federation_room_join_test.go:347: expected 403, got 400\n
    federation_room_join_test.go:349: \u001b[31mMatchJSONBytes key 'errcode' got 'M_BAD_JSON' (type string) want 'M_FORBIDDEN' (type string) with input = {\n
          "errcode": "M_BAD_JSON",\n
          "error": "serde json error: missing field `pdu` at line 1 column 1191"\n
        }\n
        \u001b[39m\n
    apidoc_server_capabilities_test.go:14: Deploy times: 11.815996ms blueprints, 13.850674852s containers\n
2025/02/23 07:22:25 ============================================\n
\n
\n
2025/02/23 07:22:25 f7e1a19a1bf4834d3cbb6d923062c1a22a2a6c7b00eb224f965ff1cd7ad3c409 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=f7e1a19a1bf4\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux f7e1a19a1bf4 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266535.6387928,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266535.6446867,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266535.6447198,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:22:25 ============== f7e1a19a1bf4834d3cbb6d923062c1a22a2a6c7b00eb224f965ff1cd7ad3c409 : END LOGS ==============\n
\n
\n
--- FAIL: TestBannedUserCannotSendJoin (24.32s)\n
null
null
=== RUN   TestCannotSendNonJoinViaSendJoinV1\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (714.449251ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/capabilities => 200 OK (6.190362ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/capabilities => 401 Unauthorized (1.870701ms)\n
2025/02/23 07:22:27 ============================================\n
\n
\n
2025/02/23 07:22:27 ea75b53cbfd8f66cc3c5641a358ee6b5d180e64495d3d477519604d2b4db212c : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=ea75b53cbfd8\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux ea75b53cbfd8 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266541.9678798,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266541.973743,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266541.9738595,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:22:27 ============== ea75b53cbfd8f66cc3c5641a358ee6b5d180e64495d3d477519604d2b4db212c : END LOGS ==============\n
\n
\n
--- PASS: TestServerCapabilities (16.19s)\n
null
null
=== RUN   TestVersionStructure\n
    federation_room_join_test.go:395: Deploy times: 9.543934ms blueprints, 14.811989277s containers\n
    apidoc_version_test.go:24: Deploy times: 9.656572ms blueprints, 14.276800745s containers\n
null
=== RUN   TestVersionStructure/Version_responds_200_OK_with_valid_structure\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/versions => 200 OK (2.005274ms)\n
--- PASS: TestVersionStructure/Version_responds_200_OK_with_valid_structure (0.00s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (595.578819ms)\n
2025/02/23 07:22:42 ============================================\n
\n
\n
2025/02/23 07:22:42 6547274f470a77c561230801d1b4124f7219cf31d95c6de97fc2b3e1fa9282ae : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=6547274f470a\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 6547274f470a 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266558.5547347,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266558.5603285,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266558.5603669,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:22:42 ============== 6547274f470a77c561230801d1b4124f7219cf31d95c6de97fc2b3e1fa9282ae : END LOGS ==============\n
\n
\n
--- PASS: TestVersionStructure (15.77s)\n
null
null
=== RUN   TestDeviceListUpdates\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (321.672752ms)\n
    federation_room_join_test.go:409: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 49 52 52 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!sNRsTg17INR43cJcJC:hs1/$NrcRDvcsO67Whz_QpxbIXJvcAbgW3KNk6240JgzAw10") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1144\u001b[39m\n
2025/02/23 07:22:44 ============================================\n
\n
\n
2025/02/23 07:22:44 63d1920ea4e3c0c9f8469f894a87cdb3eb6a6aec7e5c2a2f6ba662b80428af4b : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=63d1920ea4e3\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 63d1920ea4e3 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266557.2458212,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266557.2506852,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266557.2507167,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:22:44 ============== 63d1920ea4e3c0c9f8469f894a87cdb3eb6a6aec7e5c2a2f6ba662b80428af4b : END LOGS ==============\n
\n
\n
--- FAIL: TestCannotSendNonJoinViaSendJoinV1 (19.51s)\n
null
null
=== RUN   TestCannotSendNonJoinViaSendJoinV2\n
    federation_room_join_test.go:395: Deploy times: 8.497396ms blueprints, 12.092069678s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (658.225758ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (565.251456ms)\n
    federation_room_join_test.go:409: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 49 52 52 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!Vz3OM95T9RZaPcnVHV:hs1/$zVrztOojrxmnlXwQW9MWyNtk4Ih-P7wsBW6p8QXDBHw") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1144\u001b[39m\n
2025/02/23 07:23:03 ============================================\n
\n
\n
2025/02/23 07:23:03 e8705ef7cc093864d341cc2bd27879a546a7e6893cb9b15e28523c1a1fd12a44 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=e8705ef7cc09\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux e8705ef7cc09 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266573.7232854,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266573.7304208,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266573.730668,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:23:03 ============== e8705ef7cc093864d341cc2bd27879a546a7e6893cb9b15e28523c1a1fd12a44 : END LOGS ==============\n
\n
\n
--- FAIL: TestCannotSendNonJoinViaSendJoinV2 (18.42s)\n
null
null
=== RUN   TestCannotSendNonLeaveViaSendLeaveV1\n
    federation_room_join_test.go:395: Deploy times: 9.962562ms blueprints, 11.529278734s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (611.76991ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (188.366364ms)\n
    federation_room_join_test.go:409: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 49 52 52 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!ck1EzouwfsiezI05se:hs1/$BJodJFnqyIiUrHpwBFcE4JjIgyBM4W2xsGQyjV0Seik") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1144\u001b[39m\n
2025/02/23 07:23:17 ============================================\n
\n
\n
2025/02/23 07:23:17 70a4210e3d0534eac5dc8595a4642376dc0cb3e4593cc8aaa9df85a88c14fd43 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=70a4210e3d05\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 70a4210e3d05 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266591.8306184,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266591.8370814,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266591.8372726,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:23:17 ============== 70a4210e3d0534eac5dc8595a4642376dc0cb3e4593cc8aaa9df85a88c14fd43 : END LOGS ==============\n
\n
\n
--- FAIL: TestCannotSendNonLeaveViaSendLeaveV1 (14.75s)\n
null
null
=== RUN   TestCannotSendNonLeaveViaSendLeaveV2\n
    federation_room_join_test.go:395: Deploy times: 12.411238ms blueprints, 12.486239939s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (595.961341ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (373.909896ms)\n
    federation_room_join_test.go:409: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 49 52 52 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!sqk31vBuDf93S85LJs:hs1/$cUZ6IhmYLMzKxH6X1vMjhpEn_lKpOneZOTc6RrS18HI") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1144\u001b[39m\n
2025/02/23 07:23:37 ============================================\n
\n
\n
2025/02/23 07:23:37 610132a6f5d627f9909e3b89532fa4543e9c3e361393419571a958d3d991a0fc : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=610132a6f5d6\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 610132a6f5d6 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266607.5449195,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266607.5491202,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266607.5491555,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:23:37 ============== 610132a6f5d627f9909e3b89532fa4543e9c3e361393419571a958d3d991a0fc : END LOGS ==============\n
\n
\n
--- FAIL: TestCannotSendNonLeaveViaSendLeaveV2 (19.68s)\n
null
null
=== RUN   TestSendJoinPartialStateResponse\n
    device_lists_test.go:432: Deploy times: 52.562241559s blueprints, 15.661769487s containers\n
null
=== RUN   TestDeviceListUpdates/when_local_user_joins_a_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (679.059545ms)\n
    federation_room_join_test.go:498: Deploy times: 23.143265ms blueprints, 14.690571897s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (591.353183ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (582.235425ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (410.464284ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!mzU54shu8aWLvuHbtC:hs1 => 200 OK (108.242624ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (148.411582ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (14.743895ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (660.654047ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (545.733982ms)\n
    device_lists_test.go:160: @user-1-alice:hs1 created test room !DzOoaKKlnGrRVAJVs5:hs1.\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (258.115956ms)\n
    device_lists_test.go:166: @user-2-bob:hs1 joins the test room.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!DzOoaKKlnGrRVAJVs5:hs1 => 200 OK (93.625989ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (106.681247ms)\n
    device_lists_test.go:171: @user-1-alice:hs1 expects a device list change for @user-2-bob:hs1...\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (752.142689ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (67.769941ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/query => 200 OK (12.992101ms)\n
    device_lists_test.go:133: Sending and waiting for dummy device list update...\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (23.798716ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (34.236732ms)\n
    device_lists_test.go:184: @user-2-bob:hs1 updates their device list.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (23.010196ms)\n
    device_lists_test.go:188: @user-1-alice:hs1 expects a device list change for @user-2-bob:hs1...\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (30.003812ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/query => 200 OK (9.244686ms)\n
--- PASS: TestDeviceListUpdates/when_local_user_joins_a_room (3.74s)\n
null
null
=== RUN   TestDeviceListUpdates/when_remote_user_joins_a_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (433.525229ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!GANu21meB3ygBoAGRP:hs1 => 200 OK (138.381459ms)\n
    federation_room_join_test.go:539: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 49 57 49 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!GANu21meB3ygBoAGRP:hs1/$ZvvRJtmg8IgSKDZoWpP5QU2uJOkSa5N0QgPfcpoVz9E") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1191\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (639.199554ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (636.325169ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (577.732336ms)\n
2025/02/23 07:23:57 ============================================\n
\n
\n
2025/02/23 07:23:57 a8fc099540fc35e53678343acb7f42563c0b037c7eeaef34981180fbaafe2252 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=a8fc099540fc\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux a8fc099540fc 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266629.0792823,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266629.088891,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266629.0889843,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:23:57 ============== a8fc099540fc35e53678343acb7f42563c0b037c7eeaef34981180fbaafe2252 : END LOGS ==============\n
\n
\n
--- FAIL: TestSendJoinPartialStateResponse (19.55s)\n
null
null
=== RUN   TestJoinFederatedRoomFromApplicationServiceBridgeUser\n
    federation_room_join_test.go:584: WARNING: TestJoinFederatedRoomFromApplicationServiceBridgeUser called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/createRoom => 200 OK (467.871718ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!ZsqmAWjZqT8N238Sgz:hs2 => 200 OK (770.07929ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (32.644737ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.030372773s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.081359687s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.036033595s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.052401125s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.076117062s)\n
    device_lists_test.go:156: \u001b[31m@user-4-alice:hs1 MustSyncUntil: timed out after 5.310808944s. Seen 6 /sync responses. Checkers:\n
        [t=32.897566ms] Response #1: SyncJoinedTo(!ZsqmAWjZqT8N238Sgz:hs2): Key rooms.join.!ZsqmAWjZqT8N238Sgz:hs2.timeline.events does not exist & Key rooms.join.!ZsqmAWjZqT8N238Sgz:hs2.state.events does not exist\n
        [t=1.064220521s] Response #2: SyncJoinedTo(!ZsqmAWjZqT8N238Sgz:hs2): Key rooms.join.!ZsqmAWjZqT8N238Sgz:hs2.timeline.events does not exist & Key rooms.join.!ZsqmAWjZqT8N238Sgz:hs2.state.events does not exist\n
        [t=2.145751634s] Response #3: SyncJoinedTo(!ZsqmAWjZqT8N238Sgz:hs2): Key rooms.join.!ZsqmAWjZqT8N238Sgz:hs2.timeline.events does not exist & Key rooms.join.!ZsqmAWjZqT8N238Sgz:hs2.state.events does not exist\n
        [t=3.181961834s] Response #4: SyncJoinedTo(!ZsqmAWjZqT8N238Sgz:hs2): Key rooms.join.!ZsqmAWjZqT8N238Sgz:hs2.timeline.events does not exist & Key rooms.join.!ZsqmAWjZqT8N238Sgz:hs2.state.events does not exist\n
        [t=4.234544722s] Response #5: SyncJoinedTo(!ZsqmAWjZqT8N238Sgz:hs2): Key rooms.join.!ZsqmAWjZqT8N238Sgz:hs2.timeline.events does not exist & Key rooms.join.!ZsqmAWjZqT8N238Sgz:hs2.state.events does not exist\n
        [t=5.3108061s] Response #6: SyncJoinedTo(!ZsqmAWjZqT8N238Sgz:hs2): Key rooms.join.!ZsqmAWjZqT8N238Sgz:hs2.timeline.events does not exist & Key rooms.join.!ZsqmAWjZqT8N238Sgz:hs2.state.events does not exist, \n
        \u001b[39m\n
--- FAIL: TestDeviceListUpdates/when_remote_user_joins_a_room (8.40s)\n
null
null
=== RUN   TestDeviceListUpdates/when_joining_a_room_with_a_local_user\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (629.948939ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (745.921717ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (665.320675ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (377.26688ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!RCBl02uwwE0vruwzgs:hs1 => 200 OK (122.11053ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (110.199569ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (20.684915ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (350.030232ms)\n
    device_lists_test.go:213: @user-8-bob:hs1 created test room !3oPgfYAdkfZojYLs8k:hs1.\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (66.703726ms)\n
    device_lists_test.go:219: @user-7-alice:hs1 joins the test room.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!3oPgfYAdkfZojYLs8k:hs1 => 200 OK (87.08217ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (102.199886ms)\n
    device_lists_test.go:224: @user-7-alice:hs1 expects a device list change for @user-8-bob:hs1...\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (111.424934ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/query => 200 OK (12.585371ms)\n
    device_lists_test.go:133: Sending and waiting for dummy device list update...\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (17.338811ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (37.744378ms)\n
    device_lists_test.go:237: @user-8-bob:hs1 updates their device list.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (15.693235ms)\n
    device_lists_test.go:241: @user-7-alice:hs1 expects a device list change for @user-8-bob:hs1...\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (29.499657ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/query => 200 OK (9.498317ms)\n
--- PASS: TestDeviceListUpdates/when_joining_a_room_with_a_local_user (3.52s)\n
null
null
=== RUN   TestDeviceListUpdates/when_joining_a_room_with_a_remote_user\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (608.10855ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (611.489154ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (559.785388ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/createRoom => 200 OK (454.787431ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!GdRfhEbFYlEaHtU0Zx:hs2 => 200 OK (495.312724ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (35.241198ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.044751426s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.055885937s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.090252287s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.08140603s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.037295299s)\n
    device_lists_test.go:209: \u001b[31m@user-10-alice:hs1 MustSyncUntil: timed out after 5.346877221s. Seen 6 /sync responses. Checkers:\n
        [t=35.868889ms] Response #1: SyncJoinedTo(!GdRfhEbFYlEaHtU0Zx:hs2): Key rooms.join.!GdRfhEbFYlEaHtU0Zx:hs2.timeline.events does not exist & Key rooms.join.!GdRfhEbFYlEaHtU0Zx:hs2.state.events does not exist\n
        [t=1.081176758s] Response #2: SyncJoinedTo(!GdRfhEbFYlEaHtU0Zx:hs2): Key rooms.join.!GdRfhEbFYlEaHtU0Zx:hs2.timeline.events does not exist & Key rooms.join.!GdRfhEbFYlEaHtU0Zx:hs2.state.events does not exist\n
        [t=2.137203687s] Response #3: SyncJoinedTo(!GdRfhEbFYlEaHtU0Zx:hs2): Key rooms.join.!GdRfhEbFYlEaHtU0Zx:hs2.timeline.events does not exist & Key rooms.join.!GdRfhEbFYlEaHtU0Zx:hs2.state.events does not exist\n
        [t=3.227688604s] Response #4: SyncJoinedTo(!GdRfhEbFYlEaHtU0Zx:hs2): Key rooms.join.!GdRfhEbFYlEaHtU0Zx:hs2.timeline.events does not exist & Key rooms.join.!GdRfhEbFYlEaHtU0Zx:hs2.state.events does not exist\n
        [t=4.309408963s] Response #5: SyncJoinedTo(!GdRfhEbFYlEaHtU0Zx:hs2): Key rooms.join.!GdRfhEbFYlEaHtU0Zx:hs2.timeline.events does not exist & Key rooms.join.!GdRfhEbFYlEaHtU0Zx:hs2.state.events does not exist\n
        [t=5.346873785s] Response #6: SyncJoinedTo(!GdRfhEbFYlEaHtU0Zx:hs2): Key rooms.join.!GdRfhEbFYlEaHtU0Zx:hs2.timeline.events does not exist & Key rooms.join.!GdRfhEbFYlEaHtU0Zx:hs2.state.events does not exist, \n
        \u001b[39m\n
--- FAIL: TestDeviceListUpdates/when_joining_a_room_with_a_remote_user (8.08s)\n
null
null
=== RUN   TestDeviceListUpdates/when_local_user_leaves_a_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (633.702366ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (545.260909ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (617.771056ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (411.034961ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!Svo1sDDPqiiIKiIuPh:hs1 => 200 OK (108.929469ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (165.4417ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (11.046396ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (428.110399ms)\n
    device_lists_test.go:264: @user-13-alice:hs1 created test room !x6cfUrmyg8xsc6Hax0:hs1.\n
    device_lists_test.go:267: @user-14-bob:hs1 joins the test room.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!x6cfUrmyg8xsc6Hax0:hs1 => 200 OK (153.430008ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (136.885054ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (294.618006ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/query => 200 OK (8.430779ms)\n
    device_lists_test.go:133: Sending and waiting for dummy device list update...\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (13.333763ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (30.039176ms)\n
    device_lists_test.go:278: @user-14-bob:hs1 leaves the test room.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!x6cfUrmyg8xsc6Hax0:hs1/leave => 200 OK (100.57283ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (57.04552ms)\n
    device_lists_test.go:283: @user-13-alice:hs1 expects a device list left for @user-14-bob:hs1...\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (88.224795ms)\n
    device_lists_test.go:295: @user-14-bob:hs1 updates their device list.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (13.061745ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/query => 200 OK (10.962151ms)\n
    device_lists_test.go:300: @user-13-alice:hs1 expects no device list change for @user-14-bob:hs1...\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.029968946s)\n
--- PASS: TestDeviceListUpdates/when_local_user_leaves_a_room (4.86s)\n
null
null
=== RUN   TestDeviceListUpdates/when_remote_user_leaves_a_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (623.205381ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (613.747334ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (628.907395ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/createRoom => 200 OK (348.547274ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!94gSAmAe3SsRpurD3S:hs2 => 200 OK (380.547117ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (44.292578ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.038687584s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.065974059s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.079838438s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.036104158s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.01976784s)\n
    device_lists_test.go:260: \u001b[31m@user-16-alice:hs1 MustSyncUntil: timed out after 5.285753339s. Seen 6 /sync responses. Checkers:\n
        [t=44.568431ms] Response #1: SyncJoinedTo(!94gSAmAe3SsRpurD3S:hs2): Key rooms.join.!94gSAmAe3SsRpurD3S:hs2.timeline.events does not exist & Key rooms.join.!94gSAmAe3SsRpurD3S:hs2.state.events does not exist\n
        [t=1.08341964s] Response #2: SyncJoinedTo(!94gSAmAe3SsRpurD3S:hs2): Key rooms.join.!94gSAmAe3SsRpurD3S:hs2.timeline.events does not exist & Key rooms.join.!94gSAmAe3SsRpurD3S:hs2.state.events does not exist\n
        [t=2.149539698s] Response #3: SyncJoinedTo(!94gSAmAe3SsRpurD3S:hs2): Key rooms.join.!94gSAmAe3SsRpurD3S:hs2.timeline.events does not exist & Key rooms.join.!94gSAmAe3SsRpurD3S:hs2.state.events does not exist\n
        [t=3.22953437s] Response #4: SyncJoinedTo(!94gSAmAe3SsRpurD3S:hs2): Key rooms.join.!94gSAmAe3SsRpurD3S:hs2.timeline.events does not exist & Key rooms.join.!94gSAmAe3SsRpurD3S:hs2.state.events does not exist\n
        [t=4.265795153s] Response #5: SyncJoinedTo(!94gSAmAe3SsRpurD3S:hs2): Key rooms.join.!94gSAmAe3SsRpurD3S:hs2.timeline.events does not exist & Key rooms.join.!94gSAmAe3SsRpurD3S:hs2.state.events does not exist\n
        [t=5.285750875s] Response #6: SyncJoinedTo(!94gSAmAe3SsRpurD3S:hs2): Key rooms.join.!94gSAmAe3SsRpurD3S:hs2.timeline.events does not exist & Key rooms.join.!94gSAmAe3SsRpurD3S:hs2.state.events does not exist, \n
        \u001b[39m\n
--- FAIL: TestDeviceListUpdates/when_remote_user_leaves_a_room (7.88s)\n
null
null
=== RUN   TestDeviceListUpdates/when_leaving_a_room_with_a_local_user\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (564.909526ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (599.342837ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (563.365576ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (418.51831ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!WezgykArwiVeJeDwPj:hs1 => 200 OK (69.253378ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (134.825814ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (13.221305ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (284.157586ms)\n
    device_lists_test.go:321: @user-20-bob:hs1 created test room !FdoRBmC2owxuOIaPM3:hs1.\n
    device_lists_test.go:324: @user-19-alice:hs1 joins the test room.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!FdoRBmC2owxuOIaPM3:hs1 => 200 OK (61.024383ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (57.443469ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (140.369838ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/query => 200 OK (6.673406ms)\n
    device_lists_test.go:133: Sending and waiting for dummy device list update...\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (13.447484ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (20.450394ms)\n
    device_lists_test.go:335: @user-19-alice:hs1 leaves the test room.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!FdoRBmC2owxuOIaPM3:hs1/leave => 200 OK (43.414033ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (43.456426ms)\n
    device_lists_test.go:340: @user-19-alice:hs1 expects a device list left for @user-20-bob:hs1...\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (33.661654ms)\n
    device_lists_test.go:352: @user-20-bob:hs1 updates their device list.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (14.757987ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/query => 200 OK (13.857769ms)\n
    device_lists_test.go:357: @user-19-alice:hs1 expects no device list change for @user-20-bob:hs1...\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (43.286241ms)\n
--- PASS: TestDeviceListUpdates/when_leaving_a_room_with_a_local_user (3.15s)\n
null
null
=== RUN   TestDeviceListUpdates/when_leaving_a_room_with_a_remote_user\n
    device_lists_test.go:443: WARNING: TestDeviceListUpdates/when_leaving_a_room_with_a_remote_user called runtime.SkipIf([synapse]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (639.283159ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (607.575492ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (517.419644ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/createRoom => 200 OK (331.420875ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!dkeuzQaagDbG0ReJxK:hs2 => 200 OK (574.4801ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (47.91136ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.036849384s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.053095131s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.03086337s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.029864896s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.042466345s)\n
    device_lists_test.go:317: \u001b[31m@user-22-alice:hs1 MustSyncUntil: timed out after 5.242161919s. Seen 6 /sync responses. Checkers:\n
        [t=48.204348ms] Response #1: SyncJoinedTo(!dkeuzQaagDbG0ReJxK:hs2): Key rooms.join.!dkeuzQaagDbG0ReJxK:hs2.timeline.events does not exist & Key rooms.join.!dkeuzQaagDbG0ReJxK:hs2.state.events does not exist\n
        [t=1.085242064s] Response #2: SyncJoinedTo(!dkeuzQaagDbG0ReJxK:hs2): Key rooms.join.!dkeuzQaagDbG0ReJxK:hs2.timeline.events does not exist & Key rooms.join.!dkeuzQaagDbG0ReJxK:hs2.state.events does not exist\n
        [t=2.138500859s] Response #3: SyncJoinedTo(!dkeuzQaagDbG0ReJxK:hs2): Key rooms.join.!dkeuzQaagDbG0ReJxK:hs2.timeline.events does not exist & Key rooms.join.!dkeuzQaagDbG0ReJxK:hs2.state.events does not exist\n
        [t=3.169533633s] Response #4: SyncJoinedTo(!dkeuzQaagDbG0ReJxK:hs2): Key rooms.join.!dkeuzQaagDbG0ReJxK:hs2.timeline.events does not exist & Key rooms.join.!dkeuzQaagDbG0ReJxK:hs2.state.events does not exist\n
        [t=4.19955929s] Response #5: SyncJoinedTo(!dkeuzQaagDbG0ReJxK:hs2): Key rooms.join.!dkeuzQaagDbG0ReJxK:hs2.timeline.events does not exist & Key rooms.join.!dkeuzQaagDbG0ReJxK:hs2.state.events does not exist\n
        [t=5.242160065s] Response #6: SyncJoinedTo(!dkeuzQaagDbG0ReJxK:hs2): Key rooms.join.!dkeuzQaagDbG0ReJxK:hs2.timeline.events does not exist & Key rooms.join.!dkeuzQaagDbG0ReJxK:hs2.state.events does not exist, \n
        \u001b[39m\n
--- FAIL: TestDeviceListUpdates/when_leaving_a_room_with_a_remote_user (7.91s)\n
null
null
=== RUN   TestDeviceListUpdates/when_local_user_rejoins_a_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (605.903447ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (583.843752ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (485.730892ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (186.266373ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!roFLuv0T8GDpD0idcp:hs1 => 200 OK (88.026891ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (193.483543ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (13.896897ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (224.228338ms)\n
    device_lists_test.go:378: @user-25-alice:hs1 created test room !iABC5iwu9Bf18IEPHK:hs1.\n
    device_lists_test.go:381: @user-26-bob:hs1 joins the test room.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!iABC5iwu9Bf18IEPHK:hs1 => 200 OK (51.803641ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (99.451616ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (176.078932ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/query => 200 OK (7.640056ms)\n
    device_lists_test.go:133: Sending and waiting for dummy device list update...\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (14.152501ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (36.974066ms)\n
    device_lists_test.go:393: @user-26-bob:hs1 leaves the test room.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!iABC5iwu9Bf18IEPHK:hs1/leave => 200 OK (107.581374ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (42.273595ms)\n
    device_lists_test.go:398: @user-25-alice:hs1 expects a device list left for @user-26-bob:hs1...\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (95.968879ms)\n
    device_lists_test.go:409: @user-26-bob:hs1 updates their device list.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (10.755161ms)\n
    device_lists_test.go:413: @user-26-bob:hs1 joins the test room.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!iABC5iwu9Bf18IEPHK:hs1 => 200 OK (125.432054ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (110.349201ms)\n
    device_lists_test.go:419: @user-25-alice:hs1 expects a device list change for @user-26-bob:hs1...\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (5.101562ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (111.290801ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/query => 200 OK (13.401084ms)\n
--- PASS: TestDeviceListUpdates/when_local_user_rejoins_a_room (3.39s)\n
null
null
=== RUN   TestDeviceListUpdates/when_remote_user_rejoins_a_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (542.284992ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (615.950952ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (594.448925ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/createRoom => 200 OK (308.078035ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!RKEJyo2j0kblu5YqFU:hs2 => 200 OK (292.625508ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (44.36655ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.028793367s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.04679803s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.031687516s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.089212903s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.025206513s)\n
    device_lists_test.go:374: \u001b[31m@user-28-alice:hs1 MustSyncUntil: timed out after 5.267115405s. Seen 6 /sync responses. Checkers:\n
        [t=44.65991ms] Response #1: SyncJoinedTo(!RKEJyo2j0kblu5YqFU:hs2): Key rooms.join.!RKEJyo2j0kblu5YqFU:hs2.timeline.events does not exist & Key rooms.join.!RKEJyo2j0kblu5YqFU:hs2.state.events does not exist\n
        [t=1.073590102s] Response #2: SyncJoinedTo(!RKEJyo2j0kblu5YqFU:hs2): Key rooms.join.!RKEJyo2j0kblu5YqFU:hs2.timeline.events does not exist & Key rooms.join.!RKEJyo2j0kblu5YqFU:hs2.state.events does not exist\n
        [t=2.120554282s] Response #3: SyncJoinedTo(!RKEJyo2j0kblu5YqFU:hs2): Key rooms.join.!RKEJyo2j0kblu5YqFU:hs2.timeline.events does not exist & Key rooms.join.!RKEJyo2j0kblu5YqFU:hs2.state.events does not exist\n
        [t=3.152385824s] Response #4: SyncJoinedTo(!RKEJyo2j0kblu5YqFU:hs2): Key rooms.join.!RKEJyo2j0kblu5YqFU:hs2.timeline.events does not exist & Key rooms.join.!RKEJyo2j0kblu5YqFU:hs2.state.events does not exist\n
        [t=4.241767351s] Response #5: SyncJoinedTo(!RKEJyo2j0kblu5YqFU:hs2): Key rooms.join.!RKEJyo2j0kblu5YqFU:hs2.timeline.events does not exist & Key rooms.join.!RKEJyo2j0kblu5YqFU:hs2.state.events does not exist\n
        [t=5.267112501s] Response #6: SyncJoinedTo(!RKEJyo2j0kblu5YqFU:hs2): Key rooms.join.!RKEJyo2j0kblu5YqFU:hs2.timeline.events does not exist & Key rooms.join.!RKEJyo2j0kblu5YqFU:hs2.state.events does not exist, \n
        \u001b[39m\n
--- FAIL: TestDeviceListUpdates/when_remote_user_rejoins_a_room (7.62s)\n
null
2025/02/23 07:24:51 ============================================\n
\n
\n
2025/02/23 07:24:51 e87e7c855f2f693d65671dd00c8a06086c12dc1294046bedd7a88b7768353ba7 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=e87e7c855f2f\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux e87e7c855f2f 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266627.9234507,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266627.932169,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266627.9322116,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 11\n
To many layers, we have to go deeper frame_id: 17\n
To many layers, we have to go deeper frame_id: 23\n
To many layers, we have to go deeper frame_id: 29\n
2025/02/23 07:24:51 ============== e87e7c855f2f693d65671dd00c8a06086c12dc1294046bedd7a88b7768353ba7 : END LOGS ==============\n
\n
\n
2025/02/23 07:24:52 ============================================\n
\n
\n
2025/02/23 07:24:52 f63c87795b8bcc6398366b2961770f10f04e8ffa9c8378e757878e0c7daedfdb : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=f63c87795b8b\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux f63c87795b8b 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266627.9715884,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266627.9759521,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266627.9762142,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs2"  servername:"hs1"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs2:8448/_matrix/federation/v1/make_join/!ZsqmAWjZqT8N238Sgz:hs2/@user-4-alice:hs1?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "907", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:23:56 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$Fm0LddJSrSIn1mBITMXhPDJbLexCBVH1L7TQipiENTc","$7TjHWv5Ru8nmgFazVDHxBSyJ8P3skQ4uix6wkjI0U-w","$DpU10Ty_GG7SHO1Y8xh5kVjj7wCtK23F2DrkGbXDDso"],"content":{"membership":"join"},"depth":7,"event_sn":12,"hashes":{"sha256":"X5Y5AhZBa0b2DAF2sUMUx+iAAncS7CnTeQDswsvs0Wc"},"origin":"hs2","origin_server_ts":1740266637650,"prev_events":["$4qgMO3i6r4RUuPzRaoDQtfL_oxB98dbi619zemrwUj0","$7TjHWv5Ru8nmgFazVDHxBSyJ8P3skQ4uix6wkjI0U-w","$DpU10Ty_GG7SHO1Y8xh5kVjj7wCtK23F2DrkGbXDDso","$FRnt3U1dKqq3Vwv-y7VvkmIkTpzFGqnt8iTVryyuFBA","$Fm0LddJSrSIn1mBITMXhPDJbLexCBVH1L7TQipiENTc","$pMGwWbgGCAreT6wi-ESlIlsbPvZ1Oz_JO6ND466g5Rw"],"room_id":"!ZsqmAWjZqT8N238Sgz:hs2","sender":"@user-4-alice:hs1","signatures":{"hs2":{"ed25519:TgexhwsB":"uiObXpz5iTOJt+jQob1iOu2a5ARdCWCExaLm8ltBK+pD0jCV+0InNctrzx9gNQPD1+fB/attiMGqG9/4xsgMDQ"}},"state_key":"@user-4-alice:hs1","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:23:57.969057Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
  \u001b[2m2025-02-22T23:23:58.172053Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $vkxD2ByuRWhTT_5n5CH5MuOhrB6QoeRHX_4QPWb5ewQ\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:23:59.254569Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $vkxD2ByuRWhTT_5n5CH5MuOhrB6QoeRHX_4QPWb5ewQ\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:00.294297Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $vkxD2ByuRWhTT_5n5CH5MuOhrB6QoeRHX_4QPWb5ewQ\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:01.344603Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $vkxD2ByuRWhTT_5n5CH5MuOhrB6QoeRHX_4QPWb5ewQ\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:02.397053Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $vkxD2ByuRWhTT_5n5CH5MuOhrB6QoeRHX_4QPWb5ewQ\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
To many layers, we have to go deeper frame_id: 21\n
To many layers, we have to go deeper frame_id: 28\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs2"  servername:"hs1"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs2:8448/_matrix/federation/v1/make_join/!GdRfhEbFYlEaHtU0Zx:hs2/@user-10-alice:hs1?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "909", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:24:08 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$uYgD7Ay8h3WPngXnKX-pAt2Lj6mvVYYL2Hpm9M319OE","$8cE3f3dG9jFo8sRJQ-T9EtQhoaK8af-si2osAlsS58U","$_s-bM-11lf0ZwYxMEpMeYj33txeG48DxnGA4kM-UAVk"],"content":{"membership":"join"},"depth":7,"event_sn":24,"hashes":{"sha256":"k4bCuCnCZZxRn8cm/tfG5QKnc4oMpgTsCnU3DrYU4UY"},"origin":"hs2","origin_server_ts":1740266649280,"prev_events":["$8cE3f3dG9jFo8sRJQ-T9EtQhoaK8af-si2osAlsS58U","$KyBeMNXIteVSu1LwE1Z83sPraHf1J6b9Ec4l_o70v4M","$LUaTXQveUrTXQ226CqjJ09le8FP6By53N5InX6BqhEs","$_s-bM-11lf0ZwYxMEpMeYj33txeG48DxnGA4kM-UAVk","$hllGWFfRSdvDpdxsoGeGWobAA1f6dREwOzNxPAj-jlU","$uYgD7Ay8h3WPngXnKX-pAt2Lj6mvVYYL2Hpm9M319OE"],"room_id":"!GdRfhEbFYlEaHtU0Zx:hs2","sender":"@user-10-alice:hs1","signatures":{"hs2":{"ed25519:TgexhwsB":"sYyjmmidhctHM+cAAjIde5Oq1P8L3Vd0iRpduVfHQB78ZLXe9EHJvjCtzTVeJPSbSlRcj50yqZbre9JbHH07AQ"}},"state_key":"@user-10-alice:hs1","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:24:09.749098Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $c_O1lmy6X5vXwSgm_pbnfqyeaK6n1Vmn3gHc5T-_fA0\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:10.802136Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $c_O1lmy6X5vXwSgm_pbnfqyeaK6n1Vmn3gHc5T-_fA0\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:11.892928Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $c_O1lmy6X5vXwSgm_pbnfqyeaK6n1Vmn3gHc5T-_fA0\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:12.968630Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $c_O1lmy6X5vXwSgm_pbnfqyeaK6n1Vmn3gHc5T-_fA0\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:14.023945Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $c_O1lmy6X5vXwSgm_pbnfqyeaK6n1Vmn3gHc5T-_fA0\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
To many layers, we have to go deeper frame_id: 37\n
To many layers, we have to go deeper frame_id: 44\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs2"  servername:"hs1"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs2:8448/_matrix/federation/v1/make_join/!94gSAmAe3SsRpurD3S:hs2/@user-16-alice:hs1?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "909", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:24:21 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$0rEbZLsaeJQZkWS_W5WTWWKnGOSxP7cp5OuE4rq6Sg4","$WCkl-hFqegyW91SN5qtWlMg0Fc0cXaNMOjDubQLRt_s","$i-EsCER11wlxzwxE4gGcese55Wcl6MOUAhhhHAGkQ50"],"content":{"membership":"join"},"depth":7,"event_sn":36,"hashes":{"sha256":"xc/w+V6i8BkcSA7+/ZtKMJwB8oCWLHrK2SpytNtPydE"},"origin":"hs2","origin_server_ts":1740266662188,"prev_events":["$0rEbZLsaeJQZkWS_W5WTWWKnGOSxP7cp5OuE4rq6Sg4","$P5Y0PFLRNw73Wf9Y5lyxiUtz5GEMV6YtKlN0KLJ5ujI","$WCkl-hFqegyW91SN5qtWlMg0Fc0cXaNMOjDubQLRt_s","$i-EsCER11wlxzwxE4gGcese55Wcl6MOUAhhhHAGkQ50","$vd0de4Qr7l7rvAKtrSoX00ZLmjgnSQ7U6avVahGeo0M","$xSHWMa3zm9zhYPQQxko6qmvSw5xu0GbHgLak_3ENkpk"],"room_id":"!94gSAmAe3SsRpurD3S:hs2","sender":"@user-16-alice:hs1","signatures":{"hs2":{"ed25519:TgexhwsB":"apRqsOtWmYIhT+H+KAu8MuWlQZf1PeZTOq93wVmquIkIypEAAdhwoeiq4gsUC6Dh0nL8REpUJsK+tYthTIRfDg"}},"state_key":"@user-16-alice:hs1","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:24:22.557057Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $CNLCFR2Y_9UGT63_t9Ogshl41U2KV1ygq3xFW3HUOMs\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:23.618726Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $CNLCFR2Y_9UGT63_t9Ogshl41U2KV1ygq3xFW3HUOMs\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:24.688983Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $CNLCFR2Y_9UGT63_t9Ogshl41U2KV1ygq3xFW3HUOMs\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:25.745057Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $CNLCFR2Y_9UGT63_t9Ogshl41U2KV1ygq3xFW3HUOMs\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:26.772276Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $CNLCFR2Y_9UGT63_t9Ogshl41U2KV1ygq3xFW3HUOMs\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
To many layers, we have to go deeper frame_id: 54\n
To many layers, we have to go deeper frame_id: 61\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs2"  servername:"hs1"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs2:8448/_matrix/federation/v1/make_join/!dkeuzQaagDbG0ReJxK:hs2/@user-22-alice:hs1?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "909", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:24:32 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$DoBITi9l0kttxMqe6DDTFMf4UoEaBxTFXpH9jO0NAwE","$4jO0KT7cXurbm-LGtf4tvAlCllWXnuumlm_zmAgZt-g","$cAn4oNfWAXnZbvnm0cOHXRmCtWjbXMw2C-pT9cqM_uY"],"content":{"membership":"join"},"depth":7,"event_sn":48,"hashes":{"sha256":"UVSy3qynCDyR++xMUGVxGv4palWfSIjH3/j0ayWt6OY"},"origin":"hs2","origin_server_ts":1740266673141,"prev_events":["$4jO0KT7cXurbm-LGtf4tvAlCllWXnuumlm_zmAgZt-g","$6KIXnnxS9w693u-nskM02ZoehvwWIXTtw4I2B1xUf9s","$DoBITi9l0kttxMqe6DDTFMf4UoEaBxTFXpH9jO0NAwE","$cAn4oNfWAXnZbvnm0cOHXRmCtWjbXMw2C-pT9cqM_uY","$tWdmV86r1s5uHpkJRmtFi_JMMuwq4zhOAA58MP5hdo4","$u0w4my3b9V5BsxEmT0C3UcagxnDJ5zeXjtBUkFOiuEc"],"room_id":"!dkeuzQaagDbG0ReJxK:hs2","sender":"@user-22-alice:hs1","signatures":{"hs2":{"ed25519:TgexhwsB":"EG0D3sTzUY/c2Dj4t6Ghvy6pEpsb2aNuFxYL0IGg8SFIHGJTINrMC4dFUBlxOM51XmWzQW+3b11+gJOkuqZ/Ag"}},"state_key":"@user-22-alice:hs1","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:24:33.668824Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $PCk32xPuD8rJgQrx2GiVSp0YGPDEasTYYHuLUpv7ic4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:34.713090Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $PCk32xPuD8rJgQrx2GiVSp0YGPDEasTYYHuLUpv7ic4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:35.757256Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $PCk32xPuD8rJgQrx2GiVSp0YGPDEasTYYHuLUpv7ic4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:36.784510Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $PCk32xPuD8rJgQrx2GiVSp0YGPDEasTYYHuLUpv7ic4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:37.820215Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $PCk32xPuD8rJgQrx2GiVSp0YGPDEasTYYHuLUpv7ic4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
To many layers, we have to go deeper frame_id: 71\n
To many layers, we have to go deeper frame_id: 78\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs2"  servername:"hs1"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs2:8448/_matrix/federation/v1/make_join/!RKEJyo2j0kblu5YqFU:hs2/@user-28-alice:hs1?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "909", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:24:43 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$HKmTrDEHKA0Ilt6nIhn0VUVniaL7oFzyoTWIRjSJnhw","$b1wRxSldryW4gsyqacmAloHW9NusZmAg0P2YZ66TqrI","$w_FJ7viyyCYCB3o34nuI6lpD_QBM9hqVzAHOf8Ut4hg"],"content":{"membership":"join"},"depth":7,"event_sn":60,"hashes":{"sha256":"60nofzgIuDeLiOpLuedKwLs0pEjdej8OZzyCP+Dt/ok"},"origin":"hs2","origin_server_ts":1740266684354,"prev_events":["$HKmTrDEHKA0Ilt6nIhn0VUVniaL7oFzyoTWIRjSJnhw","$IbvLWICaqucvt-WxZxdVvajBsYajoKpmRJle2awTaKM","$QAQJhuPpbF7JWGBBkoshGgRES3p-CUJoYvvUrt0nOPM","$R_RN1jYWzJJDa6kHp4OCxx1rlIosHBJ47ucKfFIer1o","$b1wRxSldryW4gsyqacmAloHW9NusZmAg0P2YZ66TqrI","$w_FJ7viyyCYCB3o34nuI6lpD_QBM9hqVzAHOf8Ut4hg"],"room_id":"!RKEJyo2j0kblu5YqFU:hs2","sender":"@user-28-alice:hs1","signatures":{"hs2":{"ed25519:TgexhwsB":"uTXBlh+JXPnALUmxxL4Q2K+0CL5X3RPhUTuShup6H8KLge/Bi/kUTbJ81CDaADMinFb4K8D+uVVGw8BlXy9VCQ"}},"state_key":"@user-28-alice:hs1","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:24:44.647263Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $TJ1yyZsT-O1mwwJv3sqswsC0d9mB8soTSokp0F-ZIMk\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:45.689816Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $TJ1yyZsT-O1mwwJv3sqswsC0d9mB8soTSokp0F-ZIMk\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:46.726533Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $TJ1yyZsT-O1mwwJv3sqswsC0d9mB8soTSokp0F-ZIMk\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:47.805436Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $TJ1yyZsT-O1mwwJv3sqswsC0d9mB8soTSokp0F-ZIMk\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
  \u001b[2m2025-02-22T23:24:48.846334Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $TJ1yyZsT-O1mwwJv3sqswsC0d9mB8soTSokp0F-ZIMk\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:561\n
\n
2025/02/23 07:24:52 ============== f63c87795b8bcc6398366b2961770f10f04e8ffa9c8378e757878e0c7daedfdb : END LOGS ==============\n
\n
\n
--- FAIL: TestDeviceListUpdates (129.75s)\n
null
null
=== RUN   TestE2EKeyBackupReplaceRoomKeyRules\n
    federation_room_join_test.go:586: OldDeploy times: 54.257781604s blueprints, 18.7596386s containers\n
    federation_room_join_test.go:591: WARNING: Deployment.Client - HS name 'hs1' - user ID '@the-bridge-user:hs1' - deviceID not found\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (602.457663ms)\n
null
=== RUN   TestJoinFederatedRoomFromApplicationServiceBridgeUser/join_remote_federated_room_as_application_service_user\n
    e2e_key_backup_test.go:27: Deploy times: 11.727728ms blueprints, 18.197037665s containers\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/createRoom => 200 OK (417.643016ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!7EbKR6m3AYUizZsHwt:hs2 => 401 Unauthorized (5.832147ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:32989/_matrix/client/v3/join/%217EbKR6m3AYUizZsHwt:hs2?server_name=hs2 returned non-2xx code: 401 Unauthorized - body: {"errcode":"M_UNKNOWN_TOKEN","error":"Unknown access token"}\u001b[39m\n
--- FAIL: TestJoinFederatedRoomFromApplicationServiceBridgeUser/join_remote_federated_room_as_application_service_user (0.42s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (673.52757ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/room_keys/version => 200 OK (19.715215ms)\n
null
=== RUN   TestE2EKeyBackupReplaceRoomKeyRules/parallel\n
null
=== RUN   TestE2EKeyBackupReplaceRoomKeyRules/parallel/{isVerified:false_firstMessageIndex:10_forwardedCount:5}\n
=== PAUSE TestE2EKeyBackupReplaceRoomKeyRules/parallel/{isVerified:false_firstMessageIndex:10_forwardedCount:5}\n
null
null
=== RUN   TestE2EKeyBackupReplaceRoomKeyRules/parallel/{isVerified:true_firstMessageIndex:10_forwardedCount:5}\n
=== PAUSE TestE2EKeyBackupReplaceRoomKeyRules/parallel/{isVerified:true_firstMessageIndex:10_forwardedCount:5}\n
null
null
=== CONT  TestE2EKeyBackupReplaceRoomKeyRules/parallel/{isVerified:false_firstMessageIndex:10_forwardedCount:5}\n
null
=== CONT  TestE2EKeyBackupReplaceRoomKeyRules/parallel/{isVerified:true_firstMessageIndex:10_forwardedCount:5}\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/a => 200 OK (11.304354ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/b => 200 OK (24.777127ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/a => 200 OK (16.598173ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/b => 200 OK (11.186028ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/a => 200 OK (12.282209ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/b => 200 OK (11.433467ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/a => 200 OK (20.314762ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/b => 200 OK (29.697017ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/a => 200 OK (18.720623ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/b => 200 OK (40.433951ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/a => 200 OK (50.075745ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/b => 200 OK (25.92672ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/a => 200 OK (15.80009ms)\n
--- PASS: TestE2EKeyBackupReplaceRoomKeyRules/parallel/{isVerified:false_firstMessageIndex:10_forwardedCount:5} (0.15s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/b => 200 OK (14.805247ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/b => 200 OK (12.0103ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/b => 200 OK (16.943532ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/b => 200 OK (10.920379ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/b => 200 OK (15.283005ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/b => 200 OK (11.213108ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/room_keys/keys/!foo:hs1/b => 200 OK (11.650422ms)\n
--- PASS: TestE2EKeyBackupReplaceRoomKeyRules/parallel/{isVerified:true_firstMessageIndex:10_forwardedCount:5} (0.24s)\n
null
--- PASS: TestE2EKeyBackupReplaceRoomKeyRules/parallel (0.00s)\n
null
2025/02/23 07:25:12 ============================================\n
\n
\n
2025/02/23 07:25:12 0774c665c6dc7d77ff99ad59ba607ac65a7135029371dcc71aa3cd9d0511ca03 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=0774c665c6dc\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 0774c665c6dc 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266706.4109473,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266706.4152787,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266706.4153054,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:25:12 ============== 0774c665c6dc7d77ff99ad59ba607ac65a7135029371dcc71aa3cd9d0511ca03 : END LOGS ==============\n
\n
\n
2025/02/23 07:25:13 ============================================\n
\n
\n
2025/02/23 07:25:13 cba41139898581d7fb96e2a8a92258a6d8f8932588453cc8663728313ccf7742 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=cba411398985\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux cba411398985 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266707.7992835,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266707.8047078,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266707.8050609,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:25:13 ============== cba41139898581d7fb96e2a8a92258a6d8f8932588453cc8663728313ccf7742 : END LOGS ==============\n
\n
\n
--- PASS: TestE2EKeyBackupReplaceRoomKeyRules (20.68s)\n
null
null
=== RUN   TestInviteFromIgnoredUsersDoesNotAppearInSync\n
2025/02/23 07:25:14 ============================================\n
\n
\n
2025/02/23 07:25:14 e97d722d1fb6cbc4bb9d3ab9801219cd4d3c693e01f89b862c7584907719eb09 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=e97d722d1fb6\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux e97d722d1fb6 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266706.6520681,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266706.660529,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266706.660558,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:25:14 ============== e97d722d1fb6cbc4bb9d3ab9801219cd4d3c693e01f89b862c7584907719eb09 : END LOGS ==============\n
\n
\n
--- FAIL: TestJoinFederatedRoomFromApplicationServiceBridgeUser (77.01s)\n
null
null
=== RUN   TestOutboundFederationSend\n
    ignored_users_test.go:31: Deploy times: 10.37306ms blueprints, 15.983030426s containers\n
    federation_room_send_test.go:32: Deploy times: 12.924301ms blueprints, 15.788210282s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (600.703747ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (629.813027ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (660.368661ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (586.030959ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (435.006572ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (112.593283ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/user/@user-1-alice:hs1/account_data/m.ignored_user_list => 200 OK (8.9647ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (76.902866ms)\n
    ignored_users_test.go:55: {"content":{"global":{"override":[{"actions":[],"conditions":[],"default":true,"enabled":false,"rule_id":".m.rule.master"},{"actions":[],"conditions":[{"key":"content.msgtype","kind":"event_match","pattern":"m.notice"}],"default":true,"enabled":true,"rule_id":".m.rule.suppress_notices"},{"actions":["notify",{"set_tweak":"sound","value":"default"},{"set_tweak":"highlight","value":false}],"conditions":[{"key":"type","kind":"event_match","pattern":"m.room.member"},{"key":"content.membership","kind":"event_match","pattern":"invite"},{"key":"state_key","kind":"event_match","pattern":"@user-1-alice:hs1"}],"default":true,"enabled":true,"rule_id":".m.rule.invite_for_me"},{"actions":[],"conditions":[{"key":"type","kind":"event_match","pattern":"m.room.member"}],"default":true,"enabled":true,"rule_id":".m.rule.member_event"},{"actions":["notify",{"set_tweak":"sound","value":"default"},{"set_tweak":"highlight"}],"conditions":[{"key":"content.m\\\\.mentions.user_ids","kind":"event_property_con
tains","value":"@user-1-alice:hs1"}],"default":true,"enabled":true,"rule_id":".m.rule.is_user_mention"},{"actions":["notify",{"set_tweak":"highlight"}],"conditions":[{"key":"content.m\\\\.mentions.room","kind":"event_property_is","value":true},{"key":"room","kind":"sender_notification_permission"}],"default":true,"enabled":true,"rule_id":".m.rule.is_room_mention"},{"actions":["notify",{"set_tweak":"highlight"}],"conditions":[{"key":"type","kind":"event_match","pattern":"m.room.tombstone"},{"key":"state_key","kind":"event_match","pattern":""}],"default":true,"enabled":true,"rule_id":".m.rule.tombstone"},{"actions":[],"conditions":[{"key":"type","kind":"event_match","pattern":"m.reaction"}],"default":true,"enabled":true,"rule_id":".m.rule.reaction"},{"actions":[],"conditions":[{"key":"type","kind":"event_match","pattern":"m.room.server_acl"},{"key":"state_key","kind":"event_match","pattern":""}],"default":true,"enabled":true,"rule_id":".m.rule.room.server_acl"},{"actions":[],"conditions":[{"key":"content.m\\\\.rela
tes_to.rel_type","kind":"event_property_is","value":"m.replace"}],"default":true,"enabled":true,"rule_id":".m.rule.suppress_edits"}],"underride":[{"actions":["notify",{"set_tweak":"sound","value":"ring"},{"set_tweak":"highlight","value":false}],"conditions":[{"key":"type","kind":"event_match","pattern":"m.call.invite"}],"default":true,"enabled":true,"rule_id":".m.rule.call"},{"actions":["notify",{"set_tweak":"sound","value":"default"},{"set_tweak":"highlight","value":false}],"conditions":[{"is":"2","kind":"room_member_count"},{"key":"type","kind":"event_match","pattern":"m.room.encrypted"}],"default":true,"enabled":true,"rule_id":".m.rule.encrypted_room_one_to_one"},{"actions":["notify",{"set_tweak":"sound","value":"default"},{"set_tweak":"highlight","value":false}],"conditions":[{"is":"2","kind":"room_member_count"},{"key":"type","kind":"event_match","pattern":"m.room.message"}],"default":true,"enabled":true,"rule_id":".m.rule.room_one_to_one"},{"actions":["notify",{"set_tweak":"highlight","value":false}],"c
onditions":[{"key":"type","kind":"event_match","pattern":"m.room.message"}],"default":true,"enabled":true,"rule_id":".m.rule.message"},{"actions":["notify",{"set_tweak":"highlight","value":false}],"conditions":[{"key":"type","kind":"event_match","pattern":"m.room.encrypted"}],"default":true,"enabled":true,"rule_id":".m.rule.encrypted"}]}},"type":"m.push_rules"}\n
    ignored_users_test.go:55: {"content":{"ignored_users":{"@user-2-bob:hs1":{}}},"type":"m.ignored_user_list"}\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (486.066716ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (607.235768ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (76.229168ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (23.836268ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/capabilities => 200 OK (4.537537ms)\n
    server.go:185: Creating room !0-1sJnHgQCowk3RZvE6L:host.docker.internal:35915 with version 10\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/#flibble:host.docker.internal:35915 => 400 Bad Request (53.539267ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:32995/_matrix/client/v3/join/%23flibble:host.docker.internal:35915?server_name=host.docker.internal returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Answer from host.docker.internal:35915: {\\n\\t\\t\\t\\t\\"errcode\\": \\"M_NOT_FOUND\\",\\n\\t\\t\\t\\t\\"error\\": \\"Room alias not found.\\"\\n\\t\\t\\t}"}\u001b[39m\n
2025/02/23 07:25:34 ============================================\n
\n
\n
2025/02/23 07:25:34 498485f8ebe56fcc5a6897e78fa2a99ac08bdc6d5d6cb4aa33493e5072846543 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=498485f8ebe5\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 498485f8ebe5 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266726.4177322,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266726.4252918,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266726.4253945,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 11\n
To many layers, we have to go deeper frame_id: 18\n
2025/02/23 07:25:34 ============== 498485f8ebe56fcc5a6897e78fa2a99ac08bdc6d5d6cb4aa33493e5072846543 : END LOGS ==============\n
\n
\n
2025/02/23 07:25:34 ============================================\n
\n
\n
2025/02/23 07:25:34 cfc355ba71831f8c41a5053f9a9f60025316c76b0fd296573573d1acfaf576b2 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=cfc355ba7183\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux cfc355ba7183 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266726.912441,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266726.9170725,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266726.917227,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
  \u001b[2m2025-02-22T23:25:33.235312Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://host.docker.internal:35915/_matrix/federation/v1/query/directory?room_alias=#flibble:host.docker.internal:35915 404 Not Found: {\n
\t\t\t\t"errcode": "M_NOT_FOUND",\n
\t\t\t\t"error": "Room alias not found."\n
\t\t\t}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
2025/02/23 07:25:34 ============== cfc355ba71831f8c41a5053f9a9f60025316c76b0fd296573573d1acfaf576b2 : END LOGS ==============\n
\n
\n
--- PASS: TestInviteFromIgnoredUsersDoesNotAppearInSync (21.13s)\n
null
null
=== RUN   TestJson\n
--- FAIL: TestOutboundFederationSend (20.57s)\n
null
null
=== RUN   TestNetworkPartitionOrdering\n
    federation_room_send_test.go:124: WARNING: TestNetworkPartitionOrdering called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    invalid_test.go:16: Deploy times: 12.782939ms blueprints, 17.638647495s containers\n
    federation_room_send_test.go:125: Deploy times: 17.510372ms blueprints, 17.792853606s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (598.669776ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (517.267114ms)\n
null
=== RUN   TestJson/Parallel\n
null
=== RUN   TestJson/Parallel/Invalid_numerical_values\n
=== PAUSE TestJson/Parallel/Invalid_numerical_values\n
null
null
=== RUN   TestJson/Parallel/Invalid_JSON_special_values\n
=== PAUSE TestJson/Parallel/Invalid_JSON_special_values\n
null
null
=== CONT  TestJson/Parallel/Invalid_numerical_values\n
null
=== CONT  TestJson/Parallel/Invalid_JSON_special_values\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!hu81mI9FuWK1HZB15I:hs1/send/complement.dummy => 400 Bad Request (31.394072ms)\n
    invalid_test.go:40: \u001b[31mMatchResponse key 'errcode' got 'M_UNKNOWN' (type string) want 'M_BAD_JSON' (type string) - http://127.0.0.1:32997/_matrix/client/v3/rooms/%!h(MISSING)u81mI9FuWK1HZB15I:hs1/send/complement.dummy => {"errcode":"M_UNKNOWN","error":"Signing event failed"}\u001b[39m\n
--- FAIL: TestJson/Parallel/Invalid_numerical_values (0.03s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!hu81mI9FuWK1HZB15I:hs1/send/complement.dummy => 400 Bad Request (76.092355ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!hu81mI9FuWK1HZB15I:hs1/send/complement.dummy => 400 Bad Request (32.229964ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!hu81mI9FuWK1HZB15I:hs1/send/complement.dummy => 400 Bad Request (40.697168ms)\n
--- PASS: TestJson/Parallel/Invalid_JSON_special_values (0.15s)\n
null
--- FAIL: TestJson/Parallel (0.00s)\n
null
2025/02/23 07:25:55 ============================================\n
\n
\n
2025/02/23 07:25:55 4e41726ec7ab0d326563d11b04a2a8063af354f434f22028c5e5c3d85ee1e6bb : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=4e41726ec7ab\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 4e41726ec7ab 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266748.8636618,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266748.8715494,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266748.87157,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:25:55 ============== 4e41726ec7ab0d326563d11b04a2a8063af354f434f22028c5e5c3d85ee1e6bb : END LOGS ==============\n
\n
\n
--- FAIL: TestJson (20.50s)\n
null
null
=== RUN   TestFilter\n
    invalid_test.go:172: WARNING: TestFilter called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (660.463785ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (616.301916ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/capabilities => 200 OK (10.163997ms)\n
    server.go:185: Creating room !0-ugmi8zeOoTqP4lSjry:host.docker.internal:32783 with version 10\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/#flibble:host.docker.internal:32783 => 400 Bad Request (60.583482ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:32999/_matrix/client/v3/join/%23flibble:host.docker.internal:32783?server_name=host.docker.internal returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Answer from host.docker.internal:32783: {\\n\\t\\t\\t\\t\\"errcode\\": \\"M_NOT_FOUND\\",\\n\\t\\t\\t\\t\\"error\\": \\"Room alias not found.\\"\\n\\t\\t\\t}"}\u001b[39m\n
2025/02/23 07:25:58 ============================================\n
\n
\n
2025/02/23 07:25:58 31425401ad3911e7531321050ecf1615bf4dcb170cb3d294fca090e046055b0b : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=31425401ad39\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 31425401ad39 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266748.9321165,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266748.9362912,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266748.9363198,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
  \u001b[2m2025-02-22T23:25:57.206938Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://host.docker.internal:32783/_matrix/federation/v1/query/directory?room_alias=#flibble:host.docker.internal:32783 404 Not Found: {\n
\t\t\t\t"errcode": "M_NOT_FOUND",\n
\t\t\t\t"error": "Room alias not found."\n
\t\t\t}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
2025/02/23 07:25:58 ============== 31425401ad3911e7531321050ecf1615bf4dcb170cb3d294fca090e046055b0b : END LOGS ==============\n
\n
\n
--- FAIL: TestNetworkPartitionOrdering (24.02s)\n
null
null
=== RUN   TestRemoteTyping\n
    invalid_test.go:174: Deploy times: 13.527966ms blueprints, 18.749561904s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (686.295165ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 400 Bad Request (6.093669ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 400 Bad Request (6.150285ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 400 Bad Request (4.588674ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 400 Bad Request (8.141137ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 400 Bad Request (12.874799ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 400 Bad Request (10.838288ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 400 Bad Request (6.335272ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 400 Bad Request (5.489203ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 400 Bad Request (5.295974ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 400 Bad Request (5.117086ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 400 Bad Request (4.136867ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 400 Bad Request (4.795685ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 400 Bad Request (5.148102ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 400 Bad Request (4.788122ms)\n
2025/02/23 07:26:16 ============================================\n
\n
\n
2025/02/23 07:26:16 cfce1f20014e6b5ff742edd162df215878db30c84bcafcc2dca66edae9a53409 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=cfce1f20014e\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux cfce1f20014e 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266770.8930166,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266770.8985765,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266770.898604,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:26:16 ============== cfce1f20014e6b5ff742edd162df215878db30c84bcafcc2dca66edae9a53409 : END LOGS ==============\n
\n
\n
--- PASS: TestFilter (21.08s)\n
null
null
=== RUN   TestEvent\n
    federation_room_typing_test.go:13: Deploy times: 10.545908ms blueprints, 19.193839801s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (636.957103ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (629.150408ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (638.38962ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (491.687328ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!JrR0wrccgKrXqW14lE:hs1 => 200 OK (139.768055ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!JrR0wrccgKrXqW14lE:hs1 => 200 OK (868.974477ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (125.282714ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (39.025097ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.029716587s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.044017201s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.035347916s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.018986816s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.06008553s)\n
    federation_room_typing_test.go:25: \u001b[31m@user-3:hs2 MustSyncUntil: timed out after 5.22846177s. Seen 6 /sync responses. Checkers:\n
        [t=39.249643ms] Response #1: SyncJoinedTo(!JrR0wrccgKrXqW14lE:hs1): Key rooms.join.!JrR0wrccgKrXqW14lE:hs1.timeline.events does not exist & Key rooms.join.!JrR0wrccgKrXqW14lE:hs1.state.events does not exist\n
        [t=1.06911391s] Response #2: SyncJoinedTo(!JrR0wrccgKrXqW14lE:hs1): Key rooms.join.!JrR0wrccgKrXqW14lE:hs1.timeline.events does not exist & Key rooms.join.!JrR0wrccgKrXqW14lE:hs1.state.events does not exist\n
        [t=2.113343671s] Response #3: SyncJoinedTo(!JrR0wrccgKrXqW14lE:hs1): Key rooms.join.!JrR0wrccgKrXqW14lE:hs1.timeline.events does not exist & Key rooms.join.!JrR0wrccgKrXqW14lE:hs1.state.events does not exist\n
        [t=3.149025607s] Response #4: SyncJoinedTo(!JrR0wrccgKrXqW14lE:hs1): Key rooms.join.!JrR0wrccgKrXqW14lE:hs1.timeline.events does not exist & Key rooms.join.!JrR0wrccgKrXqW14lE:hs1.state.events does not exist\n
        [t=4.168191833s] Response #5: SyncJoinedTo(!JrR0wrccgKrXqW14lE:hs1): Key rooms.join.!JrR0wrccgKrXqW14lE:hs1.timeline.events does not exist & Key rooms.join.!JrR0wrccgKrXqW14lE:hs1.state.events does not exist\n
        [t=5.228459256s] Response #6: SyncJoinedTo(!JrR0wrccgKrXqW14lE:hs1): Key rooms.join.!JrR0wrccgKrXqW14lE:hs1.timeline.events does not exist & Key rooms.join.!JrR0wrccgKrXqW14lE:hs1.state.events does not exist, \n
        \u001b[39m\n
2025/02/23 07:26:28 ============================================\n
\n
\n
2025/02/23 07:26:28 756a9cd44bfd33280ecf307e947bb103d8f89ca885653fbf7aef92e90baa6ea0 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=756a9cd44bfd\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 756a9cd44bfd 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266774.7931938,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266774.8014693,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266774.8015718,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs1:8448/_matrix/federation/v1/make_join/!JrR0wrccgKrXqW14lE:hs1/@user-3:hs2?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "942", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:26:20 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$tkTecervrCMmEJA-xqfR3gMr4idWLbAu5Dqlyqiz3N0","$yPTmYqhtWczZCPiD19_FdfIKnQ0AmfwVS1J4qrfLVJM","$67KmNw41ZuOJsjuhEiyUnvV0F-ZQDIgVQpsb-X5f5DY"],"content":{"membership":"join"},"depth":8,"event_sn":14,"hashes":{"sha256":"/FGFKYNi71VAR6Pn3LON44KQvqbIUb7l8MnL3xnQr6A"},"origin":"hs1","origin_server_ts":1740266780843,"prev_events":["$29Wi43Mc0hCXNHuSIerseEeOY-QITUqT2pDU8mCHXoU","$67KmNw41ZuOJsjuhEiyUnvV0F-ZQDIgVQpsb-X5f5DY","$RIvCesSfKtF3xE-FN0nK1TV96r9JxdqJeefWmqwZr18","$_mwP_4B2hQ4CgGKemO55JRKD_xmgcz_AsO9JejNG9qE","$tPodhL6KMKIpRFMUxeizxld5Ypr5efZyhn_AigYl4P0","$tkTecervrCMmEJA-xqfR3gMr4idWLbAu5Dqlyqiz3N0","$yPTmYqhtWczZCPiD19_FdfIKnQ0AmfwVS1J4qrfLVJM"],"room_id":"!JrR0wrccgKrXqW14lE:hs1","sender":"@user-3:hs2","signatures":{"hs1":{"ed25519:3Ameu0lA":"PgQ3Hn/1zBdWXe1k2+mR54C92QGQKfVXloRdF44mN5dq8O3FHe6VWNxtVGODmPB6yDmUwDcmusMI+hIPgw2yDw"}},"state_key":"@user-3:hs2","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:26:21.213570Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
2025/02/23 07:26:28 ============== 756a9cd44bfd33280ecf307e947bb103d8f89ca885653fbf7aef92e90baa6ea0 : END LOGS ==============\n
\n
\n
    invalid_test.go:191: Deploy times: 26.186681ms blueprints, 12.982294712s containers\n
2025/02/23 07:26:29 ============================================\n
\n
\n
2025/02/23 07:26:29 d62422916461ed4a889dfd320f0bfd89a022a771944e62bd3e4b19e3dc26b9f6 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=d62422916461\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux d62422916461 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266774.790111,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266774.7974553,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266774.7977266,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:26:29 ============== d62422916461ed4a889dfd320f0bfd89a022a771944e62bd3e4b19e3dc26b9f6 : END LOGS ==============\n
\n
\n
--- FAIL: TestRemoteTyping (31.00s)\n
null
null
=== RUN   TestFederationRoomsInvite\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (619.35271ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (322.381676ms)\n
null
=== RUN   TestEvent/Parallel\n
null
=== RUN   TestEvent/Parallel/Large_Event\n
=== PAUSE TestEvent/Parallel/Large_Event\n
null
null
=== RUN   TestEvent/Parallel/Large_State_Event\n
=== PAUSE TestEvent/Parallel/Large_State_Event\n
null
null
=== CONT  TestEvent/Parallel/Large_Event\n
null
=== CONT  TestEvent/Parallel/Large_State_Event\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!PynsE02tToX81NbhU7:hs1/send/m.room.message/1 => 413 Payload Too Large (56.980107ms)\n
--- PASS: TestEvent/Parallel/Large_Event (0.06s)\n
null
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!PynsE02tToX81NbhU7:hs1/state/marvel.universe.fate => 413 Payload Too Large (78.010223ms)\n
--- PASS: TestEvent/Parallel/Large_State_Event (0.08s)\n
null
--- PASS: TestEvent/Parallel (0.00s)\n
null
2025/02/23 07:26:31 ============================================\n
\n
\n
2025/02/23 07:26:31 ddd6bd8d6416131061da32087a47ea850c873765678536d55edbd1442fd253d4 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=ddd6bd8d6416\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux ddd6bd8d6416 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266785.722097,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266785.7337017,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266785.733724,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:26:31 ============== ddd6bd8d6416131061da32087a47ea850c873765678536d55edbd1442fd253d4 : END LOGS ==============\n
\n
\n
--- PASS: TestEvent (15.64s)\n
null
null
=== RUN   TestKeyChangesLocal\n
    federation_rooms_invite_test.go:22: Deploy times: 12.190163ms blueprints, 18.966666286s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (694.62927ms)\n
    keychanges_test.go:19: Deploy times: 13.40976ms blueprints, 17.800548229s containers\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (775.748254ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (734.032066ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (707.702759ms)\n
null
=== RUN   TestFederationRoomsInvite/Parallel\n
null
=== RUN   TestFederationRoomsInvite/Parallel/Invited_user_can_reject_invite_over_federation\n
=== PAUSE TestFederationRoomsInvite/Parallel/Invited_user_can_reject_invite_over_federation\n
null
null
=== RUN   TestFederationRoomsInvite/Parallel/Invited_user_can_reject_invite_over_federation_several_times\n
=== PAUSE TestFederationRoomsInvite/Parallel/Invited_user_can_reject_invite_over_federation_several_times\n
null
null
=== RUN   TestFederationRoomsInvite/Parallel/Invited_user_can_reject_invite_over_federation_for_empty_room\n
=== PAUSE TestFederationRoomsInvite/Parallel/Invited_user_can_reject_invite_over_federation_for_empty_room\n
null
null
=== RUN   TestFederationRoomsInvite/Parallel/Remote_invited_user_can_see_room_metadata\n
=== PAUSE TestFederationRoomsInvite/Parallel/Remote_invited_user_can_see_room_metadata\n
null
null
=== RUN   TestFederationRoomsInvite/Parallel/Remote_invited_user_can_join_the_room_when_homeserver_is_already_participating_in_the_room\n
=== PAUSE TestFederationRoomsInvite/Parallel/Remote_invited_user_can_join_the_room_when_homeserver_is_already_participating_in_the_room\n
null
null
=== RUN   TestFederationRoomsInvite/Parallel/Remote_invited_user_can_reject_invite_when_homeserver_is_already_participating_in_the_room\n
=== PAUSE TestFederationRoomsInvite/Parallel/Remote_invited_user_can_reject_invite_when_homeserver_is_already_participating_in_the_room\n
null
null
=== RUN   TestFederationRoomsInvite/Parallel/Invited_user_has_'is_direct'_flag_in_prev_content_after_joining\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (701.017774ms)\n
null
=== RUN   TestKeyChangesLocal/New_login_should_create_a_device_lists.changed_entry\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (70.209119ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (492.912589ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!oKS4qJWFO9wH8QLwe5:hs1 => 200 OK (134.596764ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (129.137726ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/r0/login => 200 OK (563.091022ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (24.89037ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (36.422228ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/keys/changes => 200 OK (9.973072ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/query => 200 OK (15.808776ms)\n
--- PASS: TestKeyChangesLocal/New_login_should_create_a_device_lists.changed_entry (1.48s)\n
null
2025/02/23 07:26:53 ============================================\n
\n
\n
2025/02/23 07:26:53 57eaa59b10cd9c210c122b6a658a4bb11fba8466c351ff2ac48d9f83032ffcb7 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=57eaa59b10cd\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 57eaa59b10cd 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266806.241074,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266806.246569,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266806.246595,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:26:53 ============== 57eaa59b10cd9c210c122b6a658a4bb11fba8466c351ff2ac48d9f83032ffcb7 : END LOGS ==============\n
\n
\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (3.110752146s)\n
--- PASS: TestKeyChangesLocal (22.19s)\n
null
null
=== RUN   TestAsyncUpload\n
    media_async_uploads_test.go:19: WARNING: TestAsyncUpload called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!CHNIKvLh4jMJ1IOMfB:hs1 => 403 Forbidden (33.058998ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:33009/_matrix/client/v3/join/%21CHNIKvLh4jMJ1IOMfB:hs1 returned non-2xx code: 403 Forbidden - body: {"errcode":"M_FORBIDDEN","error":"Event is not authorized."}\u001b[39m\n
--- FAIL: TestFederationRoomsInvite/Parallel/Invited_user_has_'is_direct'_flag_in_prev_content_after_joining (3.14s)\n
null
null
=== CONT  TestFederationRoomsInvite/Parallel/Invited_user_can_reject_invite_over_federation\n
null
=== CONT  TestFederationRoomsInvite/Parallel/Remote_invited_user_can_reject_invite_when_homeserver_is_already_participating_in_the_room\n
null
=== CONT  TestFederationRoomsInvite/Parallel/Remote_invited_user_can_join_the_room_when_homeserver_is_already_participating_in_the_room\n
null
=== CONT  TestFederationRoomsInvite/Parallel/Invited_user_can_reject_invite_over_federation_several_times\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.967030564s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.972170685s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.973660647s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.597057292s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.613500307s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (9.830349752s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (28.0394ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!syEbibXzP3m2jjJkaX:hs1/invite => 200 OK (9.882081188s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (13.78987ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!3WSSKES2bqx7l2g6gf:hs1/invite => 200 OK (9.746842939s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (14.409028ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!3WSSKES2bqx7l2g6gf:hs1 => 403 Forbidden (12.000971ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:33009/_matrix/client/v3/join/%213WSSKES2bqx7l2g6gf:hs1?server_name=hs1 returned non-2xx code: 403 Forbidden - body: {"errcode":"M_FORBIDDEN","error":"Event is not authorized."}\u001b[39m\n
--- FAIL: TestFederationRoomsInvite/Parallel/Remote_invited_user_can_reject_invite_when_homeserver_is_already_participating_in_the_room (14.35s)\n
null
null
=== CONT  TestFederationRoomsInvite/Parallel/Remote_invited_user_can_see_room_metadata\n
    media_async_uploads_test.go:21: Deploy times: 16.5987ms blueprints, 14.91609297s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (606.417671ms)\n
null
=== RUN   TestAsyncUpload/Create_media\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v1/create => 200 OK (9.836899ms)\n
--- PASS: TestAsyncUpload/Create_media (0.01s)\n
null
null
=== RUN   TestAsyncUpload/Not_yet_uploaded\n
    client.go:706: [CSAPI] GET hs1/_matrix/media/v3/download/hs1/kVKsGr77tddnJFs1UCTkqF8J2uaaoAzs => 504 Gateway Timeout (5.03298ms)\n
--- PASS: TestAsyncUpload/Not_yet_uploaded (0.01s)\n
null
null
=== RUN   TestAsyncUpload/Upload_media\n
    client.go:706: [CSAPI] PUT hs1/_matrix/media/v3/upload/hs1/kVKsGr77tddnJFs1UCTkqF8J2uaaoAzs => 200 OK (9.049778ms)\n
--- PASS: TestAsyncUpload/Upload_media (0.01s)\n
null
null
=== RUN   TestAsyncUpload/Cannot_upload_to_a_media_ID_that_has_already_been_uploaded_to\n
    client.go:706: [CSAPI] PUT hs1/_matrix/media/v3/upload/hs1/kVKsGr77tddnJFs1UCTkqF8J2uaaoAzs => 409 Conflict (5.188534ms)\n
--- PASS: TestAsyncUpload/Cannot_upload_to_a_media_ID_that_has_already_been_uploaded_to (0.01s)\n
null
null
=== RUN   TestAsyncUpload/Download_media\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/media/download/hs1/kVKsGr77tddnJFs1UCTkqF8J2uaaoAzs => 200 OK (8.568539ms)\n
--- PASS: TestAsyncUpload/Download_media (0.01s)\n
null
null
=== RUN   TestAsyncUpload/Download_media_over__matrix/client/v1/media/download\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/media/download/hs1/kVKsGr77tddnJFs1UCTkqF8J2uaaoAzs => 200 OK (4.776727ms)\n
--- PASS: TestAsyncUpload/Download_media_over__matrix/client/v1/media/download (0.01s)\n
null
2025/02/23 07:27:10 ============================================\n
\n
\n
2025/02/23 07:27:10 05f3ad8d85f35887c7bfc96f7391aa995ca45244b6f7f89c2f6f54b61700813b : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=05f3ad8d85f3\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 05f3ad8d85f3 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266825.863986,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266825.870475,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266825.8704977,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:27:10 ============== 05f3ad8d85f35887c7bfc96f7391aa995ca45244b6f7f89c2f6f54b61700813b : END LOGS ==============\n
\n
\n
--- PASS: TestAsyncUpload (17.04s)\n
null
null
=== RUN   TestRoomImageRoundtrip\n
    media_misc_test.go:22: WARNING: TestRoomImageRoundtrip called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!8saqATLWD3WyTipwrK:hs1/invite => 200 OK (13.854401651s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (15.377429ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!8saqATLWD3WyTipwrK:hs1 => 403 Forbidden (13.399786ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:33009/_matrix/client/v3/join/%218saqATLWD3WyTipwrK:hs1?server_name=hs1 returned non-2xx code: 403 Forbidden - body: {"errcode":"M_FORBIDDEN","error":"Event is not authorized."}\u001b[39m\n
--- FAIL: TestFederationRoomsInvite/Parallel/Remote_invited_user_can_join_the_room_when_homeserver_is_already_participating_in_the_room (18.47s)\n
null
null
=== CONT  TestFederationRoomsInvite/Parallel/Invited_user_can_reject_invite_over_federation_for_empty_room\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/rooms/!sBg2RbdTOENRUvTVCX:hs1/leave => 200 OK (10.923508195s)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/rooms/!syEbibXzP3m2jjJkaX:hs1/leave => 200 OK (11.134394118s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (13.291054566s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (13.900336ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (22.082435ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!PMtJzBFJyh3w2iq9c9:hs1/state/m.room.join_rules/ => 200 OK (30.598424ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!PMtJzBFJyh3w2iq9c9:hs1/state/m.room.name/ => 200 OK (110.684375ms)\n
--- PASS: TestFederationRoomsInvite/Parallel/Remote_invited_user_can_see_room_metadata (13.47s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (10.053185907s)\n
    media_misc_test.go:24: Deploy times: 13.383451ms blueprints, 13.265145772s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (604.203737ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (8.237733ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (362.759289ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!aCnFbfzvix0MZTxd30:hs1/send/m.room.message/1 => 200 OK (62.177849ms)\n
    media_misc_test.go:33: SendEventSynced waiting for event ID $TnaaPZSmxluGUVHOTPRO0nGVwnQ3vi5DYbt--hPUXT0\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (83.738793ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!aCnFbfzvix0MZTxd30:hs1/send/m.room.message/2 => 200 OK (52.483224ms)\n
    media_misc_test.go:41: SendEventSynced waiting for event ID $rEJVcgfFSCwYlBJ_Gv2cZtzxD0ZTF9o6wivmZqYnYDQ\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (78.461007ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!aCnFbfzvix0MZTxd30:hs1/messages => 200 OK (70.220849ms)\n
2025/02/23 07:27:27 ============================================\n
\n
\n
2025/02/23 07:27:27 78a23cf13eca1617cf509f061dea5a214d9b139d1e0ef2832d316ad4af0d37d5 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=78a23cf13eca\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 78a23cf13eca 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266841.3589938,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266841.3635337,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266841.3635614,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:27:27 ============== 78a23cf13eca1617cf509f061dea5a214d9b139d1e0ef2832d316ad4af0d37d5 : END LOGS ==============\n
\n
\n
--- PASS: TestRoomImageRoundtrip (16.09s)\n
null
null
=== RUN   TestMediaConfig\n
    client.go:704: [CSAPI] GET hs1/_matrix/client/v3/sync => error: net/http: request canceled (30.009132684s)\n
    federation_rooms_invite_test.go:47: \u001b[31mCSAPI.Do response returned error: Get "http://127.0.0.1:33011/_matrix/client/v3/sync?filter=%7B%22room%22%3A%7B%22include_leave%22%3Atrue%7D%7D&timeout=1000": net/http: request canceled (Client.Timeout exceeded while awaiting headers)\u001b[39m\n
--- FAIL: TestFederationRoomsInvite/Parallel/Invited_user_can_reject_invite_over_federation (50.79s)\n
    media_misc_test.go:66: Deploy times: 13.092997ms blueprints, 17.69533354s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (546.789742ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/media/v3/config => 200 OK (4.661835ms)\n
2025/02/23 07:27:46 ============================================\n
\n
\n
2025/02/23 07:27:46 b8ac59b04d51e50f1e615f144709125f549615854a0c18c08b9f76b4ac87847f : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=b8ac59b04d51\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux b8ac59b04d51 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266861.5429308,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266861.548935,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266861.548959,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:27:46 ============== b8ac59b04d51e50f1e615f144709125f549615854a0c18c08b9f76b4ac87847f : END LOGS ==============\n
\n
\n
--- PASS: TestMediaConfig (19.80s)\n
null
null
=== RUN   TestMembershipOnEvents\n
    membership_on_events_test.go:18: WARNING: TestMembershipOnEvents called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
null
    client.go:704: [CSAPI] GET hs1/_matrix/client/v3/sync => error: net/http: request canceled (30.001153927s)\n
    federation_rooms_invite_test.go:60: \u001b[31mCSAPI.Do response returned error: Get "http://127.0.0.1:33011/_matrix/client/v3/sync?filter=%7B%22room%22%3A%7B%22include_leave%22%3Atrue%7D%7D&timeout=1000": net/http: request canceled (Client.Timeout exceeded while awaiting headers)\u001b[39m\n
--- FAIL: TestFederationRoomsInvite/Parallel/Invited_user_can_reject_invite_over_federation_several_times (53.00s)\n
null
    client.go:704: [CSAPI] GET hs1/_matrix/client/v3/sync => error: net/http: request canceled (30.001335009s)\n
    federation_rooms_invite_test.go:71: \u001b[31mCSAPI.Do response returned error: Get "http://127.0.0.1:33011/_matrix/client/v3/sync?timeout=1000": net/http: request canceled (Client.Timeout exceeded while awaiting headers)\u001b[39m\n
--- FAIL: TestFederationRoomsInvite/Parallel/Invited_user_can_reject_invite_over_federation_for_empty_room (40.06s)\n
null
--- FAIL: TestFederationRoomsInvite/Parallel (3.14s)\n
null
2025/02/23 07:27:53 ============================================\n
\n
\n
2025/02/23 07:27:53 72c6cc4c2ec99ed9df95fce6f89c745837867062952ad88561a4be2f8f6f3e76 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=72c6cc4c2ec9\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 72c6cc4c2ec9 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266805.3432739,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266805.3592744,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266805.35931,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 9\n
To many layers, we have to go deeper frame_id: 10\n
To many layers, we have to go deeper frame_id: 28\n
To many layers, we have to go deeper frame_id: 42\n
To many layers, we have to go deeper frame_id: 43\n
To many layers, we have to go deeper frame_id: 44\n
  \u001b[2m2025-02-22T23:27:05.892084Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $GNBfCBbpzzuqTqhfc-4McaAywvsrFSR_UhmHneyrpoE failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
  \u001b[2m2025-02-22T23:27:07.912927Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $uzkCt04s_h8AHP9GwFAoV_uIuJLE2mti2_5KTB-Xz-c failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
To many layers, we have to go deeper frame_id: 116\n
To many layers, we have to go deeper frame_id: 136\n
To many layers, we have to go deeper frame_id: 143\n
To many layers, we have to go deeper frame_id: 145\n
2025/02/23 07:27:53 ============== 72c6cc4c2ec99ed9df95fce6f89c745837867062952ad88561a4be2f8f6f3e76 : END LOGS ==============\n
\n
\n
2025/02/23 07:27:55 ============================================\n
\n
\n
2025/02/23 07:27:55 e01c025418da981b6729b01d5093afd010f73c140bd6bbb0e5c6a9f94a7300e3 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=e01c025418da\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux e01c025418da 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266805.3964427,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266805.4343638,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266805.43464,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
  \u001b[2m2025-02-22T23:26:54.067385Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:27:08.413163Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:27:12.533467Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:27:22.892927Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $9n3JO9XXTqnF-5GSso6xwPV2EW6OTmlHTSmSq-PPR-c failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
To many layers, we have to go deeper frame_id: 8\n
To many layers, we have to go deeper frame_id: 9\n
To many layers, we have to go deeper frame_id: 16\n
  \u001b[2m2025-02-22T23:27:26.719853Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $W786TZZjnUNTz406FXfPbUp0iwmENoKqTr0M86EyN0A failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
  \u001b[2m2025-02-22T23:27:26.814873Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $Yqf2KL2ufgYKHu_JP0bL6Ztq6M9w2P4Lg-FFMFqL6JQ failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
To many layers, we have to go deeper frame_id: 24\n
To many layers, we have to go deeper frame_id: 25\n
  \u001b[2m2025-02-22T23:27:31.299211Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $h5ryxekqqjGYwO-4JsbSs84zv9z6z-8_lIc1a2wMwl4 failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
To many layers, we have to go deeper frame_id: 38\n
To many layers, we have to go deeper frame_id: 39\n
  \u001b[2m2025-02-22T23:27:37.038426Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $uUOFkVgl-f1p2zCkSSEnK4HhNf3WtkEZ4N90KJUw1y4 failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
To many layers, we have to go deeper frame_id: 52\n
To many layers, we have to go deeper frame_id: 53\n
  \u001b[2m2025-02-22T23:27:38.017542Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $owYI9SroEHW25c30P9cIY1UEmM3FvSmo_4knBm5mTD8 failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
  \u001b[2m2025-02-22T23:27:41.403960Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $FcCXTDtFoDmpUhbjOiizpbF8m6CeuloWUWFUEI1BA-k failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
  \u001b[2m2025-02-22T23:27:41.488265Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $pob_R0_XAFycLKSnbfJWbravDGMBkeOB4pSNZE01t-Q failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
  \u001b[2m2025-02-22T23:27:41.680591Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $zZF4gO-bjbnE-NTS9YsBSPfkx7JOAyeE9svuiGHUMow failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
To many layers, we have to go deeper frame_id: 67\n
  \u001b[2m2025-02-22T23:27:42.548649Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $GNBfCBbpzzuqTqhfc-4McaAywvsrFSR_UhmHneyrpoE failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
To many layers, we have to go deeper frame_id: 75\n
  \u001b[2m2025-02-22T23:27:43.553460Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $uzkCt04s_h8AHP9GwFAoV_uIuJLE2mti2_5KTB-Xz-c failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
To many layers, we have to go deeper frame_id: 87\n
  \u001b[2m2025-02-22T23:27:47.167831Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $toFFyo16ldfBP21Mp-jjRtgNiNHVQxuUAp0x6ZDXinA failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
  \u001b[2m2025-02-22T23:27:47.249153Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $kEF874P2wmyXtwHhOc-V6RkvWt4n6tj-YAouaMKV8po failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
To many layers, we have to go deeper frame_id: 106\n
To many layers, we have to go deeper frame_id: 107\n
To many layers, we have to go deeper frame_id: 114\n
  \u001b[2m2025-02-22T23:27:52.341978Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $heJAy3cxzQ1bgC4nU0iikzEsm_VBgV3fy9bREglWUkc failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
  \u001b[2m2025-02-22T23:27:52.501209Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $elC-3eyiupKssKvnkidW-RzbvzBaBvbw51wr0eBn59w failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
To many layers, we have to go deeper frame_id: 122\n
To many layers, we have to go deeper frame_id: 123\n
2025/02/23 07:27:55 ============== e01c025418da981b6729b01d5093afd010f73c140bd6bbb0e5c6a9f94a7300e3 : END LOGS ==============\n
\n
\n
--- FAIL: TestFederationRoomsInvite (85.82s)\n
null
null
=== RUN   TestSyncOmitsStateChangeOnFilteredEvents\n
    federation_sync_test.go:29: WARNING: TestSyncOmitsStateChangeOnFilteredEvents called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    membership_on_events_test.go:20: Deploy times: 10.451519ms blueprints, 15.726529492s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (731.924256ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (732.728863ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (672.854413ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!b5bZe34mWkKuqvC4vs:hs1/send/m.room.message/1 => 200 OK (59.381552ms)\n
    membership_on_events_test.go:27: SendEventSynced waiting for event ID $HopmCL5DouHSoyLyxRv1mcKjUXoXzvj3dCi2Fskt4eo\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (166.578197ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!b5bZe34mWkKuqvC4vs:hs1 => 200 OK (124.179061ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!b5bZe34mWkKuqvC4vs:hs1/send/m.room.message/2 => 200 OK (125.170526ms)\n
    membership_on_events_test.go:33: SendEventSynced waiting for event ID $-S3Sqg2Y0aTocyrEKFQCWuouN2o7-Kd6_byKbaR-6uk\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (109.771403ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (103.878923ms)\n
    membership_on_events_test.go:61: Incorrect membership for event {"content":{"creator":"@user-1:hs1","room_version":"10"},"event_id":"$FTn0xXLLD4sPmXhLD_L_Zlpz_Gz_Dwf_h5VTCSc2hiY","origin_server_ts":1740266884190,"sender":"@user-1:hs1","state_key":"","type":"m.room.create","unsigned":{"age":1}}; got , want leave\n
    membership_on_events_test.go:61: Incorrect membership for event {"content":{"displayname":"user-1 ⚡️","is_direct":false,"membership":"join"},"event_id":"$KJduPbn5ORlh-kusFOHVc3gwJNZuFUpeu3KkLEgxhBg","origin_server_ts":1740266884337,"sender":"@user-1:hs1","state_key":"@user-1:hs1","type":"m.room.member","unsigned":{"age":1}}; got , want leave\n
    membership_on_events_test.go:61: Incorrect membership for event {"content":{"ban":50,"events":{},"events_default":0,"invite":0,"kick":50,"notifications":{"room":50},"redact":50,"state_default":50,"users":{"@user-1:hs1":100},"users_default":0},"event_id":"$KfPR1uOG9ld7sOJzRrO_d81RyZ6v3o_ctc2Td30RxnU","origin_server_ts":1740266884512,"sender":"@user-1:hs1","state_key":"","type":"m.room.power_levels","unsigned":{"age":1}}; got , want leave\n
    membership_on_events_test.go:61: Incorrect membership for event {"content":{"join_rule":"public"},"event_id":"$QIty8E-zdRjw_hhWIX-vTLdU1HOVuB8Eq_mVvOtLNN8","origin_server_ts":1740266884582,"sender":"@user-1:hs1","state_key":"","type":"m.room.join_rules","unsigned":{"age":1}}; got , want leave\n
    membership_on_events_test.go:61: Incorrect membership for event {"content":{"history_visibility":"shared"},"event_id":"$5yP318EjPvx5gF3mlkzr6y8v1jnX_4h4wQN07dt1In0","origin_server_ts":1740266884679,"sender":"@user-1:hs1","state_key":"","type":"m.room.history_visibility","unsigned":{"age":1}}; got , want leave\n
    membership_on_events_test.go:61: Incorrect membership for event {"content":{"guest_access":"forbidden"},"event_id":"$i6DmtR3PYTaddVEVuZolNvbDLLjp3F6TwprwCBaatpI","origin_server_ts":1740266884766,"sender":"@user-1:hs1","state_key":"","type":"m.room.guest_access","unsigned":{"age":1}}; got , want leave\n
    membership_on_events_test.go:61: Incorrect membership for event {"content":{"body":"prejoin","msgtype":"m.text"},"event_id":"$HopmCL5DouHSoyLyxRv1mcKjUXoXzvj3dCi2Fskt4eo","origin_server_ts":1740266884864,"sender":"@user-1:hs1","type":"m.room.message","unsigned":{"age":1}}; got , want leave\n
    membership_on_events_test.go:61: Incorrect membership for event {"content":{"displayname":"user-2 ⚡️","membership":"join"},"event_id":"$-k_m1ij8lDaEhLYSCI5uXhdslpttB6B9l7rBuUOgBms","origin_server_ts":1740266885107,"sender":"@user-2:hs1","state_key":"@user-2:hs1","type":"m.room.member","unsigned":{"age":1}}; got , want join\n
    membership_on_events_test.go:61: Incorrect membership for event {"content":{"body":"postjoin","msgtype":"m.text"},"event_id":"$-S3Sqg2Y0aTocyrEKFQCWuouN2o7-Kd6_byKbaR-6uk","origin_server_ts":1740266885240,"sender":"@user-1:hs1","type":"m.room.message","unsigned":{"age":1}}; got , want join\n
2025/02/23 07:28:06 ============================================\n
\n
\n
2025/02/23 07:28:06 f53f62ac383f156d434c62ead7d132e9b6254170c4794d6aa0c233c2780a29b0 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=f53f62ac383f\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux f53f62ac383f 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266879.1012506,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266879.110615,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266879.1106577,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:28:06 ============== f53f62ac383f156d434c62ead7d132e9b6254170c4794d6aa0c233c2780a29b0 : END LOGS ==============\n
\n
\n
--- FAIL: TestMembershipOnEvents (20.11s)\n
null
null
=== RUN   TestDemotingUsersViaUsersDefault\n
    federation_sync_test.go:30: Deploy times: 10.396698ms blueprints, 15.172680428s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (578.447609ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/capabilities => 200 OK (4.687492ms)\n
    server.go:185: Creating room !0-kOL44RIPFdFLR1Ivjz:host.docker.internal:46805 with version 10\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!0-kOL44RIPFdFLR1Ivjz:host.docker.internal:46805 => 400 Bad Request (121.207699ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:33023/_matrix/client/v3/join/%210-kOL44RIPFdFLR1Ivjz:host.docker.internal:46805?server_name=host.docker.internal%3A46805 returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Answer from host.docker.internal:46805: complement: HandleMakeSendJoinRequests send_join cannot parse event JSON: eventauth: invalid ID: \\"\\""}\u001b[39m\n
2025/02/23 07:28:15 ============================================\n
\n
\n
2025/02/23 07:28:15 9cd6073af3a65c3aa234b1f9d065a1a620e035e0eb4f6ab548b0e1b1d6acb9af : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=9cd6073af3a6\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 9cd6073af3a6 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266887.3842773,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266887.3933287,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266887.3935578,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "host.docker.internal:46805"  servername:"hs1"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://host.docker.internal:46805/_matrix/federation/v1/make_join/!0-kOL44RIPFdFLR1Ivjz:host.docker.internal:46805/@user-1:hs1?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"content-type": "application/json", "date": "Sat, 22 Feb 2025 23:28:14 GMT", "content-length": "426"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"sender":"@user-1:hs1","room_id":"!0-kOL44RIPFdFLR1Ivjz:host.docker.internal:46805","type":"m.room.member","state_key":"@user-1:hs1","prev_events":["$lXsqcE-Z8hKLfRxlwBtnVTvUpLSkEJbkaF3I74yAbd4"],"auth_events":["$Rs0ooIl5m4RG8iQx0Pe3vg4UO3HYw_GKjW1Wgqx9cmw","$lXsqcE-Z8hKLfRxlwBtnVTvUpLSkEJbkaF3I74yAbd4","$n5WHMM4P75dLNx0-WPUP0lg3Wcg9aXVoItJ_AG1Du90"],"depth":5,"content":{"membership":"join"}}) })\n
  \u001b[2m2025-02-22T23:28:14.376277Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://host.docker.internal:46805/_matrix/federation/v2/send_join/!0-kOL44RIPFdFLR1Ivjz:host.docker.internal:46805/$XNGYMz-r3f6zLaIO5oSJK5tnbTraDVs7jNdmx9QS_ZY?omit_members=false 500 Internal Server Error: complement: HandleMakeSendJoinRequests send_join cannot parse event JSON: eventauth: invalid ID: ""\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
2025/02/23 07:28:15 ============== 9cd6073af3a65c3aa234b1f9d065a1a620e035e0eb4f6ab548b0e1b1d6acb9af : END LOGS ==============\n
\n
\n
--- FAIL: TestSyncOmitsStateChangeOnFilteredEvents (20.25s)\n
null
null
=== RUN   TestToDeviceMessagesOverFederation\n
    power_levels_test.go:21: Deploy times: 16.563518ms blueprints, 13.916940706s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (662.879613ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (563.09501ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!apj7dXOj6Zq6N0kjQC:hs1/state/m.room.power_levels/ => 200 OK (105.702499ms)\n
    power_levels_test.go:38: SendEventSynced waiting for event ID $VPMNy9R4GfBid29U-99Cy6dEXtQ_S00Vx0ATT0e1nlo\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (193.385487ms)\n
2025/02/23 07:28:23 ============================================\n
\n
\n
2025/02/23 07:28:23 661b06f4d75031892a0f6ca9ae06a03dc87f3d81edc68717aa20d50825958339 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=661b06f4d750\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 661b06f4d750 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266897.649367,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266897.6555753,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266897.6555994,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:28:23 ============== 661b06f4d75031892a0f6ca9ae06a03dc87f3d81edc68717aa20d50825958339 : END LOGS ==============\n
\n
\n
--- PASS: TestDemotingUsersViaUsersDefault (16.96s)\n
null
null
=== RUN   TestPowerLevels\n
    federation_to_device_test.go:16: Deploy times: 9.021327ms blueprints, 16.067324831s containers\n
null
=== RUN   TestToDeviceMessagesOverFederation/good_connectivity\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (651.567002ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (614.628835ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (21.681818ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/sendToDevice/my.test.type/1 => 200 OK (16.221065ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.018582485s)\n
    federation_to_device_test.go:104: {"next_batch":"5"}\n
    power_levels_test.go:53: Deploy times: 10.962756ms blueprints, 11.908393932s containers\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.01787732s)\n
    federation_to_device_test.go:104: {"next_batch":"6"}\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (533.255972ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (355.436193ms)\n
null
=== RUN   TestPowerLevels/GET_/rooms/:room_id/state/m.room.power_levels_can_fetch_levels\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!2QbWSKspVvpgUXjXbe:hs1/state/m.room.power_levels => 200 OK (15.651001ms)\n
--- PASS: TestPowerLevels/GET_/rooms/:room_id/state/m.room.power_levels_can_fetch_levels (0.02s)\n
null
null
=== RUN   TestPowerLevels/PUT_/rooms/:room_id/state/m.room.power_levels_can_set_levels\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!2QbWSKspVvpgUXjXbe:hs1/state/m.room.power_levels/ => 200 OK (91.92633ms)\n
    power_levels_test.go:122: SendEventSynced waiting for event ID $liku2Q5EfEFWyFQ4JxZEbbXe9yE410BHShvQpdhaAhE\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (199.824689ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!2QbWSKspVvpgUXjXbe:hs1/event/$liku2Q5EfEFWyFQ4JxZEbbXe9yE410BHShvQpdhaAhE => 200 OK (14.651894ms)\n
--- PASS: TestPowerLevels/PUT_/rooms/:room_id/state/m.room.power_levels_can_set_levels (0.31s)\n
null
null
=== RUN   TestPowerLevels/PUT_power_levels_should_not_explode_if_the_old_power_levels_were_empty\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.014426991s)\n
    federation_to_device_test.go:104: {"next_batch":"7"}\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!2QbWSKspVvpgUXjXbe:hs1/state/m.room.power_levels/ => 200 OK (109.124299ms)\n
    power_levels_test.go:144: SendEventSynced waiting for event ID $bSU48eHDnHIaCSTSx4XMXMjq_6Ftbq9xwISmaFJ61DQ\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (148.753127ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!2QbWSKspVvpgUXjXbe:hs1/state/m.room.power_levels/ => 200 OK (86.922222ms)\n
    power_levels_test.go:155: SendEventSynced waiting for event ID $E8hYVSJuFgf1hPIHLBkN7h3dTMAgGI1mwvdQoscZCOU\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (114.812571ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!2QbWSKspVvpgUXjXbe:hs1/state/m.room.power_levels => 403 Forbidden (58.630879ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!2QbWSKspVvpgUXjXbe:hs1/state/m.room.power_levels => 200 OK (10.827994ms)\n
--- PASS: TestPowerLevels/PUT_power_levels_should_not_explode_if_the_old_power_levels_were_empty (0.53s)\n
null
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.024461407s)\n
    federation_to_device_test.go:104: {"next_batch":"8"}\n
2025/02/23 07:28:39 ============================================\n
\n
\n
2025/02/23 07:28:39 510099f3d6f94be42b3013884953575df22858311389b51fae51e6931ca15b5c : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=510099f3d6f9\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 510099f3d6f9 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266913.061802,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266913.067463,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266913.0674968,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
  \u001b[2m2025-02-22T23:28:37.689440Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33muser cannot send event\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:380\n
\n
2025/02/23 07:28:39 ============== 510099f3d6f94be42b3013884953575df22858311389b51fae51e6931ca15b5c : END LOGS ==============\n
\n
\n
--- PASS: TestPowerLevels (15.14s)\n
null
null
=== RUN   TestPushRuleCacheHealth\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.023036977s)\n
    federation_to_device_test.go:104: {"next_batch":"9"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.012558536s)\n
    federation_to_device_test.go:104: {"next_batch":"10"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.02722287s)\n
    federation_to_device_test.go:104: {"next_batch":"11"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.019392898s)\n
    federation_to_device_test.go:104: {"next_batch":"12"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.025836285s)\n
    federation_to_device_test.go:104: {"next_batch":"13"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.018704612s)\n
    federation_to_device_test.go:104: {"next_batch":"14"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.024901638s)\n
    federation_to_device_test.go:104: {"next_batch":"15"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.044983419s)\n
    federation_to_device_test.go:104: {"next_batch":"16"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.013548699s)\n
    federation_to_device_test.go:104: {"next_batch":"17"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.011908683s)\n
    federation_to_device_test.go:104: {"next_batch":"18"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.013461742s)\n
    federation_to_device_test.go:104: {"next_batch":"19"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.019174703s)\n
    federation_to_device_test.go:104: {"next_batch":"20"}\n
    push_test.go:19: Deploy times: 11.63947ms blueprints, 11.699219845s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (564.232786ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/pushrules/global/sender/@user-1:hs1 => 200 OK (12.44016ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/pushrules/ => 200 OK (12.516184ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/pushrules/ => 200 OK (6.367741ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.023545243s)\n
    federation_to_device_test.go:104: {"next_batch":"21"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.013696016s)\n
    federation_to_device_test.go:104: {"next_batch":"22"}\n
2025/02/23 07:28:52 ============================================\n
\n
\n
2025/02/23 07:28:52 627d4fd48ebb6730e294afae188d99c8b03230b2e751b6f34c62a80460b12697 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=627d4fd48ebb\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 627d4fd48ebb 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266927.9614818,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266927.968373,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266927.9699044,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:28:52 ============== 627d4fd48ebb6730e294afae188d99c8b03230b2e751b6f34c62a80460b12697 : END LOGS ==============\n
\n
\n
--- PASS: TestPushRuleCacheHealth (13.78s)\n
null
null
=== RUN   TestPushSync\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.030070573s)\n
    federation_to_device_test.go:104: {"next_batch":"23"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.017181651s)\n
    federation_to_device_test.go:104: {"next_batch":"24"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.019243514s)\n
    federation_to_device_test.go:104: {"next_batch":"25"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.020100359s)\n
    federation_to_device_test.go:104: {"next_batch":"26"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.030310619s)\n
    federation_to_device_test.go:104: {"next_batch":"27"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.019285839s)\n
    federation_to_device_test.go:104: {"next_batch":"28"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.023847556s)\n
    federation_to_device_test.go:104: {"next_batch":"29"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.016593828s)\n
    federation_to_device_test.go:104: {"next_batch":"30"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.031133727s)\n
    federation_to_device_test.go:104: {"next_batch":"31"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.021149449s)\n
    federation_to_device_test.go:104: {"next_batch":"32"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.044457433s)\n
    federation_to_device_test.go:104: {"next_batch":"33"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.021179725s)\n
    federation_to_device_test.go:104: {"next_batch":"34"}\n
    federation_to_device_test.go:103: \u001b[31m@user-2-bob:hs2 MustSyncUntil: timed out after 30.668001625s. Seen 30 /sync responses. Checkers:\n
        [t=1.018798689s] Response #1: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=2.036853515s] Response #2: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=3.051480407s] Response #3: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=4.076122815s] Response #4: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=5.099404818s] Response #5: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=6.112142343s] Response #6: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=7.139524542s] Response #7: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=8.159207335s] Response #8: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=9.185231712s] Response #9: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=10.204085336s] Response #10: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=11.229147474s] Response #11: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=12.274299265s] Response #12: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=13.288049586s] Response #13: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=14.300093372s] Response #14: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=15.313689254s] Response #15: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=16.333001493s] Response #16: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=17.356677602s] Response #17: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=18.370668971s] Response #18: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=19.400924201s] Response #19: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=20.418258311s] Response #20: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=21.437707161s] Response #21: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=22.457974309s] Response #22: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=23.488563925s] Response #23: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=24.508063505s] Response #24: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=25.532091782s] Response #25: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=26.548934604s] Response #26: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=27.580425515s] Response #27: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=28.602055193s] Response #28: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=29.646672155s] Response #29: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist\n
        [t=30.668000033s] Response #30: SyncToDeviceHas(@user-1-alice:hs1): Key to_device.events does not exist, \n
        \u001b[39m\n
--- FAIL: TestToDeviceMessagesOverFederation/good_connectivity (32.97s)\n
null
null
=== RUN   TestToDeviceMessagesOverFederation/interrupted_connectivity\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (631.459129ms)\n
    push_test.go:37: Deploy times: 13.713729ms blueprints, 12.587865203s containers\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (592.99219ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (24.130166ms)\n
    federation_to_device_test.go:33: StopServer hs2\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (639.930303ms)\n
null
=== RUN   TestPushSync/Push_rules_come_down_in_an_initial_/sync\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (28.767295ms)\n
--- PASS: TestPushSync/Push_rules_come_down_in_an_initial_/sync (0.03s)\n
null
null
=== RUN   TestPushSync/Adding_a_push_rule_wakes_up_an_incremental_/sync\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/pushrules/global/room/!foo:example.com => 200 OK (52.867187ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.05405002s)\n
--- PASS: TestPushSync/Adding_a_push_rule_wakes_up_an_incremental_/sync (1.05s)\n
null
null
=== RUN   TestPushSync/Disabling_a_push_rule_wakes_up_an_incremental_/sync\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/pushrules/global/room/!foo:example.com/enabled => 200 OK (49.574593ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.051993341s)\n
--- PASS: TestPushSync/Disabling_a_push_rule_wakes_up_an_incremental_/sync (1.05s)\n
null
null
=== RUN   TestPushSync/Enabling_a_push_rule_wakes_up_an_incremental_/sync\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/pushrules/global/room/!foo:example.com/enabled => 200 OK (25.711355ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.031392894s)\n
--- PASS: TestPushSync/Enabling_a_push_rule_wakes_up_an_incremental_/sync (1.03s)\n
null
null
=== RUN   TestPushSync/Setting_actions_for_a_push_rule_wakes_up_an_incremental_/sync\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/pushrules/global/room/!foo:example.com/actions => 200 OK (30.391389ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.035346s)\n
--- PASS: TestPushSync/Setting_actions_for_a_push_rule_wakes_up_an_incremental_/sync (1.04s)\n
null
2025/02/23 07:29:11 ============================================\n
\n
\n
2025/02/23 07:29:11 bdb5f22162b0825c48a262cd6258f7d5f520d42a50ff358f441a23fd848d7b00 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=bdb5f22162b0\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux bdb5f22162b0 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266942.2661264,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266942.274861,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266942.2748857,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:29:11 ============== bdb5f22162b0825c48a262cd6258f7d5f520d42a50ff358f441a23fd848d7b00 : END LOGS ==============\n
\n
\n
--- PASS: TestPushSync (18.94s)\n
null
null
=== RUN   TestNotPresentUserCannotBanOthers\n
    room_ban_test.go:18: Deploy times: 12.182905ms blueprints, 12.602547086s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (600.609297ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (678.519971ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (520.608123ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (331.423814ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!4o7qgF6l136TjIdj1V:hs1 => 200 OK (118.5508ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!4o7qgF6l136TjIdj1V:hs1/state/m.room.power_levels/ => 200 OK (71.850883ms)\n
    room_ban_test.go:31: SendEventSynced waiting for event ID $_-lfVPfqKfyYpfH4m9NRnfrQFCGk4LYC5LSM-PGlyT0\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (99.790919ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (100.897347ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!4o7qgF6l136TjIdj1V:hs1/ban => 403 Forbidden (43.688874ms)\n
2025/02/23 07:29:28 ============================================\n
\n
\n
2025/02/23 07:29:28 8fe76471e0cd81802eead7d52de02f33fdc9e7423272530bc738954bebde6b59 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=8fe76471e0cd\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 8fe76471e0cd 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266961.3035996,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266961.3081088,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266961.308138,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
  \u001b[2m2025-02-22T23:29:27.079737Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mCan't ban user if sender is not joined, \u001b[1;33msender_membership_event_id\u001b[0m\u001b[33m: None\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:652\n
\n
2025/02/23 07:29:28 ============== 8fe76471e0cd81802eead7d52de02f33fdc9e7423272530bc738954bebde6b59 : END LOGS ==============\n
\n
\n
--- PASS: TestNotPresentUserCannotBanOthers (16.76s)\n
null
null
=== RUN   TestCannotKickNonPresentUser\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/sendToDevice/my.test.type/1 => 200 OK (6.368863ms)\n
    federation_to_device_test.go:36: StartServer hs2\n
    room_kick_test.go:15: Deploy times: 11.703648ms blueprints, 11.634961288s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (593.880215ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (584.71886ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (376.837059ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!xylAKWnfmBA8PuJM3F:hs1/kick => 403 Forbidden (11.522996ms)\n
2025/02/23 07:29:43 ============================================\n
\n
\n
2025/02/23 07:29:43 f2b168cb0f7ea597119be5462d9464108ffa4670f944caaf9da7e28846aa05c5 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=f2b168cb0f7e\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux f2b168cb0f7e 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266977.3438976,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266977.3515618,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266977.3515933,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:29:43 ============== f2b168cb0f7ea597119be5462d9464108ffa4670f944caaf9da7e28846aa05c5 : END LOGS ==============\n
\n
\n
--- PASS: TestCannotKickNonPresentUser (14.73s)\n
null
null
=== RUN   TestCannotKickLeftUser\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.071661677s)\n
    federation_to_device_test.go:104: {"next_batch":"68"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.027719063s)\n
    federation_to_device_test.go:104: {"next_batch":"69"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.017927222s)\n
    federation_to_device_test.go:104: {"next_batch":"70"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.038257996s)\n
    federation_to_device_test.go:104: {"next_batch":"71"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.028050093s)\n
    federation_to_device_test.go:104: {"next_batch":"72"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.022447269s)\n
    federation_to_device_test.go:104: {"next_batch":"73"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.023543462s)\n
    federation_to_device_test.go:104: {"next_batch":"74"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.011945165s)\n
    federation_to_device_test.go:104: {"next_batch":"75"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.016382865s)\n
    federation_to_device_test.go:104: {"next_batch":"76"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.020584182s)\n
    federation_to_device_test.go:104: {"next_batch":"77"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.02028197s)\n
    federation_to_device_test.go:104: {"next_batch":"78"}\n
    room_kick_test.go:39: Deploy times: 11.057068ms blueprints, 12.317557975s containers\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.02165623s)\n
    federation_to_device_test.go:104: {"next_batch":"79"}\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (600.440827ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (553.750022ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.025253642s)\n
    federation_to_device_test.go:104: {"next_batch":"80"}\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (394.320683ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!VX0qLjQ1m35vNLwcYv:hs1 => 200 OK (91.262032ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (110.089965ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!VX0qLjQ1m35vNLwcYv:hs1/leave => 200 OK (130.139479ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (159.505162ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!VX0qLjQ1m35vNLwcYv:hs1/kick => 403 Forbidden (5.199202ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.048484452s)\n
    federation_to_device_test.go:104: {"next_batch":"81"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.019547314s)\n
    federation_to_device_test.go:104: {"next_batch":"82"}\n
2025/02/23 07:29:59 ============================================\n
\n
\n
2025/02/23 07:29:59 248921a248a053d2587d9c2a1d27e2e14aa038f7f837209236864793430b8939 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=248921a248a0\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 248921a248a0 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266992.6516297,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266992.6557894,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266992.6558166,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:29:59 ============== 248921a248a053d2587d9c2a1d27e2e14aa038f7f837209236864793430b8939 : END LOGS ==============\n
\n
\n
--- PASS: TestCannotKickLeftUser (15.89s)\n
null
null
=== RUN   TestLeftRoomFixture\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.021453371s)\n
    federation_to_device_test.go:104: {"next_batch":"83"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.069866074s)\n
    federation_to_device_test.go:104: {"next_batch":"84"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.146170035s)\n
    federation_to_device_test.go:104: {"next_batch":"85"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.470699747s)\n
    federation_to_device_test.go:104: {"next_batch":"86"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.269278885s)\n
    federation_to_device_test.go:104: {"next_batch":"87"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.159687297s)\n
    federation_to_device_test.go:104: {"next_batch":"88"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.115421937s)\n
    federation_to_device_test.go:104: {"next_batch":"89"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.110189617s)\n
    federation_to_device_test.go:104: {"next_batch":"90"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.113303877s)\n
    federation_to_device_test.go:104: {"next_batch":"91"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.033964158s)\n
    federation_to_device_test.go:104: {"next_batch":"92"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.092505232s)\n
    federation_to_device_test.go:104: {"next_batch":"93"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.07907551s)\n
    federation_to_device_test.go:104: {"next_batch":"94"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.042002277s)\n
    federation_to_device_test.go:104: {"next_batch":"95"}\n
    federation_to_device_test.go:103: \u001b[31m@user-4-bob:hs2 MustSyncUntil: timed out after 30.146900407s. Seen 28 /sync responses. Checkers:\n
        [t=1.071942889s] Response #1: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=2.099810414s] Response #2: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=3.117962773s] Response #3: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=4.156377535s] Response #4: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=5.184624813s] Response #5: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=6.207233273s] Response #6: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=7.230952818s] Response #7: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=8.243083982s] Response #8: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=9.25970963s] Response #9: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=10.280449716s] Response #10: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=11.300889251s] Response #11: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=12.322851781s] Response #12: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=13.349055886s] Response #13: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=14.397718296s] Response #14: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=15.417419842s] Response #15: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=16.439038149s] Response #16: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=17.509064575s] Response #17: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=18.655392608s] Response #18: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=20.126237591s] Response #19: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=21.395676587s] Response #20: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=22.555533477s] Response #21: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=23.671123627s] Response #22: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=24.78147011s] Response #23: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=25.895906694s] Response #24: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=26.930265745s] Response #25: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=28.023696294s] Response #26: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=29.103358613s] Response #27: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist\n
        [t=30.146896151s] Response #28: SyncToDeviceHas(@user-3-alice:hs1): Key to_device.events does not exist, \n
        \u001b[39m\n
--- FAIL: TestToDeviceMessagesOverFederation/interrupted_connectivity (68.96s)\n
null
null
=== RUN   TestToDeviceMessagesOverFederation/stopped_server\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (713.567876ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (620.640558ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (14.879156ms)\n
    federation_to_device_test.go:43: StopServer hs2\n
    room_leave_test.go:19: Deploy times: 10.868196ms blueprints, 23.149417937s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (688.326769ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (652.582919ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (648.507973ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (595.868153ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!V5jLYH925bOLRM4rtY:hs1 => 200 OK (132.845738ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (142.759093ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!V5jLYH925bOLRM4rtY:hs1/state/m.room.name/ => 200 OK (97.215356ms)\n
    room_leave_test.go:61: SendEventSynced waiting for event ID $8uQEcCmFHdxIwWXsJzxUXapeK6Dg8QFYg60vJ5rs2YQ\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (156.610691ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!V5jLYH925bOLRM4rtY:hs1/state/madeup.test.state/ => 200 OK (101.867519ms)\n
    room_leave_test.go:69: SendEventSynced waiting for event ID $8bHJn5UYH9ToREmIth8OwgkCdeyHj3mKadcBP8ANSYc\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (157.674584ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!V5jLYH925bOLRM4rtY:hs1/send/m.room.message/3 => 200 OK (142.68324ms)\n
    room_leave_test.go:77: SendEventSynced waiting for event ID $J9zk-ALbzjZcSi2PIif0w5_2pZ9fwtw2qLAd_xqKXRo\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (325.907139ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!V5jLYH925bOLRM4rtY:hs1/send/m.room.message/4 => 200 OK (104.829916ms)\n
    room_leave_test.go:85: SendEventSynced waiting for event ID $srOw344HzuDPxRY91Dtd8panA4SxUbODqAQso7eGCc0\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (162.517101ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!V5jLYH925bOLRM4rtY:hs1/leave => 200 OK (85.55928ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (279.906076ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (98.198439ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!V5jLYH925bOLRM4rtY:hs1/state/m.room.name/ => 200 OK (89.098704ms)\n
    room_leave_test.go:99: SendEventSynced waiting for event ID $OQT-MJUnfjVuSv6OS1dLYXnPfMr_nOrea0UFei6_IMg\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (229.196579ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!V5jLYH925bOLRM4rtY:hs1/state/madeup.test.state/ => 200 OK (97.672382ms)\n
    room_leave_test.go:107: SendEventSynced waiting for event ID $GcawZPkEJppqqxgAnsCZ_7Hk88s62ZQ0CEmBvCozvZ0\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (289.363459ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!V5jLYH925bOLRM4rtY:hs1/send/m.room.message/7 => 200 OK (131.552881ms)\n
    room_leave_test.go:115: SendEventSynced waiting for event ID $FqwTiBnPsO8wb6WsUou3cBNSyp6xFmQXlHfnQjuUhdc\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (350.996056ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!V5jLYH925bOLRM4rtY:hs1 => 200 OK (110.452243ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (394.363232ms)\n
null
=== RUN   TestLeftRoomFixture/Can_get_rooms/{roomId}/state_for_a_departed_room\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!V5jLYH925bOLRM4rtY:hs1/state/madeup.test.state => 200 OK (20.569563ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!V5jLYH925bOLRM4rtY:hs1/state/madeup.test.state => 200 OK (11.230619ms)\n
--- PASS: TestLeftRoomFixture/Can_get_rooms/{roomId}/state_for_a_departed_room (0.03s)\n
null
null
=== RUN   TestLeftRoomFixture/Can_get_rooms/{roomId}/members_for_a_departed_room\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!V5jLYH925bOLRM4rtY:hs1/members => 200 OK (116.163922ms)\n
--- PASS: TestLeftRoomFixture/Can_get_rooms/{roomId}/members_for_a_departed_room (0.12s)\n
null
null
=== RUN   TestLeftRoomFixture/Can_get_rooms/{roomId}/messages_for_a_departed_room\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!V5jLYH925bOLRM4rtY:hs1/messages => 200 OK (200.738306ms)\n
--- PASS: TestLeftRoomFixture/Can_get_rooms/{roomId}/messages_for_a_departed_room (0.20s)\n
null
null
=== RUN   TestLeftRoomFixture/Can_get_'m.room.name'_state_for_a_departed_room\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!V5jLYH925bOLRM4rtY:hs1/state/m.room.name => 200 OK (21.4553ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!V5jLYH925bOLRM4rtY:hs1/state/m.room.name => 200 OK (13.110205ms)\n
--- PASS: TestLeftRoomFixture/Can_get_'m.room.name'_state_for_a_departed_room (0.03s)\n
null
null
=== RUN   TestLeftRoomFixture/Getting_messages_going_forward_is_limited_for_a_departed_room\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!V5jLYH925bOLRM4rtY:hs1/messages => 200 OK (15.955038ms)\n
--- PASS: TestLeftRoomFixture/Getting_messages_going_forward_is_limited_for_a_departed_room (0.02s)\n
null
2025/02/23 07:30:30 ============================================\n
\n
\n
2025/02/23 07:30:30 958d01e708e6e559c8b427a23fa38374b7d727e96fd7f100c0815179397207dc : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=958d01e708e6\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 958d01e708e6 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267019.3754966,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267019.3826153,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267019.3826547,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 10\n
To many layers, we have to go deeper frame_id: 12\n
To many layers, we have to go deeper frame_id: 14\n
==============state  fulll:  {\n
    (\n
        "m.room.create",\n
        "",\n
    ): PduEvent {\n
        event_id: "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
        event_sn: 7,\n
        event_ty: "m.room.create",\n
        room_id: "!V5jLYH925bOLRM4rtY:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267024446),\n
        content: RawValue(\n
            {"creator":"@user-1:hs1","room_version":"10"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [],\n
        depth: 1,\n
        auth_events: [],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "P5H4cIwc5J0BD2hSxKE6trEZJotUiQP7eSmShmG1iA4",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:iy277ALx":"WF3dyxCLoX5dNSTfrH16WcKiwDXTpDk44rLrgSwlYyE5Qt8vEwCIun52gHqIRnq916byLFvZHP6A7dJWsFFsDw"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.member",\n
        "@user-1:hs1",\n
    ): PduEvent {\n
        event_id: "$7Ob4p_LXghz1N3feHjlxvBiEhGw1Em8e2zKTktIdy_U",\n
        event_sn: 8,\n
        event_ty: "m.room.member",\n
        room_id: "!V5jLYH925bOLRM4rtY:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267024534),\n
        content: RawValue(\n
            {"displayname":"user-1 ⚡️","is_direct":false,"membership":"join"},\n
        ),\n
        state_key: Some(\n
            "@user-1:hs1",\n
        ),\n
        prev_events: [\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
        ],\n
        depth: 2,\n
        auth_events: [\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "mhIEAHmYyJYF69QYbKAP0GK56K4MHVc/80efw62aK1U",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:iy277ALx":"IqjZPkamboF0+4Mbhi7Kcp49wR1Xe0ScfatLR/CKfhSKQW5gmzi/Gd3bhztC28HZb4RXrlmP5FvqQRz/l8xlBA"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.member",\n
        "@user-2:hs1",\n
    ): PduEvent {\n
        event_id: "$KD0Rk1DABHKAaTEURflR8CoTF76pcj7wjch0koewlcs",\n
        event_sn: 26,\n
        event_ty: "m.room.member",\n
        room_id: "!V5jLYH925bOLRM4rtY:hs1",\n
        sender: "@user-2:hs1",\n
        origin_server_ts: UnixMillis(1740267026579),\n
        content: RawValue(\n
            {"displayname":"user-2 ⚡️","membership":"leave"},\n
        ),\n
        state_key: Some(\n
            "@user-2:hs1",\n
        ),\n
        prev_events: [\n
            "$1LkeXOC46ORN6mw3D464Yf6S31oZPUl8Q_3jiUXh5xo",\n
            "$5n6BbG53x12y34N6o0Ap5qGGRRwxEJnrJMcNJdQBHi0",\n
            "$7Ob4p_LXghz1N3feHjlxvBiEhGw1Em8e2zKTktIdy_U",\n
            "$8bHJn5UYH9ToREmIth8OwgkCdeyHj3mKadcBP8ANSYc",\n
            "$8uQEcCmFHdxIwWXsJzxUXapeK6Dg8QFYg60vJ5rs2YQ",\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
            "$J9zk-ALbzjZcSi2PIif0w5_2pZ9fwtw2qLAd_xqKXRo",\n
            "$_e3nEZZ9ecbOARE6XesS0pB_BsWH3nW-PQxTHCKRZKY",\n
            "$hsk0j1mrPyC4u1InP479soJZbGMS20T5Q1sYn-dwXlc",\n
            "$srOw344HzuDPxRY91Dtd8panA4SxUbODqAQso7eGCc0",\n
            "$tjFgtCX_XcYJDUTZ1DcOmCtEODWcS8l6T0tNgDiVu1M",\n
            "$twiHlqlV-ZmWbW0ezWNhShO-9TKTj8mJY2sCTeNeIXo",\n
        ],\n
        depth: 13,\n
        auth_events: [\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
            "$twiHlqlV-ZmWbW0ezWNhShO-9TKTj8mJY2sCTeNeIXo",\n
            "$5n6BbG53x12y34N6o0Ap5qGGRRwxEJnrJMcNJdQBHi0",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {"prev_content":{"displayname":"user-2 ⚡️","membership":"join"},"prev_sender":"@user-2:hs1"},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "eWbF+i+ADZFk+C2nMf3L92BBIzzQUdkftccrOxggb6g",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:iy277ALx":"uHlFoEJIK/mUjkquO0hY2FnoJhT1p4Dni5AyFhA75C5vLrtUlY6CmwPkQN9yZA37Woy+khxdsxguOPQySfSpAw"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.guest_access",\n
        "",\n
    ): PduEvent {\n
        event_id: "$tjFgtCX_XcYJDUTZ1DcOmCtEODWcS8l6T0tNgDiVu1M",\n
        event_sn: 13,\n
        event_ty: "m.room.guest_access",\n
        room_id: "!V5jLYH925bOLRM4rtY:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267024866),\n
        content: RawValue(\n
            {"guest_access":"forbidden"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$7Ob4p_LXghz1N3feHjlxvBiEhGw1Em8e2zKTktIdy_U",\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
            "$_e3nEZZ9ecbOARE6XesS0pB_BsWH3nW-PQxTHCKRZKY",\n
            "$hsk0j1mrPyC4u1InP479soJZbGMS20T5Q1sYn-dwXlc",\n
            "$twiHlqlV-ZmWbW0ezWNhShO-9TKTj8mJY2sCTeNeIXo",\n
        ],\n
        depth: 6,\n
        auth_events: [\n
            "$7Ob4p_LXghz1N3feHjlxvBiEhGw1Em8e2zKTktIdy_U",\n
            "$twiHlqlV-ZmWbW0ezWNhShO-9TKTj8mJY2sCTeNeIXo",\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "C7J8tEngzWVDfzmze9I29UNiS/eg48d8CHW54/4GYCI",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:iy277ALx":"++jyu5JyLyiaurtKWyxjcOzlV2BT3DwqQZsObPSoVMG0ezU7rToJfbFPbvbPUzNGpUnnq3PWClXmY72xdBU3AA"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.join_rules",\n
        "",\n
    ): PduEvent {\n
        event_id: "$hsk0j1mrPyC4u1InP479soJZbGMS20T5Q1sYn-dwXlc",\n
        event_sn: 11,\n
        event_ty: "m.room.join_rules",\n
        room_id: "!V5jLYH925bOLRM4rtY:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267024696),\n
        content: RawValue(\n
            {"join_rule":"public"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$7Ob4p_LXghz1N3feHjlxvBiEhGw1Em8e2zKTktIdy_U",\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
            "$twiHlqlV-ZmWbW0ezWNhShO-9TKTj8mJY2sCTeNeIXo",\n
        ],\n
        depth: 4,\n
        auth_events: [\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
            "$7Ob4p_LXghz1N3feHjlxvBiEhGw1Em8e2zKTktIdy_U",\n
            "$twiHlqlV-ZmWbW0ezWNhShO-9TKTj8mJY2sCTeNeIXo",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "giEfIjdlDkg/0fp4YSZ96TzrBEDSCm4yYc/AgKLihro",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:iy277ALx":"9A/1g1I96Jzm0XcRp3sM/X6cj43HzI2phv0Lv/L5IwjB5SYJ9Xs22Yc0dGj5ywPnCzabqUkTJbJL95LMnUyLDg"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.history_visibility",\n
        "",\n
    ): PduEvent {\n
        event_id: "$1LkeXOC46ORN6mw3D464Yf6S31oZPUl8Q_3jiUXh5xo",\n
        event_sn: 14,\n
        event_ty: "m.room.history_visibility",\n
        room_id: "!V5jLYH925bOLRM4rtY:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267024967),\n
        content: RawValue(\n
            {"history_visibility":"joined"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$7Ob4p_LXghz1N3feHjlxvBiEhGw1Em8e2zKTktIdy_U",\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
            "$_e3nEZZ9ecbOARE6XesS0pB_BsWH3nW-PQxTHCKRZKY",\n
            "$hsk0j1mrPyC4u1InP479soJZbGMS20T5Q1sYn-dwXlc",\n
            "$tjFgtCX_XcYJDUTZ1DcOmCtEODWcS8l6T0tNgDiVu1M",\n
            "$twiHlqlV-ZmWbW0ezWNhShO-9TKTj8mJY2sCTeNeIXo",\n
        ],\n
        depth: 7,\n
        auth_events: [\n
            "$twiHlqlV-ZmWbW0ezWNhShO-9TKTj8mJY2sCTeNeIXo",\n
            "$7Ob4p_LXghz1N3feHjlxvBiEhGw1Em8e2zKTktIdy_U",\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {"prev_content":{"history_visibility":"shared"},"prev_sender":"@user-1:hs1"},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "GeM8yKQUMCiIsR18YAGnVU+YT9Ko4OMWefW/9Z67/5U",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:iy277ALx":"KgvSA7KIXZqJ2dA94pwneetYymJOQxjTQW9apKgxGdQedxj+XOHdGz50EKLY0say3rVGygeE65TdRKRgXr8NBw"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.name",\n
        "",\n
    ): PduEvent {\n
        event_id: "$8uQEcCmFHdxIwWXsJzxUXapeK6Dg8QFYg60vJ5rs2YQ",\n
        event_sn: 18,\n
        event_ty: "m.room.name",\n
        room_id: "!V5jLYH925bOLRM4rtY:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267025340),\n
        content: RawValue(\n
            {"name":"N1. B's room name before A left"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$1LkeXOC46ORN6mw3D464Yf6S31oZPUl8Q_3jiUXh5xo",\n
            "$5n6BbG53x12y34N6o0Ap5qGGRRwxEJnrJMcNJdQBHi0",\n
            "$7Ob4p_LXghz1N3feHjlxvBiEhGw1Em8e2zKTktIdy_U",\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
            "$_e3nEZZ9ecbOARE6XesS0pB_BsWH3nW-PQxTHCKRZKY",\n
            "$hsk0j1mrPyC4u1InP479soJZbGMS20T5Q1sYn-dwXlc",\n
            "$tjFgtCX_XcYJDUTZ1DcOmCtEODWcS8l6T0tNgDiVu1M",\n
            "$twiHlqlV-ZmWbW0ezWNhShO-9TKTj8mJY2sCTeNeIXo",\n
        ],\n
        depth: 9,\n
        auth_events: [\n
            "$7Ob4p_LXghz1N3feHjlxvBiEhGw1Em8e2zKTktIdy_U",\n
            "$twiHlqlV-ZmWbW0ezWNhShO-9TKTj8mJY2sCTeNeIXo",\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "HvljZ1cvJGwnr7ZcYK/YUZre9xsiWeDD6TJAcZeNUlQ",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:iy277ALx":"w6eM3dwiAmjOM489W9qH32qwyo2XYPfiTmDECKiXyjneoqTPnjOj7Gk4wDex5sNrAUJFm8GZtJlfUpRvQaWwAg"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "madeup.test.state",\n
        "",\n
    ): PduEvent {\n
        event_id: "$8bHJn5UYH9ToREmIth8OwgkCdeyHj3mKadcBP8ANSYc",\n
        event_sn: 20,\n
        event_ty: "madeup.test.state",\n
        room_id: "!V5jLYH925bOLRM4rtY:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267025602),\n
        content: RawValue(\n
            {"body":"S1. B's state before A left"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$1LkeXOC46ORN6mw3D464Yf6S31oZPUl8Q_3jiUXh5xo",\n
            "$5n6BbG53x12y34N6o0Ap5qGGRRwxEJnrJMcNJdQBHi0",\n
            "$7Ob4p_LXghz1N3feHjlxvBiEhGw1Em8e2zKTktIdy_U",\n
            "$8uQEcCmFHdxIwWXsJzxUXapeK6Dg8QFYg60vJ5rs2YQ",\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
            "$_e3nEZZ9ecbOARE6XesS0pB_BsWH3nW-PQxTHCKRZKY",\n
            "$hsk0j1mrPyC4u1InP479soJZbGMS20T5Q1sYn-dwXlc",\n
            "$tjFgtCX_XcYJDUTZ1DcOmCtEODWcS8l6T0tNgDiVu1M",\n
            "$twiHlqlV-ZmWbW0ezWNhShO-9TKTj8mJY2sCTeNeIXo",\n
        ],\n
        depth: 10,\n
        auth_events: [\n
            "$7Ob4p_LXghz1N3feHjlxvBiEhGw1Em8e2zKTktIdy_U",\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
            "$twiHlqlV-ZmWbW0ezWNhShO-9TKTj8mJY2sCTeNeIXo",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "0in9razH2SJD4to8rm3ATA4pzGUP4qJwlNdf8BFspPk",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:iy277ALx":"/4aUv6zeI/gw1mhLMymcmQ4LeCjfcdo3dVU+UN4q1zh5HOu2PHw+PdK7Wl5Db6Gj+e1/1H63zmJw1HedosntCQ"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.power_levels",\n
        "",\n
    ): PduEvent {\n
        event_id: "$twiHlqlV-ZmWbW0ezWNhShO-9TKTj8mJY2sCTeNeIXo",\n
        event_sn: 10,\n
        event_ty: "m.room.power_levels",\n
        room_id: "!V5jLYH925bOLRM4rtY:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267024635),\n
        content: RawValue(\n
            {"ban":50,"events":{},"events_default":0,"invite":0,"kick":50,"notifications":{"room":50},"redact":50,"state_default":50,"users":{"@user-1:hs1":100},"users_default":0},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$7Ob4p_LXghz1N3feHjlxvBiEhGw1Em8e2zKTktIdy_U",\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
        ],\n
        depth: 3,\n
        auth_events: [\n
            "$7Ob4p_LXghz1N3feHjlxvBiEhGw1Em8e2zKTktIdy_U",\n
            "$CvefLOcBIBEgP_ELG3Txw7fDvtHZ5tbceH7VXrgF0jw",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "eYNcHt2lND6KDkMKkM5qSv3EoIIaGdHaZGAQ29T+J7g",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:iy277ALx":"jl1GBoEL8KAGvSWau/WU7kDZK6ITeYFCbfHUkP4rULBbwaTQedp9ir3QUNKkN+sHSzmR2c67TQkVDc3yH0e7Cg"}},\n
            ),\n
        ),\n
    },\n
}\n
2025/02/23 07:30:30 ============== 958d01e708e6e559c8b427a23fa38374b7d727e96fd7f100c0815179397207dc : END LOGS ==============\n
\n
\n
--- PASS: TestLeftRoomFixture (31.37s)\n
null
null
=== RUN   TestGetRoomMembers\n
    room_members_test.go:25: Deploy times: 14.697704ms blueprints, 13.742966833s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (598.181201ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (588.035018ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/sendToDevice/my.test.type/1 => 200 OK (9.275439ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (398.466708ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!8bCMTybZz20ol81rnI:hs1 => 200 OK (109.124504ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (119.968444ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!8bCMTybZz20ol81rnI:hs1/members => 200 OK (20.007702ms)\n
    federation_to_device_test.go:48: StopServer hs1\n
2025/02/23 07:30:47 ============================================\n
\n
\n
2025/02/23 07:30:47 df76dc44e4efabdb6a2c0324644a83c665bb219f2ae9a466146e60108a2f570f : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=df76dc44e4ef\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux df76dc44e4ef 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267041.3176942,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267041.323341,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267041.3233616,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
==============state  fulll:  {\n
    (\n
        "m.room.history_visibility",\n
        "",\n
    ): PduEvent {\n
        event_id: "$LnzaXiBhM8AauKvNG5FI2dU_kVHQMLEy4pauOiEtxag",\n
        event_sn: 10,\n
        event_ty: "m.room.history_visibility",\n
        room_id: "!8bCMTybZz20ol81rnI:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267045871),\n
        content: RawValue(\n
            {"history_visibility":"shared"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$ATPiLHll-7jiM5mLkCYHm8COF06YS3yqWP-lh14voLI",\n
            "$BkHbyYqDaeNxqljvGZUlG7W8KHpTILaLNnSwrk2lqnE",\n
            "$XE0C_LjLvy4NHcV1f29QQQZeLS8MIKpyXb22t2YgIsU",\n
            "$ZRIdJ3jgbwRI1Pfog_COSW-Xc5GkIOMC9GoNC5USe6A",\n
        ],\n
        depth: 5,\n
        auth_events: [\n
            "$ZRIdJ3jgbwRI1Pfog_COSW-Xc5GkIOMC9GoNC5USe6A",\n
            "$BkHbyYqDaeNxqljvGZUlG7W8KHpTILaLNnSwrk2lqnE",\n
            "$ATPiLHll-7jiM5mLkCYHm8COF06YS3yqWP-lh14voLI",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "MayQMEtcYQ/mFiXeWZ3ablaCRoiQtpEOP2Lym72+VZ4",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:6I7VI2yw":"jXoTbBMz+O0xjVrVR8KxALwIMygPkAlEljG7cA84O//ZCt517OfyH+IdRd8MwWHQUYBaw+kMwhc5MVbioKJMBQ"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.join_rules",\n
        "",\n
    ): PduEvent {\n
        event_id: "$XE0C_LjLvy4NHcV1f29QQQZeLS8MIKpyXb22t2YgIsU",\n
        event_sn: 9,\n
        event_ty: "m.room.join_rules",\n
        room_id: "!8bCMTybZz20ol81rnI:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267045819),\n
        content: RawValue(\n
            {"join_rule":"public"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$ATPiLHll-7jiM5mLkCYHm8COF06YS3yqWP-lh14voLI",\n
            "$BkHbyYqDaeNxqljvGZUlG7W8KHpTILaLNnSwrk2lqnE",\n
            "$ZRIdJ3jgbwRI1Pfog_COSW-Xc5GkIOMC9GoNC5USe6A",\n
        ],\n
        depth: 4,\n
        auth_events: [\n
            "$BkHbyYqDaeNxqljvGZUlG7W8KHpTILaLNnSwrk2lqnE",\n
            "$ATPiLHll-7jiM5mLkCYHm8COF06YS3yqWP-lh14voLI",\n
            "$ZRIdJ3jgbwRI1Pfog_COSW-Xc5GkIOMC9GoNC5USe6A",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "AN3UnhF6RcbT5elMqC0e3fTK/2t7BRpMQg5Nk7IeCEs",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:6I7VI2yw":"DUQ517/ZdDT4NLwuEzzGO4EWj/kNFWUeKv4GQ8xfzUiyTEn+ilRWn2HKqvJXqQJtTs+OwQhz85ohNn+jH2Y2CQ"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.member",\n
        "@user-2:hs1",\n
    ): PduEvent {\n
        event_id: "$JycIbIuS3SKDfHV6rnZkEZ88oPHzI5I-lEmoRfRyHiA",\n
        event_sn: 12,\n
        event_ty: "m.room.member",\n
        room_id: "!8bCMTybZz20ol81rnI:hs1",\n
        sender: "@user-2:hs1",\n
        origin_server_ts: UnixMillis(1740267046033),\n
        content: RawValue(\n
            {"displayname":"user-2 ⚡️","membership":"join"},\n
        ),\n
        state_key: Some(\n
            "@user-2:hs1",\n
        ),\n
        prev_events: [\n
            "$ATPiLHll-7jiM5mLkCYHm8COF06YS3yqWP-lh14voLI",\n
            "$BkHbyYqDaeNxqljvGZUlG7W8KHpTILaLNnSwrk2lqnE",\n
            "$LnzaXiBhM8AauKvNG5FI2dU_kVHQMLEy4pauOiEtxag",\n
            "$XE0C_LjLvy4NHcV1f29QQQZeLS8MIKpyXb22t2YgIsU",\n
            "$ZRIdJ3jgbwRI1Pfog_COSW-Xc5GkIOMC9GoNC5USe6A",\n
            "$_2EhmkG3uL5A1sSo5bKe6AUU2awcmvhvM2KzuqIECa0",\n
        ],\n
        depth: 7,\n
        auth_events: [\n
            "$XE0C_LjLvy4NHcV1f29QQQZeLS8MIKpyXb22t2YgIsU",\n
            "$ZRIdJ3jgbwRI1Pfog_COSW-Xc5GkIOMC9GoNC5USe6A",\n
            "$BkHbyYqDaeNxqljvGZUlG7W8KHpTILaLNnSwrk2lqnE",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "pjJ1c1QRGty8qhsQl5dpzMP6w2dyk6ZsNl187Ku+wNo",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:6I7VI2yw":"TtHGwDZMWL+H1cLQ+Wiu7OjhiwLM8aeBQBFMpf/zIhlsbd5ecb2RRiaEPbn4oSJb/uh67ExX7Ycf3TioO8QQDA"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.create",\n
        "",\n
    ): PduEvent {\n
        event_id: "$BkHbyYqDaeNxqljvGZUlG7W8KHpTILaLNnSwrk2lqnE",\n
        event_sn: 5,\n
        event_ty: "m.room.create",\n
        room_id: "!8bCMTybZz20ol81rnI:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267045607),\n
        content: RawValue(\n
            {"creator":"@user-1:hs1","room_version":"10"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [],\n
        depth: 1,\n
        auth_events: [],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "zNlTLCljc8Lb4rmm/ilMLW1bpaicwC2fNIGrIuN3g+M",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:6I7VI2yw":"wuHNqAQR9jX34rMrlU0uqLDzzg7Bbifx17yihXCIwixUnwW6TP3/PXQxwhnBmwTFsEMUeX/so9i9zcPoV+00Bg"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.guest_access",\n
        "",\n
    ): PduEvent {\n
        event_id: "$_2EhmkG3uL5A1sSo5bKe6AUU2awcmvhvM2KzuqIECa0",\n
        event_sn: 11,\n
        event_ty: "m.room.guest_access",\n
        room_id: "!8bCMTybZz20ol81rnI:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267045939),\n
        content: RawValue(\n
            {"guest_access":"forbidden"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$ATPiLHll-7jiM5mLkCYHm8COF06YS3yqWP-lh14voLI",\n
            "$BkHbyYqDaeNxqljvGZUlG7W8KHpTILaLNnSwrk2lqnE",\n
            "$LnzaXiBhM8AauKvNG5FI2dU_kVHQMLEy4pauOiEtxag",\n
            "$XE0C_LjLvy4NHcV1f29QQQZeLS8MIKpyXb22t2YgIsU",\n
            "$ZRIdJ3jgbwRI1Pfog_COSW-Xc5GkIOMC9GoNC5USe6A",\n
        ],\n
        depth: 6,\n
        auth_events: [\n
            "$ZRIdJ3jgbwRI1Pfog_COSW-Xc5GkIOMC9GoNC5USe6A",\n
            "$BkHbyYqDaeNxqljvGZUlG7W8KHpTILaLNnSwrk2lqnE",\n
            "$ATPiLHll-7jiM5mLkCYHm8COF06YS3yqWP-lh14voLI",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "bFlV99CSTgcFovCwbHCLi01TF5slsGwuTDELHVOy++A",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:6I7VI2yw":"imLzjrJzB+r6zp7zzT2VUBl6xocFNXXV4UbrSq3Sqvsd7P9cKZp0gepHNiVaXhN7C46wXO6IT/Kdgq09q5KACw"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.power_levels",\n
        "",\n
    ): PduEvent {\n
        event_id: "$ZRIdJ3jgbwRI1Pfog_COSW-Xc5GkIOMC9GoNC5USe6A",\n
        event_sn: 8,\n
        event_ty: "m.room.power_levels",\n
        room_id: "!8bCMTybZz20ol81rnI:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267045763),\n
        content: RawValue(\n
            {"ban":50,"events":{},"events_default":0,"invite":0,"kick":50,"notifications":{"room":50},"redact":50,"state_default":50,"users":{"@user-1:hs1":100},"users_default":0},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$ATPiLHll-7jiM5mLkCYHm8COF06YS3yqWP-lh14voLI",\n
            "$BkHbyYqDaeNxqljvGZUlG7W8KHpTILaLNnSwrk2lqnE",\n
        ],\n
        depth: 3,\n
        auth_events: [\n
            "$ATPiLHll-7jiM5mLkCYHm8COF06YS3yqWP-lh14voLI",\n
            "$BkHbyYqDaeNxqljvGZUlG7W8KHpTILaLNnSwrk2lqnE",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "qoHiVxEP9LaNpWxsbuBho4Nr/i5wEhQJKVq2PBLp7hI",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:6I7VI2yw":"+LMyIOFVyLCB3GZQIfN22bK5cmJOHcnHAh6z+L1DY6yetGCcmULvnWe3DqUbYL7TE9t8x2aA7D/IMIiSnIErCg"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.member",\n
        "@user-1:hs1",\n
    ): PduEvent {\n
        event_id: "$ATPiLHll-7jiM5mLkCYHm8COF06YS3yqWP-lh14voLI",\n
        event_sn: 6,\n
        event_ty: "m.room.member",\n
        room_id: "!8bCMTybZz20ol81rnI:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267045670),\n
        content: RawValue(\n
            {"displayname":"user-1 ⚡️","is_direct":false,"membership":"join"},\n
        ),\n
        state_key: Some(\n
            "@user-1:hs1",\n
        ),\n
        prev_events: [\n
            "$BkHbyYqDaeNxqljvGZUlG7W8KHpTILaLNnSwrk2lqnE",\n
        ],\n
        depth: 2,\n
        auth_events: [\n
            "$BkHbyYqDaeNxqljvGZUlG7W8KHpTILaLNnSwrk2lqnE",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "7I/hDXyKiL4Xzfj4bCuVI8QIHlOH1AFc55VYGPG7W0w",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:6I7VI2yw":"UX6S8oo5F0CX8cedKijpn1z/WTB3UcJwuuonLiqZiUdXbTZcT4BPbG83anjHTQJYAXz7O7YYmkJtPFV6F03/Cg"}},\n
            ),\n
        ),\n
    },\n
}\n
2025/02/23 07:30:47 ============== df76dc44e4efabdb6a2c0324644a83c665bb219f2ae9a466146e60108a2f570f : END LOGS ==============\n
\n
\n
--- PASS: TestGetRoomMembers (17.02s)\n
null
null
=== RUN   TestGetRoomMembersAtPoint\n
    room_members_test.go:64: Deploy times: 11.700283ms blueprints, 15.34317879s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (926.410331ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (770.065025ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (596.380626ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!XzXwx7ROS6EuHcP1kI:hs1/send/m.room.message/1 => 200 OK (142.104818ms)\n
    room_members_test.go:74: SendEventSynced waiting for event ID $29TB2wHIJooen0Tg8urCuO4RrZBlqIbnRT9yWe3aCWI\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (171.226308ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (188.177792ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!XzXwx7ROS6EuHcP1kI:hs1 => 200 OK (166.578453ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (252.634551ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!XzXwx7ROS6EuHcP1kI:hs1/send/m.room.message/1 => 200 OK (173.785303ms)\n
    room_members_test.go:88: SendEventSynced waiting for event ID $FpOyyBuGUHHQ9GCJdNA41oFQC8r0mdKUlWzOueA2KjI\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (193.006086ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!XzXwx7ROS6EuHcP1kI:hs1/members => 200 OK (19.389355ms)\n
    room_members_test.go:105: \u001b[31mMatchResponse JSONCheckOff(chunk): did not see items: [m.room.member|@user-1:hs1] - http://127.0.0.1:33049/_matrix/client/v3/rooms/%!X(MISSING)zXwx7ROS6EuHcP1kI:hs1/members?at=5 => {"chunk":[]}\u001b[39m\n
2025/02/23 07:31:08 ============================================\n
\n
\n
2025/02/23 07:31:08 1322567e4ef72e9b02af9d5be9b9b969b6b6dc697b982994d707d9b98d71611b : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=1322567e4ef7\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 1322567e4ef7 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267059.3042488,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267059.321307,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267059.321335,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
==============state  fulll:  {\n
    (\n
        "m.room.create",\n
        "",\n
    ): PduEvent {\n
        event_id: "$o4sEOKFxjLkZZlpGeUKo_AWIKMd0i45kdzTV_ZmS7kQ",\n
        event_sn: 5,\n
        event_ty: "m.room.create",\n
        room_id: "!XzXwx7ROS6EuHcP1kI:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267064729),\n
        content: RawValue(\n
            {"creator":"@user-1:hs1","room_version":"10"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [],\n
        depth: 1,\n
        auth_events: [],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "SbMBAgP2aX7+g/8YgIA3Qe+y/DTcOTiLWDMcFU5xxYg",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:2pR5E1m6":"j9t2r8t6RoErpZVgE+Z3u8hdxaETTd4eeplsVdfcXKU8hvNno7pI7f9HMpuzD5RtY8L9ABNJdl19tthKHv6SBw"}},\n
            ),\n
        ),\n
    },\n
}\n
2025/02/23 07:31:08 ============== 1322567e4ef72e9b02af9d5be9b9b969b6b6dc697b982994d707d9b98d71611b : END LOGS ==============\n
\n
\n
--- FAIL: TestGetRoomMembersAtPoint (20.60s)\n
null
null
=== RUN   TestGetFilteredRoomMembers\n
    federation_to_device_test.go:49: StartServer hs1\n
    room_members_test.go:124: Deploy times: 14.83437ms blueprints, 15.498197982s containers\n
    federation_to_device_test.go:51: StartServer hs2\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (636.898604ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (608.184164ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (375.171994ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!28V5XLtwC5vBzUAGTR:hs1 => 200 OK (225.664601ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (195.943672ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!28V5XLtwC5vBzUAGTR:hs1/leave => 200 OK (105.302641ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (148.939393ms)\n
null
=== RUN   TestGetFilteredRoomMembers/not_membership\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!28V5XLtwC5vBzUAGTR:hs1/members => 200 OK (37.073416ms)\n
--- PASS: TestGetFilteredRoomMembers/not_membership (0.04s)\n
null
null
=== RUN   TestGetFilteredRoomMembers/membership/leave\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!28V5XLtwC5vBzUAGTR:hs1/members => 200 OK (41.663605ms)\n
--- PASS: TestGetFilteredRoomMembers/membership/leave (0.04s)\n
null
null
=== RUN   TestGetFilteredRoomMembers/membership/join\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!28V5XLtwC5vBzUAGTR:hs1/members => 200 OK (51.824441ms)\n
--- PASS: TestGetFilteredRoomMembers/membership/join (0.05s)\n
null
2025/02/23 07:31:27 ============================================\n
\n
\n
2025/02/23 07:31:27 fedf37541c6b370f1af8cc139f40a597b27aa87f60d2f188692c54acacf4bd76 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=fedf37541c6b\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux fedf37541c6b 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267080.2944276,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267080.3036458,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267080.3036761,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
==============state  fulll:  {\n
    (\n
        "m.room.member",\n
        "@user-1:hs1",\n
    ): PduEvent {\n
        event_id: "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
        event_sn: 6,\n
        event_ty: "m.room.member",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085110),\n
        content: RawValue(\n
            {"displayname":"user-1 ⚡️","is_direct":false,"membership":"join"},\n
        ),\n
        state_key: Some(\n
            "@user-1:hs1",\n
        ),\n
        prev_events: [\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        depth: 2,\n
        auth_events: [\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "jLKoimoBcJekLhQuYeHKcy+JZBFd0t9pVHAdVNt7Kp0",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"2DCJuudDT7/mZpquw1Q1SkjRIgrH31LXsJvsWO9ylKLst/bRqQf1tg2rw2z5JcMvFFouEW5XcEFVF4JMXMFWBQ"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.create",\n
        "",\n
    ): PduEvent {\n
        event_id: "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        event_sn: 5,\n
        event_ty: "m.room.create",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085040),\n
        content: RawValue(\n
            {"creator":"@user-1:hs1","room_version":"10"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [],\n
        depth: 1,\n
        auth_events: [],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "YGrSHSiViKZ7DhHBTD3OG9zORgzzuA2jz6Lu8D7npQ0",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"S/FIoKrzxKQioQG5lHIVIWj8/ouH08rpyFamj/DhFLHqkaUDJXoNFZCnGbvCH1gLOXIlBkbm9rm6YX9q4v3rBA"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.history_visibility",\n
        "",\n
    ): PduEvent {\n
        event_id: "$eCYnM83KMCChU1gai4J74jBJ7rTB7K7DgFYTx5dW2V8",\n
        event_sn: 10,\n
        event_ty: "m.room.history_visibility",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085295),\n
        content: RawValue(\n
            {"history_visibility":"shared"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
            "$wgeeTrv5eAlJzKO7v9dQgjdH0JxwuOKuAqbp963QBtU",\n
        ],\n
        depth: 5,\n
        auth_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "2Cav4lsu32zJIUBBYyv4RyisIl5txUC/74KXr5qNtqo",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"Nmjdw/sOQMIEggimZTaYD9VvXFOftbWwYqY9vaX8Hi/3AW0EEmP5c2f10y6mDCMHBgdIkqBRmOVMdFitYQz8AA"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.member",\n
        "@user-2:hs1",\n
    ): PduEvent {\n
        event_id: "$6_7oNjKuVUcxtKMXVLJyhz_45TJnQsyMDmDOEOI2IRU",\n
        event_sn: 15,\n
        event_ty: "m.room.member",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-2:hs1",\n
        origin_server_ts: UnixMillis(1740267085857),\n
        content: RawValue(\n
            {"displayname":"user-2 ⚡️","membership":"leave"},\n
        ),\n
        state_key: Some(\n
            "@user-2:hs1",\n
        ),\n
        prev_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$Ul4ATboCWQXvkhhyn7QNL1wQt-oYBsGY5Q16uXrLeCg",\n
            "$eCYnM83KMCChU1gai4J74jBJ7rTB7K7DgFYTx5dW2V8",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
            "$wgeeTrv5eAlJzKO7v9dQgjdH0JxwuOKuAqbp963QBtU",\n
            "$xqyTuo1dAXrxtV17f1pbMZw7HfU4mQknZNbjH7Wywhg",\n
        ],\n
        depth: 8,\n
        auth_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$xqyTuo1dAXrxtV17f1pbMZw7HfU4mQknZNbjH7Wywhg",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {"prev_content":{"displayname":"user-2 ⚡️","membership":"join"},"prev_sender":"@user-2:hs1"},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "O58ANJWtem3HjMzAF3sT/I+IBUGScqh31+5JrWIWZcg",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"bhQ2o9QQvL8Ko0sTACQXnL6zB2uoXzMugoHVbMpq20h1w4/zjt4usg5C0dm9RCWz5H89UZvTBvDN+KDifRCsDw"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.power_levels",\n
        "",\n
    ): PduEvent {\n
        event_id: "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
        event_sn: 8,\n
        event_ty: "m.room.power_levels",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085170),\n
        content: RawValue(\n
            {"ban":50,"events":{},"events_default":0,"invite":0,"kick":50,"notifications":{"room":50},"redact":50,"state_default":50,"users":{"@user-1:hs1":100},"users_default":0},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        depth: 3,\n
        auth_events: [\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "H/NuCQJG99VaN2HOJL5eIKY+yfghK6ovVUgeSgWVS8E",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"1fArb5dRcpu7fbLX2gW8JfTe/RhcwARpXdMX8k/W724MrAFZNK1KAoK0N3ysQcDjgIQQXdgEcDdq2c7sAM3gAA"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.join_rules",\n
        "",\n
    ): PduEvent {\n
        event_id: "$wgeeTrv5eAlJzKO7v9dQgjdH0JxwuOKuAqbp963QBtU",\n
        event_sn: 9,\n
        event_ty: "m.room.join_rules",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085221),\n
        content: RawValue(\n
            {"join_rule":"public"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        depth: 4,\n
        auth_events: [\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "SKSVFFJHOiMHp1uPM2eRzfucQNkbAalPAAujU/1tegE",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"uo8tqIIU7tgqsA0mdW/vHbX4zjERGuJeXnLzBjG+ueFx8ekenqdFbyzImepmgFYSKfvjG+E6EM+T0INfXH3OAg"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.guest_access",\n
        "",\n
    ): PduEvent {\n
        event_id: "$Ul4ATboCWQXvkhhyn7QNL1wQt-oYBsGY5Q16uXrLeCg",\n
        event_sn: 11,\n
        event_ty: "m.room.guest_access",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085347),\n
        content: RawValue(\n
            {"guest_access":"forbidden"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$eCYnM83KMCChU1gai4J74jBJ7rTB7K7DgFYTx5dW2V8",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
            "$wgeeTrv5eAlJzKO7v9dQgjdH0JxwuOKuAqbp963QBtU",\n
        ],\n
        depth: 6,\n
        auth_events: [\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "/QTHibnKIVNkNJ+CjFjMeTD4xlyCupmWn+mKIF1HIuU",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"4LwE9Rh09ugIu01WrukBsj/gUqemSDQF5NGF6VhRHh/AjSvUez0LCsXeN1X/dJLRPJAry6iKKNupBfhqTAmLCg"}},\n
            ),\n
        ),\n
    },\n
}\n
==============state  fulll:  {\n
    (\n
        "m.room.power_levels",\n
        "",\n
    ): PduEvent {\n
        event_id: "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
        event_sn: 8,\n
        event_ty: "m.room.power_levels",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085170),\n
        content: RawValue(\n
            {"ban":50,"events":{},"events_default":0,"invite":0,"kick":50,"notifications":{"room":50},"redact":50,"state_default":50,"users":{"@user-1:hs1":100},"users_default":0},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        depth: 3,\n
        auth_events: [\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "H/NuCQJG99VaN2HOJL5eIKY+yfghK6ovVUgeSgWVS8E",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"1fArb5dRcpu7fbLX2gW8JfTe/RhcwARpXdMX8k/W724MrAFZNK1KAoK0N3ysQcDjgIQQXdgEcDdq2c7sAM3gAA"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.history_visibility",\n
        "",\n
    ): PduEvent {\n
        event_id: "$eCYnM83KMCChU1gai4J74jBJ7rTB7K7DgFYTx5dW2V8",\n
        event_sn: 10,\n
        event_ty: "m.room.history_visibility",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085295),\n
        content: RawValue(\n
            {"history_visibility":"shared"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
            "$wgeeTrv5eAlJzKO7v9dQgjdH0JxwuOKuAqbp963QBtU",\n
        ],\n
        depth: 5,\n
        auth_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "2Cav4lsu32zJIUBBYyv4RyisIl5txUC/74KXr5qNtqo",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"Nmjdw/sOQMIEggimZTaYD9VvXFOftbWwYqY9vaX8Hi/3AW0EEmP5c2f10y6mDCMHBgdIkqBRmOVMdFitYQz8AA"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.join_rules",\n
        "",\n
    ): PduEvent {\n
        event_id: "$wgeeTrv5eAlJzKO7v9dQgjdH0JxwuOKuAqbp963QBtU",\n
        event_sn: 9,\n
        event_ty: "m.room.join_rules",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085221),\n
        content: RawValue(\n
            {"join_rule":"public"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        depth: 4,\n
        auth_events: [\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "SKSVFFJHOiMHp1uPM2eRzfucQNkbAalPAAujU/1tegE",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"uo8tqIIU7tgqsA0mdW/vHbX4zjERGuJeXnLzBjG+ueFx8ekenqdFbyzImepmgFYSKfvjG+E6EM+T0INfXH3OAg"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.create",\n
        "",\n
    ): PduEvent {\n
        event_id: "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        event_sn: 5,\n
        event_ty: "m.room.create",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085040),\n
        content: RawValue(\n
            {"creator":"@user-1:hs1","room_version":"10"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [],\n
        depth: 1,\n
        auth_events: [],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "YGrSHSiViKZ7DhHBTD3OG9zORgzzuA2jz6Lu8D7npQ0",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"S/FIoKrzxKQioQG5lHIVIWj8/ouH08rpyFamj/DhFLHqkaUDJXoNFZCnGbvCH1gLOXIlBkbm9rm6YX9q4v3rBA"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.member",\n
        "@user-2:hs1",\n
    ): PduEvent {\n
        event_id: "$6_7oNjKuVUcxtKMXVLJyhz_45TJnQsyMDmDOEOI2IRU",\n
        event_sn: 15,\n
        event_ty: "m.room.member",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-2:hs1",\n
        origin_server_ts: UnixMillis(1740267085857),\n
        content: RawValue(\n
            {"displayname":"user-2 ⚡️","membership":"leave"},\n
        ),\n
        state_key: Some(\n
            "@user-2:hs1",\n
        ),\n
        prev_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$Ul4ATboCWQXvkhhyn7QNL1wQt-oYBsGY5Q16uXrLeCg",\n
            "$eCYnM83KMCChU1gai4J74jBJ7rTB7K7DgFYTx5dW2V8",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
            "$wgeeTrv5eAlJzKO7v9dQgjdH0JxwuOKuAqbp963QBtU",\n
            "$xqyTuo1dAXrxtV17f1pbMZw7HfU4mQknZNbjH7Wywhg",\n
        ],\n
        depth: 8,\n
        auth_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$xqyTuo1dAXrxtV17f1pbMZw7HfU4mQknZNbjH7Wywhg",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {"prev_content":{"displayname":"user-2 ⚡️","membership":"join"},"prev_sender":"@user-2:hs1"},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "O58ANJWtem3HjMzAF3sT/I+IBUGScqh31+5JrWIWZcg",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"bhQ2o9QQvL8Ko0sTACQXnL6zB2uoXzMugoHVbMpq20h1w4/zjt4usg5C0dm9RCWz5H89UZvTBvDN+KDifRCsDw"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.member",\n
        "@user-1:hs1",\n
    ): PduEvent {\n
        event_id: "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
        event_sn: 6,\n
        event_ty: "m.room.member",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085110),\n
        content: RawValue(\n
            {"displayname":"user-1 ⚡️","is_direct":false,"membership":"join"},\n
        ),\n
        state_key: Some(\n
            "@user-1:hs1",\n
        ),\n
        prev_events: [\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        depth: 2,\n
        auth_events: [\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "jLKoimoBcJekLhQuYeHKcy+JZBFd0t9pVHAdVNt7Kp0",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"2DCJuudDT7/mZpquw1Q1SkjRIgrH31LXsJvsWO9ylKLst/bRqQf1tg2rw2z5JcMvFFouEW5XcEFVF4JMXMFWBQ"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.guest_access",\n
        "",\n
    ): PduEvent {\n
        event_id: "$Ul4ATboCWQXvkhhyn7QNL1wQt-oYBsGY5Q16uXrLeCg",\n
        event_sn: 11,\n
        event_ty: "m.room.guest_access",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085347),\n
        content: RawValue(\n
            {"guest_access":"forbidden"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$eCYnM83KMCChU1gai4J74jBJ7rTB7K7DgFYTx5dW2V8",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
            "$wgeeTrv5eAlJzKO7v9dQgjdH0JxwuOKuAqbp963QBtU",\n
        ],\n
        depth: 6,\n
        auth_events: [\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "/QTHibnKIVNkNJ+CjFjMeTD4xlyCupmWn+mKIF1HIuU",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"4LwE9Rh09ugIu01WrukBsj/gUqemSDQF5NGF6VhRHh/AjSvUez0LCsXeN1X/dJLRPJAry6iKKNupBfhqTAmLCg"}},\n
            ),\n
        ),\n
    },\n
}\n
==============state  fulll:  {\n
    (\n
        "m.room.create",\n
        "",\n
    ): PduEvent {\n
        event_id: "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        event_sn: 5,\n
        event_ty: "m.room.create",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085040),\n
        content: RawValue(\n
            {"creator":"@user-1:hs1","room_version":"10"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [],\n
        depth: 1,\n
        auth_events: [],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "YGrSHSiViKZ7DhHBTD3OG9zORgzzuA2jz6Lu8D7npQ0",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"S/FIoKrzxKQioQG5lHIVIWj8/ouH08rpyFamj/DhFLHqkaUDJXoNFZCnGbvCH1gLOXIlBkbm9rm6YX9q4v3rBA"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.join_rules",\n
        "",\n
    ): PduEvent {\n
        event_id: "$wgeeTrv5eAlJzKO7v9dQgjdH0JxwuOKuAqbp963QBtU",\n
        event_sn: 9,\n
        event_ty: "m.room.join_rules",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085221),\n
        content: RawValue(\n
            {"join_rule":"public"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        depth: 4,\n
        auth_events: [\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "SKSVFFJHOiMHp1uPM2eRzfucQNkbAalPAAujU/1tegE",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"uo8tqIIU7tgqsA0mdW/vHbX4zjERGuJeXnLzBjG+ueFx8ekenqdFbyzImepmgFYSKfvjG+E6EM+T0INfXH3OAg"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.member",\n
        "@user-2:hs1",\n
    ): PduEvent {\n
        event_id: "$6_7oNjKuVUcxtKMXVLJyhz_45TJnQsyMDmDOEOI2IRU",\n
        event_sn: 15,\n
        event_ty: "m.room.member",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-2:hs1",\n
        origin_server_ts: UnixMillis(1740267085857),\n
        content: RawValue(\n
            {"displayname":"user-2 ⚡️","membership":"leave"},\n
        ),\n
        state_key: Some(\n
            "@user-2:hs1",\n
        ),\n
        prev_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$Ul4ATboCWQXvkhhyn7QNL1wQt-oYBsGY5Q16uXrLeCg",\n
            "$eCYnM83KMCChU1gai4J74jBJ7rTB7K7DgFYTx5dW2V8",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
            "$wgeeTrv5eAlJzKO7v9dQgjdH0JxwuOKuAqbp963QBtU",\n
            "$xqyTuo1dAXrxtV17f1pbMZw7HfU4mQknZNbjH7Wywhg",\n
        ],\n
        depth: 8,\n
        auth_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$xqyTuo1dAXrxtV17f1pbMZw7HfU4mQknZNbjH7Wywhg",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {"prev_content":{"displayname":"user-2 ⚡️","membership":"join"},"prev_sender":"@user-2:hs1"},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "O58ANJWtem3HjMzAF3sT/I+IBUGScqh31+5JrWIWZcg",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"bhQ2o9QQvL8Ko0sTACQXnL6zB2uoXzMugoHVbMpq20h1w4/zjt4usg5C0dm9RCWz5H89UZvTBvDN+KDifRCsDw"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.power_levels",\n
        "",\n
    ): PduEvent {\n
        event_id: "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
        event_sn: 8,\n
        event_ty: "m.room.power_levels",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085170),\n
        content: RawValue(\n
            {"ban":50,"events":{},"events_default":0,"invite":0,"kick":50,"notifications":{"room":50},"redact":50,"state_default":50,"users":{"@user-1:hs1":100},"users_default":0},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        depth: 3,\n
        auth_events: [\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "H/NuCQJG99VaN2HOJL5eIKY+yfghK6ovVUgeSgWVS8E",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"1fArb5dRcpu7fbLX2gW8JfTe/RhcwARpXdMX8k/W724MrAFZNK1KAoK0N3ysQcDjgIQQXdgEcDdq2c7sAM3gAA"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.guest_access",\n
        "",\n
    ): PduEvent {\n
        event_id: "$Ul4ATboCWQXvkhhyn7QNL1wQt-oYBsGY5Q16uXrLeCg",\n
        event_sn: 11,\n
        event_ty: "m.room.guest_access",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085347),\n
        content: RawValue(\n
            {"guest_access":"forbidden"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$eCYnM83KMCChU1gai4J74jBJ7rTB7K7DgFYTx5dW2V8",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
            "$wgeeTrv5eAlJzKO7v9dQgjdH0JxwuOKuAqbp963QBtU",\n
        ],\n
        depth: 6,\n
        auth_events: [\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "/QTHibnKIVNkNJ+CjFjMeTD4xlyCupmWn+mKIF1HIuU",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"4LwE9Rh09ugIu01WrukBsj/gUqemSDQF5NGF6VhRHh/AjSvUez0LCsXeN1X/dJLRPJAry6iKKNupBfhqTAmLCg"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.history_visibility",\n
        "",\n
    ): PduEvent {\n
        event_id: "$eCYnM83KMCChU1gai4J74jBJ7rTB7K7DgFYTx5dW2V8",\n
        event_sn: 10,\n
        event_ty: "m.room.history_visibility",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085295),\n
        content: RawValue(\n
            {"history_visibility":"shared"},\n
        ),\n
        state_key: Some(\n
            "",\n
        ),\n
        prev_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
            "$wgeeTrv5eAlJzKO7v9dQgjdH0JxwuOKuAqbp963QBtU",\n
        ],\n
        depth: 5,\n
        auth_events: [\n
            "$GN7C9m_PjxYZzjylryAy5dhzQbQPQt-6cJUXuJ20PgU",\n
            "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "2Cav4lsu32zJIUBBYyv4RyisIl5txUC/74KXr5qNtqo",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"Nmjdw/sOQMIEggimZTaYD9VvXFOftbWwYqY9vaX8Hi/3AW0EEmP5c2f10y6mDCMHBgdIkqBRmOVMdFitYQz8AA"}},\n
            ),\n
        ),\n
    },\n
    (\n
        "m.room.member",\n
        "@user-1:hs1",\n
    ): PduEvent {\n
        event_id: "$eL3LeZ2O47jmsUKhzeYtQTyy3_KTbJ1OgJAIZzV_Apw",\n
        event_sn: 6,\n
        event_ty: "m.room.member",\n
        room_id: "!28V5XLtwC5vBzUAGTR:hs1",\n
        sender: "@user-1:hs1",\n
        origin_server_ts: UnixMillis(1740267085110),\n
        content: RawValue(\n
            {"displayname":"user-1 ⚡️","is_direct":false,"membership":"join"},\n
        ),\n
        state_key: Some(\n
            "@user-1:hs1",\n
        ),\n
        prev_events: [\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        depth: 2,\n
        auth_events: [\n
            "$sHyA0dQjb3Sldnb_fukd8v49aFszGYbZsYyWxNtdhq4",\n
        ],\n
        redacts: None,\n
        unsigned: Some(\n
            RawValue(\n
                {},\n
            ),\n
        ),\n
        hashes: EventHash {\n
            sha256: "jLKoimoBcJekLhQuYeHKcy+JZBFd0t9pVHAdVNt7Kp0",\n
        },\n
        signatures: Some(\n
            RawValue(\n
                {"hs1":{"ed25519:YCQabH0K":"2DCJuudDT7/mZpquw1Q1SkjRIgrH31LXsJvsWO9ylKLst/bRqQf1tg2rw2z5JcMvFFouEW5XcEFVF4JMXMFWBQ"}},\n
            ),\n
        ),\n
    },\n
}\n
2025/02/23 07:31:27 ============== fedf37541c6b370f1af8cc139f40a597b27aa87f60d2f188692c54acacf4bd76 : END LOGS ==============\n
\n
\n
--- PASS: TestGetFilteredRoomMembers (19.40s)\n
null
null
=== RUN   TestSendAndFetchMessage\n
    room_messages_test.go:23: WARNING: TestSendAndFetchMessage called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.047931675s)\n
    federation_to_device_test.go:104: {"next_batch":"101"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.022919914s)\n
    federation_to_device_test.go:104: {"next_batch":"102"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.025798628s)\n
    federation_to_device_test.go:104: {"next_batch":"103"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.018562746s)\n
    federation_to_device_test.go:104: {"next_batch":"104"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.020643394s)\n
    federation_to_device_test.go:104: {"next_batch":"105"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.028905827s)\n
    federation_to_device_test.go:104: {"next_batch":"106"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.017561539s)\n
    federation_to_device_test.go:104: {"next_batch":"107"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.022441852s)\n
    federation_to_device_test.go:104: {"next_batch":"108"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.038489522s)\n
    federation_to_device_test.go:104: {"next_batch":"109"}\n
    room_messages_test.go:24: Deploy times: 10.580605ms blueprints, 13.149860796s containers\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.02119714s)\n
    federation_to_device_test.go:104: {"next_batch":"110"}\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (639.472451ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.013461368s)\n
    federation_to_device_test.go:104: {"next_batch":"111"}\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (522.156233ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (118.445889ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!YnLlZP8dpE4rpS1zok:hs1/send/m.room.message => 200 OK (174.348061ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (82.053822ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!YnLlZP8dpE4rpS1zok:hs1/messages => 200 OK (16.813315ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.043455857s)\n
    federation_to_device_test.go:104: {"next_batch":"112"}\n
2025/02/23 07:31:43 ============================================\n
\n
\n
2025/02/23 07:31:43 72de8af74627eacad987542d4694426ba624ff0ea14d734b174dd94c73c32855 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=72de8af74627\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 72de8af74627 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267097.6264167,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267097.6331947,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267097.6332247,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:31:43 ============== 72de8af74627eacad987542d4694426ba624ff0ea14d734b174dd94c73c32855 : END LOGS ==============\n
\n
\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.048253949s)\n
    federation_to_device_test.go:104: {"next_batch":"113"}\n
--- PASS: TestSendAndFetchMessage (16.31s)\n
null
null
=== RUN   TestFetchMessagesFromNonExistentRoom\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.046218208s)\n
    federation_to_device_test.go:104: {"next_batch":"114"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.032586142s)\n
    federation_to_device_test.go:104: {"next_batch":"115"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.03237289s)\n
    federation_to_device_test.go:104: {"next_batch":"116"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.029778897s)\n
    federation_to_device_test.go:104: {"next_batch":"117"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.027480271s)\n
    federation_to_device_test.go:104: {"next_batch":"118"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.04835968s)\n
    federation_to_device_test.go:104: {"next_batch":"119"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.018845885s)\n
    federation_to_device_test.go:104: {"next_batch":"120"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.033783901s)\n
    federation_to_device_test.go:104: {"next_batch":"121"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.036622195s)\n
    federation_to_device_test.go:104: {"next_batch":"122"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.022419021s)\n
    federation_to_device_test.go:104: {"next_batch":"123"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.051105594s)\n
    federation_to_device_test.go:104: {"next_batch":"124"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.023758021s)\n
    federation_to_device_test.go:104: {"next_batch":"125"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.036741399s)\n
    federation_to_device_test.go:104: {"next_batch":"126"}\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.024954185s)\n
    federation_to_device_test.go:104: {"next_batch":"127"}\n
    room_messages_test.go:67: Deploy times: 11.90462ms blueprints, 15.103694985s containers\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.040854153s)\n
    federation_to_device_test.go:104: {"next_batch":"128"}\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (740.212068ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!does-not-exist:hs1/messages => 403 Forbidden (10.378002ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.027059251s)\n
    federation_to_device_test.go:104: {"next_batch":"129"}\n
2025/02/23 07:32:01 ============================================\n
\n
\n
2025/02/23 07:32:01 501e5605d6f0ba7ca31a091548eb1d667aa30eab09980a84a21676b60d63f7cd : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=501e5605d6f0\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 501e5605d6f0 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267115.8729653,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267115.8849616,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267115.8849943,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:32:01 ============== 501e5605d6f0ba7ca31a091548eb1d667aa30eab09980a84a21676b60d63f7cd : END LOGS ==============\n
\n
\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.032587307s)\n
    federation_to_device_test.go:104: {"next_batch":"130"}\n
    federation_to_device_test.go:103: \u001b[31m@user-6-bob:hs2 MustSyncUntil: timed out after 30.944972448s. Seen 30 /sync responses. Checkers:\n
        [t=1.048145165s] Response #1: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=2.071228273s] Response #2: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=3.09717306s] Response #3: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=4.117298817s] Response #4: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=5.138097664s] Response #5: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=6.167157321s] Response #6: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=7.18507196s] Response #7: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=8.207689706s] Response #8: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=9.246536064s] Response #9: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=10.267917329s] Response #10: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=11.281523804s] Response #11: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=12.326099728s] Response #12: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=13.374505975s] Response #13: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=14.421468718s] Response #14: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=15.454218055s] Response #15: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=16.486745358s] Response #16: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=17.516682271s] Response #17: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=18.545046727s] Response #18: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=19.593566118s] Response #19: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=20.612564422s] Response #20: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=21.646500159s] Response #21: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=22.683265598s] Response #22: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=23.705855405s] Response #23: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=24.757570731s] Response #24: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=25.781608603s] Response #25: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=26.818494067s] Response #26: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=27.843602544s] Response #27: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=28.884980812s] Response #28: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=29.912193933s] Response #29: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist\n
        [t=30.944969914s] Response #30: SyncToDeviceHas(@user-5-alice:hs1): Key to_device.events does not exist, \n
        \u001b[39m\n
--- FAIL: TestToDeviceMessagesOverFederation/stopped_server (107.64s)\n
null
--- PASS: TestFetchMessagesFromNonExistentRoom (17.75s)\n
null
null
=== RUN   TestSendMessageWithTxn\n
2025/02/23 07:32:03 ============================================\n
\n
\n
2025/02/23 07:32:03 04142bfd77f53dacdfcb840d514e1bdec4565056dafd8181faa9dff0ea0dc836 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=04142bfd77f5\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 04142bfd77f5 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266909.0799918,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266909.0847518,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266909.0847847,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
  \u001b[2m2025-02-22T23:29:36.524992Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mCould not send request to hs2 at https://hs2:8448/_matrix/federation/v1/send/RUo6hhW61HneRiTsrjAGvb07Iz-PAfKKFyt7tgWZ07M: error sending request for url (https://hs2:8448/_matrix/federation/v1/send/RUo6hhW61HneRiTsrjAGvb07Iz-PAfKKFyt7tgWZ07M)\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:96\n
\n
  \u001b[2m2025-02-22T23:30:45.628371Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mCould not send request to hs2 at https://hs2:8448/_matrix/federation/v1/send/78OXjtsdf-SvcNUgLObvRPyGC-erAZsC8GgzvdSMU6M: error sending request for url (https://hs2:8448/_matrix/federation/v1/send/78OXjtsdf-SvcNUgLObvRPyGC-erAZsC8GgzvdSMU6M)\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:96\n
\n
SERVER_NAME=hs1\n
HOSTNAME=04142bfd77f5\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 04142bfd77f5 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267080.589334,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267080.597691,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267080.5977235,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
  \u001b[2m2025-02-22T23:31:20.848579Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mCould not send request to hs2 at https://hs2:8448/_matrix/federation/v1/send/RUo6hhW61HneRiTsrjAGvb07Iz-PAfKKFyt7tgWZ07M: error sending request for url (https://hs2:8448/_matrix/federation/v1/send/RUo6hhW61HneRiTsrjAGvb07Iz-PAfKKFyt7tgWZ07M)\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:96\n
\n
2025/02/23 07:32:03 ============== 04142bfd77f53dacdfcb840d514e1bdec4565056dafd8181faa9dff0ea0dc836 : END LOGS ==============\n
\n
\n
2025/02/23 07:32:05 ============================================\n
\n
\n
2025/02/23 07:32:05 ebfdfa2c355bccc298ad70dfc7365830c777229d034906a67bd4f876bca211cd : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=ebfdfa2c355b\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux ebfdfa2c355b 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266908.9865234,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266908.9913883,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266908.9914184,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
SERVER_NAME=hs2\n
HOSTNAME=ebfdfa2c355b\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux ebfdfa2c355b 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740266980.844889,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740266980.8518753,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740266980.852042,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
SERVER_NAME=hs2\n
HOSTNAME=ebfdfa2c355b\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux ebfdfa2c355b 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267087.2554483,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267087.2641332,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267087.2641664,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:32:05 ============== ebfdfa2c355bccc298ad70dfc7365830c777229d034906a67bd4f876bca211cd : END LOGS ==============\n
\n
\n
--- FAIL: TestToDeviceMessagesOverFederation (229.54s)\n
null
null
=== RUN   TestUnrejectRejectedEvents\n
    room_messages_test.go:85: Deploy times: 23.653697ms blueprints, 20.082618199s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (669.745832ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (404.256378ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!jiTixjTnrwDz3A3tUd:hs1/send/m.room.message/lorem => 200 OK (59.185015ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!jiTixjTnrwDz3A3tUd:hs1/send/m.room.message/lorem => 200 OK (4.253023ms)\n
    federation_unreject_rejected_test.go:21: Deploy times: 10.90974ms blueprints, 18.138532622s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (664.27242ms)\n
2025/02/23 07:32:24 ============================================\n
\n
\n
2025/02/23 07:32:24 259bf18259266be7a8694f59d2ea6585880ba1773040648a52b2dbec77aa3a8e : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=259bf1825926\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 259bf1825926 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267138.4209337,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267138.4277272,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267138.4277732,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:32:24 ============== 259bf18259266be7a8694f59d2ea6585880ba1773040648a52b2dbec77aa3a8e : END LOGS ==============\n
\n
\n
--- PASS: TestSendMessageWithTxn (22.77s)\n
null
null
=== RUN   TestRoomMessagesLazyLoading\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/capabilities => 200 OK (11.626964ms)\n
    server.go:185: Creating room !0-oLFMBWu26JNM8zH856:host.docker.internal:33347 with version 10\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!0-oLFMBWu26JNM8zH856:host.docker.internal:33347 => 400 Bad Request (198.847735ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:33063/_matrix/client/v3/join/%210-oLFMBWu26JNM8zH856:host.docker.internal:33347?server_name=host.docker.internal%3A33347 returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Answer from host.docker.internal:33347: complement: HandleMakeSendJoinRequests send_join cannot parse event JSON: eventauth: invalid ID: \\"\\""}\u001b[39m\n
2025/02/23 07:32:32 ============================================\n
\n
\n
2025/02/23 07:32:32 9fc28e385b36fb6fada51a349a37acc801135787219d46509d1aede0bf62475f : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=9fc28e385b36\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 9fc28e385b36 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267140.2665148,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267140.2753854,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267140.2754092,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "host.docker.internal:33347"  servername:"hs1"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://host.docker.internal:33347/_matrix/federation/v1/make_join/!0-oLFMBWu26JNM8zH856:host.docker.internal:33347/@user-1:hs1?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"content-type": "application/json", "date": "Sat, 22 Feb 2025 23:32:30 GMT", "content-length": "426"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"sender":"@user-1:hs1","room_id":"!0-oLFMBWu26JNM8zH856:host.docker.internal:33347","type":"m.room.member","state_key":"@user-1:hs1","prev_events":["$nDrLDI_yU7X1b7WyCmIYcsoL7IsXLwscrbij9XKlhew"],"auth_events":["$4t2L4nKa8qqC_bZ2hHQQ7v5ibiELwSd7Nk_Becd4tqU","$nDrLDI_yU7X1b7WyCmIYcsoL7IsXLwscrbij9XKlhew","$quunTEjWV9gy1vgUdytsTMfvZNvGOs0MrSYs2-70p78"],"depth":5,"content":{"membership":"join"}}) })\n
  \u001b[2m2025-02-22T23:32:30.627810Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://host.docker.internal:33347/_matrix/federation/v2/send_join/!0-oLFMBWu26JNM8zH856:host.docker.internal:33347/$upaIGFXbPKoIjhftZ05FIGoWmkhisCDl32Ur2nTMQcY?omit_members=false 500 Internal Server Error: complement: HandleMakeSendJoinRequests send_join cannot parse event JSON: eventauth: invalid ID: ""\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
2025/02/23 07:32:32 ============== 9fc28e385b36fb6fada51a349a37acc801135787219d46509d1aede0bf62475f : END LOGS ==============\n
\n
\n
--- FAIL: TestUnrejectRejectedEvents (27.25s)\n
null
null
=== RUN   TestFederationKeyUploadQuery\n
    room_messages_test.go:112: Deploy times: 44.15437ms blueprints, 18.642888952s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (664.465489ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (652.776193ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (672.322355ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (571.723087ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!I2BF9s1JWhjzaQ8xIF:hs1 => 200 OK (122.707833ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!I2BF9s1JWhjzaQ8xIF:hs1 => 200 OK (161.557133ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!I2BF9s1JWhjzaQ8xIF:hs1/send/m.room.message/1 => 200 OK (107.485721ms)\n
    room_messages_test.go:123: SendEventSynced waiting for event ID $9DLhttDhe6j0gxduhA9ZoPiSe0ZW5LBoGwCeBpLufgI\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (216.310016ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (202.311377ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!I2BF9s1JWhjzaQ8xIF:hs1/send/m.room.message/1 => 200 OK (179.733312ms)\n
    room_messages_test.go:133: SendEventSynced waiting for event ID $QbHTZ6c-wmM0eQWYKOfnJBvTrMgDe21GRF0N7LniA4A\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (189.403135ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (121.340183ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!I2BF9s1JWhjzaQ8xIF:hs1/messages => 200 OK (14.92044ms)\n
2025/02/23 07:32:48 ============================================\n
\n
\n
2025/02/23 07:32:48 7804077e83b918f93769bd0e53c8b4ebf929780a2e58bdddc24ca6361239d600 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=7804077e83b9\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 7804077e83b9 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267159.5206597,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267159.5253682,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267159.525394,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:32:48 ============== 7804077e83b918f93769bd0e53c8b4ebf929780a2e58bdddc24ca6361239d600 : END LOGS ==============\n
\n
\n
--- PASS: TestRoomMessagesLazyLoading (24.35s)\n
null
null
=== RUN   TestRoomMessagesLazyLoadingLocalUser\n
    federation_upload_keys_test.go:19: Deploy times: 13.627963ms blueprints, 23.49484101s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (587.314135ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (674.705973ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (386.96747ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!l5MbupaAU5We52dofm:hs1 => 200 OK (938.749458ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (36.196915ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.03403106s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.042010342s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.069159737s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.174917971s)\n
    room_messages_test.go:182: Deploy times: 14.890827ms blueprints, 14.715492744s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (595.987177ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.087661547s)\n
    federation_upload_keys_test.go:32: \u001b[31m@user-2:hs2 MustSyncUntil: timed out after 5.445953604s. Seen 6 /sync responses. Checkers:\n
        [t=36.497227ms] Response #1: SyncJoinedTo(!l5MbupaAU5We52dofm:hs1): Key rooms.join.!l5MbupaAU5We52dofm:hs1.timeline.events does not exist & Key rooms.join.!l5MbupaAU5We52dofm:hs1.state.events does not exist\n
        [t=1.070668589s] Response #2: SyncJoinedTo(!l5MbupaAU5We52dofm:hs1): Key rooms.join.!l5MbupaAU5We52dofm:hs1.timeline.events does not exist & Key rooms.join.!l5MbupaAU5We52dofm:hs1.state.events does not exist\n
        [t=2.113705558s] Response #3: SyncJoinedTo(!l5MbupaAU5We52dofm:hs1): Key rooms.join.!l5MbupaAU5We52dofm:hs1.timeline.events does not exist & Key rooms.join.!l5MbupaAU5We52dofm:hs1.state.events does not exist\n
        [t=3.183040027s] Response #4: SyncJoinedTo(!l5MbupaAU5We52dofm:hs1): Key rooms.join.!l5MbupaAU5We52dofm:hs1.timeline.events does not exist & Key rooms.join.!l5MbupaAU5We52dofm:hs1.state.events does not exist\n
        [t=4.358141543s] Response #5: SyncJoinedTo(!l5MbupaAU5We52dofm:hs1): Key rooms.join.!l5MbupaAU5We52dofm:hs1.timeline.events does not exist & Key rooms.join.!l5MbupaAU5We52dofm:hs1.state.events does not exist\n
        [t=5.445951801s] Response #6: SyncJoinedTo(!l5MbupaAU5We52dofm:hs1): Key rooms.join.!l5MbupaAU5We52dofm:hs1.timeline.events does not exist & Key rooms.join.!l5MbupaAU5We52dofm:hs1.state.events does not exist, \n
        \u001b[39m\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (455.543944ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (131.13243ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!SfWSUjzstzb6NdKGrl:hs1/send/m.room.message/1 => 200 OK (76.665794ms)\n
    room_messages_test.go:191: SendEventSynced waiting for event ID $tDbi_hhyksoWnyEKk2e4O7qDGDcLJPyPVPcYx_gbX6Q\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (143.161827ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!SfWSUjzstzb6NdKGrl:hs1/messages => 200 OK (77.168748ms)\n
2025/02/23 07:33:05 ============================================\n
\n
\n
2025/02/23 07:33:05 12cfadbd3853d532c02082313a2f35f2febad5ae5a56b86a3c4ff9f629c8550a : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=12cfadbd3853\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 12cfadbd3853 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267172.7553215,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267172.7622082,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267172.7622404,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs1:8448/_matrix/federation/v1/make_join/!l5MbupaAU5We52dofm:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "895", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:32:57 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$GpFvOkD2_JmgLpy8CCIf0Oku2NrRY-g5iyZ8h5CZCgo","$cUn6ih4AUwOTPoiqTWlJgajQpO1vELHkdPCwnChuaAY","$gxB4MKr2-_Z2EdXs5zuseUzzYTzRgaKOJFNKgj0xvJY"],"content":{"membership":"join"},"depth":7,"event_sn":10,"hashes":{"sha256":"NubejBc9Y5907JM+2/6sWEUCkxBoivYQ+rHpJsPdm6A"},"origin":"hs1","origin_server_ts":1740267178092,"prev_events":["$GpFvOkD2_JmgLpy8CCIf0Oku2NrRY-g5iyZ8h5CZCgo","$K43dOywqTDA8SeJ85FbqTnmx0W5EGCUuZf5UMftdWFA","$YHXUoCvJ3-0Xz1iGR5UbS2k1jPqlNm0acYtu0x8YL34","$b_kCywdJQoXaCo8SZPTF1BivwpPuBl5kWzikj-Qt45s","$cUn6ih4AUwOTPoiqTWlJgajQpO1vELHkdPCwnChuaAY","$gxB4MKr2-_Z2EdXs5zuseUzzYTzRgaKOJFNKgj0xvJY"],"room_id":"!l5MbupaAU5We52dofm:hs1","sender":"@user-2:hs2","signatures":{"hs1":{"ed25519:9fvtT5Nj":"S9w1EU/szsMfjY8/DkkwxmDJzIvXsJT1HXP/sXaRggnI66CaFshiq8vP/g2TpENNy2PqTcvWsXBZupVhDUOGCg"}},"state_key":"@user-2:hs2","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:32:58.540645Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
2025/02/23 07:33:05 ============== 12cfadbd3853d532c02082313a2f35f2febad5ae5a56b86a3c4ff9f629c8550a : END LOGS ==============\n
\n
\n
2025/02/23 07:33:06 ============================================\n
\n
\n
2025/02/23 07:33:06 ed4240dd5af9723892019699419437f06f7d76eb06f3dd73a7433e26c8c9dd8b : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=ed4240dd5af9\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux ed4240dd5af9 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267180.0417724,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267180.0462973,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267180.046322,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:33:06 ============== ed4240dd5af9723892019699419437f06f7d76eb06f3dd73a7433e26c8c9dd8b : END LOGS ==============\n
\n
\n
--- PASS: TestRoomMessagesLazyLoadingLocalUser (17.70s)\n
null
null
=== RUN   TestAvatarUrlUpdate\n
2025/02/23 07:33:07 ============================================\n
\n
\n
2025/02/23 07:33:07 f92f19519f9b0281f66c1083c8e676d6be73555299f53eacffa8ab781858e2dd : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=f92f19519f9b\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux f92f19519f9b 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267172.7929566,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267172.8014977,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267172.8015344,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:33:07 ============== f92f19519f9b0281f66c1083c8e676d6be73555299f53eacffa8ab781858e2dd : END LOGS ==============\n
\n
\n
--- FAIL: TestFederationKeyUploadQuery (34.64s)\n
null
null
=== RUN   TestKnockingInMSC3787Room\n
    room_profile_test.go:23: Deploy times: 11.2831ms blueprints, 19.968745655s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (684.480847ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (292.131664ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (53.862831ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/profile/@user-1:hs1/avatar_url => 200 OK (51.787831ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (38.806748ms)\n
    knocking_test.go:42: Deploy times: 12.027825ms blueprints, 20.416406523s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (585.989314ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (629.193092ms)\n
2025/02/23 07:33:29 ============================================\n
\n
\n
2025/02/23 07:33:29 7429da3dfd114d81ece8d0e15f6d85f0b008ff7797cbb0be788fb8b41d94837a : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=7429da3dfd11\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 7429da3dfd11 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267203.274533,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267203.278919,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267203.2789395,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:33:29 ============== 7429da3dfd114d81ece8d0e15f6d85f0b008ff7797cbb0be788fb8b41d94837a : END LOGS ==============\n
\n
\n
--- PASS: TestAvatarUrlUpdate (22.56s)\n
null
null
=== RUN   TestDisplayNameUpdate\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (690.809574ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (470.817163ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!DrL4B6LdUgvCuARHlk:hs1/invite => 200 OK (2.74420494s)\n
2025/02/23 07:33:34 complement: Transaction 'whG_mdapbhhWITedNEEZ0CjWBZIxk1jjvEXf7-LNT_0': Failed to find local room: !DrL4B6LdUgvCuARHlk:hs1\n
    knocking_test.go:75: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 51 51 50 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!DrL4B6LdUgvCuARHlk:hs1/$hgKND8NMfW1n3fcPDE9G2IA2Etum-ChQasv_hrVIVbs") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1332\u001b[39m\n
2025/02/23 07:33:36 ============================================\n
\n
\n
2025/02/23 07:33:36 910774c4ab6ed14b88596d7f56b8c57267b445a9b386da294ddcccd858997333 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=910774c4ab6e\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 910774c4ab6e 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267204.3335056,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267204.338057,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267204.3380814,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:33:36 ============== 910774c4ab6ed14b88596d7f56b8c57267b445a9b386da294ddcccd858997333 : END LOGS ==============\n
\n
\n
2025/02/23 07:33:37 ============================================\n
\n
\n
2025/02/23 07:33:37 8872e237f76d3d12cc8cf551fbadcbd051abdfccc1ed0a7a68a0dee75dbc5842 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=8872e237f76d\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 8872e237f76d 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267204.407064,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267204.416168,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267204.4161932,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:33:37 ============== 8872e237f76d3d12cc8cf551fbadcbd051abdfccc1ed0a7a68a0dee75dbc5842 : END LOGS ==============\n
\n
\n
--- FAIL: TestKnockingInMSC3787Room (30.64s)\n
null
null
=== RUN   TestKnockRoomsInPublicRoomsDirectoryInMSC3787Room\n
    room_profile_test.go:23: Deploy times: 9.557904ms blueprints, 16.130112254s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (654.619745ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (554.715182ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (194.042545ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/profile/@user-1:hs1/displayname => 200 OK (139.040255ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (122.786155ms)\n
2025/02/23 07:33:48 ============================================\n
\n
\n
2025/02/23 07:33:48 70c9d0969967f789f54475390e8c2a59bd5829002bcd4a138b463c17c1d34cf4 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=70c9d0969967\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 70c9d0969967 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267221.942159,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267221.947448,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267221.9474955,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:33:48 ============== 70c9d0969967f789f54475390e8c2a59bd5829002bcd4a138b463c17c1d34cf4 : END LOGS ==============\n
\n
\n
--- PASS: TestDisplayNameUpdate (19.37s)\n
null
null
=== RUN   TestRelations\n
    knocking_test.go:361: Deploy times: 11.894225ms blueprints, 15.210421661s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (607.136997ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (599.091991ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!zeHNStkQGorg2jKfBR:hs1/state/m.room.join_rules/ => 200 OK (70.452605ms)\n
    knocking_test.go:375: SendEventSynced waiting for event ID $8qap4eBBl-7Hm7KXYe0gDEnMKD4NYZP9xctyaf33oWg\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (122.290774ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/list/room/!zeHNStkQGorg2jKfBR:hs1 => 200 OK (9.398094ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/publicRooms => 200 OK (24.601038ms)\n
    knocking_test.go:437: Room was not present in public room directory response\n
    knocking_test.go:411: CSAPI.Do RetryUntil: GET http://127.0.0.1:33081/_matrix/client/v3/publicRooms response condition not yet met, retrying\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/publicRooms => 200 OK (35.079063ms)\n
    knocking_test.go:437: Room was not present in public room directory response\n
    knocking_test.go:411: CSAPI.Do RetryUntil: GET http://127.0.0.1:33081/_matrix/client/v3/publicRooms response condition not yet met, retrying\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/publicRooms => 200 OK (38.708972ms)\n
    knocking_test.go:437: Room was not present in public room directory response\n
    knocking_test.go:411: CSAPI.Do RetryUntil: GET http://127.0.0.1:33081/_matrix/client/v3/publicRooms response condition not yet met, retrying\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/publicRooms => 200 OK (69.402862ms)\n
    knocking_test.go:437: Room was not present in public room directory response\n
    knocking_test.go:411: CSAPI.Do RetryUntil: GET http://127.0.0.1:33081/_matrix/client/v3/publicRooms response condition not yet met, retrying\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/publicRooms => 200 OK (46.12113ms)\n
    knocking_test.go:437: Room was not present in public room directory response\n
    knocking_test.go:411: CSAPI.Do RetryUntil: GET http://127.0.0.1:33081/_matrix/client/v3/publicRooms response condition not yet met, retrying\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/publicRooms => 200 OK (46.417334ms)\n
    knocking_test.go:437: Room was not present in public room directory response\n
    knocking_test.go:411: CSAPI.Do RetryUntil: GET http://127.0.0.1:33081/_matrix/client/v3/publicRooms response condition not yet met, retrying\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/publicRooms => 200 OK (59.002655ms)\n
    knocking_test.go:437: Room was not present in public room directory response\n
    knocking_test.go:411: CSAPI.Do RetryUntil: GET http://127.0.0.1:33081/_matrix/client/v3/publicRooms response condition not yet met, retrying\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/publicRooms => 200 OK (48.977391ms)\n
    knocking_test.go:437: Room was not present in public room directory response\n
    knocking_test.go:411: \u001b[31mCSAPI.Do RetryUntil: GET http://127.0.0.1:33081/_matrix/client/v3/publicRooms timed out after 1s\u001b[39m\n
2025/02/23 07:33:57 ============================================\n
\n
\n
2025/02/23 07:33:57 a04e1c3300e42a648e91bcfd95de81604ee2438fd26db20dd0dec302b913108b : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=a04e1c3300e4\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux a04e1c3300e4 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267229.7998252,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267229.8069618,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267229.8073034,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
  \u001b[2m2025-02-22T23:33:54.576644Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::directory\u001b[0m\u001b[31m: \u001b[31mInvalid room join rule event in database: missing field `allow` at line 1 column 32\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/directory.rs:128\n
\n
  \u001b[2m2025-02-22T23:33:54.713934Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::directory\u001b[0m\u001b[31m: \u001b[31mInvalid room join rule event in database: missing field `allow` at line 1 column 32\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/directory.rs:128\n
\n
  \u001b[2m2025-02-22T23:33:54.852705Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::directory\u001b[0m\u001b[31m: \u001b[31mInvalid room join rule event in database: missing field `allow` at line 1 column 32\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/directory.rs:128\n
\n
  \u001b[2m2025-02-22T23:33:55.022044Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::directory\u001b[0m\u001b[31m: \u001b[31mInvalid room join rule event in database: missing field `allow` at line 1 column 32\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/directory.rs:128\n
\n
  \u001b[2m2025-02-22T23:33:55.169499Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::directory\u001b[0m\u001b[31m: \u001b[31mInvalid room join rule event in database: missing field `allow` at line 1 column 32\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/directory.rs:128\n
\n
  \u001b[2m2025-02-22T23:33:55.317921Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::directory\u001b[0m\u001b[31m: \u001b[31mInvalid room join rule event in database: missing field `allow` at line 1 column 32\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/directory.rs:128\n
\n
  \u001b[2m2025-02-22T23:33:55.474387Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::directory\u001b[0m\u001b[31m: \u001b[31mInvalid room join rule event in database: missing field `allow` at line 1 column 32\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/directory.rs:128\n
\n
  \u001b[2m2025-02-22T23:33:55.640092Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::directory\u001b[0m\u001b[31m: \u001b[31mInvalid room join rule event in database: missing field `allow` at line 1 column 32\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/directory.rs:128\n
\n
2025/02/23 07:33:57 ============== a04e1c3300e42a648e91bcfd95de81604ee2438fd26db20dd0dec302b913108b : END LOGS ==============\n
\n
\n
--- FAIL: TestKnockRoomsInPublicRoomsDirectoryInMSC3787Room (19.37s)\n
null
null
=== RUN   TestCannotSendKnockViaSendKnockInMSC3787Room\n
    room_relations_test.go:21: Deploy times: 13.112091ms blueprints, 17.060062151s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (843.144924ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (668.732405ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (188.741864ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!eO2qrIIXzlRVu7nXqz:hs1/send/m.room.message/txn-1 => 200 OK (181.798999ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!eO2qrIIXzlRVu7nXqz:hs1/send/m.room.message/txn-2 => 200 OK (182.771326ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!eO2qrIIXzlRVu7nXqz:hs1/send/m.dummy/txn-3 => 200 OK (182.323034ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!eO2qrIIXzlRVu7nXqz:hs1/send/m.room.message/txn-4 => 200 OK (115.319938ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (234.516606ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!eO2qrIIXzlRVu7nXqz:hs1/relations/$zgZBFjdcsZFZI5cCDMnc3yauKprOpv6kp6fWpQYBRBg => 200 OK (58.58445ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!eO2qrIIXzlRVu7nXqz:hs1/relations/$zgZBFjdcsZFZI5cCDMnc3yauKprOpv6kp6fWpQYBRBg/m.thread => 200 OK (54.782461ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!eO2qrIIXzlRVu7nXqz:hs1/relations/$zgZBFjdcsZFZI5cCDMnc3yauKprOpv6kp6fWpQYBRBg/m.thread/m.room.message => 200 OK (31.769833ms)\n
2025/02/23 07:34:09 ============================================\n
\n
\n
2025/02/23 07:34:09 be624bdd2c78a85cff0a0bcd1c2aa710f7d08550c6ec7f6c3f2ed4aaea2dd914 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=be624bdd2c78\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux be624bdd2c78 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267241.854551,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267241.8599858,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267241.86001,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
vvvvvvvvvvvvvvvvvfilter_rel_type   None\n
get_relations            None\n
vvvvvvvvvvvvvvvvvfilter_rel_type   Some("m.thread")\n
get_relations            Some("m.thread")\n
vvvvvvvvvvvvvvvvvfilter_rel_type   Some("m.thread")\n
get_relations            Some("m.thread")\n
2025/02/23 07:34:09 ============== be624bdd2c78a85cff0a0bcd1c2aa710f7d08550c6ec7f6c3f2ed4aaea2dd914 : END LOGS ==============\n
\n
\n
--- PASS: TestRelations (21.57s)\n
null
null
=== RUN   TestRelationsPagination\n
    federation_room_join_test.go:395: Deploy times: 11.554636ms blueprints, 18.685455707s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (629.5643ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (562.582887ms)\n
    federation_room_join_test.go:409: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 49 52 52 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!O0hkJy1ICn4iS3ArTX:hs1/$Hx2a-x_DMDTGQJaXH3HDUgIHrPuLSQL7-AtEuW5Ok9c") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1144\u001b[39m\n
2025/02/23 07:34:21 ============================================\n
\n
\n
2025/02/23 07:34:21 1f62ff15d1dd4d5f32b573500c09b4529e0fe26a07647c5c85ebfbb1ec505f99 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=1f62ff15d1dd\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 1f62ff15d1dd 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267252.57701,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267252.5844412,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267252.5844681,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:34:21 ============== 1f62ff15d1dd4d5f32b573500c09b4529e0fe26a07647c5c85ebfbb1ec505f99 : END LOGS ==============\n
\n
\n
--- FAIL: TestCannotSendKnockViaSendKnockInMSC3787Room (23.95s)\n
null
null
=== RUN   TestRestrictedRoomsLocalJoinInMSC3787Room\n
    room_relations_test.go:116: Deploy times: 19.923808ms blueprints, 15.690393176s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (776.011792ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (657.096154ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (142.752392ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!rEQYsOu2K3IRXmL7Hp:hs1/send/m.room.message/txn-1 => 200 OK (122.770215ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!rEQYsOu2K3IRXmL7Hp:hs1/send/m.room.message/txn-2 => 200 OK (208.938936ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!rEQYsOu2K3IRXmL7Hp:hs1/send/m.room.message/txn-3 => 200 OK (104.949448ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!rEQYsOu2K3IRXmL7Hp:hs1/send/m.room.message/txn-4 => 200 OK (103.584192ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!rEQYsOu2K3IRXmL7Hp:hs1/send/m.room.message/txn-5 => 200 OK (131.15447ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!rEQYsOu2K3IRXmL7Hp:hs1/send/m.room.message/txn-6 => 200 OK (137.230716ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!rEQYsOu2K3IRXmL7Hp:hs1/send/m.room.message/txn-7 => 200 OK (144.100393ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!rEQYsOu2K3IRXmL7Hp:hs1/send/m.room.message/txn-8 => 200 OK (70.186699ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!rEQYsOu2K3IRXmL7Hp:hs1/send/m.room.message/txn-9 => 200 OK (124.698414ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!rEQYsOu2K3IRXmL7Hp:hs1/send/m.room.message/txn-10 => 200 OK (168.254832ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!rEQYsOu2K3IRXmL7Hp:hs1/send/m.room.message/txn-11 => 200 OK (145.938307ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (193.97513ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!rEQYsOu2K3IRXmL7Hp:hs1/relations/$ImFV7JaN7LkrcHZApOWe2Cg15X0NUPKGDsMipbRaPrM => 200 OK (24.615731ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!rEQYsOu2K3IRXmL7Hp:hs1/relations/$ImFV7JaN7LkrcHZApOWe2Cg15X0NUPKGDsMipbRaPrM => 200 OK (40.442721ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!rEQYsOu2K3IRXmL7Hp:hs1/relations/$ImFV7JaN7LkrcHZApOWe2Cg15X0NUPKGDsMipbRaPrM => 200 OK (38.099078ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!rEQYsOu2K3IRXmL7Hp:hs1/relations/$ImFV7JaN7LkrcHZApOWe2Cg15X0NUPKGDsMipbRaPrM => 200 OK (22.686881ms)\n
2025/02/23 07:34:30 ============================================\n
\n
\n
2025/02/23 07:34:30 364e080914461b1d274dc662444ec58f67dc5ebb2e232c399b11f71be7a4e8d4 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=364e08091446\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 364e08091446 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267262.4446826,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267262.4500484,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267262.4500859,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
vvvvvvvvvvvvvvvvvfilter_rel_type   None\n
get_relations            None\n
vvvvvvvvvvvvvvvvvfilter_rel_type   None\n
get_relations            None\n
vvvvvvvvvvvvvvvvvfilter_rel_type   None\n
get_relations            None\n
vvvvvvvvvvvvvvvvvfilter_rel_type   None\n
get_relations            None\n
2025/02/23 07:34:30 ============== 364e080914461b1d274dc662444ec58f67dc5ebb2e232c399b11f71be7a4e8d4 : END LOGS ==============\n
\n
\n
--- PASS: TestRelationsPagination (20.63s)\n
null
null
=== RUN   TestRelationsPaginationSync\n
    room_relations_test.go:213: WARNING: TestRelationsPaginationSync called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    knock_restricted_test.go:45: Deploy times: 12.043319ms blueprints, 17.12973255s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (694.894459ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (776.317937ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (554.699689ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (625.58826ms)\n
null
=== RUN   TestRestrictedRoomsLocalJoinInMSC3787Room/Join_should_fail_initially\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!6rKXNX0xAq91bYhiiv:hs1 => 403 Forbidden (65.317061ms)\n
--- PASS: TestRestrictedRoomsLocalJoinInMSC3787Room/Join_should_fail_initially (0.07s)\n
null
null
=== RUN   TestRestrictedRoomsLocalJoinInMSC3787Room/Join_should_succeed_when_joined_to_allowed_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!tnr2YLoLmm0s6W890k:hs1 => 200 OK (97.002739ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!tnr2YLoLmm0s6W890k:hs1/state/m.room.member/@user-2:hs1 => 200 OK (109.023394ms)\n
    restricted_rooms_test.go:74: SendEventSynced waiting for event ID $SqeORW0N_A6Qd1blVVkFgVebr_mpilL5DFl4bATfw94\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (225.559295ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!6rKXNX0xAq91bYhiiv:hs1 => 200 OK (293.796893ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!6rKXNX0xAq91bYhiiv:hs1/state/m.room.member/@user-2:hs1 => 200 OK (105.19095ms)\n
    restricted_rooms_test.go:92: SendEventSynced waiting for event ID $2u8XfgI4FKxud9IooWQxODfAizqZ3khdPeiXYo-2Nww\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (310.630463ms)\n
--- PASS: TestRestrictedRoomsLocalJoinInMSC3787Room/Join_should_succeed_when_joined_to_allowed_room (1.14s)\n
null
null
=== RUN   TestRestrictedRoomsLocalJoinInMSC3787Room/Join_should_fail_when_left_allowed_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!6rKXNX0xAq91bYhiiv:hs1/leave => 400 Bad Request (7.64017ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:33089/_matrix/client/v3/rooms/%216rKXNX0xAq91bYhiiv:hs1/leave returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Invalid member event in database."}\u001b[39m\n
--- FAIL: TestRestrictedRoomsLocalJoinInMSC3787Room/Join_should_fail_when_left_allowed_room (0.01s)\n
null
null
=== RUN   TestRestrictedRoomsLocalJoinInMSC3787Room/Join_should_succeed_when_invited\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!6rKXNX0xAq91bYhiiv:hs1/invite => 403 Forbidden (56.197774ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:33089/_matrix/client/v3/rooms/%216rKXNX0xAq91bYhiiv:hs1/invite returned non-2xx code: 403 Forbidden - body: {"errcode":"M_FORBIDDEN","error":"Event is not authorized."}\u001b[39m\n
--- FAIL: TestRestrictedRoomsLocalJoinInMSC3787Room/Join_should_succeed_when_invited (0.06s)\n
null
null
=== RUN   TestRestrictedRoomsLocalJoinInMSC3787Room/Join_should_fail_with_mangled_join_rules\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!6rKXNX0xAq91bYhiiv:hs1/state/m.room.join_rules/ => 200 OK (76.205509ms)\n
    restricted_rooms_test.go:144: SendEventSynced waiting for event ID $2h5TrkO_Yt6UvVrSGUcDnCy1syRmLKLivncjkuKg1VU\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (126.812865ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!6rKXNX0xAq91bYhiiv:hs1 => 200 OK (3.490922ms)\n
    restricted_rooms_test.go:158: \u001b[31mMatchFailure got status 200 instead of a failure code\u001b[39m\n
--- FAIL: TestRestrictedRoomsLocalJoinInMSC3787Room/Join_should_fail_with_mangled_join_rules (0.21s)\n
null
2025/02/23 07:34:43 ============================================\n
\n
\n
2025/02/23 07:34:43 aff28c045be177f2705330ce0fb9a0549dc3ff241be6a5d89e88961176259b43 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=aff28c045be1\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux aff28c045be1 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267275.2364047,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267275.2433705,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267275.2433991,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
To many layers, we have to go deeper frame_id: 17\n
To many layers, we have to go deeper frame_id: 19\n
  \u001b[2m2025-02-22T23:34:42.305561Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mCan't invite user if sender not joined or the user is currently joined or banned, \u001b[1;33mtarget_user_membership_event_id\u001b[0m\u001b[33m: Some("$2u8XfgI4FKxud9IooWQxODfAizqZ3khdPeiXYo-2Nww"), \u001b[1;33msender_membership_event_id\u001b[0m\u001b[33m: Some("$7EeBm6hKNC-mJF0St-ocL5QmDf8noJBPyP73If1ETEI")\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:601\n
\n
To many layers, we have to go deeper frame_id: 20\n
2025/02/23 07:34:43 ============== aff28c045be177f2705330ce0fb9a0549dc3ff241be6a5d89e88961176259b43 : END LOGS ==============\n
\n
\n
--- FAIL: TestRestrictedRoomsLocalJoinInMSC3787Room (22.81s)\n
null
null
=== RUN   TestRestrictedRoomsRemoteJoinInMSC3787Room\n
    room_relations_test.go:215: Deploy times: 10.673425ms blueprints, 15.085647352s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (693.256918ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (642.295462ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (116.684596ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!hjhVq6tA0Rnl1qGFf0:hs1/send/m.room.message/1 => 200 OK (77.750084ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!hjhVq6tA0Rnl1qGFf0:hs1/send/m.room.message/2 => 200 OK (90.908946ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!hjhVq6tA0Rnl1qGFf0:hs1/send/m.room.message/3 => 200 OK (97.281627ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!hjhVq6tA0Rnl1qGFf0:hs1/send/m.room.message/4 => 200 OK (80.077272ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!hjhVq6tA0Rnl1qGFf0:hs1/send/m.room.message/5 => 200 OK (136.662768ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!hjhVq6tA0Rnl1qGFf0:hs1/send/m.room.message/6 => 200 OK (109.884926ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (164.797682ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!hjhVq6tA0Rnl1qGFf0:hs1/send/m.room.message/7 => 200 OK (91.77233ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!hjhVq6tA0Rnl1qGFf0:hs1/send/m.room.message/8 => 200 OK (91.619491ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!hjhVq6tA0Rnl1qGFf0:hs1/send/m.room.message/9 => 200 OK (99.61316ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!hjhVq6tA0Rnl1qGFf0:hs1/send/m.room.message/10 => 200 OK (92.174964ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!hjhVq6tA0Rnl1qGFf0:hs1/send/m.room.message/11 => 200 OK (87.056001ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (5.097689ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (135.042719ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!hjhVq6tA0Rnl1qGFf0:hs1/relations/$hvndZM6o5xTMyxJMShil3cPYnOPmb4kfxNtDljHfs2c => 200 OK (17.107699ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!hjhVq6tA0Rnl1qGFf0:hs1/relations/$hvndZM6o5xTMyxJMShil3cPYnOPmb4kfxNtDljHfs2c => 200 OK (18.871362ms)\n
2025/02/23 07:34:50 ============================================\n
\n
\n
2025/02/23 07:34:50 64c53bc1e889a172dbb37425bd4e6b047ac0b336d49320dc17457198687a6698 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=64c53bc1e889\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 64c53bc1e889 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267282.3513834,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267282.3558276,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267282.3558726,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
vvvvvvvvvvvvvvvvvfilter_rel_type   None\n
get_relations            None\n
vvvvvvvvvvvvvvvvvfilter_rel_type   None\n
get_relations            None\n
2025/02/23 07:34:50 ============== 64c53bc1e889a172dbb37425bd4e6b047ac0b336d49320dc17457198687a6698 : END LOGS ==============\n
\n
\n
--- PASS: TestRelationsPaginationSync (19.62s)\n
null
null
=== RUN   TestThreadsEndpoint\n
    room_threads_test.go:35: WARNING: TestThreadsEndpoint called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    knock_restricted_test.go:60: Deploy times: 12.154205ms blueprints, 22.463601603s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (782.026718ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (683.799853ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (822.087338ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (732.933052ms)\n
null
=== RUN   TestRestrictedRoomsRemoteJoinInMSC3787Room/Join_should_fail_initially\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!Ur6hnv1dNwZHeBSPNQ:hs1 => 400 Bad Request (520.196769ms)\n
--- PASS: TestRestrictedRoomsRemoteJoinInMSC3787Room/Join_should_fail_initially (0.52s)\n
null
null
=== RUN   TestRestrictedRoomsRemoteJoinInMSC3787Room/Join_should_succeed_when_joined_to_allowed_room\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!LoVsNfItLE3q4COVfu:hs1 => 200 OK (1.079253368s)\n
    client.go:706: [CSAPI] PUT hs2/_matrix/client/v3/rooms/!LoVsNfItLE3q4COVfu:hs1/state/m.room.member/@user-2:hs2 => 403 Forbidden (94.455102ms)\n
    restricted_rooms_test.go:74: \u001b[31mCSAPI.MustDo PUT http://127.0.0.1:33093/_matrix/client/v3/rooms/%21LoVsNfItLE3q4COVfu:hs1/state/m.room.member/@user-2:hs2 returned non-2xx code: 403 Forbidden - body: {"errcode":"M_FORBIDDEN","error":"Event is not authorized."}\u001b[39m\n
--- FAIL: TestRestrictedRoomsRemoteJoinInMSC3787Room/Join_should_succeed_when_joined_to_allowed_room (1.17s)\n
null
null
=== RUN   TestRestrictedRoomsRemoteJoinInMSC3787Room/Join_should_fail_when_left_allowed_room\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/rooms/!Ur6hnv1dNwZHeBSPNQ:hs1/leave => 200 OK (19.799984ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/rooms/!LoVsNfItLE3q4COVfu:hs1/leave => 200 OK (15.997707ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (310.821586ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.058944753s)\n
    room_threads_test.go:36: Deploy times: 11.027078ms blueprints, 23.170828715s containers\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.067939814s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (655.967863ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (424.940919ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (109.916173ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!j4UpOfkuFUYCmA26sa:hs1/send/m.room.message/txn-1 => 200 OK (122.081016ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.057442904s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!j4UpOfkuFUYCmA26sa:hs1/send/m.room.message/txn-2 => 200 OK (65.856421ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!j4UpOfkuFUYCmA26sa:hs1/send/m.room.message/txn-3 => 200 OK (113.351172ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!j4UpOfkuFUYCmA26sa:hs1/send/m.room.message/txn-4 => 200 OK (65.151564ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (97.459264ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!j4UpOfkuFUYCmA26sa:hs1/threads => 200 OK (17.816442ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!j4UpOfkuFUYCmA26sa:hs1/send/m.room.message/txn-5 => 200 OK (99.85763ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (4.37696ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (120.712304ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!j4UpOfkuFUYCmA26sa:hs1/threads => 200 OK (26.081249ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.028481418s)\n
2025/02/23 07:35:16 ============================================\n
\n
\n
2025/02/23 07:35:16 67689a7225cecbbd84342505cd63e2b1659efc475e0d5a37dcb0e83c8f4f56a3 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=67689a7225ce\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 67689a7225ce 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267309.9505532,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267309.9563866,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267309.956411,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:35:16 ============== 67689a7225cecbbd84342505cd63e2b1659efc475e0d5a37dcb0e83c8f4f56a3 : END LOGS ==============\n
\n
\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.059717594s)\n
    restricted_rooms_test.go:117: \u001b[31m@user-1:hs1 MustSyncUntil: timed out after 5.585604259s. Seen 6 /sync responses. Checkers:\n
        [t=311.714113ms] Response #1: SyncTimelineHas(!LoVsNfItLE3q4COVfu:hs1): check function did not pass while iterating over 7 elements: [{"content":{"creator":"@user-1:hs1","room_version":"10"},"event_id":"$lkd97UZelZxkdJYEw02mdrrcHhUXGS_04a_2kzP738w","origin_server_ts":1740267307366,"sender":"@user-1:hs1","state_key":"","type":"m.room.create","unsigned":{"age":1}},{"content":{"displayname":"user-1 ⚡️","is_direct":false,"membership":"join"},"event_id":"$t_LLU43ViSg9s9uVuiCGN3r260-OmTFFwSg9txOyOIA","origin_server_ts":1740267307451,"sender":"@user-1:hs1","state_key":"@user-1:hs1","type":"m.room.member","unsigned":{"age":1}},{"content":{"ban":50,"events":{},"events_default":0,"invite":0,"kick":50,"notifications":{"room":50},"redact":50,"state_default":50,"users":{"@user-1:hs1":100},"users_default":0},"event_id":"$dwieZOt8rYv9taxkEf9s6qosP78l2OUoUnOTkVaBxL4","origin_server_ts":1740267307577,"sender":"@user-1:hs1","state_key":"","type":"m.room.power_levels","unsigned":{"age":1}},{"content":{"join_rule":"p
ublic"},"event_id":"$TTR7uDFSMTlOdjPhRCo2L6Vu_dgbVpkFNhih_ZrGyGM","origin_server_ts":1740267307656,"sender":"@user-1:hs1","state_key":"","type":"m.room.join_rules","unsigned":{"age":1}},{"content":{"history_visibility":"shared"},"event_id":"$CxgZ-wn0aoo5EhETz0I3Uy4eyc14bftsXTsJ5KLqlww","origin_server_ts":1740267307730,"sender":"@user-1:hs1","state_key":"","type":"m.room.history_visibility","unsigned":{"age":1}},{"content":{"guest_access":"forbidden"},"event_id":"$kKwyZzDjjvJi3s8__Wtzq8JPpjn8iXRZCZUCCNNatbk","origin_server_ts":1740267307787,"sender":"@user-1:hs1","state_key":"","type":"m.room.guest_access","unsigned":{"age":1}},{"content":{"name":"Allowed Room"},"event_id":"$xab4FJaMx2BJZmKei4y5yNN3cd7MVW-OrPchMIvlzhM","origin_server_ts":1740267307918,"sender":"@user-1:hs1","state_key":"","type":"m.room.name","unsigned":{"age":1}}]\n
        [t=1.371258134s] Response #2: SyncTimelineHas(!LoVsNfItLE3q4COVfu:hs1): Key rooms.join.!LoVsNfItLE3q4COVfu:hs1.timeline.events does not exist\n
        [t=2.439450658s] Response #3: SyncTimelineHas(!LoVsNfItLE3q4COVfu:hs1): Key rooms.join.!LoVsNfItLE3q4COVfu:hs1.timeline.events does not exist\n
        [t=3.497078748s] Response #4: SyncTimelineHas(!LoVsNfItLE3q4COVfu:hs1): Key rooms.join.!LoVsNfItLE3q4COVfu:hs1.timeline.events does not exist\n
        [t=4.525744682s] Response #5: SyncTimelineHas(!LoVsNfItLE3q4COVfu:hs1): Key rooms.join.!LoVsNfItLE3q4COVfu:hs1.timeline.events does not exist\n
        [t=5.585601795s] Response #6: SyncTimelineHas(!LoVsNfItLE3q4COVfu:hs1): Key rooms.join.!LoVsNfItLE3q4COVfu:hs1.timeline.events does not exist, \n
        \u001b[39m\n
--- FAIL: TestRestrictedRoomsRemoteJoinInMSC3787Room/Join_should_fail_when_left_allowed_room (5.62s)\n
null
null
=== RUN   TestRestrictedRoomsRemoteJoinInMSC3787Room/Join_should_succeed_when_invited\n
--- PASS: TestThreadsEndpoint (26.60s)\n
null
null
=== RUN   TestTyping\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!Ur6hnv1dNwZHeBSPNQ:hs1/invite => 200 OK (4.25881309s)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!Ur6hnv1dNwZHeBSPNQ:hs1 => 403 Forbidden (42.660127ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/rooms/!Ur6hnv1dNwZHeBSPNQ:hs1/leave => 200 OK (5.401456374s)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!LoVsNfItLE3q4COVfu:hs1 => 403 Forbidden (106.531923ms)\n
--- PASS: TestRestrictedRoomsRemoteJoinInMSC3787Room/Join_should_succeed_when_invited (9.81s)\n
null
null
=== RUN   TestRestrictedRoomsRemoteJoinInMSC3787Room/Join_should_fail_with_mangled_join_rules\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!Ur6hnv1dNwZHeBSPNQ:hs1/state/m.room.join_rules/ => 200 OK (146.01014ms)\n
    restricted_rooms_test.go:144: SendEventSynced waiting for event ID $Fpi-hxfwQq8aHr3l_vmqyt0kXhpNvb81DU6-iHPVltk\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (296.957189ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!Ur6hnv1dNwZHeBSPNQ:hs1 => 403 Forbidden (21.877498ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!Ur6hnv1dNwZHeBSPNQ:hs1/state/m.room.join_rules/ => 200 OK (70.977556ms)\n
    restricted_rooms_test.go:160: SendEventSynced waiting for event ID $gT1UH3kKPKR7SdeZKaHMJwmf_k_xbDkDIeeoSheuI8Q\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (306.047843ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!Ur6hnv1dNwZHeBSPNQ:hs1 => 403 Forbidden (19.199435ms)\n
--- PASS: TestRestrictedRoomsRemoteJoinInMSC3787Room/Join_should_fail_with_mangled_join_rules (0.87s)\n
null
2025/02/23 07:35:28 ============================================\n
\n
\n
2025/02/23 07:35:28 f2fb3a9db40217095b52553a2f0ae2efb99e6051a92a141400f751cd840c6a41 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=f2fb3a9db402\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux f2fb3a9db402 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267302.0826259,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267302.099632,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267302.1093254,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
  \u001b[2m2025-02-22T23:35:10.021764Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_join/!Ur6hnv1dNwZHeBSPNQ:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5] 400 Bad Request: {"errcode":"M_UNABLE_TO_AUTHORISE_JOIN","error":"Palpo does not support restricted rooms yet."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_UNABLE_TO_AUTHORISE_JOIN\\",\\"error\\":\\"Palpo does not support restricted rooms yet.\\"}")}) }))\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
  \u001b[2m2025-02-22T23:35:10.067484Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_join/!Ur6hnv1dNwZHeBSPNQ:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5] 400 Bad Request: {"errcode":"M_UNABLE_TO_AUTHORISE_JOIN","error":"Palpo does not support restricted rooms yet."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_UNABLE_TO_AUTHORISE_JOIN\\",\\"error\\":\\"Palpo does not support restricted rooms yet.\\"}")}) }))\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs1:8448/_matrix/federation/v1/make_join/!LoVsNfItLE3q4COVfu:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "942", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:35:09 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$TTR7uDFSMTlOdjPhRCo2L6Vu_dgbVpkFNhih_ZrGyGM","$dwieZOt8rYv9taxkEf9s6qosP78l2OUoUnOTkVaBxL4","$lkd97UZelZxkdJYEw02mdrrcHhUXGS_04a_2kzP738w"],"content":{"membership":"join"},"depth":8,"event_sn":20,"hashes":{"sha256":"oECGzk1+uvssgP6coDfh9sklqYtSREfv3VQnFLaL0Rc"},"origin":"hs1","origin_server_ts":1740267310199,"prev_events":["$CxgZ-wn0aoo5EhETz0I3Uy4eyc14bftsXTsJ5KLqlww","$TTR7uDFSMTlOdjPhRCo2L6Vu_dgbVpkFNhih_ZrGyGM","$dwieZOt8rYv9taxkEf9s6qosP78l2OUoUnOTkVaBxL4","$kKwyZzDjjvJi3s8__Wtzq8JPpjn8iXRZCZUCCNNatbk","$lkd97UZelZxkdJYEw02mdrrcHhUXGS_04a_2kzP738w","$t_LLU43ViSg9s9uVuiCGN3r260-OmTFFwSg9txOyOIA","$xab4FJaMx2BJZmKei4y5yNN3cd7MVW-OrPchMIvlzhM"],"room_id":"!LoVsNfItLE3q4COVfu:hs1","sender":"@user-2:hs2","signatures":{"hs1":{"ed25519:oKf3NxMC":"UVvhEvSUqZFjuG4NKF0+LEwnyp/VMuqVT2cCYvty3TLtmJ0YvWRm8WiInQ3Lf5n7XEeAKT8Um4kh2FwD80x5BQ"}},"state_key":"@user-2:hs2","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:35:10.667207Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
  \u001b[2m2025-02-22T23:35:11.244229Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:35:11.260953Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::membership\u001b[0m\u001b[33m: \u001b[33mFailed to leave room @user-2:hs2 remotely: Matrix error: `[400 / M_BAD_STATE]`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/membership.rs:880\n
\n
  \u001b[2m2025-02-22T23:35:11.279449Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::membership\u001b[0m\u001b[33m: \u001b[33mFailed to leave room @user-2:hs2 remotely: Matrix error: `[400 / M_BAD_STATE]`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/membership.rs:880\n
\n
  \u001b[2m2025-02-22T23:35:21.168048Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:35:23.322779Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/event/$PDd6d1iQat3gB88jFLP-WnY9anMTZ3RgJ1nQe-nddK8 404 Not Found: {"errcode":"M_NOT_FOUND","error":"Resource not found."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
  \u001b[2m2025-02-22T23:35:23.324311Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::routing::federation::transaction\u001b[0m\u001b[33m: \u001b[33mIncoming PDU failed $5JywroIQVzQ0G30x8ONaEo8VQ2c1E3OG0rvy4sefn9s: Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_NOT_FOUND\\",\\"error\\":\\"Resource not found.\\"}")}) })\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/routing/federation/transaction.rs:85\n
\n
  \u001b[2m2025-02-22T23:35:26.675109Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:35:27.145339Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:35:27.543285Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
2025/02/23 07:35:28 ============== f2fb3a9db40217095b52553a2f0ae2efb99e6051a92a141400f751cd840c6a41 : END LOGS ==============\n
\n
\n
2025/02/23 07:35:30 ============================================\n
\n
\n
2025/02/23 07:35:30 b14e844cdf81b979e01deb61d4156bca49d0fcab76b9b7f61b8bf899db6a854e : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=b14e844cdf81\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux b14e844cdf81 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267302.6524632,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267302.6958592,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267302.6958933,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
To many layers, we have to go deeper frame_id: 17\n
To many layers, we have to go deeper frame_id: 18\n
  \u001b[2m2025-02-22T23:35:21.988817Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $PDd6d1iQat3gB88jFLP-WnY9anMTZ3RgJ1nQe-nddK8 failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
  \u001b[2m2025-02-22T23:35:23.307154Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::error\u001b[0m\u001b[31m: \u001b[31mdiesel db error., \u001b[1;31merror\u001b[0m\u001b[31m: NotFound\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/error.rs:120\n
\n
  \u001b[2m2025-02-22T23:35:23.326554Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::sending\u001b[0m\u001b[33m: \u001b[33mFailed to send to hs2: ("$5JywroIQVzQ0G30x8ONaEo8VQ2c1E3OG0rvy4sefn9s", Err("Matrix error: `[400 / M_UNKNOWN]`"))\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sending.rs:599\n
\n
  \u001b[2m2025-02-22T23:35:28.612655Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mCould not send request to hs2 at https://hs2:8448/_matrix/federation/v1/send/T0tO5cuSr-H3YxpvHg32A2jl4H9_ywtxlCSRozWlO8A: error sending request for url (https://hs2:8448/_matrix/federation/v1/send/T0tO5cuSr-H3YxpvHg32A2jl4H9_ywtxlCSRozWlO8A)\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:96\n
\n
2025/02/23 07:35:30 ============== b14e844cdf81b979e01deb61d4156bca49d0fcab76b9b7f61b8bf899db6a854e : END LOGS ==============\n
\n
\n
--- FAIL: TestRestrictedRoomsRemoteJoinInMSC3787Room (46.68s)\n
null
null
=== RUN   TestRestrictedRoomsRemoteJoinLocalUserInMSC3787Room\n
    restricted_rooms_test.go:215: WARNING: TestRestrictedRoomsRemoteJoinLocalUserInMSC3787Room called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    room_typing_test.go:13: Deploy times: 10.66892ms blueprints, 17.568807972s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (755.011862ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (783.890294ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (844.446503ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!biXXgJbDzBFUrDs8PB:hs1 => 200 OK (204.192711ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (235.052582ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!biXXgJbDzBFUrDs8PB:hs1/typing/@user-1:hs1 => 200 OK (16.001492ms)\n
null
=== RUN   TestTyping/Typing_notification_sent_to_local_room_members\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (50.371564ms)\n
--- PASS: TestTyping/Typing_notification_sent_to_local_room_members (0.05s)\n
null
null
=== RUN   TestTyping/Typing_can_be_explicitly_stopped\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!biXXgJbDzBFUrDs8PB:hs1/typing/@user-1:hs1 => 200 OK (13.486503ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (10.62215ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (34.28895ms)\n
--- PASS: TestTyping/Typing_can_be_explicitly_stopped (0.06s)\n
null
2025/02/23 07:35:38 ============================================\n
\n
\n
2025/02/23 07:35:38 96c7b294fbafd10f511571d2f7922fb9db73fed90735445957666d222131ee15 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=96c7b294fbaf\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 96c7b294fbaf 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267330.787605,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267330.7963443,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267330.796374,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:35:38 ============== 96c7b294fbafd10f511571d2f7922fb9db73fed90735445957666d222131ee15 : END LOGS ==============\n
\n
\n
--- PASS: TestTyping (22.22s)\n
null
null
=== RUN   TestLeakyTyping\n
    restricted_rooms_test.go:217: Deploy times: 22.006081ms blueprints, 26.474238264s containers\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (682.053685ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/createRoom => 200 OK (515.433515ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/createRoom => 200 OK (570.680667ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (618.307337ms)\n
    room_typing_test.go:40: Deploy times: 13.80484ms blueprints, 21.621047446s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (856.751625ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (912.513949ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (762.333086ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (797.216638ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!eRizIt9xolFuaxjVLE:hs1 => 200 OK (176.414622ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (191.529715ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (33.717363ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!eRizIt9xolFuaxjVLE:hs1/typing/@user-1:hs1 => 200 OK (13.698009ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (64.894871ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.030083658s)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/rooms/!gS10WlwBziu1frxHbf:hs2/invite => 200 OK (6.379424329s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!gS10WlwBziu1frxHbf:hs2 => 403 Forbidden (33.565928ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (727.38581ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!gS10WlwBziu1frxHbf:hs2/invite => 403 Forbidden (4.73065ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!gS10WlwBziu1frxHbf:hs2 => 403 Forbidden (11.744522ms)\n
2025/02/23 07:36:07 ============================================\n
\n
\n
2025/02/23 07:36:07 f403dd39125963dbbc6e8caba62b784e8414b1d805f34bcdeaf350223eda490d : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=f403dd391259\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux f403dd391259 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267357.3953693,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267357.4032626,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267357.4036722,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:36:07 ============== f403dd39125963dbbc6e8caba62b784e8414b1d805f34bcdeaf350223eda490d : END LOGS ==============\n
\n
\n
--- PASS: TestLeakyTyping (28.48s)\n
null
null
=== RUN   TestRoomsInvite\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!pflRgrDmS3MKGt217Y:hs2 => 200 OK (1.306594021s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!gS10WlwBziu1frxHbf:hs2 => 403 Forbidden (20.331692ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (412.672304ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.032464639s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.133178847s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.120548517s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.108574121s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.081105292s)\n
    restricted_rooms_test.go:275: \u001b[31m@user-1:hs2 MustSyncUntil: timed out after 5.890292079s. Seen 6 /sync responses. Checkers:\n
        [t=413.032163ms] Response #1: SyncTimelineHas(!gS10WlwBziu1frxHbf:hs2): check function did not pass while iterating over 9 elements: [{"content":{"creator":"@user-1:hs2","room_version":"10"},"event_id":"$xA3g4rrozh1LW9RLqtRGkNSjt2rO3LXlU8AOCJ3FOMg","origin_server_ts":1740267358441,"sender":"@user-1:hs2","state_key":"","type":"m.room.create","unsigned":{"age":1,"prev_content":{"creator":"@user-1:hs2","room_version":"10"}}},{"content":{"displayname":"user-1 ⚡️","is_direct":false,"membership":"join"},"event_id":"$_ZST7TnKsMqVKu_Ll1BRxrFsWNteXadK2e-7CJmUBGs","origin_server_ts":1740267358507,"sender":"@user-1:hs2","state_key":"@user-1:hs2","type":"m.room.member","unsigned":{"age":1,"prev_content":{"displayname":"user-1 ⚡️","is_direct":false,"membership":"join"}}},{"content":{"ban":50,"events":{},"events_default":0,"invite":0,"kick":50,"notifications":{"room":50},"redact":50,"state_default":50,"users":{"@user-1:hs2":100},"users_default":0},"event_id":"$BhUNkOEltFmpTZfczK5Y5chfMbsXbNoRbvngsxEZP04","o
rigin_server_ts":1740267358578,"sender":"@user-1:hs2","state_key":"","type":"m.room.power_levels","unsigned":{"age":1,"prev_content":{"ban":50,"events":{},"events_default":0,"invite":0,"kick":50,"notifications":{"room":50},"redact":50,"state_default":50,"users":{"@user-1:hs2":100},"users_default":0}}},{"content":{"join_rule":"public"},"event_id":"$pBIewl6Owqz4kAy5GrY_2Buwemc_AUeuxDHd4FP5OjQ","origin_server_ts":1740267358652,"sender":"@user-1:hs2","state_key":"","type":"m.room.join_rules","unsigned":{"age":1,"prev_content":{"join_rule":"public"}}},{"content":{"history_visibility":"shared"},"event_id":"$WbpPimB6RO988h1vdpaIRlGkykZXzO13zfzrCyUR0XI","origin_server_ts":1740267358712,"sender":"@user-1:hs2","state_key":"","type":"m.room.history_visibility","unsigned":{"age":1,"prev_content":{"history_visibility":"shared"}}},{"content":{"guest_access":"forbidden"},"event_id":"$8UQE51hiYfIIf6AD7eq4KLrhN3PBjtcfoAG9bD81Xt0","origin_server_ts":1740267358754,"sender":"@user-1:hs2","state_key":"","type":"m.room.guest_acces
s","unsigned":{"age":1,"prev_content":{"guest_access":"forbidden"}}},{"content":{"allow":[{"room_id":"!pflRgrDmS3MKGt217Y:hs2","type":"m.room_membership","via":["hs2"]}],"join_rule":"knock_restricted"},"event_id":"$t1_1ZS3ihAsA_NqCnON30VO-ctJLd7TxtMG6IJKEjZk","origin_server_ts":1740267358837,"sender":"@user-1:hs2","state_key":"","type":"m.room.join_rules","unsigned":{"age":1,"prev_content":{"allow":[{"room_id":"!pflRgrDmS3MKGt217Y:hs2","type":"m.room_membership","via":["hs2"]}],"join_rule":"knock_restricted"},"prev_sender":"@user-1:hs2"}},{"content":{"name":"Room"},"event_id":"$O-k7dZ9MbWSRg0LKd3kdKJugTL4VRZxulv-8q93XJk0","origin_server_ts":1740267358951,"sender":"@user-1:hs2","state_key":"","type":"m.room.name","unsigned":{"age":1,"prev_content":{"name":"Room"}}},{"content":{"is_direct":false,"membership":"invite"},"event_id":"$QrnqEkn2ylbOqMDE8xHpHkzz0J0JTw0bplolDftdQVQ","origin_server_ts":1740267359649,"sender":"@user-1:hs2","state_key":"@user-2:hs1","type":"m.room.member","unsigned":{"age":1,"prev_content
":{"is_direct":false,"membership":"invite"}}}]\n
        [t=1.446112936s] Response #2: SyncTimelineHas(!gS10WlwBziu1frxHbf:hs2): Key rooms.join.!gS10WlwBziu1frxHbf:hs2.timeline.events does not exist\n
        [t=2.579431952s] Response #3: SyncTimelineHas(!gS10WlwBziu1frxHbf:hs2): Key rooms.join.!gS10WlwBziu1frxHbf:hs2.timeline.events does not exist\n
        [t=3.700304304s] Response #4: SyncTimelineHas(!gS10WlwBziu1frxHbf:hs2): Key rooms.join.!gS10WlwBziu1frxHbf:hs2.timeline.events does not exist\n
        [t=4.809033217s] Response #5: SyncTimelineHas(!gS10WlwBziu1frxHbf:hs2): Key rooms.join.!gS10WlwBziu1frxHbf:hs2.timeline.events does not exist\n
        [t=5.890288584s] Response #6: SyncTimelineHas(!gS10WlwBziu1frxHbf:hs2): Key rooms.join.!gS10WlwBziu1frxHbf:hs2.timeline.events does not exist, \n
        \u001b[39m\n
2025/02/23 07:36:15 ============================================\n
\n
\n
2025/02/23 07:36:15 fa167555d599d6957205377e4dccdde1a6da102596491e7055ab0472fd092a7c : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=fa167555d599\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux fa167555d599 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267353.8010726,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267353.8195982,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267353.8196726,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
  \u001b[2m2025-02-22T23:36:06.019963Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:36:06.770723Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs2"  servername:"hs1"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs2:8448/_matrix/federation/v1/make_join/!pflRgrDmS3MKGt217Y:hs2/@user-3:hs1?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "942", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:36:06 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$TEXNMFSjEt-xHWoBKGXWvZkn7hFbZgGVJB_cUagQx2w","$uX46G3qCuPWkBD1lDoWGELLW_76lPUqEllrx1nz3nVM","$ZOnYaN621QC_bOoB4eONKEpGrmGbsSVC39XGFIS556A"],"content":{"membership":"join"},"depth":8,"event_sn":23,"hashes":{"sha256":"WUKyhGznJYYnzQPsaZct9eNkyMswUWMu5IQqhcu8kPc"},"origin":"hs2","origin_server_ts":1740267367061,"prev_events":["$GsgU1UNwambX2aHkKcEejbNVYGvK6bQ7f4hafje-YbE","$MJxX6vfeL4gESyk2iNhZOYpRjP7BooS5l6rDM91yOQk","$TEXNMFSjEt-xHWoBKGXWvZkn7hFbZgGVJB_cUagQx2w","$ZOnYaN621QC_bOoB4eONKEpGrmGbsSVC39XGFIS556A","$_wLA9v6GUmuJfba1_4xs4K9vP4qBOyrbnbzacCY_9LA","$pF6sftyRXutj_GjUAxkUEuVTG2GaNnUHnaQXzmh-fmM","$uX46G3qCuPWkBD1lDoWGELLW_76lPUqEllrx1nz3nVM"],"room_id":"!pflRgrDmS3MKGt217Y:hs2","sender":"@user-3:hs1","signatures":{"hs2":{"ed25519:PPHYpo4c":"UNsrDjWe1Iyo1NGgXz6+0ZYZN8VTStOb6M+HhiLlYgZbb8fAW79UZ3CgPBzN/PdxwXTlzhwplB11WFYimk8/Aw"}},"state_key":"@user-3:hs1","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:36:08.097819Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:36:10.379820Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::event::handler\u001b[0m\u001b[33m: \u001b[33mPrev event $_ZST7TnKsMqVKu_Ll1BRxrFsWNteXadK2e-7CJmUBGs failed: diesel: `Record not found`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/event/handler/mod.rs:137\n
\n
To many layers, we have to go deeper frame_id: 10\n
To many layers, we have to go deeper frame_id: 11\n
To many layers, we have to go deeper frame_id: 18\n
2025/02/23 07:36:15 ============== fa167555d599d6957205377e4dccdde1a6da102596491e7055ab0472fd092a7c : END LOGS ==============\n
\n
\n
2025/02/23 07:36:17 ============================================\n
\n
\n
2025/02/23 07:36:17 40167307b98b9b196633cad17f03617f2aaa70602984c3634453c169e74eeb6c : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=40167307b98b\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 40167307b98b 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267353.9827728,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267353.9873886,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267353.987423,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
To many layers, we have to go deeper frame_id: 17\n
To many layers, we have to go deeper frame_id: 18\n
  \u001b[2m2025-02-22T23:36:15.050286Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mCould not send request to hs1 at https://hs1:8448/_matrix/federation/v1/send/r9nSQlYYsywATYhBZ-TgAnSoaGWM3H2fh1uOkRbQcCc: error sending request for url (https://hs1:8448/_matrix/federation/v1/send/r9nSQlYYsywATYhBZ-TgAnSoaGWM3H2fh1uOkRbQcCc)\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:96\n
\n
2025/02/23 07:36:17 ============== 40167307b98b9b196633cad17f03617f2aaa70602984c3634453c169e74eeb6c : END LOGS ==============\n
\n
\n
--- FAIL: TestRestrictedRoomsRemoteJoinLocalUserInMSC3787Room (46.78s)\n
null
null
=== RUN   TestRestrictedRoomsRemoteJoinFailOverInMSC3787Room\n
    restricted_rooms_test.go:334: WARNING: TestRestrictedRoomsRemoteJoinFailOverInMSC3787Room called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    rooms_invite_test.go:16: Deploy times: 14.662726ms blueprints, 27.897974584s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (905.098101ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (704.221414ms)\n
null
=== RUN   TestRoomsInvite/Parallel\n
null
=== RUN   TestRoomsInvite/Parallel/Can_invite_users_to_invite-only_rooms\n
=== PAUSE TestRoomsInvite/Parallel/Can_invite_users_to_invite-only_rooms\n
null
null
=== RUN   TestRoomsInvite/Parallel/Uninvited_users_cannot_join_the_room\n
=== PAUSE TestRoomsInvite/Parallel/Uninvited_users_cannot_join_the_room\n
null
null
=== RUN   TestRoomsInvite/Parallel/Invited_user_can_reject_invite\n
=== PAUSE TestRoomsInvite/Parallel/Invited_user_can_reject_invite\n
null
null
=== RUN   TestRoomsInvite/Parallel/Invited_user_can_reject_invite_for_empty_room\n
=== PAUSE TestRoomsInvite/Parallel/Invited_user_can_reject_invite_for_empty_room\n
null
null
=== RUN   TestRoomsInvite/Parallel/Users_cannot_invite_themselves_to_a_room\n
=== PAUSE TestRoomsInvite/Parallel/Users_cannot_invite_themselves_to_a_room\n
null
null
=== RUN   TestRoomsInvite/Parallel/Users_cannot_invite_a_user_that_is_already_in_the_room\n
=== PAUSE TestRoomsInvite/Parallel/Users_cannot_invite_a_user_that_is_already_in_the_room\n
null
null
=== RUN   TestRoomsInvite/Parallel/Invited_user_can_see_room_metadata\n
=== PAUSE TestRoomsInvite/Parallel/Invited_user_can_see_room_metadata\n
null
null
=== RUN   TestRoomsInvite/Parallel/Test_that_we_can_be_reinvited_to_a_room_we_created\n
=== PAUSE TestRoomsInvite/Parallel/Test_that_we_can_be_reinvited_to_a_room_we_created\n
null
null
=== CONT  TestRoomsInvite/Parallel/Can_invite_users_to_invite-only_rooms\n
null
=== CONT  TestRoomsInvite/Parallel/Test_that_we_can_be_reinvited_to_a_room_we_created\n
null
=== CONT  TestRoomsInvite/Parallel/Invited_user_can_see_room_metadata\n
null
=== CONT  TestRoomsInvite/Parallel/Users_cannot_invite_a_user_that_is_already_in_the_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.636071821s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.650204603s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.740000256s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (3.186507437s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!hS7HtVbGv0F4CGJLjH:hs1/invite => 200 OK (984.190566ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!PUxeRkLGqEYEN80nbH:hs1/invite => 200 OK (1.019477833s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!c00AdHzTzhsOj9snak:hs1/invite => 200 OK (1.066893487s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (183.381936ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (204.42101ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (141.906965ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!ozBHoWVu2iysqae8Yh:hs1/invite => 200 OK (963.758372ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (44.287808ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (132.746767ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!ozBHoWVu2iysqae8Yh:hs1/state/m.room.join_rules/ => 200 OK (124.713057ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!ozBHoWVu2iysqae8Yh:hs1/state/m.room.name/ => 200 OK (107.484715ms)\n
--- PASS: TestRoomsInvite/Parallel/Invited_user_can_see_room_metadata (4.56s)\n
null
null
=== CONT  TestRoomsInvite/Parallel/Users_cannot_invite_themselves_to_a_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!PUxeRkLGqEYEN80nbH:hs1 => 200 OK (891.994936ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!hS7HtVbGv0F4CGJLjH:hs1 => 200 OK (995.38937ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!c00AdHzTzhsOj9snak:hs1 => 200 OK (896.571495ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.153459753s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!b1fuMTUlSSClUSucgB:hs1/invite => 403 Forbidden (340.262155ms)\n
--- PASS: TestRoomsInvite/Parallel/Users_cannot_invite_themselves_to_a_room (2.49s)\n
null
null
=== CONT  TestRoomsInvite/Parallel/Invited_user_can_reject_invite_for_empty_room\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.366334392s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.609793162s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.654956001s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!c00AdHzTzhsOj9snak:hs1/invite => 403 Forbidden (211.452668ms)\n
--- PASS: TestRoomsInvite/Parallel/Users_cannot_invite_a_user_that_is_already_in_the_room (7.67s)\n
null
null
=== CONT  TestRoomsInvite/Parallel/Invited_user_can_reject_invite\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!hS7HtVbGv0F4CGJLjH:hs1/state/m.room.power_levels => 200 OK (286.269212ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!hS7HtVbGv0F4CGJLjH:hs1/leave => 200 OK (257.522278ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (967.302806ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (731.57915ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.374704348s)\n
--- PASS: TestRoomsInvite/Parallel/Can_invite_users_to_invite-only_rooms (8.49s)\n
null
null
=== CONT  TestRoomsInvite/Parallel/Uninvited_users_cannot_join_the_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!UOpQ4823toHHQD1k7R:hs1/invite => 200 OK (185.31851ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (752.64868ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.284808345s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!dgL3goTtamK976UhDN:hs1 => 403 Forbidden (82.0531ms)\n
--- PASS: TestRoomsInvite/Parallel/Uninvited_users_cannot_join_the_room (0.84s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (867.090311ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.443995941s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!hS7HtVbGv0F4CGJLjH:hs1/invite => 200 OK (204.769723ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!UOpQ4823toHHQD1k7R:hs1/leave => 200 OK (196.237826ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!6c4rVndYM8xUOfUAIh:hs1/invite => 200 OK (301.501402ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (673.479062ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!6c4rVndYM8xUOfUAIh:hs1/leave => 200 OK (284.188825ms)\n
    restricted_rooms_test.go:336: Deploy times: 10.240328ms blueprints, 30.561738553s containers\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.770626838s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.856726492s)\n
--- PASS: TestRoomsInvite/Parallel/Invited_user_can_reject_invite (3.84s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (830.453732ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!hS7HtVbGv0F4CGJLjH:hs1 => 200 OK (296.030271ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (635.609414ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!6c4rVndYM8xUOfUAIh:hs1/leave => 200 OK (244.944256ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (556.937954ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (499.765556ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (329.388139ms)\n
--- PASS: TestRoomsInvite/Parallel/Invited_user_can_reject_invite_for_empty_room (5.58s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.112617072s)\n
--- PASS: TestRoomsInvite/Parallel/Test_that_we_can_be_reinvited_to_a_room_we_created (12.69s)\n
null
--- PASS: TestRoomsInvite/Parallel (0.00s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (617.14448ms)\n
    restricted_rooms_test.go:341: @user-1:hs1 created authorizing room !IXcKv6t7z6ecJYv4Iu:hs1.\n
    restricted_rooms_test.go:342: @user-1:hs1 created restricted room !IgCBSL8BWkyX0Mf7YC:hs1.\n
    restricted_rooms_test.go:345: @user-1:hs1 restricts invites to themself only.\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!IgCBSL8BWkyX0Mf7YC:hs1/state/m.room.power_levels/ => 200 OK (58.283725ms)\n
    restricted_rooms_test.go:347: SendEventSynced waiting for event ID $Ga-GW-HWLgnGXu6tuy-M31sM2cHp0JzDgbUTVZ2CwyU\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (203.908632ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (598.452685ms)\n
    restricted_rooms_test.go:362: @user-2:hs2 joins the authorizing room via hs1.\n
    restricted_rooms_test.go:363: @user-2:hs2 joins the restricted room via hs1.\n
2025/02/23 07:36:51 ============================================\n
\n
\n
2025/02/23 07:36:51 ecfac3f137c66edb512f7788db7b49fea40360f5ba5d09dc3e600ea19448b7cf : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=ecfac3f137c6\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux ecfac3f137c6 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267391.461651,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267391.4697611,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267391.469824,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 17\n
To many layers, we have to go deeper frame_id: 18\n
To many layers, we have to go deeper frame_id: 19\n
To many layers, we have to go deeper frame_id: 20\n
To many layers, we have to go deeper frame_id: 37\n
  \u001b[2m2025-02-22T23:36:44.155735Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mCan't invite user if sender not joined or the user is currently joined or banned, \u001b[1;33mtarget_user_membership_event_id\u001b[0m\u001b[33m: Some("$2RCeCHKlHXa0Qno4NqMsAj4LoHMuVDNVpoT6dUkbhqI"), \u001b[1;33msender_membership_event_id\u001b[0m\u001b[33m: Some("$2RCeCHKlHXa0Qno4NqMsAj4LoHMuVDNVpoT6dUkbhqI")\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:601\n
\n
  \u001b[2m2025-02-22T23:36:44.773765Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mCan't invite user if sender not joined or the user is currently joined or banned, \u001b[1;33mtarget_user_membership_event_id\u001b[0m\u001b[33m: Some("$JEsU-vUDCZaofCti_x8H9LYKoDp4ROH_VazU4SA5XAY"), \u001b[1;33msender_membership_event_id\u001b[0m\u001b[33m: Some("$8bbNND4cWhi3C_lTGWxF309R41XoGsdH3PGGBrBfcek")\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:601\n
\n
To many layers, we have to go deeper frame_id: 45\n
To many layers, we have to go deeper frame_id: 51\n
To many layers, we have to go deeper frame_id: 58\n
To many layers, we have to go deeper frame_id: 64\n
2025/02/23 07:36:51 ============== ecfac3f137c66edb512f7788db7b49fea40360f5ba5d09dc3e600ea19448b7cf : END LOGS ==============\n
\n
\n
--- PASS: TestRoomsInvite (43.89s)\n
null
null
=== RUN   TestMembersLocal\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!IXcKv6t7z6ecJYv4Iu:hs1 => 200 OK (1.424903439s)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!IgCBSL8BWkyX0Mf7YC:hs1 => 400 Bad Request (106.905267ms)\n
    client.go:706: [CSAPI] POST hs3/_matrix/client/v3/register => 200 OK (659.030828ms)\n
    restricted_rooms_test.go:369: @user-3:hs3 joins the authorizing room via hs1.\n
    client.go:706: [CSAPI] POST hs3/_matrix/client/v3/join/!IXcKv6t7z6ecJYv4Iu:hs1 => 200 OK (850.481971ms)\n
    restricted_rooms_test.go:373: @user-3:hs3 joins the restricted room via hs2, which is expected to fail.\n
    client.go:706: [CSAPI] POST hs3/_matrix/client/v3/join/!IgCBSL8BWkyX0Mf7YC:hs1 => 400 Bad Request (121.077688ms)\n
    restricted_rooms_test.go:378: @user-3:hs3 joins the restricted room via {hs2,hs1}.\n
    client.go:706: [CSAPI] POST hs3/_matrix/client/v3/join/!IgCBSL8BWkyX0Mf7YC:hs1 => 400 Bad Request (100.463571ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (35.550983ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (64.37938ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (49.195753ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (69.076189ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (55.621024ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (70.298202ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (51.843812ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (91.562641ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (45.116049ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.028528956s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.03584439s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.04607922s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.04204175s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.043083712s)\n
    restricted_rooms_test.go:382: \u001b[31m@user-2:hs2 MustSyncUntil: timed out after 5.732262719s. Seen 14 /sync responses. Checkers:\n
        [t=35.771043ms] Response #1: SyncTimelineHas(!IgCBSL8BWkyX0Mf7YC:hs1): Key rooms.join.!IgCBSL8BWkyX0Mf7YC:hs1.timeline.events does not exist\n
        [t=100.298825ms] Response #2: SyncTimelineHas(!IgCBSL8BWkyX0Mf7YC:hs1): Key rooms.join.!IgCBSL8BWkyX0Mf7YC:hs1.timeline.events does not exist\n
        [t=149.667108ms] Response #3: SyncTimelineHas(!IgCBSL8BWkyX0Mf7YC:hs1): Key rooms.join.!IgCBSL8BWkyX0Mf7YC:hs1.timeline.events does not exist\n
        [t=218.883757ms] Response #4: SyncTimelineHas(!IgCBSL8BWkyX0Mf7YC:hs1): Key rooms.join.!IgCBSL8BWkyX0Mf7YC:hs1.timeline.events does not exist\n
        [t=274.669689ms] Response #5: SyncTimelineHas(!IgCBSL8BWkyX0Mf7YC:hs1): Key rooms.join.!IgCBSL8BWkyX0Mf7YC:hs1.timeline.events does not exist\n
        [t=345.187899ms] Response #6: SyncTimelineHas(!IgCBSL8BWkyX0Mf7YC:hs1): Key rooms.join.!IgCBSL8BWkyX0Mf7YC:hs1.timeline.events does not exist\n
        [t=397.178181ms] Response #7: SyncTimelineHas(!IgCBSL8BWkyX0Mf7YC:hs1): Key rooms.join.!IgCBSL8BWkyX0Mf7YC:hs1.timeline.events does not exist\n
        [t=488.951248ms] Response #8: SyncTimelineHas(!IgCBSL8BWkyX0Mf7YC:hs1): Key rooms.join.!IgCBSL8BWkyX0Mf7YC:hs1.timeline.events does not exist\n
        [t=534.252604ms] Response #9: SyncTimelineHas(!IgCBSL8BWkyX0Mf7YC:hs1): Key rooms.join.!IgCBSL8BWkyX0Mf7YC:hs1.timeline.events does not exist\n
        [t=1.562977494s] Response #10: SyncTimelineHas(!IgCBSL8BWkyX0Mf7YC:hs1): Key rooms.join.!IgCBSL8BWkyX0Mf7YC:hs1.timeline.events does not exist\n
        [t=2.599010478s] Response #11: SyncTimelineHas(!IgCBSL8BWkyX0Mf7YC:hs1): Key rooms.join.!IgCBSL8BWkyX0Mf7YC:hs1.timeline.events does not exist\n
        [t=3.645240023s] Response #12: SyncTimelineHas(!IgCBSL8BWkyX0Mf7YC:hs1): Key rooms.join.!IgCBSL8BWkyX0Mf7YC:hs1.timeline.events does not exist\n
        [t=4.688944395s] Response #13: SyncTimelineHas(!IgCBSL8BWkyX0Mf7YC:hs1): Key rooms.join.!IgCBSL8BWkyX0Mf7YC:hs1.timeline.events does not exist\n
        [t=5.732259534s] Response #14: SyncTimelineHas(!IgCBSL8BWkyX0Mf7YC:hs1): Key rooms.join.!IgCBSL8BWkyX0Mf7YC:hs1.timeline.events does not exist, \n
        \u001b[39m\n
2025/02/23 07:37:01 ============================================\n
\n
\n
2025/02/23 07:37:01 cd3e8ea303ee916ea37c88b7e23663141ebcf8727d328ef33784381519335616 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=cd3e8ea303ee\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux cd3e8ea303ee 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267404.3153005,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267404.3236585,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267404.323994,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs1:8448/_matrix/federation/v1/make_join/!IXcKv6t7z6ecJYv4Iu:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "942", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:36:51 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$WK5YLKaWpV1bQ2et15t-BE9a0iGhiSz1Q3OZQvOUh3Y","$wdCtuAVODFp9R9ii7YqZZsgjiumQfzlwDtVFE6rmEw4","$Cenu9e_CSbSpSxWEV0k-Q-dK5GvCKVkne8-wCcn2tLA"],"content":{"membership":"join"},"depth":8,"event_sn":22,"hashes":{"sha256":"1LVwMkHhycAckOS3jvFXaah+PJ+QeYWigpMsoNep2zg"},"origin":"hs1","origin_server_ts":1740267411296,"prev_events":["$Cenu9e_CSbSpSxWEV0k-Q-dK5GvCKVkne8-wCcn2tLA","$Q3BiteC1DAup_BsVEM0EwcW-AuYY8fanSLmZeZGppQM","$WK5YLKaWpV1bQ2et15t-BE9a0iGhiSz1Q3OZQvOUh3Y","$_u2jYakl0HuLbELWpv9y38hWpXOMKsgX8wX4JhMvL7o","$oGi-dv_TEN9V5D6lUdwDgmGKCNEKoX9ekIvKhOVsGr8","$wFKxNAodpV2vBPn-L1ol7juY72wsJyv1z-Aa8XqS7jw","$wdCtuAVODFp9R9ii7YqZZsgjiumQfzlwDtVFE6rmEw4"],"room_id":"!IXcKv6t7z6ecJYv4Iu:hs1","sender":"@user-2:hs2","signatures":{"hs1":{"ed25519:Zpf2n81R":"gAQl0FVb0tXgkMhE0c1mMaeEQcwdQhu6cmkcyhJ8aFLjYr1+dxrE897k6pWJU3V/flgjPJDi4ECfBDQ/rPPoAg"}},"state_key":"@user-2:hs2","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:36:51.862874Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
  \u001b[2m2025-02-22T23:36:52.245545Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_join/!IgCBSL8BWkyX0Mf7YC:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5] 400 Bad Request: {"errcode":"M_UNABLE_TO_AUTHORISE_JOIN","error":"Palpo does not support restricted rooms yet."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_UNABLE_TO_AUTHORISE_JOIN\\",\\"error\\":\\"Palpo does not support restricted rooms yet.\\"}")}) }))\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
  \u001b[2m2025-02-22T23:36:52.284921Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_join/!IgCBSL8BWkyX0Mf7YC:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5] 400 Bad Request: {"errcode":"M_UNABLE_TO_AUTHORISE_JOIN","error":"Palpo does not support restricted rooms yet."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_UNABLE_TO_AUTHORISE_JOIN\\",\\"error\\":\\"Palpo does not support restricted rooms yet.\\"}")}) }))\n
  \u001b[2m2025-02-22T23:36:54.082829Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $oGi-dv_TEN9V5D6lUdwDgmGKCNEKoX9ekIvKhOVsGr8\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:36:54.086244Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $WK5YLKaWpV1bQ2et15t-BE9a0iGhiSz1Q3OZQvOUh3Y\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.088311Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Q3BiteC1DAup_BsVEM0EwcW-AuYY8fanSLmZeZGppQM\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.089288Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Z53o7YhXYXcAU99HMIMW9CJCUKYHGTDy3EVSytPRtxU\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:36:54.091609Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $wFKxNAodpV2vBPn-L1ol7juY72wsJyv1z-Aa8XqS7jw\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.094244Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Cenu9e_CSbSpSxWEV0k-Q-dK5GvCKVkne8-wCcn2tLA\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.097581Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $wdCtuAVODFp9R9ii7YqZZsgjiumQfzlwDtVFE6rmEw4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.101222Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $_u2jYakl0HuLbELWpv9y38hWpXOMKsgX8wX4JhMvL7o\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.143306Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $WK5YLKaWpV1bQ2et15t-BE9a0iGhiSz1Q3OZQvOUh3Y\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.144574Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $wdCtuAVODFp9R9ii7YqZZsgjiumQfzlwDtVFE6rmEw4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.146961Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $wFKxNAodpV2vBPn-L1ol7juY72wsJyv1z-Aa8XqS7jw\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.149053Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $_u2jYakl0HuLbELWpv9y38hWpXOMKsgX8wX4JhMvL7o\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.150461Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Z53o7YhXYXcAU99HMIMW9CJCUKYHGTDy3EVSytPRtxU\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:36:54.152732Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Cenu9e_CSbSpSxWEV0k-Q-dK5GvCKVkne8-wCcn2tLA\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.154619Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Q3BiteC1DAup_BsVEM0EwcW-AuYY8fanSLmZeZGppQM\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.155988Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $oGi-dv_TEN9V5D6lUdwDgmGKCNEKoX9ekIvKhOVsGr8\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:36:54.191340Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $oGi-dv_TEN9V5D6lUdwDgmGKCNEKoX9ekIvKhOVsGr8\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:36:54.192364Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Cenu9e_CSbSpSxWEV0k-Q-dK5GvCKVkne8-wCcn2tLA\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.194296Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $wFKxNAodpV2vBPn-L1ol7juY72wsJyv1z-Aa8XqS7jw\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.196152Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $_u2jYakl0HuLbELWpv9y38hWpXOMKsgX8wX4JhMvL7o\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.198350Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $wdCtuAVODFp9R9ii7YqZZsgjiumQfzlwDtVFE6rmEw4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.200823Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $WK5YLKaWpV1bQ2et15t-BE9a0iGhiSz1Q3OZQvOUh3Y\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.201988Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Z53o7YhXYXcAU99HMIMW9CJCUKYHGTDy3EVSytPRtxU\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:36:54.204779Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Q3BiteC1DAup_BsVEM0EwcW-AuYY8fanSLmZeZGppQM\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.261867Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Z53o7YhXYXcAU99HMIMW9CJCUKYHGTDy3EVSytPRtxU\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:36:54.265096Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $oGi-dv_TEN9V5D6lUdwDgmGKCNEKoX9ekIvKhOVsGr8\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:36:54.267302Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $wdCtuAVODFp9R9ii7YqZZsgjiumQfzlwDtVFE6rmEw4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.269359Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $WK5YLKaWpV1bQ2et15t-BE9a0iGhiSz1Q3OZQvOUh3Y\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.270801Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $_u2jYakl0HuLbELWpv9y38hWpXOMKsgX8wX4JhMvL7o\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.272433Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Cenu9e_CSbSpSxWEV0k-Q-dK5GvCKVkne8-wCcn2tLA\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.274064Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Q3BiteC1DAup_BsVEM0EwcW-AuYY8fanSLmZeZGppQM\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.276094Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $wFKxNAodpV2vBPn-L1ol7juY72wsJyv1z-Aa8XqS7jw\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.335179Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Cenu9e_CSbSpSxWEV0k-Q-dK5GvCKVkne8-wCcn2tLA\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.337316Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $_u2jYakl0HuLbELWpv9y38hWpXOMKsgX8wX4JhMvL7o\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.340390Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $wFKxNAodpV2vBPn-L1ol7juY72wsJyv1z-Aa8XqS7jw\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.341713Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $oGi-dv_TEN9V5D6lUdwDgmGKCNEKoX9ekIvKhOVsGr8\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:36:54.342405Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Z53o7YhXYXcAU99HMIMW9CJCUKYHGTDy3EVSytPRtxU\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:36:54.343345Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $wdCtuAVODFp9R9ii7YqZZsgjiumQfzlwDtVFE6rmEw4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.344368Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Q3BiteC1DAup_BsVEM0EwcW-AuYY8fanSLmZeZGppQM\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.345370Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $WK5YLKaWpV1bQ2et15t-BE9a0iGhiSz1Q3OZQvOUh3Y\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.385295Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Q3BiteC1DAup_BsVEM0EwcW-AuYY8fanSLmZeZGppQM\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.386546Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Z53o7YhXYXcAU99HMIMW9CJCUKYHGTDy3EVSytPRtxU\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:36:54.388142Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Cenu9e_CSbSpSxWEV0k-Q-dK5GvCKVkne8-wCcn2tLA\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.390016Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $WK5YLKaWpV1bQ2et15t-BE9a0iGhiSz1Q3OZQvOUh3Y\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.392440Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $wdCtuAVODFp9R9ii7YqZZsgjiumQfzlwDtVFE6rmEw4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.395546Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $wFKxNAodpV2vBPn-L1ol7juY72wsJyv1z-Aa8XqS7jw\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.397790Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $oGi-dv_TEN9V5D6lUdwDgmGKCNEKoX9ekIvKhOVsGr8\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:36:54.398986Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $_u2jYakl0HuLbELWpv9y38hWpXOMKsgX8wX4JhMvL7o\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.462861Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $wFKxNAodpV2vBPn-L1ol7juY72wsJyv1z-Aa8XqS7jw\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.464289Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $WK5YLKaWpV1bQ2et15t-BE9a0iGhiSz1Q3OZQvOUh3Y\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.465277Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Z53o7YhXYXcAU99HMIMW9CJCUKYHGTDy3EVSytPRtxU\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:36:54.466705Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $wdCtuAVODFp9R9ii7YqZZsgjiumQfzlwDtVFE6rmEw4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.468924Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $_u2jYakl0HuLbELWpv9y38hWpXOMKsgX8wX4JhMvL7o\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.470391Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Q3BiteC1DAup_BsVEM0EwcW-AuYY8fanSLmZeZGppQM\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.472557Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $Cenu9e_CSbSpSxWEV0k-Q-dK5GvCKVkne8-wCcn2tLA\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:36:54.476191Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $oGi-dv_TEN9V5D6lUdwDgmGKCNEKoX9ekIvKhOVsGr8\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
2025/02/23 07:37:01 ============== cd3e8ea303ee916ea37c88b7e23663141ebcf8727d328ef33784381519335616 : END LOGS ==============\n
\n
\n
2025/02/23 07:37:03 ============================================\n
\n
\n
2025/02/23 07:37:03 0ef56daf56f364b7da856befb9ee080273c414eb1ad2d2038691d186c630330b : Server logs:\n
SERVER_NAME=hs3\n
HOSTNAME=0ef56daf56f3\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 0ef56daf56f3 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267404.4178548,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267404.4295456,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267404.4295826,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs3"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs1:8448/_matrix/federation/v1/make_join/!IXcKv6t7z6ecJYv4Iu:hs1/@user-3:hs3?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "942", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:36:52 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$Cenu9e_CSbSpSxWEV0k-Q-dK5GvCKVkne8-wCcn2tLA","$WK5YLKaWpV1bQ2et15t-BE9a0iGhiSz1Q3OZQvOUh3Y","$wdCtuAVODFp9R9ii7YqZZsgjiumQfzlwDtVFE6rmEw4"],"content":{"membership":"join"},"depth":8,"event_sn":23,"hashes":{"sha256":"SIeSF8ld4NFEGiqYzk8lKkXwIiqH48Fs1pZ3hJXgdIk"},"origin":"hs1","origin_server_ts":1740267413248,"prev_events":["$Cenu9e_CSbSpSxWEV0k-Q-dK5GvCKVkne8-wCcn2tLA","$Q3BiteC1DAup_BsVEM0EwcW-AuYY8fanSLmZeZGppQM","$WK5YLKaWpV1bQ2et15t-BE9a0iGhiSz1Q3OZQvOUh3Y","$_u2jYakl0HuLbELWpv9y38hWpXOMKsgX8wX4JhMvL7o","$oGi-dv_TEN9V5D6lUdwDgmGKCNEKoX9ekIvKhOVsGr8","$wFKxNAodpV2vBPn-L1ol7juY72wsJyv1z-Aa8XqS7jw","$wdCtuAVODFp9R9ii7YqZZsgjiumQfzlwDtVFE6rmEw4"],"room_id":"!IXcKv6t7z6ecJYv4Iu:hs1","sender":"@user-3:hs3","signatures":{"hs1":{"ed25519:Zpf2n81R":"f6NWTPwJfw9K5Jw/SDDq43tmbDLICnC9h+FNIVDN2J0aOHDm4g7T26D/qhoNZ67v40uTfxgwuSSoY2eVxzQkBg"}},"state_key":"@user-3:hs3","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:36:53.453742Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs2"  servername:"hs3"\n
  \u001b[2m2025-02-22T23:36:53.875106Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs2:8448/_matrix/federation/v1/make_join/!IgCBSL8BWkyX0Mf7YC:hs1/@user-3:hs3?ver=[6,7,8,9,10,11,3,4,5] 404 Not Found: {"errcode":"M_NOT_FOUND","error":"Room is unknown to this server."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs2: {\\"errcode\\":\\"M_NOT_FOUND\\",\\"error\\":\\"Room is unknown to this server.\\"}")}) }))\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs3"\n
  \u001b[2m2025-02-22T23:36:53.917157Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_join/!IgCBSL8BWkyX0Mf7YC:hs1/@user-3:hs3?ver=[6,7,8,9,10,11,3,4,5] 400 Bad Request: {"errcode":"M_UNABLE_TO_AUTHORISE_JOIN","error":"Palpo does not support restricted rooms yet."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_UNABLE_TO_AUTHORISE_JOIN\\",\\"error\\":\\"Palpo does not support restricted rooms yet.\\"}")}) }))\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs2"  servername:"hs3"\n
  \u001b[2m2025-02-22T23:36:53.951040Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs2:8448/_matrix/federation/v1/make_join/!IgCBSL8BWkyX0Mf7YC:hs1/@user-3:hs3?ver=[6,7,8,9,10,11,3,4,5] 404 Not Found: {"errcode":"M_NOT_FOUND","error":"Room is unknown to this server."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs2: {\\"errcode\\":\\"M_NOT_FOUND\\",\\"error\\":\\"Room is unknown to this server.\\"}")}) }))\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs3"\n
  \u001b[2m2025-02-22T23:36:53.984536Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_join/!IgCBSL8BWkyX0Mf7YC:hs1/@user-3:hs3?ver=[6,7,8,9,10,11,3,4,5] 400 Bad Request: {"errcode":"M_UNABLE_TO_AUTHORISE_JOIN","error":"Palpo does not support restricted rooms yet."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_UNABLE_TO_AUTHORISE_JOIN\\",\\"error\\":\\"Palpo does not support restricted rooms yet.\\"}")}) }))\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs3"\n
  \u001b[2m2025-02-22T23:36:54.017990Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_join/!IgCBSL8BWkyX0Mf7YC:hs1/@user-3:hs3?ver=[6,7,8,9,10,11,3,4,5] 400 Bad Request: {"errcode":"M_UNABLE_TO_AUTHORISE_JOIN","error":"Palpo does not support restricted rooms yet."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_UNABLE_TO_AUTHORISE_JOIN\\",\\"error\\":\\"Palpo does not support restricted rooms yet.\\"}")}) }))\n
2025/02/23 07:37:03 ============== 0ef56daf56f364b7da856befb9ee080273c414eb1ad2d2038691d186c630330b : END LOGS ==============\n
\n
\n
2025/02/23 07:37:05 ============================================\n
\n
\n
2025/02/23 07:37:05 9d8a3c7107f664c7af7d0ffafdc2beb6ee355a9cb8d531390958d2a9689db20a : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=9d8a3c7107f6\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 9d8a3c7107f6 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267404.4298296,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267404.4421422,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267404.4421806,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
2025/02/23 07:37:05 ============== 9d8a3c7107f664c7af7d0ffafdc2beb6ee355a9cb8d531390958d2a9689db20a : END LOGS ==============\n
\n
\n
--- FAIL: TestRestrictedRoomsRemoteJoinFailOverInMSC3787Room (47.82s)\n
null
null
=== RUN   TestKnocking\n
    rooms_members_local_test.go:13: Deploy times: 55.319601ms blueprints, 19.019559049s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (743.52267ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (926.308108ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.239498351s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/presence/@user-2-bob:hs1/status => 200 OK (19.830271ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (267.95023ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!f7WcKGz6H0oB20NfZ7:hs1 => 200 OK (161.99104ms)\n
null
=== RUN   TestMembersLocal/Parallel\n
null
=== RUN   TestMembersLocal/Parallel/New_room_members_see_their_own_join_event\n
=== PAUSE TestMembersLocal/Parallel/New_room_members_see_their_own_join_event\n
null
null
=== RUN   TestMembersLocal/Parallel/Existing_members_see_new_members'_join_events\n
=== PAUSE TestMembersLocal/Parallel/Existing_members_see_new_members'_join_events\n
null
null
=== RUN   TestMembersLocal/Parallel/Existing_members_see_new_members'_presence_(in_initial_sync)\n
    rooms_members_local_test.go:53: WARNING: TestMembersLocal/Parallel/Existing_members_see_new_members'_presence_(in_initial_sync) called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
=== PAUSE TestMembersLocal/Parallel/Existing_members_see_new_members'_presence_(in_initial_sync)\n
null
null
=== RUN   TestMembersLocal/Parallel/Existing_members_see_new_members'_presence_(in_incremental_sync)\n
=== PAUSE TestMembersLocal/Parallel/Existing_members_see_new_members'_presence_(in_incremental_sync)\n
null
null
=== CONT  TestMembersLocal/Parallel/New_room_members_see_their_own_join_event\n
null
=== CONT  TestMembersLocal/Parallel/Existing_members_see_new_members'_join_events\n
null
=== CONT  TestMembersLocal/Parallel/Existing_members_see_new_members'_presence_(in_incremental_sync)\n
null
=== CONT  TestMembersLocal/Parallel/Existing_members_see_new_members'_presence_(in_initial_sync)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (379.29343ms)\n
--- PASS: TestMembersLocal/Parallel/Existing_members_see_new_members'_presence_(in_incremental_sync) (0.38s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (414.068509ms)\n
--- PASS: TestMembersLocal/Parallel/Existing_members_see_new_members'_join_events (0.41s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (547.447958ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (591.785179ms)\n
--- PASS: TestMembersLocal/Parallel/New_room_members_see_their_own_join_event (0.59s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (182.729703ms)\n
--- PASS: TestMembersLocal/Parallel/Existing_members_see_new_members'_presence_(in_initial_sync) (0.73s)\n
null
--- PASS: TestMembersLocal/Parallel (0.00s)\n
null
2025/02/23 07:37:16 ============================================\n
\n
\n
2025/02/23 07:37:16 3f0273114100c704b80a9e3856e0381c0f6ae1859f71b6b18b5dc75f21b6521a : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=3f0273114100\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 3f0273114100 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267427.030543,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267427.037587,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267427.037628,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:37:16 ============== 3f0273114100c704b80a9e3856e0381c0f6ae1859f71b6b18b5dc75f21b6521a : END LOGS ==============\n
\n
\n
--- PASS: TestMembersLocal (24.70s)\n
null
null
=== RUN   TestRoomCreationReportsEventsToMyself\n
    knocking_test.go:42: Deploy times: 14.578079ms blueprints, 23.685346093s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (619.189146ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (646.600689ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (661.75328ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (568.717882ms)\n
    rooms_state_test.go:20: Deploy times: 10.584734ms blueprints, 18.307421839s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (635.105183ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (766.768348ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!PJHhJKlQAk1eSJZgKe:hs1/invite => 200 OK (2.388587655s)\n
    knocking_test.go:75: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 51 51 50 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!PJHhJKlQAk1eSJZgKe:hs1/$s3_Wz7Y79G8Gu2h6L9pov42TIrbrHm0Flr1h6CFMvaQ") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1332\u001b[39m\n
2025/02/23 07:37:36 complement: Transaction 'U59HT6p57a-XOe1vADuXi3K23bjYimrw7R3n2ik13OE': HTTP Code 401. Invalid http request: {Invalid request signature}\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (440.202815ms)\n
null
=== RUN   TestRoomCreationReportsEventsToMyself/parallel\n
null
=== RUN   TestRoomCreationReportsEventsToMyself/parallel/Room_creation_reports_m.room.create_to_myself\n
=== PAUSE TestRoomCreationReportsEventsToMyself/parallel/Room_creation_reports_m.room.create_to_myself\n
null
null
=== RUN   TestRoomCreationReportsEventsToMyself/parallel/Room_creation_reports_m.room.member_to_myself\n
=== PAUSE TestRoomCreationReportsEventsToMyself/parallel/Room_creation_reports_m.room.member_to_myself\n
null
null
=== RUN   TestRoomCreationReportsEventsToMyself/parallel/Setting_room_topic_reports_m.room.topic_to_myself\n
=== PAUSE TestRoomCreationReportsEventsToMyself/parallel/Setting_room_topic_reports_m.room.topic_to_myself\n
null
null
=== RUN   TestRoomCreationReportsEventsToMyself/parallel/Setting_state_twice_is_idempotent\n
=== PAUSE TestRoomCreationReportsEventsToMyself/parallel/Setting_state_twice_is_idempotent\n
null
null
=== RUN   TestRoomCreationReportsEventsToMyself/parallel/Joining_room_twice_is_idempotent\n
=== PAUSE TestRoomCreationReportsEventsToMyself/parallel/Joining_room_twice_is_idempotent\n
null
null
=== CONT  TestRoomCreationReportsEventsToMyself/parallel/Room_creation_reports_m.room.create_to_myself\n
null
=== CONT  TestRoomCreationReportsEventsToMyself/parallel/Room_creation_reports_m.room.member_to_myself\n
null
=== CONT  TestRoomCreationReportsEventsToMyself/parallel/Joining_room_twice_is_idempotent\n
null
=== CONT  TestRoomCreationReportsEventsToMyself/parallel/Setting_room_topic_reports_m.room.topic_to_myself\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (147.606321ms)\n
--- PASS: TestRoomCreationReportsEventsToMyself/parallel/Room_creation_reports_m.room.create_to_myself (0.15s)\n
null
null
=== CONT  TestRoomCreationReportsEventsToMyself/parallel/Setting_state_twice_is_idempotent\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!Gi5M0CS1TBpcHaKgys:hs1/state/m.room.topic/ => 200 OK (739.728562ms)\n
    rooms_state_test.go:66: SendEventSynced waiting for event ID $7LBcYDu-QaWkb-2-N2cawADk-Skj5KsuItRlcMAHnd8\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!Gi5M0CS1TBpcHaKgys:hs1/state/a.test.state.type/ => 200 OK (639.15343ms)\n
    rooms_state_test.go:99: SendEventSynced waiting for event ID $mh8aaSAxdFZNbrHW9W66G0ys5CdyMb_6JuX18VpEVrA\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.27789954s)\n
--- PASS: TestRoomCreationReportsEventsToMyself/parallel/Room_creation_reports_m.room.member_to_myself (1.28s)\n
2025/02/23 07:37:37 ============================================\n
\n
\n
2025/02/23 07:37:37 01c40814bc8d2a726484dde6d9808a8d95b0e20161919c0b61879540c6538e87 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=01c40814bc8d\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 01c40814bc8d 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267445.5601773,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267445.5660787,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267445.5661025,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:37:37 ============== 01c40814bc8d2a726484dde6d9808a8d95b0e20161919c0b61879540c6538e87 : END LOGS ==============\n
\n
\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (938.858147ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (905.764726ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!Gi5M0CS1TBpcHaKgys:hs1/state/a.test.state.type/ => 200 OK (283.865276ms)\n
    rooms_state_test.go:100: SendEventSynced waiting for event ID $tPXGuFkTi6FVMXEB6E6ion60j0JiU7advEdQxCkZxDk\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.085992067s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (590.481362ms)\n
--- PASS: TestRoomCreationReportsEventsToMyself/parallel/Setting_room_topic_reports_m.room.topic_to_myself (2.27s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!oDGDwZeiOirOJ20WJR:hs1 => 200 OK (352.831354ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (529.190628ms)\n
    rooms_state_test.go:103: Both Event IDs from supposedly-idempotent state-setting differ, $mh8aaSAxdFZNbrHW9W66G0ys5CdyMb_6JuX18VpEVrA != $tPXGuFkTi6FVMXEB6E6ion60j0JiU7advEdQxCkZxDk\n
--- FAIL: TestRoomCreationReportsEventsToMyself/parallel/Setting_state_twice_is_idempotent (2.36s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (397.156507ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!oDGDwZeiOirOJ20WJR:hs1/state => 200 OK (56.775104ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!oDGDwZeiOirOJ20WJR:hs1 => 200 OK (5.939913ms)\n
2025/02/23 07:37:39 ============================================\n
\n
\n
2025/02/23 07:37:39 69ea206a4c11340101d66ea8e73144427ed0b5004391d1596809ca8be54f63a1 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=69ea206a4c11\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 69ea206a4c11 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267445.626764,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267445.634635,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267445.634669,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
  \u001b[2m2025-02-22T23:37:36.289549Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mCould not send request to host.docker.internal:41693 at https://host.docker.internal:41693/_matrix/federation/v1/send/U59HT6p57a-XOe1vADuXi3K23bjYimrw7R3n2ik13OE: error sending request for url (https://host.docker.internal:41693/_matrix/federation/v1/send/U59HT6p57a-XOe1vADuXi3K23bjYimrw7R3n2ik13OE)\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:96\n
\n
2025/02/23 07:37:39 ============== 69ea206a4c11340101d66ea8e73144427ed0b5004391d1596809ca8be54f63a1 : END LOGS ==============\n
\n
\n
--- FAIL: TestKnocking (34.38s)\n
null
null
=== RUN   TestKnockRoomsInPublicRoomsDirectory\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!oDGDwZeiOirOJ20WJR:hs1/state => 200 OK (38.57673ms)\n
--- PASS: TestRoomCreationReportsEventsToMyself/parallel/Joining_room_twice_is_idempotent (7.94s)\n
null
--- FAIL: TestRoomCreationReportsEventsToMyself/parallel (0.00s)\n
null
2025/02/23 07:37:45 ============================================\n
\n
\n
2025/02/23 07:37:45 460db02b8544d2ee0e7fc9d39b1630f47131e9871d65eb2a207d3c111e183dfe : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=460db02b8544\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 460db02b8544 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267450.9309356,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267450.937716,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267450.9377468,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 13\n
2025/02/23 07:37:45 ============== 460db02b8544d2ee0e7fc9d39b1630f47131e9871d65eb2a207d3c111e183dfe : END LOGS ==============\n
\n
\n
--- FAIL: TestRoomCreationReportsEventsToMyself (30.00s)\n
null
null
=== RUN   TestSyncLeaveSection\n
    sync_archive_test.go:16: WARNING: TestSyncLeaveSection called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    knocking_test.go:361: Deploy times: 11.626866ms blueprints, 20.686737631s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (830.369192ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.526743785s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!K0f0qRrpDvxInicpN6:hs1/state/m.room.join_rules/ => 200 OK (210.165297ms)\n
    knocking_test.go:375: SendEventSynced waiting for event ID $W_xb8CVh3hEgyLlX36W8IqwYgkB8A_Jsr9PWcQD6H8I\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (572.108571ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/list/room/!K0f0qRrpDvxInicpN6:hs1 => 200 OK (45.652494ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/publicRooms => 200 OK (56.05153ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (419.542273ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/directory/list/room/!XQFRJhniE4odYtiVng:hs1 => 200 OK (14.136087ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/publicRooms => 200 OK (90.803628ms)\n
    knocking_test.go:414: \u001b[31mMatchResponse 'join_rule' key for room in public room chunk is '', expected 'public' - http://127.0.0.1:33123/_matrix/client/v3/publicRooms => {"chunk":[{"num_joined_members":1,"room_id":"!K0f0qRrpDvxInicpN6:hs1","world_readable":false,"guest_can_join":true,"join_rule":"knock"},{"num_joined_members":1,"room_id":"!XQFRJhniE4odYtiVng:hs1","world_readable":false,"guest_can_join":false}],"total_room_count_estimate":2}\u001b[39m\n
2025/02/23 07:38:05 ============================================\n
\n
\n
2025/02/23 07:38:05 c25cf05153d7455d578377ea1931e1409a82306cec53bc12ffa7195a318940ea : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=c25cf05153d7\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux c25cf05153d7 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267476.8785343,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267476.885628,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267476.8856666,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
2025/02/23 07:38:05 ============== c25cf05153d7455d578377ea1931e1409a82306cec53bc12ffa7195a318940ea : END LOGS ==============\n
\n
\n
--- FAIL: TestKnockRoomsInPublicRoomsDirectory (26.29s)\n
null
null
=== RUN   TestCannotSendNonKnockViaSendKnock\n
    sync_archive_test.go:18: Deploy times: 10.627939ms blueprints, 21.453103036s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (835.052274ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 200 OK (34.585937ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (756.023956ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (143.983724ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (201.215835ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (148.31726ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!ToeObJhyEbu8gFIOl4:hs1/leave => 200 OK (97.935978ms)\n
null
=== RUN   TestSyncLeaveSection/Left_rooms_appear_in_the_leave_section_of_sync\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (34.355592ms)\n
--- PASS: TestSyncLeaveSection/Left_rooms_appear_in_the_leave_section_of_sync (0.03s)\n
null
null
=== RUN   TestSyncLeaveSection/Left_rooms_appear_in_the_leave_section_of_full_state_sync\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (59.39448ms)\n
--- PASS: TestSyncLeaveSection/Left_rooms_appear_in_the_leave_section_of_full_state_sync (0.06s)\n
null
null
=== RUN   TestSyncLeaveSection/Newly_left_rooms_appear_in_the_leave_section_of_incremental_sync\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (64.248846ms)\n
--- PASS: TestSyncLeaveSection/Newly_left_rooms_appear_in_the_leave_section_of_incremental_sync (0.06s)\n
null
2025/02/23 07:38:11 ============================================\n
\n
\n
2025/02/23 07:38:11 245b32a778a17a24d75ab922450a9a30b4ab2791c4a5cea9a7868b213a8f3fd8 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=245b32a778a1\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 245b32a778a1 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267483.8542078,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267483.8687809,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267483.8688102,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:38:11 ============== 245b32a778a17a24d75ab922450a9a30b4ab2791c4a5cea9a7868b213a8f3fd8 : END LOGS ==============\n
\n
\n
--- PASS: TestSyncLeaveSection (25.34s)\n
null
null
=== RUN   TestGappedSyncLeaveSection\n
    sync_archive_test.go:77: WARNING: TestGappedSyncLeaveSection called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    federation_room_join_test.go:395: Deploy times: 60.524705ms blueprints, 19.921830988s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (773.62241ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (599.006903ms)\n
    federation_room_join_test.go:409: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 49 52 52 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!fOMGNfpiVrffCRf0oc:hs1/$tC4kutrgxhA873f2EFQyI1j3ltwNuiJ6o8q1SDgGaIQ") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1144\u001b[39m\n
    sync_archive_test.go:79: Deploy times: 10.191084ms blueprints, 19.683033169s containers\n
2025/02/23 07:38:31 ============================================\n
\n
\n
2025/02/23 07:38:31 e686fb6ec4d9f30d27a04fc0031f52397604913d8ae1b9def3d6ef1b79d9b5b7 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=e686fb6ec4d9\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux e686fb6ec4d9 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267502.3941123,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267502.399219,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267502.3992405,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:38:31 ============== e686fb6ec4d9f30d27a04fc0031f52397604913d8ae1b9def3d6ef1b79d9b5b7 : END LOGS ==============\n
\n
\n
--- FAIL: TestCannotSendNonKnockViaSendKnock (25.31s)\n
null
null
=== RUN   TestMediaFilenames\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (690.573885ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 200 OK (20.364773ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (614.153416ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (578.977363ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (238.854049ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!iOrElDKLotuGSfzTTC:hs1/leave => 200 OK (93.868982ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/1 => 200 OK (86.370263ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $6hezdnXPJP3HISCjS7xOwqKwZBcTlg4cExuRqutBnDI\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (243.643608ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/2 => 200 OK (200.418291ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $YRuwWL8iXH59uyo4SYmA0tz0RFKT__BqhdryOW9zFaU\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (275.134986ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/3 => 200 OK (122.761068ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $ibrVbYCkFLBt8F7rYwdgrC7iQf6PBdueJIi9pjsUPuQ\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (230.403984ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/4 => 200 OK (206.121789ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $ZwK233YFpgngRKE9ftLovU8M-S2qYLMNypPGlCJKH8o\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (289.693178ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/5 => 200 OK (140.859974ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $r24Ewzb8KOylYqGeNwjZrTDTYg7MM_hTZP6tlRP2knQ\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (287.639079ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/6 => 200 OK (130.340187ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $eIrgZ268tQLLruHQ7svBMHous5Mhn0aLJ9tJY8S33r4\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (267.243099ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/7 => 200 OK (149.645251ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $2IJIeAy_srL78lcf_J31nxb-Sv43E_8iAahRwhnoe1I\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (236.933211ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/8 => 200 OK (108.833612ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $5YUNXflLtnr4ru7vBvSyTrsGN9Nb3w2kW970h-d58Bc\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (334.326165ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/9 => 200 OK (175.913523ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $Yb8TKG-7X0hdd_tU9KtT9VYysdgDlnJe8nH3iNJpzf0\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (309.899874ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/10 => 200 OK (117.1249ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $ik-f4EJnsMg5ElMXUNsd2vm0nPTT_lO-noCyoz0fRbk\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (537.54954ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/11 => 200 OK (159.862414ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $MqhI6-_s86ZXyEEHyoQfMVY6YuLwZ02gGepT2-NB0n4\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (359.617872ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/12 => 200 OK (102.141683ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $j7riY62X_9kC34vE27JikZdZaePNNHvyaNj0fANPGnA\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (439.08518ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/13 => 200 OK (224.172003ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $WiAfApnEdzMqNNxgbewdPQRMoXQY5aKu-0LUMJYm2Ow\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (404.055928ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/14 => 200 OK (193.030619ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $JToK9aLj5g4k6II29PPcA1CiZcIwbmZ1r0om0HUghKk\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (598.10983ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/15 => 200 OK (323.34774ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $KzTVHLTLgO907kiDYEtKEgkBSyA-jtgMR3a6PiBvvEs\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (556.487017ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/16 => 200 OK (171.711926ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $bBYitNho9wxPsme_jX-vcsNjaOnZdpdqqWiuxAkVc2w\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (891.284288ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/17 => 200 OK (220.522004ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $m1nA7uAjevYD9s8_Ak4ZhBCB-uzoBMUfwcxZjdDFwNM\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (795.718321ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/18 => 200 OK (192.488205ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $qv8zkofru9X_INSOqoYi09trp-doOweCoYRPqlpWKPw\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (602.543016ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/19 => 200 OK (146.177885ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $o007oFTxOVz0z2BckoIs1sbBMoBQwJ-2lTF6Waq4fbg\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (406.278842ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1kacB3ypOnOwEULrsl:hs1/send/m.room.message/20 => 200 OK (132.908186ms)\n
    sync_archive_test.go:104: SendEventSynced waiting for event ID $hlVw-gx_bfIr2bzBqMtldyH5R6ysUiUN1WI5Ed3iz8Y\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (562.756524ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (358.780259ms)\n
2025/02/23 07:38:47 ============================================\n
\n
\n
2025/02/23 07:38:47 216e1ff91366a263772945a77a9858c6dd4a632598bfd7d2eb8baa4d34c4b11e : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=216e1ff91366\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 216e1ff91366 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267507.810634,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267507.8164418,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267507.8164635,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 11\n
2025/02/23 07:38:47 ============== 216e1ff91366a263772945a77a9858c6dd4a632598bfd7d2eb8baa4d34c4b11e : END LOGS ==============\n
\n
\n
--- PASS: TestGappedSyncLeaveSection (36.04s)\n
null
null
=== RUN   TestArchivedRoomsHistory\n
    sync_archive_test.go:119: WARNING: TestArchivedRoomsHistory called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    media_filename_test.go:19: Deploy times: 13.815356ms blueprints, 26.802725182s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (680.038342ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (675.762103ms)\n
null
=== RUN   TestMediaFilenames/Parallel\n
null
=== RUN   TestMediaFilenames/Parallel/ASCII\n
=== PAUSE TestMediaFilenames/Parallel/ASCII\n
null
null
=== RUN   TestMediaFilenames/Parallel/Unicode\n
=== PAUSE TestMediaFilenames/Parallel/Unicode\n
null
null
=== CONT  TestMediaFilenames/Parallel/ASCII\n
null
=== RUN   TestMediaFilenames/Parallel/ASCII/Can_upload_with_ASCII_file_name\n
=== PAUSE TestMediaFilenames/Parallel/ASCII/Can_upload_with_ASCII_file_name\n
null
null
=== RUN   TestMediaFilenames/Parallel/ASCII/Can_download_file_'ascii'\n
    media_filename_test.go:45: WARNING: TestMediaFilenames/Parallel/ASCII/Can_download_file_'ascii' called runtime.SkipIf([synapse]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
=== PAUSE TestMediaFilenames/Parallel/ASCII/Can_download_file_'ascii'\n
null
null
=== RUN   TestMediaFilenames/Parallel/ASCII/Can_download_file_'ascii'_over_/_matrix/client/v1/media/download\n
=== PAUSE TestMediaFilenames/Parallel/ASCII/Can_download_file_'ascii'_over_/_matrix/client/v1/media/download\n
null
null
=== RUN   TestMediaFilenames/Parallel/ASCII/Can_download_file_'name_with_spaces'\n
    media_filename_test.go:45: WARNING: TestMediaFilenames/Parallel/ASCII/Can_download_file_'name_with_spaces' called runtime.SkipIf([synapse]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
=== PAUSE TestMediaFilenames/Parallel/ASCII/Can_download_file_'name_with_spaces'\n
null
null
=== RUN   TestMediaFilenames/Parallel/ASCII/Can_download_file_'name_with_spaces'_over_/_matrix/client/v1/media/download\n
=== PAUSE TestMediaFilenames/Parallel/ASCII/Can_download_file_'name_with_spaces'_over_/_matrix/client/v1/media/download\n
null
null
=== RUN   TestMediaFilenames/Parallel/ASCII/Can_download_file_'name;with;semicolons'\n
    media_filename_test.go:45: WARNING: TestMediaFilenames/Parallel/ASCII/Can_download_file_'name;with;semicolons' called runtime.SkipIf([synapse]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
=== PAUSE TestMediaFilenames/Parallel/ASCII/Can_download_file_'name;with;semicolons'\n
null
null
=== RUN   TestMediaFilenames/Parallel/ASCII/Can_download_file_'name;with;semicolons'_over_/_matrix/client/v1/media/download\n
=== PAUSE TestMediaFilenames/Parallel/ASCII/Can_download_file_'name;with;semicolons'_over_/_matrix/client/v1/media/download\n
null
null
=== RUN   TestMediaFilenames/Parallel/ASCII/Can_download_specifying_a_different_ASCII_file_name\n
    media_filename_test.go:75: WARNING: TestMediaFilenames/Parallel/ASCII/Can_download_specifying_a_different_ASCII_file_name called runtime.SkipIf([synapse]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
=== PAUSE TestMediaFilenames/Parallel/ASCII/Can_download_specifying_a_different_ASCII_file_name\n
null
null
=== RUN   TestMediaFilenames/Parallel/ASCII/Can_download_specifying_a_different_ASCII_file_name_over__matrix/client/v1/media/download\n
=== PAUSE TestMediaFilenames/Parallel/ASCII/Can_download_specifying_a_different_ASCII_file_name_over__matrix/client/v1/media/download\n
null
null
=== CONT  TestMediaFilenames/Parallel/ASCII/Can_upload_with_ASCII_file_name\n
null
=== CONT  TestMediaFilenames/Parallel/Unicode\n
null
=== RUN   TestMediaFilenames/Parallel/Unicode/Can_upload_with_Unicode_file_name\n
=== PAUSE TestMediaFilenames/Parallel/Unicode/Can_upload_with_Unicode_file_name\n
null
null
=== RUN   TestMediaFilenames/Parallel/Unicode/Can_download_specifying_a_different_Unicode_file_name\n
    media_filename_test.go:115: WARNING: TestMediaFilenames/Parallel/Unicode/Can_download_specifying_a_different_Unicode_file_name called runtime.SkipIf([synapse]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
=== PAUSE TestMediaFilenames/Parallel/Unicode/Can_download_specifying_a_different_Unicode_file_name\n
null
null
=== RUN   TestMediaFilenames/Parallel/Unicode/Can_download_specifying_a_different_Unicode_file_name_over__matrix/client/v1/media/download\n
=== PAUSE TestMediaFilenames/Parallel/Unicode/Can_download_specifying_a_different_Unicode_file_name_over__matrix/client/v1/media/download\n
null
null
=== RUN   TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_locally\n
    media_filename_test.go:146: WARNING: TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_locally called runtime.SkipIf([synapse]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
=== PAUSE TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_locally\n
null
null
=== RUN   TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_locally_over__matrix/client/v1/media/download\n
=== PAUSE TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_locally_over__matrix/client/v1/media/download\n
null
null
=== RUN   TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_over_federation\n
    media_filename_test.go:173: WARNING: TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_over_federation called runtime.SkipIf([synapse]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
=== PAUSE TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_over_federation\n
null
null
=== RUN   TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_over_federation_via__matrix/client/v1/media/download\n
=== PAUSE TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_over_federation_via__matrix/client/v1/media/download\n
null
null
=== RUN   TestMediaFilenames/Parallel/Unicode/Will_serve_safe_media_types_as_inline\n
    media_filename_test.go:203: Skipping test of Content-Disposition header requirements on non-conduwuit homeserver\n
--- SKIP: TestMediaFilenames/Parallel/Unicode/Will_serve_safe_media_types_as_inline (0.00s)\n
null
null
=== RUN   TestMediaFilenames/Parallel/Unicode/Will_serve_safe_media_types_as_inline_via__matrix/client/v1/media/download\n
    media_filename_test.go:221: Skipping test of Content-Disposition header requirements on non-Synapse and non-conduwuit homeserver\n
null
=== CONT  TestMediaFilenames/Parallel/ASCII/Can_download_file_'name_with_spaces'_over_/_matrix/client/v1/media/download\n
null
=== CONT  TestMediaFilenames/Parallel/ASCII/Can_download_specifying_a_different_ASCII_file_name_over__matrix/client/v1/media/download\n
--- SKIP: TestMediaFilenames/Parallel/Unicode/Will_serve_safe_media_types_as_inline_via__matrix/client/v1/media/download (0.00s)\n
null
null
=== RUN   TestMediaFilenames/Parallel/Unicode/Will_serve_safe_media_types_with_parameters_as_inline\n
    media_filename_test.go:240: Skipping test of Content-Disposition header requirements on non-conduwuit homeserver\n
--- SKIP: TestMediaFilenames/Parallel/Unicode/Will_serve_safe_media_types_with_parameters_as_inline (0.00s)\n
null
null
=== RUN   TestMediaFilenames/Parallel/Unicode/Will_serve_safe_media_types_with_parameters_as_inline_via__matrix/client/v1/media/download\n
    media_filename_test.go:259: Skipping test of Content-Disposition header requirements on non-Synapse and non-conduwuit homeserver\n
--- SKIP: TestMediaFilenames/Parallel/Unicode/Will_serve_safe_media_types_with_parameters_as_inline_via__matrix/client/v1/media/download (0.00s)\n
null
null
=== RUN   TestMediaFilenames/Parallel/Unicode/Will_serve_unsafe_media_types_as_attachments\n
    media_filename_test.go:279: Skipping test of Content-Disposition header requirements on non-conduwuit homeserver\n
--- SKIP: TestMediaFilenames/Parallel/Unicode/Will_serve_unsafe_media_types_as_attachments (0.00s)\n
null
null
=== RUN   TestMediaFilenames/Parallel/Unicode/Will_serve_unsafe_media_types_as_attachments_via__matrix/client/v1/media/download\n
    media_filename_test.go:297: Skipping test of Content-Disposition header requirements on non-Synapse and non-conduwuit homeserver\n
--- SKIP: TestMediaFilenames/Parallel/Unicode/Will_serve_unsafe_media_types_as_attachments_via__matrix/client/v1/media/download (0.00s)\n
null
null
=== CONT  TestMediaFilenames/Parallel/ASCII/Can_download_specifying_a_different_ASCII_file_name\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (17.117968ms)\n
--- PASS: TestMediaFilenames/Parallel/ASCII/Can_upload_with_ASCII_file_name (0.02s)\n
null
null
=== CONT  TestMediaFilenames/Parallel/ASCII/Can_download_file_'name;with;semicolons'_over_/_matrix/client/v1/media/download\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (30.893343ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (31.510858ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (19.640688ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/media/v3/download/hs1/ACQ5QEMREX3XSC77PEW3ZZBBAM/file.png => 200 OK (7.791649ms)\n
--- PASS: TestMediaFilenames/Parallel/ASCII/Can_download_specifying_a_different_ASCII_file_name (0.04s)\n
null
null
=== CONT  TestMediaFilenames/Parallel/ASCII/Can_download_file_'name;with;semicolons'\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (42.579068ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/media/download/hs1/71MR89JD3558VAA2PMJVK49790 => 200 OK (25.110726ms)\n
--- PASS: TestMediaFilenames/Parallel/ASCII/Can_download_file_'name_with_spaces'_over_/_matrix/client/v1/media/download (0.06s)\n
null
null
=== CONT  TestMediaFilenames/Parallel/ASCII/Can_download_file_'ascii'_over_/_matrix/client/v1/media/download\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/media/download/hs1/EFDCPQJJCS525C3BBCHPZB6D3M => 200 OK (24.170016ms)\n
--- PASS: TestMediaFilenames/Parallel/ASCII/Can_download_file_'name;with;semicolons'_over_/_matrix/client/v1/media/download (0.04s)\n
null
null
=== CONT  TestMediaFilenames/Parallel/ASCII/Can_download_file_'name_with_spaces'\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/media/download/hs1/TC6JZMKT1D7P30NR6C4RM12B48/file.png => 200 OK (27.990924ms)\n
--- PASS: TestMediaFilenames/Parallel/ASCII/Can_download_specifying_a_different_ASCII_file_name_over__matrix/client/v1/media/download (0.07s)\n
null
null
=== CONT  TestMediaFilenames/Parallel/ASCII/Can_download_file_'ascii'\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (31.142727ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/media/v3/download/hs1/N57BAZ490X2WS88Z5H1YB5J4F4 => 200 OK (8.004959ms)\n
--- PASS: TestMediaFilenames/Parallel/ASCII/Can_download_file_'name;with;semicolons' (0.04s)\n
null
null
=== CONT  TestMediaFilenames/Parallel/Unicode/Can_upload_with_Unicode_file_name\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (38.812743ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (37.727847ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (30.28362ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/media/v3/download/hs1/EMYWYKFXX95M1B7SHSXRY0DT2R => 200 OK (4.936309ms)\n
--- PASS: TestMediaFilenames/Parallel/ASCII/Can_download_file_'name_with_spaces' (0.04s)\n
null
null
=== CONT  TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_locally_over__matrix/client/v1/media/download\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (24.576146ms)\n
--- PASS: TestMediaFilenames/Parallel/Unicode/Can_upload_with_Unicode_file_name (0.02s)\n
null
null
=== CONT  TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_over_federation_via__matrix/client/v1/media/download\n
    client.go:706: [CSAPI] GET hs1/_matrix/media/v3/download/hs1/N1WFTNKN8969H3HEEPW0361WTG => 200 OK (5.008948ms)\n
--- PASS: TestMediaFilenames/Parallel/ASCII/Can_download_file_'ascii' (0.04s)\n
null
null
=== CONT  TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_over_federation\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/media/download/hs1/HP9GBBAMQ94F77RE7C2FC8V8NM => 200 OK (17.858166ms)\n
--- PASS: TestMediaFilenames/Parallel/ASCII/Can_download_file_'ascii'_over_/_matrix/client/v1/media/download (0.06s)\n
null
--- PASS: TestMediaFilenames/Parallel/ASCII (0.00s)\n
null
null
=== CONT  TestMediaFilenames/Parallel/Unicode/Can_download_specifying_a_different_Unicode_file_name_over__matrix/client/v1/media/download\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (27.589913ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (32.744588ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (35.646538ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (41.712229ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/media/download/hs1/B9RMG66HAD38Q7766Y5KJVCGAW => 200 OK (28.921649ms)\n
--- PASS: TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_locally_over__matrix/client/v1/media/download (0.06s)\n
null
null
=== CONT  TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_locally\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/media/download/hs1/4P478B7BHX2CF9CCHHMQQ7TBQR/☕ => 200 OK (11.363432ms)\n
--- PASS: TestMediaFilenames/Parallel/Unicode/Can_download_specifying_a_different_Unicode_file_name_over__matrix/client/v1/media/download (0.05s)\n
null
null
=== CONT  TestMediaFilenames/Parallel/Unicode/Can_download_specifying_a_different_Unicode_file_name\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (21.127096ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/media/v3/download/hs1/0Z9XFJJCF94CZ6SYESRVRB2XPM => 200 OK (9.105487ms)\n
--- PASS: TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_locally (0.03s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (40.859691ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/media/v3/download/hs1/2TKT0067C14E33NB8JXMDYRA0W/☕ => 200 OK (6.804009ms)\n
--- PASS: TestMediaFilenames/Parallel/Unicode/Can_download_specifying_a_different_Unicode_file_name (0.05s)\n
null
    client.go:706: [CSAPI] GET hs2/_matrix/media/v3/download/hs1/MSQQC8CAC96AH6HGAD4D2ZSXP0 => 200 OK (330.260534ms)\n
--- PASS: TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_over_federation (0.37s)\n
null
    client.go:706: [CSAPI] GET hs2/_matrix/client/v1/media/download/hs1/VAQ89PT1Y95TN14Y8847YACNX0 => 200 OK (347.902597ms)\n
--- PASS: TestMediaFilenames/Parallel/Unicode/Can_download_with_Unicode_file_name_over_federation_via__matrix/client/v1/media/download (0.38s)\n
null
--- PASS: TestMediaFilenames/Parallel/Unicode (0.00s)\n
null
--- PASS: TestMediaFilenames/Parallel (0.00s)\n
null
2025/02/23 07:39:01 ============================================\n
\n
\n
2025/02/23 07:39:01 36ca2ebb0e0834682318435cf59d54f95daea87c89c37d6436707dbaa9b588e6 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=36ca2ebb0e08\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 36ca2ebb0e08 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267534.3959696,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267534.4113886,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267534.4114585,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:39:01 ============== 36ca2ebb0e0834682318435cf59d54f95daea87c89c37d6436707dbaa9b588e6 : END LOGS ==============\n
\n
\n
2025/02/23 07:39:03 ============================================\n
\n
\n
2025/02/23 07:39:03 9f497769d9ec1c3e17124f7115205175d805ba6028817c0658eb664a4d6bba28 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=9f497769d9ec\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 9f497769d9ec 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267534.2428205,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267534.2501345,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267534.2501757,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:39:03 ============== 9f497769d9ec1c3e17124f7115205175d805ba6028817c0658eb664a4d6bba28 : END LOGS ==============\n
\n
\n
--- PASS: TestMediaFilenames (32.72s)\n
null
null
=== RUN   TestMediaWithoutFileName\n
    media_nofilename_test.go:19: WARNING: TestMediaWithoutFileName called runtime.SkipIf([synapse]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    sync_archive_test.go:121: Deploy times: 9.225377ms blueprints, 20.724812294s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (768.969687ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (678.071147ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-2:hs1/filter => 200 OK (12.382548ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (561.080828ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!tRdbsgfJhCKtJSVKxA:hs1 => 200 OK (148.612596ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (154.638088ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (130.185617ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!tRdbsgfJhCKtJSVKxA:hs1/send/m.room.message/1 => 200 OK (106.332424ms)\n
    sync_archive_test.go:158: SendEventSynced waiting for event ID $VIpYYYbhoFVBosA45qhBkBCuY77aXGxjsce48YIgSsE\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (164.843363ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!tRdbsgfJhCKtJSVKxA:hs1/state/a.madeup.test.state/ => 200 OK (112.512008ms)\n
    sync_archive_test.go:166: SendEventSynced waiting for event ID $yrUD_U1GjWMJMVnJRyGD6BA45vDEPfayIFn11TNWkaA\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (392.265521ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!tRdbsgfJhCKtJSVKxA:hs1/leave => 200 OK (192.972574ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (228.222047ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!tRdbsgfJhCKtJSVKxA:hs1/send/m.room.message/3 => 200 OK (149.931743ms)\n
    sync_archive_test.go:177: SendEventSynced waiting for event ID $FaQPb4_ugjX_PrbPlpDd1R6hahYlKXz9slaBCO-rH9w\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (205.64013ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!tRdbsgfJhCKtJSVKxA:hs1/state/a.madeup.test.state/ => 200 OK (103.526398ms)\n
    sync_archive_test.go:185: SendEventSynced waiting for event ID $v_eM9flaLlXwF7viOFNAqzxTVCH8ci49nBYp7uGpRss\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (225.091535ms)\n
null
=== RUN   TestArchivedRoomsHistory/timeline_has_events\n
null
=== RUN   TestArchivedRoomsHistory/timeline_has_events/initial_sync\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (144.286551ms)\n
    sync_archive_test.go:205: expected no state events in syncRes\n
--- FAIL: TestArchivedRoomsHistory/timeline_has_events/initial_sync (0.14s)\n
null
null
=== RUN   TestArchivedRoomsHistory/timeline_has_events/incremental_sync\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (152.31817ms)\n
    sync_archive_test.go:205: expected no state events in sinceSyncRes\n
--- FAIL: TestArchivedRoomsHistory/timeline_has_events/incremental_sync (0.15s)\n
null
--- FAIL: TestArchivedRoomsHistory/timeline_has_events (0.30s)\n
null
null
=== RUN   TestArchivedRoomsHistory/timeline_is_empty\n
null
=== RUN   TestArchivedRoomsHistory/timeline_is_empty/initial_sync\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (166.493487ms)\n
    sync_archive_test.go:243: Sync result: {"timeline":{"prev_batch":"0","events":[{"content":{"displayname":"user-2 ⚡️","membership":"leave"},"event_id":"$KTZvBvUE3gE5scf8omRsO0MXLheDR5K-88wB2XuTiXI","origin_server_ts":1740267551589,"sender":"@user-2:hs1","state_key":"@user-2:hs1","type":"m.room.member","unsigned":{"prev_content":{"displayname":"user-2 ⚡️","membership":"join"},"prev_sender":"@user-2:hs1"}}]},"state":{"events":[{"content":{"ban":50,"events":{},"events_default":0,"invite":0,"kick":50,"notifications":{"room":50},"redact":50,"state_default":50,"users":{"@user-1:hs1":100},"users_default":0},"event_id":"$ykvsdmgQObcPXmsj8JDC3-p4YMRXjs9qYmNRiFM87kY","origin_server_ts":1740267549993,"sender":"@user-1:hs1","state_key":"","type":"m.room.power_levels","unsigned":{}},{"content":{"displayname":"user-1 ⚡️","is_direct":false,"membership":"join"},"event_id":"$tr_3JjEWG0TYWq09-w2ieFdUZrwZr5hCIahlPBDy8W4","origin_server_ts":1740267549859,"sender":"@user-1:hs1","state_key":"@user-1:hs1","type":"m.r
oom.member","unsigned":{}},{"content":{"displayname":"user-2 ⚡️","membership":"leave"},"event_id":"$KTZvBvUE3gE5scf8omRsO0MXLheDR5K-88wB2XuTiXI","origin_server_ts":1740267551589,"sender":"@user-2:hs1","state_key":"@user-2:hs1","type":"m.room.member","unsigned":{"prev_content":{"displayname":"user-2 ⚡️","membership":"join"},"prev_sender":"@user-2:hs1"}},{"content":{"creator":"@user-1:hs1","room_version":"10"},"event_id":"$jL9-zoZoumY3tPtlw3I1AOK3l9g9sTVjbly3rbLCPZ8","origin_server_ts":1740267549765,"sender":"@user-1:hs1","state_key":"","type":"m.room.create","unsigned":{}},{"content":{"my_key":"before"},"event_id":"$yrUD_U1GjWMJMVnJRyGD6BA45vDEPfayIFn11TNWkaA","origin_server_ts":1740267551065,"sender":"@user-1:hs1","state_key":"","type":"a.madeup.test.state","unsigned":{}},{"content":{"history_visibility":"shared"},"event_id":"$sN1wy6NuP2RnoLwTvnT0T2Jf2mOt2yeKh7pvgNtjDo0","origin_server_ts":1740267550152,"sender":"@user-1:hs1","state_key":"","type":"m.room.history_visibility","unsigned":{}},{"content":
{"guest_access":"forbidden"},"event_id":"$92SimwTPQrNNnvnq4mHKqVPyB6S533QE2lqx_jol5hE","origin_server_ts":1740267550259,"sender":"@user-1:hs1","state_key":"","type":"m.room.guest_access","unsigned":{}},{"content":{"join_rule":"public"},"event_id":"$28ua8xYMv_o54xR1kwCmnbg6WpuhR7OuOWgG1RYTuzE","origin_server_ts":1740267550073,"sender":"@user-1:hs1","state_key":"","type":"m.room.join_rules","unsigned":{}}]}}\n
    sync_archive_test.go:251: Expected no timeline events\n
--- FAIL: TestArchivedRoomsHistory/timeline_is_empty/initial_sync (0.17s)\n
null
null
=== RUN   TestArchivedRoomsHistory/timeline_is_empty/incremental_sync\n
    sync_archive_test.go:293: Synapse doesn't return the room at all!\n
--- SKIP: TestArchivedRoomsHistory/timeline_is_empty/incremental_sync (0.00s)\n
null
--- FAIL: TestArchivedRoomsHistory/timeline_is_empty (0.17s)\n
null
2025/02/23 07:39:14 ============================================\n
\n
\n
2025/02/23 07:39:14 aae39812a3bc6770e11d0f31c3746bf6fe178e903853c74b8c1ed37ffe1ca0b1 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=aae39812a3bc\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux aae39812a3bc 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267544.45993,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267544.4905677,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267544.4905975,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 9\n
2025/02/23 07:39:14 ============== aae39812a3bc6770e11d0f31c3746bf6fe178e903853c74b8c1ed37ffe1ca0b1 : END LOGS ==============\n
\n
\n
--- FAIL: TestArchivedRoomsHistory (27.36s)\n
null
null
=== RUN   TestOlderLeftRoomsNotInLeaveSection\n
    sync_archive_test.go:304: WARNING: TestOlderLeftRoomsNotInLeaveSection called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    media_nofilename_test.go:21: Deploy times: 39.221987ms blueprints, 21.579215689s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (847.449492ms)\n
null
=== RUN   TestMediaWithoutFileName/parallel\n
null
=== RUN   TestMediaWithoutFileName/parallel/Can_upload_without_a_file_name\n
=== PAUSE TestMediaWithoutFileName/parallel/Can_upload_without_a_file_name\n
null
null
=== RUN   TestMediaWithoutFileName/parallel/Can_download_without_a_file_name_locally\n
=== PAUSE TestMediaWithoutFileName/parallel/Can_download_without_a_file_name_locally\n
null
null
=== RUN   TestMediaWithoutFileName/parallel/Can_download_without_a_file_name_over_federation\n
=== PAUSE TestMediaWithoutFileName/parallel/Can_download_without_a_file_name_over_federation\n
null
null
=== CONT  TestMediaWithoutFileName/parallel/Can_upload_without_a_file_name\n
null
=== CONT  TestMediaWithoutFileName/parallel/Can_download_without_a_file_name_over_federation\n
null
=== CONT  TestMediaWithoutFileName/parallel/Can_download_without_a_file_name_locally\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (15.079873ms)\n
--- PASS: TestMediaWithoutFileName/parallel/Can_upload_without_a_file_name (0.02s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (29.786484ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/media/v3/download/hs1/ZA79M25BKH06D847G49Q08KGTW => 200 OK (4.630209ms)\n
--- PASS: TestMediaWithoutFileName/parallel/Can_download_without_a_file_name_locally (0.08s)\n
null
    server.go:116: \u001b[31mServer.UnexpectedRequestsAreErrors=true received unexpected request to server: GET /_matrix/client/v1/media/download/host.docker.internal:44843/PlainTextFile\n
        \u001b[39m\n
    client.go:706: [CSAPI] GET hs1/_matrix/media/v3/download/host.docker.internal:44843/PlainTextFile => 400 Bad Request (84.223056ms)\n
    media_nofilename_test.go:83: \u001b[31mCSAPI.MustDo GET http://127.0.0.1:33137/_matrix/media/v3/download/host.docker.internal:44843/PlainTextFile returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Answer from host.docker.internal:44843: complement: federation server is not listening for this path"}\u001b[39m\n
--- FAIL: TestMediaWithoutFileName/parallel/Can_download_without_a_file_name_over_federation (0.08s)\n
null
--- FAIL: TestMediaWithoutFileName/parallel (0.00s)\n
null
2025/02/23 07:39:33 ============================================\n
\n
\n
2025/02/23 07:39:33 b68776687dd485d3348c4d092dd6d8917c48594df64a704bfaba879b904afab7 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=b68776687dd4\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux b68776687dd4 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267561.9670763,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267561.975521,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267561.975552,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
  \u001b[2m2025-02-22T23:39:31.630273Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://host.docker.internal:44843/_matrix/client/v1/media/download/host.docker.internal:44843/PlainTextFile?allow_remote=false&allow_redirect=false 404 Not Found: complement: federation server is not listening for this path\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
2025/02/23 07:39:33 ============== b68776687dd485d3348c4d092dd6d8917c48594df64a704bfaba879b904afab7 : END LOGS ==============\n
\n
\n
--- FAIL: TestMediaWithoutFileName (29.42s)\n
null
null
=== RUN   TestMediaWithoutFileNameCSMediaV1\n
    sync_archive_test.go:306: Deploy times: 29.66337ms blueprints, 20.712032244s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (631.455153ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (699.060002ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 200 OK (15.067135ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (754.176964ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (639.479821ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!sAiBPieqoSkWXUykhV:hs1 => 200 OK (237.366395ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!mePJrkhZpC7iIlwlJk:hs1 => 200 OK (204.720824ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (293.756485ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (347.72783ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!sAiBPieqoSkWXUykhV:hs1/leave => 200 OK (138.714992ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (58.624408ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!sAiBPieqoSkWXUykhV:hs1/state/m.room.member/@user-2:hs1 => 200 OK (144.765089ms)\n
    sync_archive_test.go:343: SendEventSynced waiting for event ID $ffzyzmjIjHziXXB7SqHNKw1irIrlqFgc5EC0qJuha6U\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (437.958022ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/2 => 200 OK (112.395043ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $A48kC1ugjT0ocBhCvF4iep_TBlmOGNMWRG5eNDPhCwg\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (297.700877ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/3 => 200 OK (94.840541ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $IMnEie4_rqzQI361jxOOmp0TjrGqzNUy33HHUk6GhK4\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (349.095349ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/4 => 200 OK (133.991322ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $s2Qh3ZDxNyXKlfRMeklS-qacZEqfj5zgrVQhICHDCgM\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (489.160396ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/5 => 200 OK (177.833245ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $LU0BebOhXAtH4pRLx1wvVYATHGhPfcV2sCNaXbDooMM\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (613.849216ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/6 => 200 OK (188.614854ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $YE4rcB9vPqP5XL-4CtqSWgMhmHLoI4O9t_vDfHVi7WY\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (631.251278ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/7 => 200 OK (144.451882ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $XGbHjXQ1FCu5NUNtk2emqqaMxj3Xgc2d48N7WVnxWe4\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (837.937549ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/8 => 200 OK (201.023163ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $BIZLrskf6tMfc44QoLNBcfxLuEhVsOrgkS9tgKm1pdM\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (552.306453ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/9 => 200 OK (202.034128ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $qwAdKeaN8jahICbyp3pFua0recCqIEjl2SR0nnAqsgs\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (521.856744ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/10 => 200 OK (162.275086ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $tQvlTZ1LnuptCOflpEkr0CUOphzCK6esfiEsnVyuYfI\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (623.761903ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/11 => 200 OK (140.997324ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $0DOIfYeXFLzZZFkJrREaIApoxECO4Cb2LATX75_q2bo\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (436.50939ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/12 => 200 OK (195.667205ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $5JPQufJjNpY_7ByU3RjeP4fDxZr1cSlacCK9bdk5Us8\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (671.981469ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/13 => 200 OK (181.638059ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $NApqU-jvxqtILe7auR8wn7NBcMTT4dhHCf45oE9hZi4\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (600.210935ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/14 => 200 OK (104.2132ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $-xHQAp7kazRldys12CQHaOzwfHV2ZpA0Fpvc-IadDbM\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (485.760121ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/15 => 200 OK (104.670747ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $_BNS6HnAexdiK3tuGCo46VBYLFNaRVq6-3kxZ6SswLU\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (447.491972ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/16 => 200 OK (174.991366ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $KLywzC4LYNtzEURhfnPYXujW5AH1Jnbr_VAXefYpcms\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (587.206604ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/17 => 200 OK (178.808566ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $MxV6EzYPB0F7XXZlk62hdm8MO8TceVaJXKirfNof5nw\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (714.364545ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/18 => 200 OK (116.703792ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $n7J-WdlECobOhrhut3-Q4DzcR_ts38IPLymWNdcZKwY\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (711.312541ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/19 => 200 OK (187.855158ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $rmz2ZbH0swB0VAFnFwT6vW4jmtHMG2jCoXdatdj_kuM\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (808.321412ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/20 => 200 OK (168.940186ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $A2Wt9kMVh23bPuoRAsEhMNcdL_yB77HlrVnGMwRRpT0\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (614.49019ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!mePJrkhZpC7iIlwlJk:hs1/send/m.room.message/21 => 200 OK (130.623605ms)\n
    sync_archive_test.go:355: SendEventSynced waiting for event ID $MlEyfDAymwidPpJiv_RCZqmxHvhgiutriuRHSZRBWeM\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (462.069022ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (481.325555ms)\n
2025/02/23 07:39:56 ============================================\n
\n
\n
2025/02/23 07:39:56 2b2da1acd9c5d7abae15fe3d417dde32df8e9532a063f4c4c6b0e1586257d752 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=2b2da1acd9c5\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 2b2da1acd9c5 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267571.7663603,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267571.7750297,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267571.7750585,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 11\n
2025/02/23 07:39:56 ============== 2b2da1acd9c5d7abae15fe3d417dde32df8e9532a063f4c4c6b0e1586257d752 : END LOGS ==============\n
\n
\n
--- PASS: TestOlderLeftRoomsNotInLeaveSection (41.95s)\n
null
null
=== RUN   TestLeaveEventVisibility\n
    sync_archive_test.go:382: WARNING: TestLeaveEventVisibility called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    media_nofilename_test.go:106: Deploy times: 10.957874ms blueprints, 26.779457643s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (963.406374ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (1.501639047s)\n
null
=== RUN   TestMediaWithoutFileNameCSMediaV1/parallel\n
null
=== RUN   TestMediaWithoutFileNameCSMediaV1/parallel/Can_upload_without_a_file_name\n
=== PAUSE TestMediaWithoutFileNameCSMediaV1/parallel/Can_upload_without_a_file_name\n
null
null
=== RUN   TestMediaWithoutFileNameCSMediaV1/parallel/Can_download_without_a_file_name_locally\n
=== PAUSE TestMediaWithoutFileNameCSMediaV1/parallel/Can_download_without_a_file_name_locally\n
null
null
=== RUN   TestMediaWithoutFileNameCSMediaV1/parallel/Can_download_without_a_file_name_over_federation\n
=== PAUSE TestMediaWithoutFileNameCSMediaV1/parallel/Can_download_without_a_file_name_over_federation\n
null
null
=== CONT  TestMediaWithoutFileNameCSMediaV1/parallel/Can_upload_without_a_file_name\n
null
=== CONT  TestMediaWithoutFileNameCSMediaV1/parallel/Can_download_without_a_file_name_over_federation\n
null
=== CONT  TestMediaWithoutFileNameCSMediaV1/parallel/Can_download_without_a_file_name_locally\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (269.755715ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (282.102551ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/media/v3/upload => 200 OK (300.031083ms)\n
--- PASS: TestMediaWithoutFileNameCSMediaV1/parallel/Can_upload_without_a_file_name (0.30s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/media/download/hs1/D663CEBGKN1BH0B015Q0APV5D0 => 200 OK (81.048982ms)\n
--- PASS: TestMediaWithoutFileNameCSMediaV1/parallel/Can_download_without_a_file_name_locally (0.40s)\n
null
    client.go:706: [CSAPI] GET hs2/_matrix/client/v1/media/download/hs1/CZZMQZFAP56QX2B6GGG7M0PAER => 200 OK (1.326761842s)\n
--- PASS: TestMediaWithoutFileNameCSMediaV1/parallel/Can_download_without_a_file_name_over_federation (1.60s)\n
null
--- PASS: TestMediaWithoutFileNameCSMediaV1/parallel (0.00s)\n
null
2025/02/23 07:40:06 ============================================\n
\n
\n
2025/02/23 07:40:06 eed66769412ed55e98b8933e5850159fc91e0481a7e44d020cf1e9951f4ed9b3 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=eed66769412e\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux eed66769412e 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267596.617447,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267596.6236205,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267596.6236734,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:40:06 ============== eed66769412ed55e98b8933e5850159fc91e0481a7e44d020cf1e9951f4ed9b3 : END LOGS ==============\n
\n
\n
2025/02/23 07:40:09 ============================================\n
\n
\n
2025/02/23 07:40:09 2e0e814180316f25cf3542f19ead18b28ed0724a6e2108ac8d0c3206b2049956 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=2e0e81418031\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 2e0e81418031 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267596.5182068,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267596.5329344,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267596.5335138,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:40:09 ============== 2e0e814180316f25cf3542f19ead18b28ed0724a6e2108ac8d0c3206b2049956 : END LOGS ==============\n
\n
\n
--- PASS: TestMediaWithoutFileNameCSMediaV1 (36.07s)\n
null
null
=== RUN   TestLocalPngThumbnail\n
2025/02/23 07:40:27 ============================================\n
\n
\n
2025/02/23 07:40:27 csapi.1_servers.hs1 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=9256a4e5369f\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
2025/02/23 07:40:27 ============== csapi.1_servers.hs1 : END LOGS ==============\n
\n
\n
2025/02/23 07:40:27 ============== While deploying complement_csapi_78_csapi.1_servers.hs1_1 : START ALL COMPLEMENT DOCKER PORT BINDINGS ==============\n
2025/02/23 07:40:27 Container: f3e3c088ce0a8df7830796cccb8804485e724a6be7f4976e623b4be331f78175: [/complement_fed_54_fed.1_servers.hs1_1]\n
2025/02/23 07:40:27     (host) -> (container)\n
2025/02/23 07:40:27     127.0.0.1:33147 -> 8008/tcp\n
2025/02/23 07:40:27     127.0.0.1:33148 -> 8448/tcp\n
2025/02/23 07:40:27 Container: 9256a4e5369f43849ec092402cf44f0b36ebd458cedcef8648609a8a8dcef171: [/complement_csapi_78_csapi.1_servers.hs1_1]\n
2025/02/23 07:40:27     (host) -> (container)\n
2025/02/23 07:40:27     127.0.0.1:33145 -> 8008/tcp\n
2025/02/23 07:40:27     127.0.0.1:33146 -> 8448/tcp\n
2025/02/23 07:40:27 Container: 8f5cc968b7b11456ce6c3bc46d22af38a10c22bf4c39989d4dc8b94389042ab9: [/complement_fed.hs_with_application_service.hs2]\n
2025/02/23 07:40:27     (host) -> (container)\n
2025/02/23 07:40:27 Container: 457b2602f4ecd40565226f12ef552c0f8c8aa74f985545923fd8f61b3bb8876d: [/complement_fed.hs_with_application_service.hs1]\n
2025/02/23 07:40:27     (host) -> (container)\n
2025/02/23 07:40:27 Container: 1dbc82506f8b6c347140e464eb229ea2276bb61d8e36474f6a3e73414422269f: [/complement_csapi.2_servers.hs2]\n
2025/02/23 07:40:27     (host) -> (container)\n
2025/02/23 07:40:27 Container: fc0d7abe083e0ff1e87dbd0431bb9ee54092d429d2d45ccc837c5e57030556dc: [/complement_csapi.2_servers.hs1]\n
2025/02/23 07:40:27     (host) -> (container)\n
2025/02/23 07:40:27 Container: 03e855d8b56e542d3b9388513d3091081cbdfd6454de54c9a5dfb38c36969933: [/complement_fed.2_servers.hs2]\n
2025/02/23 07:40:27     (host) -> (container)\n
2025/02/23 07:40:27 Container: 3e196ce98f6d96b9161e12256a117faa6a7d588301e6e20f3efbdece097728e3: [/complement_fed.2_servers.hs1]\n
2025/02/23 07:40:27     (host) -> (container)\n
2025/02/23 07:40:27 Container: 47b3d5eeeeed234a4f4ffa7f74a9c9c705bae1aedd721747f354b42f936b625f: [/complement_fed.3_servers.hs3]\n
2025/02/23 07:40:27     (host) -> (container)\n
2025/02/23 07:40:27 Container: 949c2a09607571caf4c8412e5c666a3fc44c45d1bc263cfd751eebffbf81e389: [/complement_fed.3_servers.hs2]\n
2025/02/23 07:40:27     (host) -> (container)\n
2025/02/23 07:40:27 Container: 3ef6f9294cd7c90643b01a93347a4bc7946a8b1130db336bb1e6bcc7842c5fe9: [/complement_fed.3_servers.hs1]\n
2025/02/23 07:40:27     (host) -> (container)\n
2025/02/23 07:40:27 Container: 0ad13e17fbfcc7ab04525caeb127eed438a405e9230ae2b177ffe73017823b6f: [/complement_fed.1_servers.hs1]\n
2025/02/23 07:40:27     (host) -> (container)\n
2025/02/23 07:40:27 Container: 4c2d7803dd9fc6ce3390f6e9cf322905cfc8e11f58e38387ff37241f2244e390: [/complement_csapi.1_servers.hs1]\n
2025/02/23 07:40:27     (host) -> (container)\n
2025/02/23 07:40:27 =============== While deploying complement_csapi_78_csapi.1_servers.hs1_1 : END ALL COMPLEMENT DOCKER PORT BINDINGS ===============\n
\n
\n
    sync_archive_test.go:388: \u001b[31mDeploy: Deploy returned error Deploy: Failed to deploy image {Containers:-1 Created:1740265731 ID:sha256:2eaa4d4b0935d10eda6f5c1a30404544de457f02557ee322f6aef94e773de293 Labels:map[complement_blueprint:1_servers complement_context:csapi.1_servers.hs1 complement_hs_name:hs1 complement_pkg:csapi org.opencontainers.image.source:https://github.com/rust-lang/docker-rust] ParentID:sha256:43423fed373499994daef88954f4eec573152502bf76e064a0ec7133928dbc93 RepoDigests:[] RepoTags:[localhost/complement:csapi.1_servers.hs1] SharedSize:-1 Size:2980705912 VirtualSize:0} : csapi.1_servers.hs1: failed to check server is up. timed out checking for homeserver to be up: GET http://127.0.0.1:33145/_matrix/client/versions => error: Get "http://127.0.0.1:33145/_matrix/client/versions": read tcp 127.0.0.1:49678->127.0.0.1:33145: read: connection reset by peer\u001b[39m\n
--- FAIL: TestLeaveEventVisibility (30.72s)\n
null
null
=== RUN   TestLeaveEventInviteRejection\n
    sync_archive_test.go:469: WARNING: TestLeaveEventInviteRejection called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
2025/02/23 07:40:40 ============================================\n
\n
\n
2025/02/23 07:40:40 fed.1_servers.hs1 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=f3e3c088ce0a\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux f3e3c088ce0a 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267639.8423476,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267639.8470724,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267639.8473458,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:40:40 ============== fed.1_servers.hs1 : END LOGS ==============\n
\n
\n
2025/02/23 07:40:40 ============== While deploying complement_fed_54_fed.1_servers.hs1_1 : START ALL COMPLEMENT DOCKER PORT BINDINGS ==============\n
2025/02/23 07:40:40 Container: e0650fcdabed75fb20691e001bff7365e02f8534e05c5c295e5f69d2572bdce5: [/complement_csapi_79_csapi.1_servers.hs1_1]\n
2025/02/23 07:40:40     (host) -> (container)\n
2025/02/23 07:40:40     127.0.0.1:33149 -> 8008/tcp\n
2025/02/23 07:40:40     127.0.0.1:33150 -> 8448/tcp\n
2025/02/23 07:40:40 Container: f3e3c088ce0a8df7830796cccb8804485e724a6be7f4976e623b4be331f78175: [/complement_fed_54_fed.1_servers.hs1_1]\n
2025/02/23 07:40:40     (host) -> (container)\n
2025/02/23 07:40:40     127.0.0.1:33147 -> 8008/tcp\n
2025/02/23 07:40:40     127.0.0.1:33148 -> 8448/tcp\n
2025/02/23 07:40:40 Container: 9256a4e5369f43849ec092402cf44f0b36ebd458cedcef8648609a8a8dcef171: [/complement_csapi_78_csapi.1_servers.hs1_1]\n
2025/02/23 07:40:40     (host) -> (container)\n
2025/02/23 07:40:40     127.0.0.1:33145 -> 8008/tcp\n
2025/02/23 07:40:40     127.0.0.1:33146 -> 8448/tcp\n
2025/02/23 07:40:40 Container: 8f5cc968b7b11456ce6c3bc46d22af38a10c22bf4c39989d4dc8b94389042ab9: [/complement_fed.hs_with_application_service.hs2]\n
2025/02/23 07:40:40     (host) -> (container)\n
2025/02/23 07:40:40 Container: 457b2602f4ecd40565226f12ef552c0f8c8aa74f985545923fd8f61b3bb8876d: [/complement_fed.hs_with_application_service.hs1]\n
2025/02/23 07:40:40     (host) -> (container)\n
2025/02/23 07:40:40 Container: 1dbc82506f8b6c347140e464eb229ea2276bb61d8e36474f6a3e73414422269f: [/complement_csapi.2_servers.hs2]\n
2025/02/23 07:40:40     (host) -> (container)\n
2025/02/23 07:40:40 Container: fc0d7abe083e0ff1e87dbd0431bb9ee54092d429d2d45ccc837c5e57030556dc: [/complement_csapi.2_servers.hs1]\n
2025/02/23 07:40:40     (host) -> (container)\n
2025/02/23 07:40:40 Container: 03e855d8b56e542d3b9388513d3091081cbdfd6454de54c9a5dfb38c36969933: [/complement_fed.2_servers.hs2]\n
2025/02/23 07:40:40     (host) -> (container)\n
2025/02/23 07:40:40 Container: 3e196ce98f6d96b9161e12256a117faa6a7d588301e6e20f3efbdece097728e3: [/complement_fed.2_servers.hs1]\n
2025/02/23 07:40:40     (host) -> (container)\n
2025/02/23 07:40:40 Container: 47b3d5eeeeed234a4f4ffa7f74a9c9c705bae1aedd721747f354b42f936b625f: [/complement_fed.3_servers.hs3]\n
2025/02/23 07:40:40     (host) -> (container)\n
2025/02/23 07:40:40 Container: 949c2a09607571caf4c8412e5c666a3fc44c45d1bc263cfd751eebffbf81e389: [/complement_fed.3_servers.hs2]\n
2025/02/23 07:40:40     (host) -> (container)\n
2025/02/23 07:40:40 Container: 3ef6f9294cd7c90643b01a93347a4bc7946a8b1130db336bb1e6bcc7842c5fe9: [/complement_fed.3_servers.hs1]\n
2025/02/23 07:40:41     (host) -> (container)\n
2025/02/23 07:40:41 Container: 0ad13e17fbfcc7ab04525caeb127eed438a405e9230ae2b177ffe73017823b6f: [/complement_fed.1_servers.hs1]\n
2025/02/23 07:40:41     (host) -> (container)\n
2025/02/23 07:40:41 Container: 4c2d7803dd9fc6ce3390f6e9cf322905cfc8e11f58e38387ff37241f2244e390: [/complement_csapi.1_servers.hs1]\n
2025/02/23 07:40:41     (host) -> (container)\n
2025/02/23 07:40:41 =============== While deploying complement_fed_54_fed.1_servers.hs1_1 : END ALL COMPLEMENT DOCKER PORT BINDINGS ===============\n
\n
\n
    media_thumbnail_test.go:29: \u001b[31mDeploy: Deploy returned error Deploy: Failed to deploy image {Containers:-1 Created:1740265732 ID:sha256:143be3930fbb1b303d7696b88bc8669bf513fcd5b0b735b69fbeaeb5d6dc6215 Labels:map[complement_blueprint:1_servers complement_context:fed.1_servers.hs1 complement_hs_name:hs1 complement_pkg:fed org.opencontainers.image.source:https://github.com/rust-lang/docker-rust] ParentID:sha256:43423fed373499994daef88954f4eec573152502bf76e064a0ec7133928dbc93 RepoDigests:[] RepoTags:[localhost/complement:fed.1_servers.hs1] SharedSize:-1 Size:2980600302 VirtualSize:0} : fed.1_servers.hs1: failed to check server is up. timed out checking for homeserver to be up: GET http://127.0.0.1:33147/_matrix/client/versions => error: Get "http://127.0.0.1:33147/_matrix/client/versions": read tcp 127.0.0.1:52800->127.0.0.1:33147: read: connection reset by peer\u001b[39m\n
--- FAIL: TestLocalPngThumbnail (31.47s)\n
null
null
=== RUN   TestRemotePngThumbnail\n
2025/02/23 07:40:58 ============================================\n
\n
\n
2025/02/23 07:40:58 csapi.1_servers.hs1 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=e0650fcdabed\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux e0650fcdabed 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267657.6782799,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267657.6840174,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267657.6841452,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:40:58 ============== csapi.1_servers.hs1 : END LOGS ==============\n
\n
\n
2025/02/23 07:40:58 ============== While deploying complement_csapi_79_csapi.1_servers.hs1_1 : START ALL COMPLEMENT DOCKER PORT BINDINGS ==============\n
2025/02/23 07:40:58 Container: 7a466f5fa45ea54935b9453592b832331ece1c7e168e368bd4481a1c7f858d3a: [/complement_fed_55_fed.2_servers.hs2_2]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58     127.0.0.1:33153 -> 8008/tcp\n
2025/02/23 07:40:58     127.0.0.1:33154 -> 8448/tcp\n
2025/02/23 07:40:58 Container: 2885acfeddf9aef94a40588b85c26c9d1052f32dd96d906aed1376935500953b: [/complement_fed_55_fed.2_servers.hs1_1]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58     127.0.0.1:33151 -> 8008/tcp\n
2025/02/23 07:40:58     127.0.0.1:33152 -> 8448/tcp\n
2025/02/23 07:40:58 Container: e0650fcdabed75fb20691e001bff7365e02f8534e05c5c295e5f69d2572bdce5: [/complement_csapi_79_csapi.1_servers.hs1_1]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58     127.0.0.1:33149 -> 8008/tcp\n
2025/02/23 07:40:58     127.0.0.1:33150 -> 8448/tcp\n
2025/02/23 07:40:58 Container: f3e3c088ce0a8df7830796cccb8804485e724a6be7f4976e623b4be331f78175: [/complement_fed_54_fed.1_servers.hs1_1]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58     127.0.0.1:33148 -> 8448/tcp\n
2025/02/23 07:40:58     127.0.0.1:33147 -> 8008/tcp\n
2025/02/23 07:40:58 Container: 9256a4e5369f43849ec092402cf44f0b36ebd458cedcef8648609a8a8dcef171: [/complement_csapi_78_csapi.1_servers.hs1_1]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58     127.0.0.1:33145 -> 8008/tcp\n
2025/02/23 07:40:58     127.0.0.1:33146 -> 8448/tcp\n
2025/02/23 07:40:58 Container: 8f5cc968b7b11456ce6c3bc46d22af38a10c22bf4c39989d4dc8b94389042ab9: [/complement_fed.hs_with_application_service.hs2]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58 Container: 457b2602f4ecd40565226f12ef552c0f8c8aa74f985545923fd8f61b3bb8876d: [/complement_fed.hs_with_application_service.hs1]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58 Container: 1dbc82506f8b6c347140e464eb229ea2276bb61d8e36474f6a3e73414422269f: [/complement_csapi.2_servers.hs2]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58 Container: fc0d7abe083e0ff1e87dbd0431bb9ee54092d429d2d45ccc837c5e57030556dc: [/complement_csapi.2_servers.hs1]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58 Container: 03e855d8b56e542d3b9388513d3091081cbdfd6454de54c9a5dfb38c36969933: [/complement_fed.2_servers.hs2]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58 Container: 3e196ce98f6d96b9161e12256a117faa6a7d588301e6e20f3efbdece097728e3: [/complement_fed.2_servers.hs1]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58 Container: 47b3d5eeeeed234a4f4ffa7f74a9c9c705bae1aedd721747f354b42f936b625f: [/complement_fed.3_servers.hs3]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58 Container: 949c2a09607571caf4c8412e5c666a3fc44c45d1bc263cfd751eebffbf81e389: [/complement_fed.3_servers.hs2]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58 Container: 3ef6f9294cd7c90643b01a93347a4bc7946a8b1130db336bb1e6bcc7842c5fe9: [/complement_fed.3_servers.hs1]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58 Container: 0ad13e17fbfcc7ab04525caeb127eed438a405e9230ae2b177ffe73017823b6f: [/complement_fed.1_servers.hs1]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58 Container: 4c2d7803dd9fc6ce3390f6e9cf322905cfc8e11f58e38387ff37241f2244e390: [/complement_csapi.1_servers.hs1]\n
2025/02/23 07:40:58     (host) -> (container)\n
2025/02/23 07:40:58 =============== While deploying complement_csapi_79_csapi.1_servers.hs1_1 : END ALL COMPLEMENT DOCKER PORT BINDINGS ===============\n
\n
\n
    sync_archive_test.go:471: \u001b[31mDeploy: Deploy returned error Deploy: Failed to deploy image {Containers:-1 Created:1740265731 ID:sha256:2eaa4d4b0935d10eda6f5c1a30404544de457f02557ee322f6aef94e773de293 Labels:map[complement_blueprint:1_servers complement_context:csapi.1_servers.hs1 complement_hs_name:hs1 complement_pkg:csapi org.opencontainers.image.source:https://github.com/rust-lang/docker-rust] ParentID:sha256:43423fed373499994daef88954f4eec573152502bf76e064a0ec7133928dbc93 RepoDigests:[] RepoTags:[localhost/complement:csapi.1_servers.hs1] SharedSize:-1 Size:2980705912 VirtualSize:0} : csapi.1_servers.hs1: failed to check server is up. timed out checking for homeserver to be up: GET http://127.0.0.1:33149/_matrix/client/versions => error: Get "http://127.0.0.1:33149/_matrix/client/versions": read tcp 127.0.0.1:54318->127.0.0.1:33149: read: connection reset by peer\u001b[39m\n
--- FAIL: TestLeaveEventInviteRejection (30.88s)\n
null
null
=== RUN   TestSyncFilter\n
2025/02/23 07:41:12 ============================================\n
\n
\n
2025/02/23 07:41:12 fed.2_servers.hs1 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=2885acfeddf9\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
2025/02/23 07:41:12 ============== fed.2_servers.hs1 : END LOGS ==============\n
\n
\n
2025/02/23 07:41:12 ============== While deploying complement_fed_55_fed.2_servers.hs1_1 : START ALL COMPLEMENT DOCKER PORT BINDINGS ==============\n
2025/02/23 07:41:12 Container: 44fc07da9a8929ff2206cbce34728b010434a66f84d479d697c28b1fe3a5fc82: [/complement_csapi_80_csapi.1_servers.hs1_1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12     127.0.0.1:33156 -> 8448/tcp\n
2025/02/23 07:41:12     127.0.0.1:33155 -> 8008/tcp\n
2025/02/23 07:41:12 Container: 7a466f5fa45ea54935b9453592b832331ece1c7e168e368bd4481a1c7f858d3a: [/complement_fed_55_fed.2_servers.hs2_2]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12     127.0.0.1:33153 -> 8008/tcp\n
2025/02/23 07:41:12     127.0.0.1:33154 -> 8448/tcp\n
2025/02/23 07:41:12 Container: 2885acfeddf9aef94a40588b85c26c9d1052f32dd96d906aed1376935500953b: [/complement_fed_55_fed.2_servers.hs1_1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12     127.0.0.1:33151 -> 8008/tcp\n
2025/02/23 07:41:12     127.0.0.1:33152 -> 8448/tcp\n
2025/02/23 07:41:12 Container: e0650fcdabed75fb20691e001bff7365e02f8534e05c5c295e5f69d2572bdce5: [/complement_csapi_79_csapi.1_servers.hs1_1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12     127.0.0.1:33150 -> 8448/tcp\n
2025/02/23 07:41:12     127.0.0.1:33149 -> 8008/tcp\n
2025/02/23 07:41:12 Container: f3e3c088ce0a8df7830796cccb8804485e724a6be7f4976e623b4be331f78175: [/complement_fed_54_fed.1_servers.hs1_1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12     127.0.0.1:33147 -> 8008/tcp\n
2025/02/23 07:41:12     127.0.0.1:33148 -> 8448/tcp\n
2025/02/23 07:41:12 Container: 9256a4e5369f43849ec092402cf44f0b36ebd458cedcef8648609a8a8dcef171: [/complement_csapi_78_csapi.1_servers.hs1_1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12     127.0.0.1:33145 -> 8008/tcp\n
2025/02/23 07:41:12     127.0.0.1:33146 -> 8448/tcp\n
2025/02/23 07:41:12 Container: 8f5cc968b7b11456ce6c3bc46d22af38a10c22bf4c39989d4dc8b94389042ab9: [/complement_fed.hs_with_application_service.hs2]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 457b2602f4ecd40565226f12ef552c0f8c8aa74f985545923fd8f61b3bb8876d: [/complement_fed.hs_with_application_service.hs1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 1dbc82506f8b6c347140e464eb229ea2276bb61d8e36474f6a3e73414422269f: [/complement_csapi.2_servers.hs2]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: fc0d7abe083e0ff1e87dbd0431bb9ee54092d429d2d45ccc837c5e57030556dc: [/complement_csapi.2_servers.hs1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 03e855d8b56e542d3b9388513d3091081cbdfd6454de54c9a5dfb38c36969933: [/complement_fed.2_servers.hs2]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 3e196ce98f6d96b9161e12256a117faa6a7d588301e6e20f3efbdece097728e3: [/complement_fed.2_servers.hs1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 47b3d5eeeeed234a4f4ffa7f74a9c9c705bae1aedd721747f354b42f936b625f: [/complement_fed.3_servers.hs3]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 949c2a09607571caf4c8412e5c666a3fc44c45d1bc263cfd751eebffbf81e389: [/complement_fed.3_servers.hs2]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 3ef6f9294cd7c90643b01a93347a4bc7946a8b1130db336bb1e6bcc7842c5fe9: [/complement_fed.3_servers.hs1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 0ad13e17fbfcc7ab04525caeb127eed438a405e9230ae2b177ffe73017823b6f: [/complement_fed.1_servers.hs1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 4c2d7803dd9fc6ce3390f6e9cf322905cfc8e11f58e38387ff37241f2244e390: [/complement_csapi.1_servers.hs1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 =============== While deploying complement_fed_55_fed.2_servers.hs1_1 : END ALL COMPLEMENT DOCKER PORT BINDINGS ===============\n
\n
\n
2025/02/23 07:41:12 ============================================\n
\n
\n
2025/02/23 07:41:12 fed.2_servers.hs2 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=7a466f5fa45e\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
2025/02/23 07:41:12 ============== fed.2_servers.hs2 : END LOGS ==============\n
\n
\n
2025/02/23 07:41:12 ============== While deploying complement_fed_55_fed.2_servers.hs2_2 : START ALL COMPLEMENT DOCKER PORT BINDINGS ==============\n
2025/02/23 07:41:12 Container: 44fc07da9a8929ff2206cbce34728b010434a66f84d479d697c28b1fe3a5fc82: [/complement_csapi_80_csapi.1_servers.hs1_1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12     127.0.0.1:33155 -> 8008/tcp\n
2025/02/23 07:41:12     127.0.0.1:33156 -> 8448/tcp\n
2025/02/23 07:41:12 Container: 7a466f5fa45ea54935b9453592b832331ece1c7e168e368bd4481a1c7f858d3a: [/complement_fed_55_fed.2_servers.hs2_2]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12     127.0.0.1:33153 -> 8008/tcp\n
2025/02/23 07:41:12     127.0.0.1:33154 -> 8448/tcp\n
2025/02/23 07:41:12 Container: 2885acfeddf9aef94a40588b85c26c9d1052f32dd96d906aed1376935500953b: [/complement_fed_55_fed.2_servers.hs1_1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12     127.0.0.1:33151 -> 8008/tcp\n
2025/02/23 07:41:12     127.0.0.1:33152 -> 8448/tcp\n
2025/02/23 07:41:12 Container: e0650fcdabed75fb20691e001bff7365e02f8534e05c5c295e5f69d2572bdce5: [/complement_csapi_79_csapi.1_servers.hs1_1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12     127.0.0.1:33149 -> 8008/tcp\n
2025/02/23 07:41:12     127.0.0.1:33150 -> 8448/tcp\n
2025/02/23 07:41:12 Container: f3e3c088ce0a8df7830796cccb8804485e724a6be7f4976e623b4be331f78175: [/complement_fed_54_fed.1_servers.hs1_1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12     127.0.0.1:33148 -> 8448/tcp\n
2025/02/23 07:41:12     127.0.0.1:33147 -> 8008/tcp\n
2025/02/23 07:41:12 Container: 9256a4e5369f43849ec092402cf44f0b36ebd458cedcef8648609a8a8dcef171: [/complement_csapi_78_csapi.1_servers.hs1_1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12     127.0.0.1:33145 -> 8008/tcp\n
2025/02/23 07:41:12     127.0.0.1:33146 -> 8448/tcp\n
2025/02/23 07:41:12 Container: 8f5cc968b7b11456ce6c3bc46d22af38a10c22bf4c39989d4dc8b94389042ab9: [/complement_fed.hs_with_application_service.hs2]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 457b2602f4ecd40565226f12ef552c0f8c8aa74f985545923fd8f61b3bb8876d: [/complement_fed.hs_with_application_service.hs1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 1dbc82506f8b6c347140e464eb229ea2276bb61d8e36474f6a3e73414422269f: [/complement_csapi.2_servers.hs2]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: fc0d7abe083e0ff1e87dbd0431bb9ee54092d429d2d45ccc837c5e57030556dc: [/complement_csapi.2_servers.hs1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 03e855d8b56e542d3b9388513d3091081cbdfd6454de54c9a5dfb38c36969933: [/complement_fed.2_servers.hs2]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 3e196ce98f6d96b9161e12256a117faa6a7d588301e6e20f3efbdece097728e3: [/complement_fed.2_servers.hs1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 47b3d5eeeeed234a4f4ffa7f74a9c9c705bae1aedd721747f354b42f936b625f: [/complement_fed.3_servers.hs3]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 949c2a09607571caf4c8412e5c666a3fc44c45d1bc263cfd751eebffbf81e389: [/complement_fed.3_servers.hs2]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 3ef6f9294cd7c90643b01a93347a4bc7946a8b1130db336bb1e6bcc7842c5fe9: [/complement_fed.3_servers.hs1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 0ad13e17fbfcc7ab04525caeb127eed438a405e9230ae2b177ffe73017823b6f: [/complement_fed.1_servers.hs1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 Container: 4c2d7803dd9fc6ce3390f6e9cf322905cfc8e11f58e38387ff37241f2244e390: [/complement_csapi.1_servers.hs1]\n
2025/02/23 07:41:12     (host) -> (container)\n
2025/02/23 07:41:12 =============== While deploying complement_fed_55_fed.2_servers.hs2_2 : END ALL COMPLEMENT DOCKER PORT BINDINGS ===============\n
\n
\n
    media_thumbnail_test.go:54: \u001b[31mDeploy: Deploy returned error Deploy: Failed to deploy image {Containers:-1 Created:1740265967 ID:sha256:8ea8a4e96904934b4e5fb551b9cf50cfe3218dae330a38ef13437ef05b67a9cb Labels:map[complement_blueprint:2_servers complement_context:fed.2_servers.hs2 complement_hs_name:hs2 complement_pkg:fed org.opencontainers.image.source:https://github.com/rust-lang/docker-rust] ParentID:sha256:43423fed373499994daef88954f4eec573152502bf76e064a0ec7133928dbc93 RepoDigests:[] RepoTags:[localhost/complement:fed.2_servers.hs2] SharedSize:-1 Size:2980705910 VirtualSize:0} : fed.2_servers.hs2: failed to check server is up. timed out checking for homeserver to be up: GET http://127.0.0.1:33153/_matrix/client/versions => error: Get "http://127.0.0.1:33153/_matrix/client/versions": EOF\u001b[39m\n
--- FAIL: TestRemotePngThumbnail (31.42s)\n
null
null
=== RUN   TestFederationThumbnail\n
    media_thumbnail_test.go:86: WARNING: TestFederationThumbnail called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
2025/02/23 07:41:29 ============================================\n
\n
\n
2025/02/23 07:41:29 csapi.1_servers.hs1 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=44fc07da9a89\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
2025/02/23 07:41:29 ============== csapi.1_servers.hs1 : END LOGS ==============\n
\n
\n
2025/02/23 07:41:29 ============== While deploying complement_csapi_80_csapi.1_servers.hs1_1 : START ALL COMPLEMENT DOCKER PORT BINDINGS ==============\n
2025/02/23 07:41:29 Container: f849b39b7953a93063fc8904f0a22cca38050590ae61960b02def9b1d5730988: [/complement_fed_56_fed.1_servers.hs1_1]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29     127.0.0.1:33158 -> 8448/tcp\n
2025/02/23 07:41:29     127.0.0.1:33157 -> 8008/tcp\n
2025/02/23 07:41:29 Container: 44fc07da9a8929ff2206cbce34728b010434a66f84d479d697c28b1fe3a5fc82: [/complement_csapi_80_csapi.1_servers.hs1_1]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29     127.0.0.1:33156 -> 8448/tcp\n
2025/02/23 07:41:29     127.0.0.1:33155 -> 8008/tcp\n
2025/02/23 07:41:29 Container: 7a466f5fa45ea54935b9453592b832331ece1c7e168e368bd4481a1c7f858d3a: [/complement_fed_55_fed.2_servers.hs2_2]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29     127.0.0.1:33153 -> 8008/tcp\n
2025/02/23 07:41:29     127.0.0.1:33154 -> 8448/tcp\n
2025/02/23 07:41:29 Container: 2885acfeddf9aef94a40588b85c26c9d1052f32dd96d906aed1376935500953b: [/complement_fed_55_fed.2_servers.hs1_1]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29     127.0.0.1:33151 -> 8008/tcp\n
2025/02/23 07:41:29     127.0.0.1:33152 -> 8448/tcp\n
2025/02/23 07:41:29 Container: e0650fcdabed75fb20691e001bff7365e02f8534e05c5c295e5f69d2572bdce5: [/complement_csapi_79_csapi.1_servers.hs1_1]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29     127.0.0.1:33149 -> 8008/tcp\n
2025/02/23 07:41:29     127.0.0.1:33150 -> 8448/tcp\n
2025/02/23 07:41:29 Container: f3e3c088ce0a8df7830796cccb8804485e724a6be7f4976e623b4be331f78175: [/complement_fed_54_fed.1_servers.hs1_1]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29     127.0.0.1:33147 -> 8008/tcp\n
2025/02/23 07:41:29     127.0.0.1:33148 -> 8448/tcp\n
2025/02/23 07:41:29 Container: 9256a4e5369f43849ec092402cf44f0b36ebd458cedcef8648609a8a8dcef171: [/complement_csapi_78_csapi.1_servers.hs1_1]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29     127.0.0.1:33145 -> 8008/tcp\n
2025/02/23 07:41:29     127.0.0.1:33146 -> 8448/tcp\n
2025/02/23 07:41:29 Container: 8f5cc968b7b11456ce6c3bc46d22af38a10c22bf4c39989d4dc8b94389042ab9: [/complement_fed.hs_with_application_service.hs2]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29 Container: 457b2602f4ecd40565226f12ef552c0f8c8aa74f985545923fd8f61b3bb8876d: [/complement_fed.hs_with_application_service.hs1]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29 Container: 1dbc82506f8b6c347140e464eb229ea2276bb61d8e36474f6a3e73414422269f: [/complement_csapi.2_servers.hs2]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29 Container: fc0d7abe083e0ff1e87dbd0431bb9ee54092d429d2d45ccc837c5e57030556dc: [/complement_csapi.2_servers.hs1]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29 Container: 03e855d8b56e542d3b9388513d3091081cbdfd6454de54c9a5dfb38c36969933: [/complement_fed.2_servers.hs2]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29 Container: 3e196ce98f6d96b9161e12256a117faa6a7d588301e6e20f3efbdece097728e3: [/complement_fed.2_servers.hs1]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29 Container: 47b3d5eeeeed234a4f4ffa7f74a9c9c705bae1aedd721747f354b42f936b625f: [/complement_fed.3_servers.hs3]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29 Container: 949c2a09607571caf4c8412e5c666a3fc44c45d1bc263cfd751eebffbf81e389: [/complement_fed.3_servers.hs2]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29 Container: 3ef6f9294cd7c90643b01a93347a4bc7946a8b1130db336bb1e6bcc7842c5fe9: [/complement_fed.3_servers.hs1]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29 Container: 0ad13e17fbfcc7ab04525caeb127eed438a405e9230ae2b177ffe73017823b6f: [/complement_fed.1_servers.hs1]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29 Container: 4c2d7803dd9fc6ce3390f6e9cf322905cfc8e11f58e38387ff37241f2244e390: [/complement_csapi.1_servers.hs1]\n
2025/02/23 07:41:29     (host) -> (container)\n
2025/02/23 07:41:29 =============== While deploying complement_csapi_80_csapi.1_servers.hs1_1 : END ALL COMPLEMENT DOCKER PORT BINDINGS ===============\n
\n
\n
    sync_filter_test.go:17: \u001b[31mDeploy: Deploy returned error Deploy: Failed to deploy image {Containers:-1 Created:1740265731 ID:sha256:2eaa4d4b0935d10eda6f5c1a30404544de457f02557ee322f6aef94e773de293 Labels:map[complement_blueprint:1_servers complement_context:csapi.1_servers.hs1 complement_hs_name:hs1 complement_pkg:csapi org.opencontainers.image.source:https://github.com/rust-lang/docker-rust] ParentID:sha256:43423fed373499994daef88954f4eec573152502bf76e064a0ec7133928dbc93 RepoDigests:[] RepoTags:[localhost/complement:csapi.1_servers.hs1] SharedSize:-1 Size:2980705912 VirtualSize:0} : csapi.1_servers.hs1: failed to check server is up. timed out checking for homeserver to be up: GET http://127.0.0.1:33155/_matrix/client/versions => error: Get "http://127.0.0.1:33155/_matrix/client/versions": read tcp 127.0.0.1:46500->127.0.0.1:33155: read: connection reset by peer\u001b[39m\n
--- FAIL: TestSyncFilter (31.14s)\n
null
null
=== RUN   TestCumulativeJoinLeaveJoinSync\n
2025/02/23 07:41:43 ============================================\n
\n
\n
2025/02/23 07:41:43 fed.1_servers.hs1 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=f849b39b7953\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux f849b39b7953 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267700.8596015,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267700.8687477,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267700.8687756,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:41:43 ============== fed.1_servers.hs1 : END LOGS ==============\n
\n
\n
2025/02/23 07:41:43 ============== While deploying complement_fed_56_fed.1_servers.hs1_1 : START ALL COMPLEMENT DOCKER PORT BINDINGS ==============\n
2025/02/23 07:41:43 Container: 899f5c977fac123a4216f32976a2935b9359570e4f547a3b6a6a643a19760426: [/complement_csapi_81_csapi.1_servers.hs1_1]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43     127.0.0.1:33159 -> 8008/tcp\n
2025/02/23 07:41:43     127.0.0.1:33160 -> 8448/tcp\n
2025/02/23 07:41:43 Container: f849b39b7953a93063fc8904f0a22cca38050590ae61960b02def9b1d5730988: [/complement_fed_56_fed.1_servers.hs1_1]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43     127.0.0.1:33157 -> 8008/tcp\n
2025/02/23 07:41:43     127.0.0.1:33158 -> 8448/tcp\n
2025/02/23 07:41:43 Container: 44fc07da9a8929ff2206cbce34728b010434a66f84d479d697c28b1fe3a5fc82: [/complement_csapi_80_csapi.1_servers.hs1_1]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43     127.0.0.1:33155 -> 8008/tcp\n
2025/02/23 07:41:43     127.0.0.1:33156 -> 8448/tcp\n
2025/02/23 07:41:43 Container: 7a466f5fa45ea54935b9453592b832331ece1c7e168e368bd4481a1c7f858d3a: [/complement_fed_55_fed.2_servers.hs2_2]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43     127.0.0.1:33153 -> 8008/tcp\n
2025/02/23 07:41:43     127.0.0.1:33154 -> 8448/tcp\n
2025/02/23 07:41:43 Container: 2885acfeddf9aef94a40588b85c26c9d1052f32dd96d906aed1376935500953b: [/complement_fed_55_fed.2_servers.hs1_1]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43     127.0.0.1:33151 -> 8008/tcp\n
2025/02/23 07:41:43     127.0.0.1:33152 -> 8448/tcp\n
2025/02/23 07:41:43 Container: e0650fcdabed75fb20691e001bff7365e02f8534e05c5c295e5f69d2572bdce5: [/complement_csapi_79_csapi.1_servers.hs1_1]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43     127.0.0.1:33150 -> 8448/tcp\n
2025/02/23 07:41:43     127.0.0.1:33149 -> 8008/tcp\n
2025/02/23 07:41:43 Container: f3e3c088ce0a8df7830796cccb8804485e724a6be7f4976e623b4be331f78175: [/complement_fed_54_fed.1_servers.hs1_1]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43     127.0.0.1:33147 -> 8008/tcp\n
2025/02/23 07:41:43     127.0.0.1:33148 -> 8448/tcp\n
2025/02/23 07:41:43 Container: 9256a4e5369f43849ec092402cf44f0b36ebd458cedcef8648609a8a8dcef171: [/complement_csapi_78_csapi.1_servers.hs1_1]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43     127.0.0.1:33145 -> 8008/tcp\n
2025/02/23 07:41:43     127.0.0.1:33146 -> 8448/tcp\n
2025/02/23 07:41:43 Container: 8f5cc968b7b11456ce6c3bc46d22af38a10c22bf4c39989d4dc8b94389042ab9: [/complement_fed.hs_with_application_service.hs2]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43 Container: 457b2602f4ecd40565226f12ef552c0f8c8aa74f985545923fd8f61b3bb8876d: [/complement_fed.hs_with_application_service.hs1]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43 Container: 1dbc82506f8b6c347140e464eb229ea2276bb61d8e36474f6a3e73414422269f: [/complement_csapi.2_servers.hs2]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43 Container: fc0d7abe083e0ff1e87dbd0431bb9ee54092d429d2d45ccc837c5e57030556dc: [/complement_csapi.2_servers.hs1]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43 Container: 03e855d8b56e542d3b9388513d3091081cbdfd6454de54c9a5dfb38c36969933: [/complement_fed.2_servers.hs2]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43 Container: 3e196ce98f6d96b9161e12256a117faa6a7d588301e6e20f3efbdece097728e3: [/complement_fed.2_servers.hs1]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43 Container: 47b3d5eeeeed234a4f4ffa7f74a9c9c705bae1aedd721747f354b42f936b625f: [/complement_fed.3_servers.hs3]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43 Container: 949c2a09607571caf4c8412e5c666a3fc44c45d1bc263cfd751eebffbf81e389: [/complement_fed.3_servers.hs2]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43 Container: 3ef6f9294cd7c90643b01a93347a4bc7946a8b1130db336bb1e6bcc7842c5fe9: [/complement_fed.3_servers.hs1]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43 Container: 0ad13e17fbfcc7ab04525caeb127eed438a405e9230ae2b177ffe73017823b6f: [/complement_fed.1_servers.hs1]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43 Container: 4c2d7803dd9fc6ce3390f6e9cf322905cfc8e11f58e38387ff37241f2244e390: [/complement_csapi.1_servers.hs1]\n
2025/02/23 07:41:43     (host) -> (container)\n
2025/02/23 07:41:43 =============== While deploying complement_fed_56_fed.1_servers.hs1_1 : END ALL COMPLEMENT DOCKER PORT BINDINGS ===============\n
\n
\n
    media_thumbnail_test.go:88: \u001b[31mDeploy: Deploy returned error Deploy: Failed to deploy image {Containers:-1 Created:1740265732 ID:sha256:143be3930fbb1b303d7696b88bc8669bf513fcd5b0b735b69fbeaeb5d6dc6215 Labels:map[complement_blueprint:1_servers complement_context:fed.1_servers.hs1 complement_hs_name:hs1 complement_pkg:fed org.opencontainers.image.source:https://github.com/rust-lang/docker-rust] ParentID:sha256:43423fed373499994daef88954f4eec573152502bf76e064a0ec7133928dbc93 RepoDigests:[] RepoTags:[localhost/complement:fed.1_servers.hs1] SharedSize:-1 Size:2980600302 VirtualSize:0} : fed.1_servers.hs1: failed to check server is up. timed out checking for homeserver to be up: GET http://127.0.0.1:33157/_matrix/client/versions => error: Get "http://127.0.0.1:33157/_matrix/client/versions": read tcp 127.0.0.1:46412->127.0.0.1:33157: read: connection reset by peer\u001b[39m\n
--- FAIL: TestFederationThumbnail (31.19s)\n
null
null
=== RUN   TestRestrictedRoomsSpacesSummaryLocal\n
    sync_test.go:24: Deploy times: 37.04119ms blueprints, 24.821966193s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (775.627099ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (681.573002ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (568.373378ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (84.898044ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!xdBrHHAnJeNkT7Hq74:hs1 => 200 OK (270.04678ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (188.214902ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!xdBrHHAnJeNkT7Hq74:hs1/leave => 200 OK (154.59469ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (53.75274ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!xdBrHHAnJeNkT7Hq74:hs1 => 200 OK (155.648931ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (181.383673ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (152.159911ms)\n
2025/02/23 07:41:59 ============================================\n
\n
\n
2025/02/23 07:41:59 899f5c977fac123a4216f32976a2935b9359570e4f547a3b6a6a643a19760426 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=899f5c977fac\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 899f5c977fac 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267710.7150362,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267710.7201228,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267710.7201605,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:41:59 ============== 899f5c977fac123a4216f32976a2935b9359570e4f547a3b6a6a643a19760426 : END LOGS ==============\n
\n
\n
--- PASS: TestCumulativeJoinLeaveJoinSync (29.92s)\n
null
null
=== RUN   TestTentativeEventualJoiningAfterRejecting\n
    restricted_room_hierarchy_test.go:40: Deploy times: 18.822252ms blueprints, 20.381639653s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (901.61932ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.74028767s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.197223558s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!TmnvhGYtwYkIOR8rXY:hs1/state/m.space.child/!x4foZ7qqcTbYYfoZmR:hs1 => 200 OK (237.703042ms)\n
    restricted_room_hierarchy_test.go:84: SendEventSynced waiting for event ID $fFCYmk156TgeXY5FL6UBjxl84eo3GCUBVoAsrxBPYUs\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (672.396501ms)\n
    restricted_room_hierarchy_test.go:92: Space: !TmnvhGYtwYkIOR8rXY:hs1\n
    restricted_room_hierarchy_test.go:93: Room: !x4foZ7qqcTbYYfoZmR:hs1\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (866.775063ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!TmnvhGYtwYkIOR8rXY:hs1/hierarchy => 200 OK (64.21376ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!TmnvhGYtwYkIOR8rXY:hs1 => 200 OK (159.834375ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (210.452665ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!TmnvhGYtwYkIOR8rXY:hs1/hierarchy => 200 OK (154.208052ms)\n
2025/02/23 07:42:11 ============================================\n
\n
\n
2025/02/23 07:42:11 e09656d6103c117188562dcf19308f8b84b07b27538c64bc5e0422ec4fafbb8e : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=e09656d6103c\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux e09656d6103c 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267719.917603,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267719.9234767,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267719.9234982,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 13\n
To many layers, we have to go deeper frame_id: 18\n
2025/02/23 07:42:11 ============== e09656d6103c117188562dcf19308f8b84b07b27538c64bc5e0422ec4fafbb8e : END LOGS ==============\n
\n
\n
--- PASS: TestRestrictedRoomsSpacesSummaryLocal (28.49s)\n
null
null
=== RUN   TestRestrictedRoomsSpacesSummaryFederation\n
    sync_test.go:62: Deploy times: 14.05087ms blueprints, 25.700742115s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (704.317338ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (637.911684ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (419.291614ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (159.565771ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!i5BhilNt4XT9kraaRO:hs1/invite => 200 OK (182.742011ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (31.968458ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!i5BhilNt4XT9kraaRO:hs1/leave => 200 OK (128.224545ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (38.179467ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!i5BhilNt4XT9kraaRO:hs1 => 200 OK (151.596619ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (122.019975ms)\n
2025/02/23 07:42:29 ============================================\n
\n
\n
2025/02/23 07:42:29 93c65181973893b3dba5009c184dbe5b48d1634d9844b0dd85db4409f1a89948 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=93c651819738\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 93c651819738 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267741.9262302,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267741.9341636,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267741.9346104,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:42:29 ============== 93c65181973893b3dba5009c184dbe5b48d1634d9844b0dd85db4409f1a89948 : END LOGS ==============\n
\n
\n
--- PASS: TestTentativeEventualJoiningAfterRejecting (29.88s)\n
null
null
=== RUN   TestSync\n
    sync_test.go:110: WARNING: TestSync called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    restricted_room_hierarchy_test.go:121: Deploy times: 20.385465ms blueprints, 20.345942193s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (775.030703ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (641.446613ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (715.852891ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (659.136318ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/createRoom => 200 OK (623.449699ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!VRjW0Mz1UKvvBxhpPx:hs1/state/m.space.child/!E7XQHDXEDIbidAQUDi:hs2 => 200 OK (68.649679ms)\n
    restricted_room_hierarchy_test.go:171: SendEventSynced waiting for event ID $2ie9aBOdZJY-WMD0ZxzYeeR5jmi7JZuZVVna5C51F3w\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (216.377358ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!VRjW0Mz1UKvvBxhpPx:hs1/hierarchy => 200 OK (47.434199ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!VRjW0Mz1UKvvBxhpPx:hs1/hierarchy => 200 OK (4.601257ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!VRjW0Mz1UKvvBxhpPx:hs1 => 400 Bad Request (756.427889ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:33165/_matrix/client/v3/join/%21VRjW0Mz1UKvvBxhpPx:hs1?server_name=hs1 returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Answer from hs1: {\\"errcode\\":\\"M_UNKNOWN\\",\\"error\\":\\"Failed to fetch federation signing-key\\"}"}\u001b[39m\n
2025/02/23 07:42:38 ============================================\n
\n
\n
2025/02/23 07:42:38 004489fdab52993d35cf49ff188e4ea229e70e8b85d7167e777160d289d1da9d : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=004489fdab52\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 004489fdab52 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267748.9567237,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267748.9624002,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267748.962429,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs1:8448/_matrix/federation/v1/make_join/!VRjW0Mz1UKvvBxhpPx:hs1/@user-3:hs2?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "1037", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:42:36 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$PzM3Hi1zSD_zT4ACMV40OaWzB43sSLC5B88QEO5ILqw","$s63LSytlgaXQ6ohm2c6XrLHrScFVD1ta5FhrshPaSpo","$NptVJqxFBZJmKq2X4AWswJTC3EjH85drMpw-Ey9BvSw"],"content":{"membership":"join"},"depth":10,"event_sn":16,"hashes":{"sha256":"QgqkGmX49frmhuzenofFM3eqS55ISaI9p9mXMVEWJAc"},"origin":"hs1","origin_server_ts":1740267756604,"prev_events":["$2ie9aBOdZJY-WMD0ZxzYeeR5jmi7JZuZVVna5C51F3w","$6yMIgr_efJWX5IC1-yvDCCmlYu-VTpa5dJUGespt06I","$HgCkB3mmchLF-HLnAbfVRLw9clW-VO7O55ZKidGDs6I","$NptVJqxFBZJmKq2X4AWswJTC3EjH85drMpw-Ey9BvSw","$PzM3Hi1zSD_zT4ACMV40OaWzB43sSLC5B88QEO5ILqw","$aT6oV_gBqjDSG8OVij1RmO2yZFeaSAMApj6am9wCgHE","$s63LSytlgaXQ6ohm2c6XrLHrScFVD1ta5FhrshPaSpo","$uudJr4zN1LaTZwq2CVtWicGWsZ9ArALhcHoPs4qjd9U","$vyH2Jgt5swQzAgAFS2N3qfQJJYsJmMketLWpQRQXG4o"],"room_id":"!VRjW0Mz1UKvvBxhpPx:hs1","sender":"@user-3:hs2","signatures":{"hs1":{"ed25519:qY24DV9X":"PUYDJNNuqzoph308qjJbOQUqFv+ZDtVsJfsZJGGkcKRWOLSn5gf1c7mL/JsvoZrmZC9Wn6joHjucbvjF1
7LODg"}},"state_key":"@user-3:hs2","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:42:36.974589Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v2/send_join/!VRjW0Mz1UKvvBxhpPx:hs1/$SnbzFwwgRJbfsde8SAxn-eWWHGbgbv6H6w3kdf5UK3A?omit_members=false 400 Bad Request: {"errcode":"M_UNKNOWN","error":"Failed to fetch federation signing-key"}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
2025/02/23 07:42:38 ============== 004489fdab52993d35cf49ff188e4ea229e70e8b85d7167e777160d289d1da9d : END LOGS ==============\n
\n
\n
2025/02/23 07:42:40 ============================================\n
\n
\n
2025/02/23 07:42:40 745b82325e5d6df839ef1679646039bfedcdc254faeadd6977d6b2ecac99833f : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=745b82325e5d\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 745b82325e5d 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267749.1030052,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267749.1090312,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267749.1090589,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:42:40 ============== 745b82325e5d6df839ef1679646039bfedcdc254faeadd6977d6b2ecac99833f : END LOGS ==============\n
\n
\n
--- FAIL: TestRestrictedRoomsSpacesSummaryFederation (28.00s)\n
null
null
=== RUN   TestRestrictedRoomsLocalJoin\n
    sync_test.go:112: Deploy times: 13.756089ms blueprints, 16.137628643s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (681.152159ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (705.579052ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-1:hs1/filter => 200 OK (24.880984ms)\n
null
=== RUN   TestSync/parallel\n
null
=== RUN   TestSync/parallel/Can_sync_a_joined_room\n
=== PAUSE TestSync/parallel/Can_sync_a_joined_room\n
null
null
=== RUN   TestSync/parallel/Full_state_sync_includes_joined_rooms\n
=== PAUSE TestSync/parallel/Full_state_sync_includes_joined_rooms\n
null
null
=== RUN   TestSync/parallel/Newly_joined_room_is_included_in_an_incremental_sync\n
=== PAUSE TestSync/parallel/Newly_joined_room_is_included_in_an_incremental_sync\n
null
null
=== RUN   TestSync/parallel/Newly_joined_room_has_correct_timeline_in_incremental_sync\n
    sync_test.go:165: WARNING: TestSync/parallel/Newly_joined_room_has_correct_timeline_in_incremental_sync called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
=== PAUSE TestSync/parallel/Newly_joined_room_has_correct_timeline_in_incremental_sync\n
null
null
=== RUN   TestSync/parallel/Newly_joined_room_includes_presence_in_incremental_sync\n
    sync_test.go:210: WARNING: TestSync/parallel/Newly_joined_room_includes_presence_in_incremental_sync called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.003493597s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (291.480191ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (27.136234ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!j5IJnANU97MVFEbUEe:hs1 => 200 OK (203.480237ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (162.749454ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (108.605669ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.15987587s)\n
--- PASS: TestSync/parallel/Newly_joined_room_includes_presence_in_incremental_sync (2.96s)\n
null
null
=== RUN   TestSync/parallel/Get_presence_for_newly_joined_members_in_incremental_sync\n
    sync_test.go:230: WARNING: TestSync/parallel/Get_presence_for_newly_joined_members_in_incremental_sync called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (655.202856ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (238.174931ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!ODpl2XbrvQwUXJCSlh:hs1/send/m.room.message/1 => 200 OK (118.516966ms)\n
    sync_test.go:233: SendEventSynced waiting for event ID $SoNNZo2clwYWV2nZp8FQqlO-O_DuKnRML6-Mlzdo2UE\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (177.478833ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (57.529631ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!ODpl2XbrvQwUXJCSlh:hs1 => 200 OK (101.950383ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (205.405573ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (80.305631ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.024271714s)\n
--- PASS: TestSync/parallel/Get_presence_for_newly_joined_members_in_incremental_sync (2.66s)\n
null
null
=== RUN   TestSync/parallel/sync_should_succeed_even_if_the_sync_token_points_to_a_redaction_of_an_unknown_event\n
=== PAUSE TestSync/parallel/sync_should_succeed_even_if_the_sync_token_points_to_a_redaction_of_an_unknown_event\n
null
null
=== RUN   TestSync/parallel/Device_list_tracking\n
null
=== RUN   TestSync/parallel/Device_list_tracking/User_is_correctly_listed_when_they_leave,_even_when_lazy_loading_is_enabled\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (662.387336ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (362.297929ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (388.085533ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!SeOLxbu5kQJZG5VG5V:hs1 => 200 OK (136.408853ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (63.383577ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!SeOLxbu5kQJZG5VG5V:hs1/send/m.room.message/1 => 200 OK (54.003616ms)\n
    sync_test.go:422: SendEventSynced waiting for event ID $ME6a5hmwn-UKGSH4bkxx4tSJBhC2usOqtz2e7qdWbKk\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (70.521255ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!SeOLxbu5kQJZG5VG5V:hs1/leave => 200 OK (153.256287ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (165.068302ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (6.051831ms)\n
--- PASS: TestSync/parallel/Device_list_tracking/User_is_correctly_listed_when_they_leave,_even_when_lazy_loading_is_enabled (2.06s)\n
null
--- PASS: TestSync/parallel/Device_list_tracking (2.06s)\n
null
null
=== CONT  TestSync/parallel/Can_sync_a_joined_room\n
null
=== CONT  TestSync/parallel/Newly_joined_room_has_correct_timeline_in_incremental_sync\n
null
=== CONT  TestSync/parallel/Newly_joined_room_is_included_in_an_incremental_sync\n
null
=== CONT  TestSync/parallel/Full_state_sync_includes_joined_rooms\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (436.311878ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user/@user-2:hs1/filter => 200 OK (475.079217ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.261134082s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.875013404s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.511875811s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.012807589s)\n
    restricted_rooms_test.go:180: Deploy times: 11.463072ms blueprints, 17.674864711s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (602.94092ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (657.216613ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.495446179s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (720.105049ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.425791072s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (779.570421ms)\n
null
=== RUN   TestRestrictedRoomsLocalJoin/Join_should_fail_initially\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.571612684s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!hMQQt2TBL0PVwN2DR8:hs1 => 403 Forbidden (78.813694ms)\n
--- PASS: TestRestrictedRoomsLocalJoin/Join_should_fail_initially (0.08s)\n
null
null
=== RUN   TestRestrictedRoomsLocalJoin/Join_should_succeed_when_joined_to_allowed_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!RGC78rUdU0iaXoFafU:hs1 => 200 OK (134.996996ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!RGC78rUdU0iaXoFafU:hs1/state/m.room.member/@user-2:hs1 => 200 OK (151.222798ms)\n
    restricted_rooms_test.go:74: SendEventSynced waiting for event ID $OoxpsgSIYh7DaHNrORx1pmyMXaBvzKJ6L0g5KpNrqsI\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!GhcLfJEvFlk2ndFYFa:hs1/send/m.room.message/2 => 200 OK (375.813839ms)\n
    sync_test.go:183: SendEventSynced waiting for event ID $1yiYegRAuFD45f165AwBhuEhil6YC6fEUXLmA-uGwD0\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (197.258941ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!hMQQt2TBL0PVwN2DR8:hs1 => 200 OK (279.402799ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.808706115s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!hMQQt2TBL0PVwN2DR8:hs1/state/m.room.member/@user-2:hs1 => 200 OK (215.682016ms)\n
    restricted_rooms_test.go:92: SendEventSynced waiting for event ID $gPPNPDBobCBtVWL86MaYR_NVa7xZFDL7fxQ4wMCZOrI\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (506.96992ms)\n
--- PASS: TestRestrictedRoomsLocalJoin/Join_should_succeed_when_joined_to_allowed_room (1.49s)\n
null
null
=== RUN   TestRestrictedRoomsLocalJoin/Join_should_fail_when_left_allowed_room\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!hMQQt2TBL0PVwN2DR8:hs1/leave => 400 Bad Request (14.414076ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:33171/_matrix/client/v3/rooms/%21hMQQt2TBL0PVwN2DR8:hs1/leave returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Invalid member event in database."}\u001b[39m\n
--- FAIL: TestRestrictedRoomsLocalJoin/Join_should_fail_when_left_allowed_room (0.01s)\n
null
null
=== RUN   TestRestrictedRoomsLocalJoin/Join_should_succeed_when_invited\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!hMQQt2TBL0PVwN2DR8:hs1/invite => 403 Forbidden (119.130245ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:33171/_matrix/client/v3/rooms/%21hMQQt2TBL0PVwN2DR8:hs1/invite returned non-2xx code: 403 Forbidden - body: {"errcode":"M_FORBIDDEN","error":"Event is not authorized."}\u001b[39m\n
--- FAIL: TestRestrictedRoomsLocalJoin/Join_should_succeed_when_invited (0.12s)\n
null
null
=== RUN   TestRestrictedRoomsLocalJoin/Join_should_fail_with_mangled_join_rules\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!hMQQt2TBL0PVwN2DR8:hs1/state/m.room.join_rules/ => 200 OK (266.973938ms)\n
    restricted_rooms_test.go:144: SendEventSynced waiting for event ID $esYGv1gjs0riRWL7Gjq6Ex7SW9ZAMBC7wTqabWAceSo\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (470.032604ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!hMQQt2TBL0PVwN2DR8:hs1 => 200 OK (9.920159ms)\n
    restricted_rooms_test.go:158: \u001b[31mMatchFailure got status 200 instead of a failure code\u001b[39m\n
--- FAIL: TestRestrictedRoomsLocalJoin/Join_should_fail_with_mangled_join_rules (0.75s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.762197536s)\n
--- PASS: TestSync/parallel/Can_sync_a_joined_room (8.52s)\n
null
null
=== CONT  TestSync/parallel/sync_should_succeed_even_if_the_sync_token_points_to_a_redaction_of_an_unknown_event\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (4.78718147s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (4.176120688s)\n
2025/02/23 07:43:04 ============================================\n
\n
\n
2025/02/23 07:43:04 a3ddb31673026f276683d2079a3c5e630f7292e6774a92982678beb7087a261c : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=a3ddb3167302\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux a3ddb3167302 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267774.30673,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267774.3119695,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267774.312184,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
To many layers, we have to go deeper frame_id: 17\n
To many layers, we have to go deeper frame_id: 19\n
  \u001b[2m2025-02-22T23:43:02.249646Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mCan't invite user if sender not joined or the user is currently joined or banned, \u001b[1;33mtarget_user_membership_event_id\u001b[0m\u001b[33m: Some("$gPPNPDBobCBtVWL86MaYR_NVa7xZFDL7fxQ4wMCZOrI"), \u001b[1;33msender_membership_event_id\u001b[0m\u001b[33m: Some("$7k4fAzKGLJ1RpwyRqrt7apCPQr6kG2IyOTRPtT75u3w")\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:601\n
\n
To many layers, we have to go deeper frame_id: 20\n
2025/02/23 07:43:04 ============== a3ddb31673026f276683d2079a3c5e630f7292e6774a92982678beb7087a261c : END LOGS ==============\n
\n
\n
--- FAIL: TestRestrictedRoomsLocalJoin (24.76s)\n
null
null
=== RUN   TestRestrictedRoomsRemoteJoin\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.988420415s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (448.432849ms)\n
--- PASS: TestSync/parallel/Full_state_sync_includes_joined_rooms (10.32s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.029002768s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!GhcLfJEvFlk2ndFYFa:hs1/send/m.room.message/3 => 200 OK (189.978811ms)\n
    sync_test.go:183: SendEventSynced waiting for event ID $c82RncqyiggvutnoE7msOkjNxoLieGCYVSfc2XEvbj0\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (299.949106ms)\n
--- PASS: TestSync/parallel/Newly_joined_room_is_included_in_an_incremental_sync (10.63s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (981.625785ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (798.020868ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!GhcLfJEvFlk2ndFYFa:hs1/send/m.room.message/4 => 200 OK (185.706966ms)\n
    sync_test.go:183: SendEventSynced waiting for event ID $wptP6IbY0NWozTYCZgDR1vJ2fciNrTV1hR8Up4PeAaw\n
    sync_test.go:290: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 49 52 52 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!UibOXcfzFaPo2rHlYL:hs1/$rlUodAoBA1VQzllK1dBb0RAEtvxD-GSDipp-Xq_-4Yw") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1144\u001b[39m\n
--- FAIL: TestSync/parallel/sync_should_succeed_even_if_the_sync_token_points_to_a_redaction_of_an_unknown_event (3.51s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.240878332s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!GhcLfJEvFlk2ndFYFa:hs1/send/m.room.message/5 => 200 OK (122.489531ms)\n
    sync_test.go:183: SendEventSynced waiting for event ID $F5P8h5OlBS9-J_H4ogkjf5pSrV82Lih3U818VNy12l4\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (935.396873ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (283.185269ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!GhcLfJEvFlk2ndFYFa:hs1/send/m.room.message/6 => 200 OK (119.863595ms)\n
    sync_test.go:185: SendEventSynced waiting for event ID $BQHG27SA7GRDmZvm_Ag1y3kHtQOxhvXBVUV8gPp68XU\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.229304062s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!GhcLfJEvFlk2ndFYFa:hs1/send/m.room.message/7 => 200 OK (111.437223ms)\n
    sync_test.go:185: SendEventSynced waiting for event ID $M4pVP6cpTwLUo5LCq4zpYU6ZuoFuqeOOD5xgXGnL52Q\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.241299663s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!GhcLfJEvFlk2ndFYFa:hs1/send/m.room.message/8 => 200 OK (122.026717ms)\n
    sync_test.go:185: SendEventSynced waiting for event ID $n_yqLBJSp4YdIJfmkTU3NyyK60cr7CLJLHxTx2cP4hg\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.157080565s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!GhcLfJEvFlk2ndFYFa:hs1/send/m.room.message/9 => 200 OK (87.019394ms)\n
    sync_test.go:185: SendEventSynced waiting for event ID $eeab3NEc4kan8e6TRrsPPPLggnP5UqP7MbXWTsTk3Ds\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (844.259576ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!GhcLfJEvFlk2ndFYFa:hs1 => 200 OK (99.845879ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (922.701627ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (280.935846ms)\n
    sync_test.go:195: Only expected 'm.room.message' events\n
--- FAIL: TestSync/parallel/Newly_joined_room_has_correct_timeline_in_incremental_sync (20.45s)\n
null
--- FAIL: TestSync/parallel (7.69s)\n
null
2025/02/23 07:43:16 ============================================\n
\n
\n
2025/02/23 07:43:16 96d3ca0e729141e3c95b144c9a643039d3e919df98c4a5c14cbf7886808a42d5 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=96d3ca0e7291\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 96d3ca0e7291 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267762.116442,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267762.126335,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267762.126365,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
To many layers, we have to go deeper frame_id: 19\n
To many layers, we have to go deeper frame_id: 27\n
To many layers, we have to go deeper frame_id: 37\n
To many layers, we have to go deeper frame_id: 38\n
To many layers, we have to go deeper frame_id: 45\n
To many layers, we have to go deeper frame_id: 51\n
2025/02/23 07:43:16 ============== 96d3ca0e729141e3c95b144c9a643039d3e919df98c4a5c14cbf7886808a42d5 : END LOGS ==============\n
\n
\n
--- FAIL: TestSync (47.25s)\n
null
null
=== RUN   TestSyncTimelineGap\n
    sync_test.go:450: WARNING: TestSyncTimelineGap called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    restricted_rooms_test.go:195: Deploy times: 19.604516ms blueprints, 20.324730365s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (620.648025ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (351.961689ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (399.840937ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (616.202866ms)\n
null
=== RUN   TestRestrictedRoomsRemoteJoin/Join_should_fail_initially\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!gmZPfOOEOs5tmTzovN:hs1 => 400 Bad Request (366.664006ms)\n
--- PASS: TestRestrictedRoomsRemoteJoin/Join_should_fail_initially (0.37s)\n
null
null
=== RUN   TestRestrictedRoomsRemoteJoin/Join_should_succeed_when_joined_to_allowed_room\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!Nf9dmK2AtvnbDY0Kdx:hs1 => 200 OK (596.876034ms)\n
    client.go:706: [CSAPI] PUT hs2/_matrix/client/v3/rooms/!Nf9dmK2AtvnbDY0Kdx:hs1/state/m.room.member/@user-2:hs2 => 403 Forbidden (69.158934ms)\n
    restricted_rooms_test.go:74: \u001b[31mCSAPI.MustDo PUT http://127.0.0.1:33173/_matrix/client/v3/rooms/%21Nf9dmK2AtvnbDY0Kdx:hs1/state/m.room.member/@user-2:hs2 returned non-2xx code: 403 Forbidden - body: {"errcode":"M_FORBIDDEN","error":"Event is not authorized."}\u001b[39m\n
--- FAIL: TestRestrictedRoomsRemoteJoin/Join_should_succeed_when_joined_to_allowed_room (0.67s)\n
null
null
=== RUN   TestRestrictedRoomsRemoteJoin/Join_should_fail_when_left_allowed_room\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/rooms/!gmZPfOOEOs5tmTzovN:hs1/leave => 200 OK (20.138506ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/rooms/!Nf9dmK2AtvnbDY0Kdx:hs1/leave => 200 OK (15.803387ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (275.029344ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.042310691s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.058607318s)\n
    sync_test.go:451: Deploy times: 10.699898ms blueprints, 14.935480149s containers\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.036164588s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (645.0823ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.043928897s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.040704584s)\n
    restricted_rooms_test.go:117: \u001b[31m@user-1:hs1 MustSyncUntil: timed out after 5.498066182s. Seen 6 /sync responses. Checkers:\n
        [t=275.33963ms] Response #1: SyncTimelineHas(!Nf9dmK2AtvnbDY0Kdx:hs1): check function did not pass while iterating over 7 elements: [{"content":{"creator":"@user-1:hs1","room_version":"10"},"event_id":"$1t1zx2efTP9FUxV1O1usVLDeTw0Kk7tlYNKmk55h8zs","origin_server_ts":1740267805841,"sender":"@user-1:hs1","state_key":"","type":"m.room.create","unsigned":{"age":1}},{"content":{"displayname":"user-1 ⚡️","is_direct":false,"membership":"join"},"event_id":"$cpX6zO0tKVttEEJPPPD1cl4i0sG7gj2OyE4SZEog5TM","origin_server_ts":1740267805883,"sender":"@user-1:hs1","state_key":"@user-1:hs1","type":"m.room.member","unsigned":{"age":1}},{"content":{"ban":50,"events":{},"events_default":0,"invite":0,"kick":50,"notifications":{"room":50},"redact":50,"state_default":50,"users":{"@user-1:hs1":100},"users_default":0},"event_id":"$br6mRovHCCwE8K8J3hHpeCQGNAJu7LQVxeq50Cl9BJ8","origin_server_ts":1740267805948,"sender":"@user-1:hs1","state_key":"","type":"m.room.power_levels","unsigned":{"age":1}},{"content":{"join_rule":"pu
blic"},"event_id":"$nRdVnIR5cpcZ5m2n1vRQArAbEZdH65IVuchhQqklWRw","origin_server_ts":1740267805989,"sender":"@user-1:hs1","state_key":"","type":"m.room.join_rules","unsigned":{"age":1}},{"content":{"history_visibility":"shared"},"event_id":"$V17KmWO3A64mAXk4mZ18NYNNTuaJ-f5O0pn9vDKPXOo","origin_server_ts":1740267806049,"sender":"@user-1:hs1","state_key":"","type":"m.room.history_visibility","unsigned":{"age":1}},{"content":{"guest_access":"forbidden"},"event_id":"$mth32DI8e1Ni8L0WHdT9xZEXiSPBA3UxFayZptUO2x8","origin_server_ts":1740267806094,"sender":"@user-1:hs1","state_key":"","type":"m.room.guest_access","unsigned":{"age":1}},{"content":{"name":"Allowed Room"},"event_id":"$HeQlMxYFo7mz1I0iNBFUV-sWrKgQFBRMhhLPdvMqEYA","origin_server_ts":1740267806140,"sender":"@user-1:hs1","state_key":"","type":"m.room.name","unsigned":{"age":1}}]\n
        [t=1.317917832s] Response #2: SyncTimelineHas(!Nf9dmK2AtvnbDY0Kdx:hs1): Key rooms.join.!Nf9dmK2AtvnbDY0Kdx:hs1.timeline.events does not exist\n
        [t=2.376724448s] Response #3: SyncTimelineHas(!Nf9dmK2AtvnbDY0Kdx:hs1): Key rooms.join.!Nf9dmK2AtvnbDY0Kdx:hs1.timeline.events does not exist\n
        [t=3.413042656s] Response #4: SyncTimelineHas(!Nf9dmK2AtvnbDY0Kdx:hs1): Key rooms.join.!Nf9dmK2AtvnbDY0Kdx:hs1.timeline.events does not exist\n
        [t=4.457177212s] Response #5: SyncTimelineHas(!Nf9dmK2AtvnbDY0Kdx:hs1): Key rooms.join.!Nf9dmK2AtvnbDY0Kdx:hs1.timeline.events does not exist\n
        [t=5.498063849s] Response #6: SyncTimelineHas(!Nf9dmK2AtvnbDY0Kdx:hs1): Key rooms.join.!Nf9dmK2AtvnbDY0Kdx:hs1.timeline.events does not exist, \n
        \u001b[39m\n
--- FAIL: TestRestrictedRoomsRemoteJoin/Join_should_fail_when_left_allowed_room (5.53s)\n
null
null
=== RUN   TestRestrictedRoomsRemoteJoin/Join_should_succeed_when_invited\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!gmZPfOOEOs5tmTzovN:hs1/invite => 200 OK (3.343880402s)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!gmZPfOOEOs5tmTzovN:hs1 => 403 Forbidden (23.99757ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/rooms/!gmZPfOOEOs5tmTzovN:hs1/leave => 200 OK (57.780548ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!Nf9dmK2AtvnbDY0Kdx:hs1 => 403 Forbidden (27.327781ms)\n
--- PASS: TestRestrictedRoomsRemoteJoin/Join_should_succeed_when_invited (3.45s)\n
null
null
=== RUN   TestRestrictedRoomsRemoteJoin/Join_should_fail_with_mangled_join_rules\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!gmZPfOOEOs5tmTzovN:hs1/state/m.room.join_rules/ => 200 OK (71.685791ms)\n
    restricted_rooms_test.go:144: SendEventSynced waiting for event ID $0K0IZpBXSS2d1fPziQkZuJYdZy8br-KZzW6Oa7k_bEk\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (252.621548ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!gmZPfOOEOs5tmTzovN:hs1 => 403 Forbidden (20.236764ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!gmZPfOOEOs5tmTzovN:hs1/state/m.room.join_rules/ => 200 OK (76.271263ms)\n
    restricted_rooms_test.go:160: SendEventSynced waiting for event ID $F1rCovDI8T9V-ZsLijez5lNkLFW_73K2Wr41v7_rO_w\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (155.318429ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!gmZPfOOEOs5tmTzovN:hs1 => 403 Forbidden (17.165459ms)\n
--- PASS: TestRestrictedRoomsRemoteJoin/Join_should_fail_with_mangled_join_rules (0.60s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (348.377818ms)\n
    sync_test.go:465: \u001b[31mMustJoinRoom: send_join failed: contents=[123 34 101 114 114 99 111 100 101 34 58 34 77 95 66 65 68 95 74 83 79 78 34 44 34 101 114 114 111 114 34 58 34 115 101 114 100 101 32 106 115 111 110 32 101 114 114 111 114 58 32 109 105 115 115 105 110 103 32 102 105 101 108 100 32 96 112 100 117 96 32 97 116 32 108 105 110 101 32 49 32 99 111 108 117 109 110 32 49 49 52 52 34 125] msg=Failed to PUT JSON (hostname "hs1" path "/_matrix/federation/v2/send_join/!DOi9QTqZPMycOGzA9o:hs1/$xBFMTJd3qyqL8JQs5_-CnVkhz9aciZLlkKD7OUoHbbE") code=400 wrapped=M_BAD_JSON: serde json error: missing field `pdu` at line 1 column 1144\u001b[39m\n
2025/02/23 07:43:39 ============================================\n
\n
\n
2025/02/23 07:43:39 535ed6de7246453b35a5eb1847daf814f0a3c7f8b284a09fe0190825860b93c3 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=535ed6de7246\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 535ed6de7246 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267801.8108275,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267801.8164427,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267801.8168151,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
  \u001b[2m2025-02-22T23:43:27.499220Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_join/!gmZPfOOEOs5tmTzovN:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5] 400 Bad Request: {"errcode":"M_UNKNOWN","error":"Failed to fetch federation signing-key"}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_UNKNOWN\\",\\"error\\":\\"Failed to fetch federation signing-key\\"}")}) }))\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
  \u001b[2m2025-02-22T23:43:27.560525Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_join/!gmZPfOOEOs5tmTzovN:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5] 404 Not Found: {"errcode":"M_NOT_FOUND","error":"Room is unknown to this server."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_NOT_FOUND\\",\\"error\\":\\"Room is unknown to this server.\\"}")}) }))\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
  \u001b[2m2025-02-22T23:43:27.590514Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_join/!Nf9dmK2AtvnbDY0Kdx:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5] 404 Not Found: {"errcode":"M_NOT_FOUND","error":"Room is unknown to this server."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_NOT_FOUND\\",\\"error\\":\\"Room is unknown to this server.\\"}")}) }))\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs1:8448/_matrix/federation/v1/make_join/!Nf9dmK2AtvnbDY0Kdx:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "942", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:43:27 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$br6mRovHCCwE8K8J3hHpeCQGNAJu7LQVxeq50Cl9BJ8","$1t1zx2efTP9FUxV1O1usVLDeTw0Kk7tlYNKmk55h8zs","$nRdVnIR5cpcZ5m2n1vRQArAbEZdH65IVuchhQqklWRw"],"content":{"membership":"join"},"depth":8,"event_sn":20,"hashes":{"sha256":"ae34NCxKvJ2cUNoWVVEkDli+UO2f1XH7vloomixQJCg"},"origin":"hs1","origin_server_ts":1740267807667,"prev_events":["$1t1zx2efTP9FUxV1O1usVLDeTw0Kk7tlYNKmk55h8zs","$HeQlMxYFo7mz1I0iNBFUV-sWrKgQFBRMhhLPdvMqEYA","$V17KmWO3A64mAXk4mZ18NYNNTuaJ-f5O0pn9vDKPXOo","$br6mRovHCCwE8K8J3hHpeCQGNAJu7LQVxeq50Cl9BJ8","$cpX6zO0tKVttEEJPPPD1cl4i0sG7gj2OyE4SZEog5TM","$mth32DI8e1Ni8L0WHdT9xZEXiSPBA3UxFayZptUO2x8","$nRdVnIR5cpcZ5m2n1vRQArAbEZdH65IVuchhQqklWRw"],"room_id":"!Nf9dmK2AtvnbDY0Kdx:hs1","sender":"@user-2:hs2","signatures":{"hs1":{"ed25519:isZYuUfA":"Im6Z+OGwbpLdcYCRfNQrTp7dkAoY++QLi/nnXFo2XEF8z2ZPII5hqI4ooL07uzsG7sPT9OR3qnvb4IOpTmfTAw"}},"state_key":"@user-2:hs2","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:43:27.945643Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
  \u001b[2m2025-02-22T23:43:27.963099Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers unreachable\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:87\n
\n
  \u001b[2m2025-02-22T23:43:27.963176Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mdid not obtain 1 keys for 1 servers out of 1 total keys for 1 total servers.\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:102\n
\n
  \u001b[2m2025-02-22T23:43:27.963192Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing, \u001b[1;33mserver\u001b[0m\u001b[33m: "hs1", \u001b[1;33mkey_ids\u001b[0m\u001b[33m: ["ed25519:isZYuUfA"]\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:109\n
\n
  \u001b[2m2025-02-22T23:43:28.227642Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:43:28.247277Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::membership\u001b[0m\u001b[33m: \u001b[33mFailed to leave room @user-2:hs2 remotely: Matrix error: `[400 / M_BAD_STATE]`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/membership.rs:880\n
\n
  \u001b[2m2025-02-22T23:43:28.259758Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::membership\u001b[0m\u001b[33m: \u001b[33mFailed to leave room @user-2:hs2 remotely: Matrix error: `[400 / M_BAD_STATE]`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/membership.rs:880\n
\n
  \u001b[2m2025-02-22T23:43:37.131349Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:43:37.183745Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_leave/!gmZPfOOEOs5tmTzovN:hs1/@user-2:hs2 403 Forbidden: {"errcode":"M_FORBIDDEN","error":"Server is not in room"}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
  \u001b[2m2025-02-22T23:43:37.183920Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::membership\u001b[0m\u001b[33m: \u001b[33mFailed to leave room @user-2:hs2 remotely: Matrix error: `[400 / M_UNKNOWN]`\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/membership.rs:880\n
\n
  \u001b[2m2025-02-22T23:43:37.216019Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:43:37.561759Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
  \u001b[2m2025-02-22T23:43:37.812148Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo_core::state::event_auth\u001b[0m\u001b[33m: \u001b[33mno m.room.create event in auth chain\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/core/src/state/event_auth.rs:209\n
\n
2025/02/23 07:43:39 ============== 535ed6de7246453b35a5eb1847daf814f0a3c7f8b284a09fe0190825860b93c3 : END LOGS ==============\n
\n
\n
2025/02/23 07:43:40 ============================================\n
\n
\n
2025/02/23 07:43:40 31aa0ef723959abde5b082d98733a014f8ce26b56218d14840d3457328e54f8c : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=31aa0ef72395\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 31aa0ef72395 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267808.2106268,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267808.2404416,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267808.2404766,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:43:40 ============== 31aa0ef723959abde5b082d98733a014f8ce26b56218d14840d3457328e54f8c : END LOGS ==============\n
\n
\n
--- FAIL: TestSyncTimelineGap (23.89s)\n
null
null
=== RUN   TestPresenceSyncDifferentRooms\n
2025/02/23 07:43:40 ============================================\n
\n
\n
2025/02/23 07:43:40 8549f992396cec3fd118918ceb66b0b10956e8459488381229a48a20d5227455 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=8549f992396c\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 8549f992396c 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267801.9296937,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267801.9358013,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267801.9358344,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
  \u001b[2m2025-02-22T23:43:27.497758Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::server_key\u001b[0m\u001b[31m: \u001b[31mFailed to fetch federation signing-key, \u001b[1;31mkey_id\u001b[0m\u001b[31m: "ed25519:snjtr6g1", \u001b[1;31morigin\u001b[0m\u001b[31m: "hs2"\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/mod.rs:234\n
\n
To many layers, we have to go deeper frame_id: 17\n
To many layers, we have to go deeper frame_id: 18\n
  \u001b[2m2025-02-22T23:43:37.338603Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs2:8448/_matrix/federation/v1/send/gAMido4KWt-HauGSVzZWCnEDQJKyPQF-XqG1LCPxZU4 400 Bad Request: {"errcode":"M_UNKNOWN","error":"Failed to fetch federation signing-key"}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
2025/02/23 07:43:40 ============== 8549f992396cec3fd118918ceb66b0b10956e8459488381229a48a20d5227455 : END LOGS ==============\n
\n
\n
--- FAIL: TestRestrictedRoomsRemoteJoin (35.94s)\n
null
null
=== RUN   TestRestrictedRoomsRemoteJoinLocalUser\n
    restricted_rooms_test.go:215: WARNING: TestRestrictedRoomsRemoteJoinLocalUser called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    sync_test.go:627: Deploy times: 15.608656ms blueprints, 18.933374827s containers\n
    restricted_rooms_test.go:217: Deploy times: 18.574992ms blueprints, 18.722804141s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (678.134168ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (723.861849ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (788.83578ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/createRoom => 200 OK (931.921514ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (700.855305ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/createRoom => 200 OK (1.066528187s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (942.450657ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (751.89589ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (571.012162ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/rooms/!mhG42oHC8BmLSauKg2:hs2/invite => 400 Bad Request (455.052657ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:33181/_matrix/client/v3/rooms/%21mhG42oHC8BmLSauKg2:hs2/invite returned non-2xx code: 400 Bad Request - body: {"errcode":"M_UNKNOWN","error":"Answer from hs1: {\\"errcode\\":\\"M_UNKNOWN\\",\\"error\\":\\"Failed to fetch federation signing-key\\"}"}\u001b[39m\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (377.332811ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!9bIYTOc5fNJ61M9pkb:hs1/invite => 200 OK (102.710475ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!FYRwlJkAlMMoaVemMx:hs1/invite => 200 OK (148.866769ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!9bIYTOc5fNJ61M9pkb:hs1 => 200 OK (131.859256ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!FYRwlJkAlMMoaVemMx:hs1 => 200 OK (183.19231ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (216.46266ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/presence/@user-2:hs1/status => 200 OK (17.448614ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/presence/@user-3-charlie:hs1/status => 200 OK (12.634758ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (95.02787ms)\n
2025/02/23 07:44:05 ============================================\n
\n
\n
2025/02/23 07:44:05 df14a88702bb4d25880efb54a90c3f850c88ac2ed315e0b5df81354a50d03ff0 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=df14a88702bb\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux df14a88702bb 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267836.5799735,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267836.5843174,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267836.5843446,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
  \u001b[2m2025-02-22T23:44:03.471553Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v2/invite/!mhG42oHC8BmLSauKg2:hs2/$k-9PX-rJh63aGNanIOzExHh43dG7nFf_OcSlNP-VZQM 400 Bad Request: {"errcode":"M_UNKNOWN","error":"Failed to fetch federation signing-key"}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
2025/02/23 07:44:05 ============== df14a88702bb4d25880efb54a90c3f850c88ac2ed315e0b5df81354a50d03ff0 : END LOGS ==============\n
\n
\n
2025/02/23 07:44:06 ============================================\n
\n
\n
2025/02/23 07:44:06 287b0951c5ef91855d2c1649580ea617d816556d5fb1635ddabcc9112fc13b90 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=287b0951c5ef\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 287b0951c5ef 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267836.3992743,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267836.4101417,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267836.4101791,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 11\n
2025/02/23 07:44:06 ============== 287b0951c5ef91855d2c1649580ea617d816556d5fb1635ddabcc9112fc13b90 : END LOGS ==============\n
\n
\n
--- PASS: TestPresenceSyncDifferentRooms (25.65s)\n
null
null
=== RUN   TestRoomSummary\n
    sync_test.go:689: WARNING: TestRoomSummary called runtime.SkipIf([synapse]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
2025/02/23 07:44:06 ============================================\n
\n
\n
2025/02/23 07:44:06 637b65725476a0e35a6d112e893ba73384565c9672564622fdd1a8758e773d51 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=637b65725476\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 637b65725476 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267836.578715,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267836.5856707,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267836.5860286,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:44:06 ============== 637b65725476a0e35a6d112e893ba73384565c9672564622fdd1a8758e773d51 : END LOGS ==============\n
\n
\n
--- FAIL: TestRestrictedRoomsRemoteJoinLocalUser (25.98s)\n
null
null
=== RUN   TestRestrictedRoomsRemoteJoinFailOver\n
    restricted_rooms_test.go:334: WARNING: TestRestrictedRoomsRemoteJoinFailOver called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    sync_test.go:690: Deploy times: 22.607087ms blueprints, 19.514111466s containers\n
    restricted_rooms_test.go:336: Deploy times: 24.776328ms blueprints, 19.582645295s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (652.293207ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (638.647403ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (641.186098ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (26.384749ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (373.359448ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (385.454768ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (103.649543ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (16.451278ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!TuE3IcwtZWZDsC8FMN:hs1 => 200 OK (90.499102ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (83.431769ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (447.76253ms)\n
    restricted_rooms_test.go:341: @user-1:hs1 created authorizing room !iit4Pb5FNhPjBzKgOE:hs1.\n
    restricted_rooms_test.go:342: @user-1:hs1 created restricted room !zbjWLQuYI194NED3ge:hs1.\n
    restricted_rooms_test.go:345: @user-1:hs1 restricts invites to themself only.\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (143.103232ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!zbjWLQuYI194NED3ge:hs1/state/m.room.power_levels/ => 200 OK (94.356503ms)\n
    restricted_rooms_test.go:347: SendEventSynced waiting for event ID $FaQnHfRy9xWfLg9uUSzxU2b3jEVkCpLMb6pOGZRD6fU\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (133.69588ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (564.61202ms)\n
    restricted_rooms_test.go:362: @user-2:hs2 joins the authorizing room via hs1.\n
    restricted_rooms_test.go:363: @user-2:hs2 joins the restricted room via hs1.\n
2025/02/23 07:44:29 ============================================\n
\n
\n
2025/02/23 07:44:29 618f791e6b7c451961b5df9765923d7dcea0977f1982bfba1c8169da461ecf29 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=618f791e6b7c\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 618f791e6b7c 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267862.529898,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267862.535128,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267862.535151,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:44:29 ============== 618f791e6b7c451961b5df9765923d7dcea0977f1982bfba1c8169da461ecf29 : END LOGS ==============\n
\n
\n
--- PASS: TestRoomSummary (23.20s)\n
null
null
=== RUN   TestThreadedReceipts\n
    thread_notifications_test.go:75: WARNING: TestThreadedReceipts called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!iit4Pb5FNhPjBzKgOE:hs1 => 200 OK (806.583556ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!zbjWLQuYI194NED3ge:hs1 => 400 Bad Request (76.446338ms)\n
    client.go:706: [CSAPI] POST hs3/_matrix/client/v3/register => 200 OK (660.940871ms)\n
    restricted_rooms_test.go:369: @user-3:hs3 joins the authorizing room via hs1.\n
    client.go:706: [CSAPI] POST hs3/_matrix/client/v3/join/!iit4Pb5FNhPjBzKgOE:hs1 => 200 OK (780.368403ms)\n
    restricted_rooms_test.go:373: @user-3:hs3 joins the restricted room via hs2, which is expected to fail.\n
    client.go:706: [CSAPI] POST hs3/_matrix/client/v3/join/!zbjWLQuYI194NED3ge:hs1 => 400 Bad Request (94.56174ms)\n
    restricted_rooms_test.go:378: @user-3:hs3 joins the restricted room via {hs2,hs1}.\n
    client.go:706: [CSAPI] POST hs3/_matrix/client/v3/join/!zbjWLQuYI194NED3ge:hs1 => 400 Bad Request (83.925077ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (36.071008ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (65.361091ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (42.566714ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (41.112524ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (48.034169ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (53.886392ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (42.200526ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (34.401906ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (23.60393ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.036389098s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.040315425s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.076506474s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.028993693s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.038333183s)\n
    restricted_rooms_test.go:382: \u001b[31m@user-2:hs2 MustSyncUntil: timed out after 5.610435982s. Seen 14 /sync responses. Checkers:\n
        [t=36.33208ms] Response #1: SyncTimelineHas(!zbjWLQuYI194NED3ge:hs1): Key rooms.join.!zbjWLQuYI194NED3ge:hs1.timeline.events does not exist\n
        [t=101.847573ms] Response #2: SyncTimelineHas(!zbjWLQuYI194NED3ge:hs1): Key rooms.join.!zbjWLQuYI194NED3ge:hs1.timeline.events does not exist\n
        [t=144.601788ms] Response #3: SyncTimelineHas(!zbjWLQuYI194NED3ge:hs1): Key rooms.join.!zbjWLQuYI194NED3ge:hs1.timeline.events does not exist\n
        [t=185.867262ms] Response #4: SyncTimelineHas(!zbjWLQuYI194NED3ge:hs1): Key rooms.join.!zbjWLQuYI194NED3ge:hs1.timeline.events does not exist\n
        [t=234.242443ms] Response #5: SyncTimelineHas(!zbjWLQuYI194NED3ge:hs1): Key rooms.join.!zbjWLQuYI194NED3ge:hs1.timeline.events does not exist\n
        [t=288.302664ms] Response #6: SyncTimelineHas(!zbjWLQuYI194NED3ge:hs1): Key rooms.join.!zbjWLQuYI194NED3ge:hs1.timeline.events does not exist\n
        [t=330.669019ms] Response #7: SyncTimelineHas(!zbjWLQuYI194NED3ge:hs1): Key rooms.join.!zbjWLQuYI194NED3ge:hs1.timeline.events does not exist\n
        [t=365.264816ms] Response #8: SyncTimelineHas(!zbjWLQuYI194NED3ge:hs1): Key rooms.join.!zbjWLQuYI194NED3ge:hs1.timeline.events does not exist\n
        [t=389.001545ms] Response #9: SyncTimelineHas(!zbjWLQuYI194NED3ge:hs1): Key rooms.join.!zbjWLQuYI194NED3ge:hs1.timeline.events does not exist\n
        [t=1.425550924s] Response #10: SyncTimelineHas(!zbjWLQuYI194NED3ge:hs1): Key rooms.join.!zbjWLQuYI194NED3ge:hs1.timeline.events does not exist\n
        [t=2.466126788s] Response #11: SyncTimelineHas(!zbjWLQuYI194NED3ge:hs1): Key rooms.join.!zbjWLQuYI194NED3ge:hs1.timeline.events does not exist\n
        [t=3.5427856s] Response #12: SyncTimelineHas(!zbjWLQuYI194NED3ge:hs1): Key rooms.join.!zbjWLQuYI194NED3ge:hs1.timeline.events does not exist\n
        [t=4.571946905s] Response #13: SyncTimelineHas(!zbjWLQuYI194NED3ge:hs1): Key rooms.join.!zbjWLQuYI194NED3ge:hs1.timeline.events does not exist\n
        [t=5.610433498s] Response #14: SyncTimelineHas(!zbjWLQuYI194NED3ge:hs1): Key rooms.join.!zbjWLQuYI194NED3ge:hs1.timeline.events does not exist, \n
        \u001b[39m\n
2025/02/23 07:44:38 ============================================\n
\n
\n
2025/02/23 07:44:38 b9e8d99aeaa89f3012cc7348373b4efd28f7582fe95c4601f43962cbef120749 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=b9e8d99aeaa8\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux b9e8d99aeaa8 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267863.2680387,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267863.2751982,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267863.2753108,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
2025/02/23 07:44:38 ============== b9e8d99aeaa89f3012cc7348373b4efd28f7582fe95c4601f43962cbef120749 : END LOGS ==============\n
\n
\n
2025/02/23 07:44:39 ============================================\n
\n
\n
2025/02/23 07:44:39 247cb8edad6793302cff42740b2d9441adea25f0bfd745146bd8ff6911a77254 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=247cb8edad67\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 247cb8edad67 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267863.1622298,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267863.167647,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267863.1676805,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs1:8448/_matrix/federation/v1/make_join/!iit4Pb5FNhPjBzKgOE:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "942", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:44:28 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$x0Hh2u8nKS0HiFn2JNTlClO1VQfl9NxTAPIX6he7Pf4","$4BGp-1sxHtAtsdbviIBgQcaBxlFG7mYNUEHfgAFlCn4","$jYcEzmbmutHql0ockn1bWx1GsL-v1fjHp4iSu-lmdeY"],"content":{"membership":"join"},"depth":8,"event_sn":22,"hashes":{"sha256":"D//u8M7D4LRtMGYq82gzvJAIOmXvhZ1zUCl5AFTc1L4"},"origin":"hs1","origin_server_ts":1740267868932,"prev_events":["$4BGp-1sxHtAtsdbviIBgQcaBxlFG7mYNUEHfgAFlCn4","$6gYfBo--RVU2Uk6JWvWnl-MYH5kWOIk9PTQfYtVqKu0","$AhSFkaTMWVmgtR7psa95FvW-a7DHdnfI1rJxqHWImhs","$UY2OgEWtYD9-M8efQDS5A3XtdtjJmkyhk6LWyPVyhDc","$aiDU_ukHWhcach8OiJ5EbUsV36lGPEAK6TgszTg5mOk","$jYcEzmbmutHql0ockn1bWx1GsL-v1fjHp4iSu-lmdeY","$x0Hh2u8nKS0HiFn2JNTlClO1VQfl9NxTAPIX6he7Pf4"],"room_id":"!iit4Pb5FNhPjBzKgOE:hs1","sender":"@user-2:hs2","signatures":{"hs1":{"ed25519:wNyt2eEb":"OYML0qbjU4/2ryv8Nw4tZtjyozOYBKPfuP8hzq5OHgEPwNB6emOBVL0756OCRG8gutR4PSfLEquAdcI7OQ9oCA"}},"state_key":"@user-2:hs2","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:44:29.238782Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
  \u001b[2m2025-02-22T23:44:29.483990Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_join/!zbjWLQuYI194NED3ge:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5] 400 Bad Request: {"errcode":"M_UNABLE_TO_AUTHORISE_JOIN","error":"Palpo does not support restricted rooms yet."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_UNABLE_TO_AUTHORISE_JOIN\\",\\"error\\":\\"Palpo does not support restricted rooms yet.\\"}")}) }))\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
  \u001b[2m2025-02-22T23:44:29.520350Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_join/!zbjWLQuYI194NED3ge:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5] 400 Bad Request: {"errcode":"M_UNABLE_TO_AUTHORISE_JOIN","error":"Palpo does not support restricted rooms yet."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_UNABLE_TO_AUTHORISE_JOIN\\",\\"error\\":\\"Palpo does not support restricted rooms yet.\\"}")}) }))\n
  \u001b[2m2025-02-22T23:44:31.207576Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $4BGp-1sxHtAtsdbviIBgQcaBxlFG7mYNUEHfgAFlCn4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.208890Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $DgWDqEmfn9yClW4BNdY8YSg400AT6TcM6ye6BZIS0Qc\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:44:31.211311Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $x0Hh2u8nKS0HiFn2JNTlClO1VQfl9NxTAPIX6he7Pf4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.215167Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $UY2OgEWtYD9-M8efQDS5A3XtdtjJmkyhk6LWyPVyhDc\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.219398Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $6gYfBo--RVU2Uk6JWvWnl-MYH5kWOIk9PTQfYtVqKu0\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:44:31.221672Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $aiDU_ukHWhcach8OiJ5EbUsV36lGPEAK6TgszTg5mOk\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.224542Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $jYcEzmbmutHql0ockn1bWx1GsL-v1fjHp4iSu-lmdeY\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.226935Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $AhSFkaTMWVmgtR7psa95FvW-a7DHdnfI1rJxqHWImhs\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.266676Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $6gYfBo--RVU2Uk6JWvWnl-MYH5kWOIk9PTQfYtVqKu0\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:44:31.267708Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $jYcEzmbmutHql0ockn1bWx1GsL-v1fjHp4iSu-lmdeY\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.269813Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $UY2OgEWtYD9-M8efQDS5A3XtdtjJmkyhk6LWyPVyhDc\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.270979Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $DgWDqEmfn9yClW4BNdY8YSg400AT6TcM6ye6BZIS0Qc\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:44:31.272349Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $x0Hh2u8nKS0HiFn2JNTlClO1VQfl9NxTAPIX6he7Pf4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.274046Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $4BGp-1sxHtAtsdbviIBgQcaBxlFG7mYNUEHfgAFlCn4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.275481Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $aiDU_ukHWhcach8OiJ5EbUsV36lGPEAK6TgszTg5mOk\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.277008Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $AhSFkaTMWVmgtR7psa95FvW-a7DHdnfI1rJxqHWImhs\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.311964Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $UY2OgEWtYD9-M8efQDS5A3XtdtjJmkyhk6LWyPVyhDc\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.313439Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $6gYfBo--RVU2Uk6JWvWnl-MYH5kWOIk9PTQfYtVqKu0\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:44:31.314689Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $jYcEzmbmutHql0ockn1bWx1GsL-v1fjHp4iSu-lmdeY\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.315743Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $AhSFkaTMWVmgtR7psa95FvW-a7DHdnfI1rJxqHWImhs\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.317241Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $aiDU_ukHWhcach8OiJ5EbUsV36lGPEAK6TgszTg5mOk\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.318216Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $DgWDqEmfn9yClW4BNdY8YSg400AT6TcM6ye6BZIS0Qc\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:44:31.319384Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $4BGp-1sxHtAtsdbviIBgQcaBxlFG7mYNUEHfgAFlCn4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.320458Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $x0Hh2u8nKS0HiFn2JNTlClO1VQfl9NxTAPIX6he7Pf4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.345833Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $AhSFkaTMWVmgtR7psa95FvW-a7DHdnfI1rJxqHWImhs\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.347645Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $4BGp-1sxHtAtsdbviIBgQcaBxlFG7mYNUEHfgAFlCn4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.348958Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $6gYfBo--RVU2Uk6JWvWnl-MYH5kWOIk9PTQfYtVqKu0\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:44:31.351097Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $jYcEzmbmutHql0ockn1bWx1GsL-v1fjHp4iSu-lmdeY\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.353327Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $x0Hh2u8nKS0HiFn2JNTlClO1VQfl9NxTAPIX6he7Pf4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.355615Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $DgWDqEmfn9yClW4BNdY8YSg400AT6TcM6ye6BZIS0Qc\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:44:31.357800Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $UY2OgEWtYD9-M8efQDS5A3XtdtjJmkyhk6LWyPVyhDc\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.359082Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $aiDU_ukHWhcach8OiJ5EbUsV36lGPEAK6TgszTg5mOk\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.401550Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $UY2OgEWtYD9-M8efQDS5A3XtdtjJmkyhk6LWyPVyhDc\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.403814Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $aiDU_ukHWhcach8OiJ5EbUsV36lGPEAK6TgszTg5mOk\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.408121Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $x0Hh2u8nKS0HiFn2JNTlClO1VQfl9NxTAPIX6he7Pf4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.411438Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $AhSFkaTMWVmgtR7psa95FvW-a7DHdnfI1rJxqHWImhs\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.412926Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $DgWDqEmfn9yClW4BNdY8YSg400AT6TcM6ye6BZIS0Qc\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:44:31.417159Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $4BGp-1sxHtAtsdbviIBgQcaBxlFG7mYNUEHfgAFlCn4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.419550Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $6gYfBo--RVU2Uk6JWvWnl-MYH5kWOIk9PTQfYtVqKu0\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:44:31.423387Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $jYcEzmbmutHql0ockn1bWx1GsL-v1fjHp4iSu-lmdeY\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.447101Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $UY2OgEWtYD9-M8efQDS5A3XtdtjJmkyhk6LWyPVyhDc\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.449715Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $6gYfBo--RVU2Uk6JWvWnl-MYH5kWOIk9PTQfYtVqKu0\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:44:31.452264Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $x0Hh2u8nKS0HiFn2JNTlClO1VQfl9NxTAPIX6he7Pf4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.455363Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $aiDU_ukHWhcach8OiJ5EbUsV36lGPEAK6TgszTg5mOk\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.458191Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $4BGp-1sxHtAtsdbviIBgQcaBxlFG7mYNUEHfgAFlCn4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.459451Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $jYcEzmbmutHql0ockn1bWx1GsL-v1fjHp4iSu-lmdeY\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.460706Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $AhSFkaTMWVmgtR7psa95FvW-a7DHdnfI1rJxqHWImhs\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.461365Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $DgWDqEmfn9yClW4BNdY8YSg400AT6TcM6ye6BZIS0Qc\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:44:31.489243Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $DgWDqEmfn9yClW4BNdY8YSg400AT6TcM6ye6BZIS0Qc\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:44:31.490310Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $UY2OgEWtYD9-M8efQDS5A3XtdtjJmkyhk6LWyPVyhDc\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.491238Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $AhSFkaTMWVmgtR7psa95FvW-a7DHdnfI1rJxqHWImhs\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.492184Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $aiDU_ukHWhcach8OiJ5EbUsV36lGPEAK6TgszTg5mOk\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.493301Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $6gYfBo--RVU2Uk6JWvWnl-MYH5kWOIk9PTQfYtVqKu0\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:505\n
\n
  \u001b[2m2025-02-22T23:44:31.494565Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $4BGp-1sxHtAtsdbviIBgQcaBxlFG7mYNUEHfgAFlCn4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.496343Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $x0Hh2u8nKS0HiFn2JNTlClO1VQfl9NxTAPIX6he7Pf4\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
  \u001b[2m2025-02-22T23:44:31.497514Z\u001b[0m \u001b[31mERROR\u001b[0m \u001b[1;31mpalpo::bl::sync\u001b[0m\u001b[31m: \u001b[31mPdu in state not found: $jYcEzmbmutHql0ockn1bWx1GsL-v1fjHp4iSu-lmdeY\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/sync.rs:491\n
\n
2025/02/23 07:44:39 ============== 247cb8edad6793302cff42740b2d9441adea25f0bfd745146bd8ff6911a77254 : END LOGS ==============\n
\n
\n
2025/02/23 07:44:41 ============================================\n
\n
\n
2025/02/23 07:44:41 48d9cbfc0e71673f611618ea22d1fd5e44360e129ca4b5dddf8ca1d1987ad296 : Server logs:\n
SERVER_NAME=hs3\n
HOSTNAME=48d9cbfc0e71\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 48d9cbfc0e71 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267863.311216,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267863.3217406,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267863.3220968,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs3"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs1:8448/_matrix/federation/v1/make_join/!iit4Pb5FNhPjBzKgOE:hs1/@user-3:hs3?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "942", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:44:30 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$jYcEzmbmutHql0ockn1bWx1GsL-v1fjHp4iSu-lmdeY","$4BGp-1sxHtAtsdbviIBgQcaBxlFG7mYNUEHfgAFlCn4","$x0Hh2u8nKS0HiFn2JNTlClO1VQfl9NxTAPIX6he7Pf4"],"content":{"membership":"join"},"depth":8,"event_sn":23,"hashes":{"sha256":"l6rk1iKqfHRsA0uk3IokyjKgcGSAOmYurmrJNMc2K+o"},"origin":"hs1","origin_server_ts":1740267870429,"prev_events":["$4BGp-1sxHtAtsdbviIBgQcaBxlFG7mYNUEHfgAFlCn4","$6gYfBo--RVU2Uk6JWvWnl-MYH5kWOIk9PTQfYtVqKu0","$AhSFkaTMWVmgtR7psa95FvW-a7DHdnfI1rJxqHWImhs","$UY2OgEWtYD9-M8efQDS5A3XtdtjJmkyhk6LWyPVyhDc","$aiDU_ukHWhcach8OiJ5EbUsV36lGPEAK6TgszTg5mOk","$jYcEzmbmutHql0ockn1bWx1GsL-v1fjHp4iSu-lmdeY","$x0Hh2u8nKS0HiFn2JNTlClO1VQfl9NxTAPIX6he7Pf4"],"room_id":"!iit4Pb5FNhPjBzKgOE:hs1","sender":"@user-3:hs3","signatures":{"hs1":{"ed25519:wNyt2eEb":"yCgsFaSLo5gJQKZnINMXHE5tPLGWubTewJuSZ5DTez8TZbc83po+gpfFPUky6vbMonuGAyRI5HOMHLwxqkILAg"}},"state_key":"@user-3:hs3","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:44:30.679247Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs2"  servername:"hs3"\n
  \u001b[2m2025-02-22T23:44:31.026886Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs2:8448/_matrix/federation/v1/make_join/!zbjWLQuYI194NED3ge:hs1/@user-3:hs3?ver=[6,7,8,9,10,11,3,4,5] 404 Not Found: {"errcode":"M_NOT_FOUND","error":"Room is unknown to this server."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs2: {\\"errcode\\":\\"M_NOT_FOUND\\",\\"error\\":\\"Room is unknown to this server.\\"}")}) }))\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs3"\n
  \u001b[2m2025-02-22T23:44:31.057887Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_join/!zbjWLQuYI194NED3ge:hs1/@user-3:hs3?ver=[6,7,8,9,10,11,3,4,5] 400 Bad Request: {"errcode":"M_UNABLE_TO_AUTHORISE_JOIN","error":"Palpo does not support restricted rooms yet."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_UNABLE_TO_AUTHORISE_JOIN\\",\\"error\\":\\"Palpo does not support restricted rooms yet.\\"}")}) }))\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs2"  servername:"hs3"\n
  \u001b[2m2025-02-22T23:44:31.089767Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs2:8448/_matrix/federation/v1/make_join/!zbjWLQuYI194NED3ge:hs1/@user-3:hs3?ver=[6,7,8,9,10,11,3,4,5] 404 Not Found: {"errcode":"M_NOT_FOUND","error":"Room is unknown to this server."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs2: {\\"errcode\\":\\"M_NOT_FOUND\\",\\"error\\":\\"Room is unknown to this server.\\"}")}) }))\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs3"\n
  \u001b[2m2025-02-22T23:44:31.115808Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_join/!zbjWLQuYI194NED3ge:hs1/@user-3:hs3?ver=[6,7,8,9,10,11,3,4,5] 400 Bad Request: {"errcode":"M_UNABLE_TO_AUTHORISE_JOIN","error":"Palpo does not support restricted rooms yet."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_UNABLE_TO_AUTHORISE_JOIN\\",\\"error\\":\\"Palpo does not support restricted rooms yet.\\"}")}) }))\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs3"\n
  \u001b[2m2025-02-22T23:44:31.142179Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::federation\u001b[0m\u001b[33m: \u001b[33mhttps://hs1:8448/_matrix/federation/v1/make_join/!zbjWLQuYI194NED3ge:hs1/@user-3:hs3?ver=[6,7,8,9,10,11,3,4,5] 400 Bad Request: {"errcode":"M_UNABLE_TO_AUTHORISE_JOIN","error":"Palpo does not support restricted rooms yet."}\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/federation.rs:89\n
\n
rrrrrrrrmake_join_response: Err(Matrix(MatrixError { status_code: None, authenticate: None, kind: Unknown, body: ErrorBody({"error": String("Answer from hs1: {\\"errcode\\":\\"M_UNABLE_TO_AUTHORISE_JOIN\\",\\"error\\":\\"Palpo does not support restricted rooms yet.\\"}")}) }))\n
2025/02/23 07:44:41 ============== 48d9cbfc0e71673f611618ea22d1fd5e44360e129ca4b5dddf8ca1d1987ad296 : END LOGS ==============\n
\n
\n
--- FAIL: TestRestrictedRoomsRemoteJoinFailOver (34.64s)\n
null
null
=== RUN   TestClientSpacesSummary\n
    thread_notifications_test.go:76: Deploy times: 11.552816ms blueprints, 14.122025281s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (614.406839ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (676.956548ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (891.661686ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!JvDl7NiMvqe9SG3lkX:hs1 => 200 OK (164.31815ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (195.884367ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!JvDl7NiMvqe9SG3lkX:hs1/send/m.room.message/1 => 200 OK (73.72653ms)\n
    thread_notifications_test.go:90: SendEventSynced waiting for event ID $-4uYTlKb_EcdDK9PtkmqfJJ2VatsKqbxkY16TrbCGec\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (158.326339ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!JvDl7NiMvqe9SG3lkX:hs1/send/m.room.message/2 => 200 OK (96.419265ms)\n
    thread_notifications_test.go:100: SendEventSynced waiting for event ID $hCxOeE0MKPtsE9qbU5lWE0KzcWLENaCicjHNA9SmwDM\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (149.432909ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!JvDl7NiMvqe9SG3lkX:hs1/send/m.room.message/3 => 200 OK (131.653178ms)\n
    thread_notifications_test.go:111: SendEventSynced waiting for event ID $alT3Z_Ki-DugS7oBz4La7ldDXdYySJ2Q_GUKYDMigFw\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (157.192521ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!JvDl7NiMvqe9SG3lkX:hs1/send/m.room.message/4 => 200 OK (175.234444ms)\n
    thread_notifications_test.go:124: SendEventSynced waiting for event ID $4DiY9euUAXwZd89mT6W-rAjsxRgYQaJcYiC4WELn4Ek\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (230.646814ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!JvDl7NiMvqe9SG3lkX:hs1/send/m.room.message/5 => 200 OK (123.124765ms)\n
    thread_notifications_test.go:133: SendEventSynced waiting for event ID $iVvZlvbWrl2Az7dKOzg7_94bkqpVP23AHiRj1pjv84o\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (207.776352ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!JvDl7NiMvqe9SG3lkX:hs1/send/m.room.message/6 => 200 OK (143.902369ms)\n
    thread_notifications_test.go:147: SendEventSynced waiting for event ID $onyjFB7jxhkycAwyeGWCFBIXovl7ByUCxT4xE4d-kDo\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (187.722672ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!JvDl7NiMvqe9SG3lkX:hs1/send/m.room.reaction/7 => 200 OK (91.453493ms)\n
    thread_notifications_test.go:158: SendEventSynced waiting for event ID $WGXOInQvdCsZKBVihqSSHU_VQ-5DQ_nwVJAXsqIW32s\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (159.903543ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (159.099739ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.024509697s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.035779499s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.04418596s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.040113395s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.050304471s)\n
    thread_notifications_test.go:174: \u001b[31m@user-2:hs1 MustSyncUntil: timed out after 5.355054161s. Seen 6 /sync responses. Checkers:\n
        [t=159.321601ms] Response #1: syncHasUnreadNotifs(!JvDl7NiMvqe9SG3lkX:hs1): check function did not pass: {"highlight_count":0,"notification_count":0} / \n
        [t=1.183996315s] Response #2: syncHasUnreadNotifs(!JvDl7NiMvqe9SG3lkX:hs1): missing unread notifications\n
        [t=2.219924367s] Response #3: syncHasUnreadNotifs(!JvDl7NiMvqe9SG3lkX:hs1): missing unread notifications\n
        [t=3.264281813s] Response #4: syncHasUnreadNotifs(!JvDl7NiMvqe9SG3lkX:hs1): missing unread notifications\n
        [t=4.304608157s] Response #5: syncHasUnreadNotifs(!JvDl7NiMvqe9SG3lkX:hs1): missing unread notifications\n
        [t=5.355051377s] Response #6: syncHasUnreadNotifs(!JvDl7NiMvqe9SG3lkX:hs1): missing unread notifications, \n
        \u001b[39m\n
2025/02/23 07:44:55 ============================================\n
\n
\n
2025/02/23 07:44:55 04114b80b8ce45df531341fd95f807df4edb2de1c21ce6ea40be43807227b6da : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=04114b80b8ce\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 04114b80b8ce 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267880.4408226,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267880.4485638,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267880.448606,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:44:55 ============== 04114b80b8ce45df531341fd95f807df4edb2de1c21ce6ea40be43807227b6da : END LOGS ==============\n
\n
\n
--- FAIL: TestThreadedReceipts (25.82s)\n
null
null
=== RUN   TestThreadReceiptsInSyncMSC4102\n
    thread_notifications_test.go:308: WARNING: TestThreadReceiptsInSyncMSC4102 called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    room_hierarchy_test.go:86: Deploy times: 15.688836ms blueprints, 14.395227234s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (697.573213ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (512.94025ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (464.661484ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (695.898682ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (513.892858ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (619.634399ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (665.237022ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (726.555445ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.357293758s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.170803223s)\n
    room_hierarchy_test.go:154: map[!E2TVa39Cl9cEDKvpBM:hs1:Root !V8FKu9q3FNKT89QhRV:hs1:R5 !gufuotNFU7VhhqJba2:hs1:Sub-Space 1 !hjLO4J2dVBia3TjgNq:hs1:R1 !jVXQa3V3GbwFwRdi6A:hs1:SS2 !mCWSehYHFYPmI0MhZm:hs1:R4 !pOYhDnMpDr6l9Eub53:hs1:R2 !wknM7zN4Mu3udk9aTM:hs1:R3]\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!E2TVa39Cl9cEDKvpBM:hs1/state/m.space.child/!hjLO4J2dVBia3TjgNq:hs1 => 200 OK (123.984244ms)\n
    room_hierarchy_test.go:158: SendEventSynced waiting for event ID $yITQyeboajXWAVsbjWqnqkMMbbzySIZtGf1XIvuOMxc\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.48725984s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!E2TVa39Cl9cEDKvpBM:hs1/state/m.space.child/!gufuotNFU7VhhqJba2:hs1 => 200 OK (177.43964ms)\n
    room_hierarchy_test.go:167: SendEventSynced waiting for event ID $46a9Iu0i1qxQ_a4CPyGLE3vrz8U-N9SegB9c9dyx5QI\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.267711952s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!E2TVa39Cl9cEDKvpBM:hs1/state/m.space.child/!pOYhDnMpDr6l9Eub53:hs1 => 200 OK (153.061527ms)\n
    room_hierarchy_test.go:175: SendEventSynced waiting for event ID $1_IGkCwL27LGsPnIp8O_2TCrGaPw4tzHufzSAPukydg\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.107385034s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!pOYhDnMpDr6l9Eub53:hs1/state/m.space.child/!V8FKu9q3FNKT89QhRV:hs1 => 200 OK (236.230824ms)\n
    room_hierarchy_test.go:184: SendEventSynced waiting for event ID $0SKe0YiVXJZmdSmDj2WB2pcj-K6AALKXcCwzKY5Pg6k\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (923.825913ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!pOYhDnMpDr6l9Eub53:hs1/state/m.space.parent/!E2TVa39Cl9cEDKvpBM:hs1 => 200 OK (313.399705ms)\n
    room_hierarchy_test.go:191: SendEventSynced waiting for event ID $0jmtiYT2ICZ2AQaEoyKZxbRQUIxjsZZb0E6aWoVyuYo\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.167611119s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!gufuotNFU7VhhqJba2:hs1/state/m.space.child/!jVXQa3V3GbwFwRdi6A:hs1 => 200 OK (86.024215ms)\n
    room_hierarchy_test.go:199: SendEventSynced waiting for event ID $GigEUyd8pypqlqYGXXb7-tX680lQ2NZvR5sjlSLtkuw\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.207638797s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!jVXQa3V3GbwFwRdi6A:hs1/state/m.space.child/!wknM7zN4Mu3udk9aTM:hs1 => 200 OK (188.163895ms)\n
    room_hierarchy_test.go:207: SendEventSynced waiting for event ID $v1CNir1hkY5lCjlgNrDmzWiTBh34tsI8zLB90ng9fz4\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.164307228s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!jVXQa3V3GbwFwRdi6A:hs1/state/m.space.child/!mCWSehYHFYPmI0MhZm:hs1 => 200 OK (300.532509ms)\n
    room_hierarchy_test.go:215: SendEventSynced waiting for event ID $UPl6dCgt_XbD0lV-CSH6T9u56moxTv-lzv7g73I6pVE\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.052460347s)\n
null
=== RUN   TestClientSpacesSummary/query_whole_graph\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!E2TVa39Cl9cEDKvpBM:hs1/hierarchy => 200 OK (565.460717ms)\n
    room_hierarchy_test.go:228: \u001b[31mMatchResponse JSONCheckOff(rooms): unexpected item {"name":"R5","num_joined_members":1,"room_id":"!V8FKu9q3FNKT89QhRV:hs1","world_readable":false,"guest_can_join":false,"children_state":[]} (mapped value !V8FKu9q3FNKT89QhRV:hs1) - http://127.0.0.1:33195/_matrix/client/v1/rooms/%!E(MISSING)2TVa39Cl9cEDKvpBM:hs1/hierarchy => {"next_batch":"5","rooms":[{"name":"Root","num_joined_members":1,"room_id":"!E2TVa39Cl9cEDKvpBM:hs1","world_readable":false,"guest_can_join":false,"room_type":"m.space","children_state":[{"content":{"suggested":true,"via":["hs1"]},"origin_server_ts":1740267907387,"sender":"@user-1:hs1","state_key":"!pOYhDnMpDr6l9Eub53:hs1","type":"m.space.child"},{"content":{"suggested":true,"via":["hs1"]},"origin_server_ts":1740267904308,"sender":"@user-1:hs1","state_key":"!hjLO4J2dVBia3TjgNq:hs1","type":"m.space.child"},{"content":{"via":["hs1"]},"origin_server_ts":1740267905970,"sender":"@user-1:hs1","state_key":"!gufuotNFU7VhhqJba2:hs1","type":"m.space.child"}]},{"na
me":"R2","num_joined_members":1,"room_id":"!pOYhDnMpDr6l9Eub53:hs1","world_readable":false,"guest_can_join":false,"children_state":[{"content":{"via":["hs1"]},"origin_server_ts":1740267908634,"sender":"@user-1:hs1","state_key":"!V8FKu9q3FNKT89QhRV:hs1","type":"m.space.child"}]},{"name":"R5","num_joined_members":1,"room_id":"!V8FKu9q3FNKT89QhRV:hs1","world_readable":false,"guest_can_join":false,"children_state":[]},{"name":"R1","num_joined_members":1,"room_id":"!hjLO4J2dVBia3TjgNq:hs1","world_readable":false,"guest_can_join":false,"children_state":[]},{"name":"Sub-Space 1","num_joined_members":1,"room_id":"!gufuotNFU7VhhqJba2:hs1","topic":"Some topic for sub-space 1","world_readable":false,"guest_can_join":false,"room_type":"m.space","children_state":[{"content":{"via":["hs1"]},"origin_server_ts":1740267911253,"sender":"@user-1:hs1","state_key":"!jVXQa3V3GbwFwRdi6A:hs1","type":"m.space.child"}]}]}\u001b[39m\n
--- FAIL: TestClientSpacesSummary/query_whole_graph (0.57s)\n
null
null
=== RUN   TestClientSpacesSummary/max_depth\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!E2TVa39Cl9cEDKvpBM:hs1/hierarchy => 200 OK (6.802086ms)\n
    room_hierarchy_test.go:271: \u001b[31mMatchResponse JSONCheckOff(rooms.#(room_type=="m.space")#): unexpected item {"name":"Root","num_joined_members":1,"room_id":"!E2TVa39Cl9cEDKvpBM:hs1","world_readable":false,"guest_can_join":false,"room_type":"m.space","children_state":[{"content":{"suggested":true,"via":["hs1"]},"origin_server_ts":1740267907387,"sender":"@user-1:hs1","state_key":"!pOYhDnMpDr6l9Eub53:hs1","type":"m.space.child"},{"content":{"suggested":true,"via":["hs1"]},"origin_server_ts":1740267904308,"sender":"@user-1:hs1","state_key":"!hjLO4J2dVBia3TjgNq:hs1","type":"m.space.child"},{"content":{"via":["hs1"]},"origin_server_ts":1740267905970,"sender":"@user-1:hs1","state_key":"!gufuotNFU7VhhqJba2:hs1","type":"m.space.child"}]} (mapped value !E2TVa39Cl9cEDKvpBM:hs1|!pOYhDnMpDr6l9Eub53:hs1|m.space.child;!E2TVa39Cl9cEDKvpBM:hs1|!hjLO4J2dVBia3TjgNq:hs1|m.space.child;!E2TVa39Cl9cEDKvpBM:hs1|!gufuotNFU7VhhqJba2:hs1|m.space.child) - http://127.0.0.1:33195/_matrix/client/v1/rooms/%!E(MISSING)2TVa39Cl9cEDKvpBM:
hs1/hierarchy?max_depth=1 => {"next_batch":"4","rooms":[{"name":"Root","num_joined_members":1,"room_id":"!E2TVa39Cl9cEDKvpBM:hs1","world_readable":false,"guest_can_join":false,"room_type":"m.space","children_state":[{"content":{"suggested":true,"via":["hs1"]},"origin_server_ts":1740267907387,"sender":"@user-1:hs1","state_key":"!pOYhDnMpDr6l9Eub53:hs1","type":"m.space.child"},{"content":{"suggested":true,"via":["hs1"]},"origin_server_ts":1740267904308,"sender":"@user-1:hs1","state_key":"!hjLO4J2dVBia3TjgNq:hs1","type":"m.space.child"},{"content":{"via":["hs1"]},"origin_server_ts":1740267905970,"sender":"@user-1:hs1","state_key":"!gufuotNFU7VhhqJba2:hs1","type":"m.space.child"}]},{"name":"R2","num_joined_members":1,"room_id":"!pOYhDnMpDr6l9Eub53:hs1","world_readable":false,"guest_can_join":false,"children_state":[{"content":{"via":["hs1"]},"origin_server_ts":1740267908634,"sender":"@user-1:hs1","state_key":"!V8FKu9q3FNKT89QhRV:hs1","type":"m.space.child"}]},{"name":"R1","num_joined_members":1,"room_id":"!hjLO4J
2dVBia3TjgNq:hs1","world_readable":false,"guest_can_join":false,"children_state":[]},{"name":"Sub-Space 1","num_joined_members":1,"room_id":"!gufuotNFU7VhhqJba2:hs1","topic":"Some topic for sub-space 1","world_readable":false,"guest_can_join":false,"room_type":"m.space","children_state":[{"content":{"via":["hs1"]},"origin_server_ts":1740267911253,"sender":"@user-1:hs1","state_key":"!jVXQa3V3GbwFwRdi6A:hs1","type":"m.space.child"}]}]}\u001b[39m\n
--- FAIL: TestClientSpacesSummary/max_depth (0.01s)\n
null
null
=== RUN   TestClientSpacesSummary/suggested_only\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!E2TVa39Cl9cEDKvpBM:hs1/hierarchy => 200 OK (6.339593ms)\n
    room_hierarchy_test.go:297: \u001b[31mMatchResponse JSONCheckOff(rooms): unexpected item {"name":"R5","num_joined_members":1,"room_id":"!V8FKu9q3FNKT89QhRV:hs1","world_readable":false,"guest_can_join":false,"children_state":[]} (mapped value !V8FKu9q3FNKT89QhRV:hs1) - http://127.0.0.1:33195/_matrix/client/v1/rooms/%!E(MISSING)2TVa39Cl9cEDKvpBM:hs1/hierarchy?suggested_only=true => {"next_batch":"5","rooms":[{"name":"Root","num_joined_members":1,"room_id":"!E2TVa39Cl9cEDKvpBM:hs1","world_readable":false,"guest_can_join":false,"room_type":"m.space","children_state":[{"content":{"suggested":true,"via":["hs1"]},"origin_server_ts":1740267907387,"sender":"@user-1:hs1","state_key":"!pOYhDnMpDr6l9Eub53:hs1","type":"m.space.child"},{"content":{"suggested":true,"via":["hs1"]},"origin_server_ts":1740267904308,"sender":"@user-1:hs1","state_key":"!hjLO4J2dVBia3TjgNq:hs1","type":"m.space.child"},{"content":{"via":["hs1"]},"origin_server_ts":1740267905970,"sender":"@user-1:hs1","state_key":"!gufuotNFU7VhhqJba2:hs1","type":"m.
space.child"}]},{"name":"R2","num_joined_members":1,"room_id":"!pOYhDnMpDr6l9Eub53:hs1","world_readable":false,"guest_can_join":false,"children_state":[{"content":{"via":["hs1"]},"origin_server_ts":1740267908634,"sender":"@user-1:hs1","state_key":"!V8FKu9q3FNKT89QhRV:hs1","type":"m.space.child"}]},{"name":"R5","num_joined_members":1,"room_id":"!V8FKu9q3FNKT89QhRV:hs1","world_readable":false,"guest_can_join":false,"children_state":[]},{"name":"R1","num_joined_members":1,"room_id":"!hjLO4J2dVBia3TjgNq:hs1","world_readable":false,"guest_can_join":false,"children_state":[]},{"name":"Sub-Space 1","num_joined_members":1,"room_id":"!gufuotNFU7VhhqJba2:hs1","topic":"Some topic for sub-space 1","world_readable":false,"guest_can_join":false,"room_type":"m.space","children_state":[{"content":{"via":["hs1"]},"origin_server_ts":1740267911253,"sender":"@user-1:hs1","state_key":"!jVXQa3V3GbwFwRdi6A:hs1","type":"m.space.child"}]}]}\u001b[39m\n
--- FAIL: TestClientSpacesSummary/suggested_only (0.01s)\n
null
null
=== RUN   TestClientSpacesSummary/pagination\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!E2TVa39Cl9cEDKvpBM:hs1/hierarchy => 200 OK (4.230461ms)\n
    room_hierarchy_test.go:323: \u001b[31mMatchResponse JSONCheckOff(rooms): unexpected item {"name":"R2","num_joined_members":1,"room_id":"!pOYhDnMpDr6l9Eub53:hs1","world_readable":false,"guest_can_join":false,"children_state":[{"content":{"via":["hs1"]},"origin_server_ts":1740267908634,"sender":"@user-1:hs1","state_key":"!V8FKu9q3FNKT89QhRV:hs1","type":"m.space.child"}]} (mapped value !pOYhDnMpDr6l9Eub53:hs1) - http://127.0.0.1:33195/_matrix/client/v1/rooms/%!E(MISSING)2TVa39Cl9cEDKvpBM:hs1/hierarchy?limit=4 => {"next_batch":"4","rooms":[{"name":"Root","num_joined_members":1,"room_id":"!E2TVa39Cl9cEDKvpBM:hs1","world_readable":false,"guest_can_join":false,"room_type":"m.space","children_state":[{"content":{"suggested":true,"via":["hs1"]},"origin_server_ts":1740267907387,"sender":"@user-1:hs1","state_key":"!pOYhDnMpDr6l9Eub53:hs1","type":"m.space.child"},{"content":{"suggested":true,"via":["hs1"]},"origin_server_ts":1740267904308,"sender":"@user-1:hs1","state_key":"!hjLO4J2dVBia3TjgNq:hs1","type":"m.space.child"}
,{"content":{"via":["hs1"]},"origin_server_ts":1740267905970,"sender":"@user-1:hs1","state_key":"!gufuotNFU7VhhqJba2:hs1","type":"m.space.child"}]},{"name":"R2","num_joined_members":1,"room_id":"!pOYhDnMpDr6l9Eub53:hs1","world_readable":false,"guest_can_join":false,"children_state":[{"content":{"via":["hs1"]},"origin_server_ts":1740267908634,"sender":"@user-1:hs1","state_key":"!V8FKu9q3FNKT89QhRV:hs1","type":"m.space.child"}]},{"name":"R5","num_joined_members":1,"room_id":"!V8FKu9q3FNKT89QhRV:hs1","world_readable":false,"guest_can_join":false,"children_state":[]},{"name":"R1","num_joined_members":1,"room_id":"!hjLO4J2dVBia3TjgNq:hs1","world_readable":false,"guest_can_join":false,"children_state":[]}]}\u001b[39m\n
--- FAIL: TestClientSpacesSummary/pagination (0.00s)\n
null
null
=== RUN   TestClientSpacesSummary/redact_link\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!E2TVa39Cl9cEDKvpBM:hs1/state/m.space.child/!gufuotNFU7VhhqJba2:hs1 => 200 OK (219.712034ms)\n
    room_hierarchy_test.go:355: SendEventSynced waiting for event ID $bmPEN70cd8oDAWBVYfup9PWYr8EdvcBHy_gMfTRoTOw\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (1.167933865s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!E2TVa39Cl9cEDKvpBM:hs1/hierarchy => 200 OK (90.251961ms)\n
    room_hierarchy_test.go:361: \u001b[31mMatchResponse JSONCheckOff(rooms): unexpected item {"name":"R5","num_joined_members":1,"room_id":"!V8FKu9q3FNKT89QhRV:hs1","world_readable":false,"guest_can_join":false,"children_state":[]} (mapped value !V8FKu9q3FNKT89QhRV:hs1) - http://127.0.0.1:33195/_matrix/client/v1/rooms/%!E(MISSING)2TVa39Cl9cEDKvpBM:hs1/hierarchy => {"next_batch":"4","rooms":[{"name":"Root","num_joined_members":1,"room_id":"!E2TVa39Cl9cEDKvpBM:hs1","world_readable":false,"guest_can_join":false,"room_type":"m.space","children_state":[{"content":{"suggested":true,"via":["hs1"]},"origin_server_ts":1740267907387,"sender":"@user-1:hs1","state_key":"!pOYhDnMpDr6l9Eub53:hs1","type":"m.space.child"},{"content":{"suggested":true,"via":["hs1"]},"origin_server_ts":1740267904308,"sender":"@user-1:hs1","state_key":"!hjLO4J2dVBia3TjgNq:hs1","type":"m.space.child"}]},{"name":"R2","num_joined_members":1,"room_id":"!pOYhDnMpDr6l9Eub53:hs1","world_readable":false,"guest_can_join":false,"children_state":[{"content":{"
via":["hs1"]},"origin_server_ts":1740267908634,"sender":"@user-1:hs1","state_key":"!V8FKu9q3FNKT89QhRV:hs1","type":"m.space.child"}]},{"name":"R5","num_joined_members":1,"room_id":"!V8FKu9q3FNKT89QhRV:hs1","world_readable":false,"guest_can_join":false,"children_state":[]},{"name":"R1","num_joined_members":1,"room_id":"!hjLO4J2dVBia3TjgNq:hs1","world_readable":false,"guest_can_join":false,"children_state":[]}]}\u001b[39m\n
--- FAIL: TestClientSpacesSummary/redact_link (1.48s)\n
null
2025/02/23 07:45:18 ============================================\n
\n
\n
2025/02/23 07:45:18 3d1154a2023836b8e47fa690627d963283920313bc5dfb8c2cecb07983833312 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=3d1154a20238\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 3d1154a20238 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267892.5996947,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267892.6066604,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267892.6068277,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
To many layers, we have to go deeper frame_id: 19\n
To many layers, we have to go deeper frame_id: 27\n
To many layers, we have to go deeper frame_id: 34\n
To many layers, we have to go deeper frame_id: 41\n
To many layers, we have to go deeper frame_id: 48\n
To many layers, we have to go deeper frame_id: 56\n
To many layers, we have to go deeper frame_id: 60\n
To many layers, we have to go deeper frame_id: 63\n
To many layers, we have to go deeper frame_id: 64\n
To many layers, we have to go deeper frame_id: 66\n
2025/02/23 07:45:18 ============== 3d1154a2023836b8e47fa690627d963283920313bc5dfb8c2cecb07983833312 : END LOGS ==============\n
\n
\n
--- FAIL: TestClientSpacesSummary (37.54s)\n
null
null
=== RUN   TestClientSpacesSummaryJoinRules\n
    thread_notifications_test.go:309: Deploy times: 12.321469ms blueprints, 28.968801128s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (789.025738ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (813.684819ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (872.529095ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!JI1ab2J3LubO7ye4LZ:hs1 => 200 OK (1.244260335s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!JI1ab2J3LubO7ye4LZ:hs1/send/m.room.message/1 => 200 OK (148.169968ms)\n
    thread_notifications_test.go:317: SendEventSynced waiting for event ID $1soGyGdUlGJafrCAE3xRfKfw0DPzcJnmae_fOgPLFrA\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (243.748993ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!JI1ab2J3LubO7ye4LZ:hs1/send/m.room.message/2 => 200 OK (165.126784ms)\n
    thread_notifications_test.go:324: SendEventSynced waiting for event ID $IFdXb8I2ltrLbcXUiMtRMgbVOCyxd9_BNfjG30BlpLA\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (236.919457ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!JI1ab2J3LubO7ye4LZ:hs1/receipt/m.read/$IFdXb8I2ltrLbcXUiMtRMgbVOCyxd9_BNfjG30BlpLA => 200 OK (25.109848ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/rooms/!JI1ab2J3LubO7ye4LZ:hs1/receipt/m.read/$IFdXb8I2ltrLbcXUiMtRMgbVOCyxd9_BNfjG30BlpLA => 200 OK (15.305693ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (207.906699ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (88.590892ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.035229362s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.037452484s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.049892291s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.027008711s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v3/sync => 200 OK (1.033687631s)\n
    thread_notifications_test.go:348: \u001b[31m@user-2:hs2 MustSyncUntil: timed out after 5.27471659s. Seen 6 /sync responses. Checkers:\n
        [t=88.807387ms] Response #1: SyncEphemeralHas(!JI1ab2J3LubO7ye4LZ:hs1): check function did not pass while iterating over 2 elements: [{"type":"m.receipt","content":{"$tG5VtMiDqx6ZVzKr6xGXFMfKvbEKg6km7UD9HG7WyIg":{"m.read.private":{"@user-2:hs2":{}}}}},{"type":"m.typing","content":{"user_ids":[]}}]\n
        [t=1.125590778s] Response #2: SyncEphemeralHas(!JI1ab2J3LubO7ye4LZ:hs1): Key rooms.join.!JI1ab2J3LubO7ye4LZ:hs1.ephemeral.events does not exist\n
        [t=2.163591154s] Response #3: SyncEphemeralHas(!JI1ab2J3LubO7ye4LZ:hs1): Key rooms.join.!JI1ab2J3LubO7ye4LZ:hs1.ephemeral.events does not exist\n
        [t=3.213655703s] Response #4: SyncEphemeralHas(!JI1ab2J3LubO7ye4LZ:hs1): Key rooms.join.!JI1ab2J3LubO7ye4LZ:hs1.ephemeral.events does not exist\n
        [t=4.240829209s] Response #5: SyncEphemeralHas(!JI1ab2J3LubO7ye4LZ:hs1): Key rooms.join.!JI1ab2J3LubO7ye4LZ:hs1.ephemeral.events does not exist\n
        [t=5.274713315s] Response #6: SyncEphemeralHas(!JI1ab2J3LubO7ye4LZ:hs1): Key rooms.join.!JI1ab2J3LubO7ye4LZ:hs1.ephemeral.events does not exist, \n
        \u001b[39m\n
2025/02/23 07:45:35 ============================================\n
\n
\n
2025/02/23 07:45:35 affc17e1858805899b0d158e86477a8f3764c758e7e120a59e0def0eafc6e80d : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=affc17e18588\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux affc17e18588 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267920.4670022,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267920.474414,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267920.4744554,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs1:8448/_matrix/federation/v1/make_join/!JI1ab2J3LubO7ye4LZ:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "895", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:45:26 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$sXAWxAxKSDwfJo8zakeR1LvxOGKMbgGw1h8-wxnkDPc","$9v7Eedglgk06-FXJ-QhcBbvf2nROkFuJT1zHnfMGvF0","$nAFDYmfHynqk4YR0nGQkeT-vPgOvJSxvM75YazIq_Cs"],"content":{"membership":"join"},"depth":7,"event_sn":10,"hashes":{"sha256":"K1qlcxsSLK1tiOGAA3jXZqVI4IJTx0gFcIj1x3OB+HU"},"origin":"hs1","origin_server_ts":1740267927162,"prev_events":["$0reF5CNODn29F1YBPgEzcTMcXNXgV5H95l5HhHFCwN8","$15_Km154ZrsI1K2Sxa_Ot8HFSrBw5n3aAD7uTixD8IE","$9v7Eedglgk06-FXJ-QhcBbvf2nROkFuJT1zHnfMGvF0","$nAFDYmfHynqk4YR0nGQkeT-vPgOvJSxvM75YazIq_Cs","$sXAWxAxKSDwfJo8zakeR1LvxOGKMbgGw1h8-wxnkDPc","$w6_h3QlBtLxpEwDI-3Zb0gIzPF3vkxgsjl7WasOEdrw"],"room_id":"!JI1ab2J3LubO7ye4LZ:hs1","sender":"@user-2:hs2","signatures":{"hs1":{"ed25519:UtBPlQkY":"+XSJLbqrBnNdk78Km0henP7Ju9OMpnfZ/xiLRMFZ7/MUN5zDuNeQXfTsVucsEtQZsBCbFAPYqwiG8MkNXf8dAQ"}},"state_key":"@user-2:hs2","type":"m.room.member"}) })\n
  \u001b[2m2025-02-22T23:45:27.532461Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
2025/02/23 07:45:35 ============== affc17e1858805899b0d158e86477a8f3764c758e7e120a59e0def0eafc6e80d : END LOGS ==============\n
\n
\n
    room_hierarchy_test.go:396: Deploy times: 12.329181ms blueprints, 17.705331918s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (620.609624ms)\n
2025/02/23 07:45:37 ============================================\n
\n
\n
2025/02/23 07:45:37 bcec9cd312cc1b5d26e761a3b8a85e66e69385affa509de98be25d0e3815cd9b : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=bcec9cd312cc\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux bcec9cd312cc 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267920.4321232,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267920.4440196,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267920.4440548,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:45:37 ============== bcec9cd312cc1b5d26e761a3b8a85e66e69385affa509de98be25d0e3815cd9b : END LOGS ==============\n
\n
\n
--- FAIL: TestThreadReceiptsInSyncMSC4102 (42.28s)\n
null
null
=== RUN   TestToDeviceMessages\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (633.269751ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (518.853007ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (633.098746ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (760.914915ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (638.611849ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!drTyS9GJKQjaWPi6XI:hs1/state/m.space.child/!gYhf4Ffz5sbYlFS3rH:hs1 => 200 OK (92.670898ms)\n
    room_hierarchy_test.go:439: SendEventSynced waiting for event ID $sscFzbcR3DcVWJbX-mUvynNCjw72J9V8ga5fNtzu3l8\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (885.072877ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!drTyS9GJKQjaWPi6XI:hs1/state/m.space.child/!80Clp3pEXk4EL5iaG5:hs1 => 200 OK (145.518814ms)\n
    room_hierarchy_test.go:447: SendEventSynced waiting for event ID $7AW1tGN7suizQhVoAbrAW4GLEZcwsb3YWJssM0F-zFU\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (661.623761ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!80Clp3pEXk4EL5iaG5:hs1/state/m.space.child/!AuLxTV9VxItXQA3T0E:hs1 => 200 OK (112.733601ms)\n
    room_hierarchy_test.go:455: SendEventSynced waiting for event ID $4jNs7GYvOyKLLB7VuqzTZs19S2zayss5w0uLtfSoVmA\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (917.005383ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!80Clp3pEXk4EL5iaG5:hs1/state/m.space.child/!0bxbkuAVNjepH1rKgX:hs1 => 200 OK (97.23539ms)\n
    room_hierarchy_test.go:463: SendEventSynced waiting for event ID $hn1Ocdfymjkzg4cu06-tHNAlRg9Dsa5ap4GrkpLebxk\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (843.267795ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (680.521859ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!drTyS9GJKQjaWPi6XI:hs1 => 200 OK (268.000026ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!drTyS9GJKQjaWPi6XI:hs1/hierarchy => 200 OK (378.75479ms)\n
    room_hierarchy_test.go:476: \u001b[31mMatchResponse JSONCheckOff(rooms): unexpected item {"name":"R2","num_joined_members":1,"room_id":"!AuLxTV9VxItXQA3T0E:hs1","world_readable":true,"guest_can_join":false,"children_state":[]} (mapped value !AuLxTV9VxItXQA3T0E:hs1) - http://127.0.0.1:33201/_matrix/client/v1/rooms/%!d(MISSING)rTyS9GJKQjaWPi6XI:hs1/hierarchy => {"next_batch":"2","rooms":[{"name":"Root","num_joined_members":2,"room_id":"!drTyS9GJKQjaWPi6XI:hs1","world_readable":false,"guest_can_join":false,"room_type":"m.space","children_state":[{"content":{"via":["hs1"]},"origin_server_ts":1740267941523,"sender":"@user-1:hs1","state_key":"!80Clp3pEXk4EL5iaG5:hs1","type":"m.space.child"},{"content":{"via":["hs1"]},"origin_server_ts":1740267940504,"sender":"@user-1:hs1","state_key":"!gYhf4Ffz5sbYlFS3rH:hs1","type":"m.space.child"}]},{"name":"R2","num_joined_members":1,"room_id":"!AuLxTV9VxItXQA3T0E:hs1","world_readable":true,"guest_can_join":false,"children_state":[]}]}\u001b[39m\n
2025/02/23 07:45:47 ============================================\n
\n
\n
2025/02/23 07:45:47 fb7cde5e02cca3eaeee4f5e5ea7e5ba6feea4753a581cd6830b2faa73e4200bd : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=fb7cde5e02cc\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux fb7cde5e02cc 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267933.3440607,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267933.3512392,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267933.3513494,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 12\n
To many layers, we have to go deeper frame_id: 19\n
To many layers, we have to go deeper frame_id: 26\n
To many layers, we have to go deeper frame_id: 34\n
To many layers, we have to go deeper frame_id: 38\n
To many layers, we have to go deeper frame_id: 40\n
2025/02/23 07:45:47 ============== fb7cde5e02cca3eaeee4f5e5ea7e5ba6feea4753a581cd6830b2faa73e4200bd : END LOGS ==============\n
\n
\n
--- FAIL: TestClientSpacesSummaryJoinRules (28.53s)\n
null
null
=== RUN   TestFederatedClientSpaces\n
    to_device_test.go:18: Deploy times: 10.551647ms blueprints, 22.437942274s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (894.153994ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (821.624527ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (956.991994ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (149.841874ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (29.197776ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/sendToDevice/my.test.type/1 => 200 OK (32.501598ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (80.575858ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (67.295351ms)\n
2025/02/23 07:46:04 ============================================\n
\n
\n
2025/02/23 07:46:04 9356b8f57ae19e559512fdcbf5e565f566900f7b77e273b0cbdf57b213a99ac5 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=9356b8f57ae1\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 9356b8f57ae1 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267955.7482646,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267955.7529814,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267955.753013,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:46:04 ============== 9356b8f57ae19e559512fdcbf5e565f566900f7b77e273b0cbdf57b213a99ac5 : END LOGS ==============\n
\n
\n
--- PASS: TestToDeviceMessages (27.48s)\n
null
null
=== RUN   TestTxnInEvent\n
    txnid_test.go:21: WARNING: TestTxnInEvent called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
2025/02/23 07:46:18 ============================================\n
\n
\n
2025/02/23 07:46:18 fed.2_servers.hs1 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=1dc2e46dffe1\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 1dc2e46dffe1 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267976.044118,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267976.0528214,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267976.0529585,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:46:18 ============== fed.2_servers.hs1 : END LOGS ==============\n
\n
\n
2025/02/23 07:46:18 ============== While deploying complement_fed_65_fed.2_servers.hs1_1 : START ALL COMPLEMENT DOCKER PORT BINDINGS ==============\n
2025/02/23 07:46:18 Container: 596cf5316ac7d0d909d85f33ef9dd23fc2146410595eee6ce206c0e7cad91922: [/complement_csapi_90_csapi.1_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33209 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33210 -> 8448/tcp\n
2025/02/23 07:46:18 Container: 500bff10c599242bafc1729b680fe41fef0f4fd77dfcee13cb5768f521b568f1: [/complement_fed_65_fed.2_servers.hs2_2]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33207 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33208 -> 8448/tcp\n
2025/02/23 07:46:18 Container: 1dc2e46dffe1c40f4c7c50655392c9ad2d5d88087ef978e9101cdb0122fe207c: [/complement_fed_65_fed.2_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33205 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33206 -> 8448/tcp\n
2025/02/23 07:46:18 Container: f849b39b7953a93063fc8904f0a22cca38050590ae61960b02def9b1d5730988: [/complement_fed_56_fed.1_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33157 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33158 -> 8448/tcp\n
2025/02/23 07:46:18 Container: 44fc07da9a8929ff2206cbce34728b010434a66f84d479d697c28b1fe3a5fc82: [/complement_csapi_80_csapi.1_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33155 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33156 -> 8448/tcp\n
2025/02/23 07:46:18 Container: 7a466f5fa45ea54935b9453592b832331ece1c7e168e368bd4481a1c7f858d3a: [/complement_fed_55_fed.2_servers.hs2_2]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33153 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33154 -> 8448/tcp\n
2025/02/23 07:46:18 Container: 2885acfeddf9aef94a40588b85c26c9d1052f32dd96d906aed1376935500953b: [/complement_fed_55_fed.2_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33151 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33152 -> 8448/tcp\n
2025/02/23 07:46:18 Container: e0650fcdabed75fb20691e001bff7365e02f8534e05c5c295e5f69d2572bdce5: [/complement_csapi_79_csapi.1_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33149 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33150 -> 8448/tcp\n
2025/02/23 07:46:18 Container: f3e3c088ce0a8df7830796cccb8804485e724a6be7f4976e623b4be331f78175: [/complement_fed_54_fed.1_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33147 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33148 -> 8448/tcp\n
2025/02/23 07:46:18 Container: 9256a4e5369f43849ec092402cf44f0b36ebd458cedcef8648609a8a8dcef171: [/complement_csapi_78_csapi.1_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33145 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33146 -> 8448/tcp\n
2025/02/23 07:46:18 Container: 8f5cc968b7b11456ce6c3bc46d22af38a10c22bf4c39989d4dc8b94389042ab9: [/complement_fed.hs_with_application_service.hs2]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 457b2602f4ecd40565226f12ef552c0f8c8aa74f985545923fd8f61b3bb8876d: [/complement_fed.hs_with_application_service.hs1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 1dbc82506f8b6c347140e464eb229ea2276bb61d8e36474f6a3e73414422269f: [/complement_csapi.2_servers.hs2]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: fc0d7abe083e0ff1e87dbd0431bb9ee54092d429d2d45ccc837c5e57030556dc: [/complement_csapi.2_servers.hs1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 03e855d8b56e542d3b9388513d3091081cbdfd6454de54c9a5dfb38c36969933: [/complement_fed.2_servers.hs2]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 3e196ce98f6d96b9161e12256a117faa6a7d588301e6e20f3efbdece097728e3: [/complement_fed.2_servers.hs1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 47b3d5eeeeed234a4f4ffa7f74a9c9c705bae1aedd721747f354b42f936b625f: [/complement_fed.3_servers.hs3]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 949c2a09607571caf4c8412e5c666a3fc44c45d1bc263cfd751eebffbf81e389: [/complement_fed.3_servers.hs2]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 3ef6f9294cd7c90643b01a93347a4bc7946a8b1130db336bb1e6bcc7842c5fe9: [/complement_fed.3_servers.hs1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 0ad13e17fbfcc7ab04525caeb127eed438a405e9230ae2b177ffe73017823b6f: [/complement_fed.1_servers.hs1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 4c2d7803dd9fc6ce3390f6e9cf322905cfc8e11f58e38387ff37241f2244e390: [/complement_csapi.1_servers.hs1]\n
2025/02/23 07:46:18 ============================================\n
\n
\n
2025/02/23 07:46:18 fed.2_servers.hs2 : Server logs:\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 =============== While deploying complement_fed_65_fed.2_servers.hs1_1 : END ALL COMPLEMENT DOCKER PORT BINDINGS ===============\n
\n
\n
SERVER_NAME=hs2\n
HOSTNAME=500bff10c599\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 500bff10c599 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267975.5906842,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267975.5996928,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267975.5997221,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:46:18 ============== fed.2_servers.hs2 : END LOGS ==============\n
\n
\n
2025/02/23 07:46:18 ============== While deploying complement_fed_65_fed.2_servers.hs2_2 : START ALL COMPLEMENT DOCKER PORT BINDINGS ==============\n
2025/02/23 07:46:18 Container: 596cf5316ac7d0d909d85f33ef9dd23fc2146410595eee6ce206c0e7cad91922: [/complement_csapi_90_csapi.1_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33209 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33210 -> 8448/tcp\n
2025/02/23 07:46:18 Container: 500bff10c599242bafc1729b680fe41fef0f4fd77dfcee13cb5768f521b568f1: [/complement_fed_65_fed.2_servers.hs2_2]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33207 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33208 -> 8448/tcp\n
2025/02/23 07:46:18 Container: 1dc2e46dffe1c40f4c7c50655392c9ad2d5d88087ef978e9101cdb0122fe207c: [/complement_fed_65_fed.2_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33205 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33206 -> 8448/tcp\n
2025/02/23 07:46:18 Container: f849b39b7953a93063fc8904f0a22cca38050590ae61960b02def9b1d5730988: [/complement_fed_56_fed.1_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33157 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33158 -> 8448/tcp\n
2025/02/23 07:46:18 Container: 44fc07da9a8929ff2206cbce34728b010434a66f84d479d697c28b1fe3a5fc82: [/complement_csapi_80_csapi.1_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33156 -> 8448/tcp\n
2025/02/23 07:46:18     127.0.0.1:33155 -> 8008/tcp\n
2025/02/23 07:46:18 Container: 7a466f5fa45ea54935b9453592b832331ece1c7e168e368bd4481a1c7f858d3a: [/complement_fed_55_fed.2_servers.hs2_2]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33153 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33154 -> 8448/tcp\n
2025/02/23 07:46:18 Container: 2885acfeddf9aef94a40588b85c26c9d1052f32dd96d906aed1376935500953b: [/complement_fed_55_fed.2_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33151 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33152 -> 8448/tcp\n
2025/02/23 07:46:18 Container: e0650fcdabed75fb20691e001bff7365e02f8534e05c5c295e5f69d2572bdce5: [/complement_csapi_79_csapi.1_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33150 -> 8448/tcp\n
2025/02/23 07:46:18     127.0.0.1:33149 -> 8008/tcp\n
2025/02/23 07:46:18 Container: f3e3c088ce0a8df7830796cccb8804485e724a6be7f4976e623b4be331f78175: [/complement_fed_54_fed.1_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33147 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33148 -> 8448/tcp\n
2025/02/23 07:46:18 Container: 9256a4e5369f43849ec092402cf44f0b36ebd458cedcef8648609a8a8dcef171: [/complement_csapi_78_csapi.1_servers.hs1_1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18     127.0.0.1:33145 -> 8008/tcp\n
2025/02/23 07:46:18     127.0.0.1:33146 -> 8448/tcp\n
2025/02/23 07:46:18 Container: 8f5cc968b7b11456ce6c3bc46d22af38a10c22bf4c39989d4dc8b94389042ab9: [/complement_fed.hs_with_application_service.hs2]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 457b2602f4ecd40565226f12ef552c0f8c8aa74f985545923fd8f61b3bb8876d: [/complement_fed.hs_with_application_service.hs1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 1dbc82506f8b6c347140e464eb229ea2276bb61d8e36474f6a3e73414422269f: [/complement_csapi.2_servers.hs2]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: fc0d7abe083e0ff1e87dbd0431bb9ee54092d429d2d45ccc837c5e57030556dc: [/complement_csapi.2_servers.hs1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 03e855d8b56e542d3b9388513d3091081cbdfd6454de54c9a5dfb38c36969933: [/complement_fed.2_servers.hs2]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 3e196ce98f6d96b9161e12256a117faa6a7d588301e6e20f3efbdece097728e3: [/complement_fed.2_servers.hs1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 47b3d5eeeeed234a4f4ffa7f74a9c9c705bae1aedd721747f354b42f936b625f: [/complement_fed.3_servers.hs3]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 949c2a09607571caf4c8412e5c666a3fc44c45d1bc263cfd751eebffbf81e389: [/complement_fed.3_servers.hs2]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 3ef6f9294cd7c90643b01a93347a4bc7946a8b1130db336bb1e6bcc7842c5fe9: [/complement_fed.3_servers.hs1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 0ad13e17fbfcc7ab04525caeb127eed438a405e9230ae2b177ffe73017823b6f: [/complement_fed.1_servers.hs1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 Container: 4c2d7803dd9fc6ce3390f6e9cf322905cfc8e11f58e38387ff37241f2244e390: [/complement_csapi.1_servers.hs1]\n
2025/02/23 07:46:18     (host) -> (container)\n
2025/02/23 07:46:18 =============== While deploying complement_fed_65_fed.2_servers.hs2_2 : END ALL COMPLEMENT DOCKER PORT BINDINGS ===============\n
\n
\n
    room_hierarchy_test.go:544: \u001b[31mDeploy: Deploy returned error Deploy: Failed to deploy image {Containers:-1 Created:1740265967 ID:sha256:8ea8a4e96904934b4e5fb551b9cf50cfe3218dae330a38ef13437ef05b67a9cb Labels:map[complement_blueprint:2_servers complement_context:fed.2_servers.hs2 complement_hs_name:hs2 complement_pkg:fed org.opencontainers.image.source:https://github.com/rust-lang/docker-rust] ParentID:sha256:43423fed373499994daef88954f4eec573152502bf76e064a0ec7133928dbc93 RepoDigests:[] RepoTags:[localhost/complement:fed.2_servers.hs2] SharedSize:-1 Size:2980705910 VirtualSize:0} : fed.2_servers.hs2: failed to check server is up. timed out checking for homeserver to be up: GET http://127.0.0.1:33207/_matrix/client/versions => error: Get "http://127.0.0.1:33207/_matrix/client/versions": read tcp 127.0.0.1:49478->127.0.0.1:33207: read: connection reset by peer\u001b[39m\n
--- FAIL: TestFederatedClientSpaces (31.04s)\n
null
null
=== RUN   TestJumpToDateEndpoint\n
    txnid_test.go:23: Deploy times: 40.726438ms blueprints, 26.536065468s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (733.741178ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (980.370012ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!EqEHQD5RxEKg4KJCm9:hs1/send/m.room.message/abcdefg => 200 OK (147.207146ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/rooms/!EqEHQD5RxEKg4KJCm9:hs1/event/$M2M7YflxwVvbXGSKI6myQIx_2UIBpqCTmy-xcINAfcc => 200 OK (22.324454ms)\n
2025/02/23 07:46:35 ============================================\n
\n
\n
2025/02/23 07:46:35 596cf5316ac7d0d909d85f33ef9dd23fc2146410595eee6ce206c0e7cad91922 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=596cf5316ac7\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 596cf5316ac7 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740267987.7511373,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740267987.7588966,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740267987.7589269,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:46:35 ============== 596cf5316ac7d0d909d85f33ef9dd23fc2146410595eee6ce206c0e7cad91922 : END LOGS ==============\n
\n
\n
--- PASS: TestTxnInEvent (30.66s)\n
null
null
=== RUN   TestTxnScopeOnLocalEcho\n
    txnid_test.go:75: WARNING: TestTxnScopeOnLocalEcho called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    room_timestamp_to_event_test.go:29: OldDeploy times: 18.658407ms blueprints, 27.837107424s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (704.895462ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/register => 200 OK (792.242119ms)\n
    room_timestamp_to_event_test.go:40: WARNING: Deployment.Client - HS name 'hs1' - user ID '@the-bridge-user:hs1' - deviceID not found\n
null
=== RUN   TestJumpToDateEndpoint/parallel\n
null
=== RUN   TestJumpToDateEndpoint/parallel/should_find_event_after_given_timestmap\n
=== PAUSE TestJumpToDateEndpoint/parallel/should_find_event_after_given_timestmap\n
null
null
=== RUN   TestJumpToDateEndpoint/parallel/should_find_event_before_given_timestmap\n
=== PAUSE TestJumpToDateEndpoint/parallel/should_find_event_before_given_timestmap\n
null
null
=== RUN   TestJumpToDateEndpoint/parallel/should_find_nothing_before_the_earliest_timestmap\n
=== PAUSE TestJumpToDateEndpoint/parallel/should_find_nothing_before_the_earliest_timestmap\n
null
null
=== RUN   TestJumpToDateEndpoint/parallel/should_find_nothing_after_the_latest_timestmap\n
=== PAUSE TestJumpToDateEndpoint/parallel/should_find_nothing_after_the_latest_timestmap\n
null
null
=== RUN   TestJumpToDateEndpoint/parallel/should_find_next_event_topologically_before_given_timestamp_when_all_message_timestamps_are_the_same\n
=== PAUSE TestJumpToDateEndpoint/parallel/should_find_next_event_topologically_before_given_timestamp_when_all_message_timestamps_are_the_same\n
null
null
=== RUN   TestJumpToDateEndpoint/parallel/should_find_next_event_topologically_after_given_timestmap_when_all_message_timestamps_are_the_same\n
=== PAUSE TestJumpToDateEndpoint/parallel/should_find_next_event_topologically_after_given_timestmap_when_all_message_timestamps_are_the_same\n
null
null
=== RUN   TestJumpToDateEndpoint/parallel/should_not_be_able_to_query_a_private_room_you_are_not_a_member_of\n
=== PAUSE TestJumpToDateEndpoint/parallel/should_not_be_able_to_query_a_private_room_you_are_not_a_member_of\n
null
null
=== RUN   TestJumpToDateEndpoint/parallel/should_not_be_able_to_query_a_public_room_you_are_not_a_member_of\n
=== PAUSE TestJumpToDateEndpoint/parallel/should_not_be_able_to_query_a_public_room_you_are_not_a_member_of\n
null
null
=== RUN   TestJumpToDateEndpoint/parallel/federation\n
null
=== RUN   TestJumpToDateEndpoint/parallel/federation/looking_forwards,_should_be_able_to_find_event_that_was_sent_before_we_joined\n
=== PAUSE TestJumpToDateEndpoint/parallel/federation/looking_forwards,_should_be_able_to_find_event_that_was_sent_before_we_joined\n
null
null
=== RUN   TestJumpToDateEndpoint/parallel/federation/looking_backwards,_should_be_able_to_find_event_that_was_sent_before_we_joined\n
=== PAUSE TestJumpToDateEndpoint/parallel/federation/looking_backwards,_should_be_able_to_find_event_that_was_sent_before_we_joined\n
null
null
=== RUN   TestJumpToDateEndpoint/parallel/federation/when_looking_backwards_before_the_room_was_created,_should_be_able_to_find_event_that_was_imported\n
=== PAUSE TestJumpToDateEndpoint/parallel/federation/when_looking_backwards_before_the_room_was_created,_should_be_able_to_find_event_that_was_imported\n
null
null
=== RUN   TestJumpToDateEndpoint/parallel/federation/can_paginate_after_getting_remote_event_from_timestamp_to_event_endpoint\n
=== PAUSE TestJumpToDateEndpoint/parallel/federation/can_paginate_after_getting_remote_event_from_timestamp_to_event_endpoint\n
null
null
=== CONT  TestJumpToDateEndpoint/parallel/federation/looking_forwards,_should_be_able_to_find_event_that_was_sent_before_we_joined\n
null
=== CONT  TestJumpToDateEndpoint/parallel/federation/when_looking_backwards_before_the_room_was_created,_should_be_able_to_find_event_that_was_imported\n
null
=== CONT  TestJumpToDateEndpoint/parallel/federation/looking_backwards,_should_be_able_to_find_event_that_was_sent_before_we_joined\n
null
=== CONT  TestJumpToDateEndpoint/parallel/federation/can_paginate_after_getting_remote_event_from_timestamp_to_event_endpoint\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.583013233s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.621429406s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.658683948s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.688082536s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!fCG30B7CGN8VTAa7Cr:hs1/send/m.room.message/1 => 200 OK (384.426846ms)\n
    room_timestamp_to_event_test.go:166: SendEventSynced waiting for event ID $0n_Lp37dAz9W7IheZQHDDdP3DRAmaeEprwy74KWMA4o\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!WmSVdVS1nL5IxcylrH:hs1/send/m.room.message/2 => 200 OK (372.499077ms)\n
    room_timestamp_to_event_test.go:181: SendEventSynced waiting for event ID $GKiFanLg8M2clq8GCBszAKv-S_X95wplWAxc33A9u5w\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1qGgwXZfHjjw2WcwCx:hs1/send/m.room.message/3 => 200 OK (438.382152ms)\n
    room_timestamp_to_event_test.go:173: SendEventSynced waiting for event ID $7-KbKVIx84NnLklu5dQflIh8EqUjdeznQaUUHP-eBTY\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!YLpkhhodVvw74tN4af:hs1/send/m.room.message/4 => 200 OK (446.349345ms)\n
    room_timestamp_to_event_test.go:197: SendEventSynced waiting for event ID $h-fM6vwNRljyR2qTJ2x4AgiKvZjqBTDi4oVIe0RTO1M\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.368347161s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.445393789s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.297500776s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.345428929s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!WmSVdVS1nL5IxcylrH:hs1/send/m.room.message/5 => 200 OK (509.558242ms)\n
    room_timestamp_to_event_test.go:181: SendEventSynced waiting for event ID $Rqjzsi-mAvJmpGYx2xIvmj0DkXWl-IbJCwHnOIPyx5E\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!1qGgwXZfHjjw2WcwCx:hs1/send/m.room.message/8 => 200 OK (473.970258ms)\n
    room_timestamp_to_event_test.go:173: SendEventSynced waiting for event ID $AbSYpbvpE5QhzwAaVyOa1kUqQVLqfNxw4egzQOZE_oQ\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!YLpkhhodVvw74tN4af:hs1/send/m.room.message/7 => 200 OK (505.095093ms)\n
    room_timestamp_to_event_test.go:197: SendEventSynced waiting for event ID $fQV18MkMdT5vd47Cj6bnsNARVS3EQk7_yIEYbBjvi0g\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!fCG30B7CGN8VTAa7Cr:hs1/send/m.room.message/6 => 200 OK (526.777864ms)\n
    room_timestamp_to_event_test.go:166: SendEventSynced waiting for event ID $rgdotr7DfLStGQq8Gw9-18K7s7_o177orejt37iAV7U\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.152877394s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.093254562s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!WmSVdVS1nL5IxcylrH:hs1 => 401 Unauthorized (19.374341ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:33211/_matrix/client/v3/join/%21WmSVdVS1nL5IxcylrH:hs1?server_name=hs1 returned non-2xx code: 401 Unauthorized - body: {"errcode":"M_UNKNOWN_TOKEN","error":"Unknown access token"}\u001b[39m\n
--- FAIL: TestJumpToDateEndpoint/parallel/federation/when_looking_backwards_before_the_room_was_created,_should_be_able_to_find_event_that_was_imported (8.05s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.19738585s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (2.413562027s)\n
    txnid_test.go:77: Deploy times: 13.73629ms blueprints, 21.103378774s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (779.209646ms)\n
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!fCG30B7CGN8VTAa7Cr:hs1 => 200 OK (1.788401383s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v1/rooms/!fCG30B7CGN8VTAa7Cr:hs1/timestamp_to_event => 200 OK (22.696862ms)\n
    room_timestamp_to_event_test.go:168: \u001b[31mJSONFieldStr: key 'event_id' missing from {}\u001b[39m\n
--- FAIL: TestJumpToDateEndpoint/parallel/federation/looking_forwards,_should_be_able_to_find_event_that_was_sent_before_we_joined (10.17s)\n
null
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!YLpkhhodVvw74tN4af:hs1 => 200 OK (2.302338849s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (717.611593ms)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v1/rooms/!YLpkhhodVvw74tN4af:hs1/timestamp_to_event => 200 OK (36.412231ms)\n
    room_timestamp_to_event_test.go:199: \u001b[31mJSONFieldStr: key 'event_id' missing from {}\u001b[39m\n
--- FAIL: TestJumpToDateEndpoint/parallel/federation/can_paginate_after_getting_remote_event_from_timestamp_to_event_endpoint (10.38s)\n
null
    client.go:706: [CSAPI] POST hs2/_matrix/client/v3/join/!1qGgwXZfHjjw2WcwCx:hs1 => 200 OK (2.26269165s)\n
    client.go:706: [CSAPI] GET hs2/_matrix/client/v1/rooms/!1qGgwXZfHjjw2WcwCx:hs1/timestamp_to_event => 200 OK (9.212758ms)\n
    room_timestamp_to_event_test.go:175: \u001b[31mJSONFieldStr: key 'event_id' missing from {}\u001b[39m\n
--- FAIL: TestJumpToDateEndpoint/parallel/federation/looking_backwards,_should_be_able_to_find_event_that_was_sent_before_we_joined (10.39s)\n
null
--- FAIL: TestJumpToDateEndpoint/parallel/federation (0.00s)\n
null
null
=== CONT  TestJumpToDateEndpoint/parallel/should_find_event_after_given_timestmap\n
null
=== CONT  TestJumpToDateEndpoint/parallel/should_not_be_able_to_query_a_public_room_you_are_not_a_member_of\n
null
=== CONT  TestJumpToDateEndpoint/parallel/should_find_nothing_after_the_latest_timestmap\n
null
=== CONT  TestJumpToDateEndpoint/parallel/should_not_be_able_to_query_a_private_room_you_are_not_a_member_of\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (500.526915ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!ZdKlPXM0ORabRQu0Hp:hs1/send/m.room.message/abdefgh => 200 OK (153.744095ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (184.599205ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (593.050172ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (99.053837ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.333624755s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.333990153s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.394905723s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.414184561s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!TBlb7amThD6CkYpH1h:hs1/send/m.room.message/9 => 200 OK (195.535428ms)\n
    room_timestamp_to_event_test.go:64: SendEventSynced waiting for event ID $-mD2gHeV2BJxEQ4tN9JWp2QnwGFzj5b7jwnszqvKLTI\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!WTDIalq6U8ZqtKELGm:hs1/send/m.room.message/10 => 200 OK (149.403738ms)\n
    room_timestamp_to_event_test.go:45: SendEventSynced waiting for event ID $IzwxvgRbyenSQohMnJ_LHL3pvvCSWR0B0EctntsWrec\n
2025/02/23 07:47:01 ============================================\n
\n
\n
2025/02/23 07:47:01 9826b8cabf3eeb953432f0f187971a98babc3baf05f037f435dd6c91f8321e19 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=9826b8cabf3e\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 9826b8cabf3e 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740268012.915379,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740268012.922922,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740268012.9231184,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:47:01 ============== 9826b8cabf3eeb953432f0f187971a98babc3baf05f037f435dd6c91f8321e19 : END LOGS ==============\n
\n
\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (900.184783ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!Fo2Q8bB4IcjWn8R9qq:hs1/timestamp_to_event => 200 OK (5.115107ms)\n
    room_timestamp_to_event_test.go:159: /timestamp_to_event returned 200 HTTP status code but expected 403\n
--- FAIL: TestJumpToDateEndpoint/parallel/should_not_be_able_to_query_a_public_room_you_are_not_a_member_of (3.25s)\n
null
null
=== CONT  TestJumpToDateEndpoint/parallel/should_find_event_before_given_timestmap\n
--- PASS: TestTxnScopeOnLocalEcho (25.99s)\n
null
null
=== RUN   TestTxnIdempotencyScopedToDevice\n
    txnid_test.go:117: WARNING: TestTxnIdempotencyScopedToDevice called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (1.344497885s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!t1tSQPFfrMHjBWmJvo:hs1/timestamp_to_event => 200 OK (117.302951ms)\n
    room_timestamp_to_event_test.go:131: /timestamp_to_event returned 200 HTTP status code but expected 403\n
--- FAIL: TestJumpToDateEndpoint/parallel/should_not_be_able_to_query_a_private_room_you_are_not_a_member_of (3.89s)\n
null
null
=== CONT  TestJumpToDateEndpoint/parallel/should_find_nothing_before_the_earliest_timestmap\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (4.6534508s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (5.509849941s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!TBlb7amThD6CkYpH1h:hs1/send/m.room.message/11 => 200 OK (978.435115ms)\n
    room_timestamp_to_event_test.go:64: SendEventSynced waiting for event ID $_2UGwOEVJUM5DLN0heq0uD1BeMpeZwhsD0hAJBa6V9Y\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (4.92566669s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (4.363250045s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!WTDIalq6U8ZqtKELGm:hs1/send/m.room.message/12 => 200 OK (733.692509ms)\n
    room_timestamp_to_event_test.go:45: SendEventSynced waiting for event ID $5RyTGv7KcDKAGucK6Cr5YND9BaBqC3RoLqSxrAcISSI\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!CHQWUcIGXN4m3a8ALj:hs1/send/m.room.message/13 => 200 OK (613.450272ms)\n
    room_timestamp_to_event_test.go:51: SendEventSynced waiting for event ID $aBkQMt-DUjgQGXDzvBaNE2bStVaeepgXHl_CD2NfJ7w\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!5FnRNPG05XAdZzCDmL:hs1/send/m.room.message/14 => 200 OK (578.662027ms)\n
    room_timestamp_to_event_test.go:58: SendEventSynced waiting for event ID $pTin786hMhXTzQFzU7cWtrhQxVk5Vb7SBMtBIA7RRLI\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (6.264411396s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!TBlb7amThD6CkYpH1h:hs1/timestamp_to_event => 200 OK (22.326427ms)\n
    room_timestamp_to_event_test.go:65: \u001b[31mJSONFieldStr: key 'event_id' missing from {}\u001b[39m\n
--- FAIL: TestJumpToDateEndpoint/parallel/should_find_nothing_after_the_latest_timestmap (14.46s)\n
null
null
=== CONT  TestJumpToDateEndpoint/parallel/should_find_next_event_topologically_before_given_timestamp_when_all_message_timestamps_are_the_same\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (6.015587162s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (6.081064369s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!WTDIalq6U8ZqtKELGm:hs1/timestamp_to_event => 200 OK (19.80056ms)\n
    room_timestamp_to_event_test.go:46: \u001b[31mJSONFieldStr: key 'event_id' missing from {}\u001b[39m\n
--- FAIL: TestJumpToDateEndpoint/parallel/should_find_event_after_given_timestmap (14.89s)\n
null
null
=== CONT  TestJumpToDateEndpoint/parallel/should_find_next_event_topologically_after_given_timestmap_when_all_message_timestamps_are_the_same\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (6.133303503s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!5FnRNPG05XAdZzCDmL:hs1/send/m.room.message/15 => 200 OK (625.346154ms)\n
    room_timestamp_to_event_test.go:58: SendEventSynced waiting for event ID $f3Ck0mHcMOak-Vcpq689qDsSRt901baQMIlswYwJDBw\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!CHQWUcIGXN4m3a8ALj:hs1/send/m.room.message/16 => 200 OK (598.55843ms)\n
    room_timestamp_to_event_test.go:51: SendEventSynced waiting for event ID $RWwYl_sXiOI6REGpbphpeJciA-Lzcw1O2vn2yx1sOEU\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.024826578s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!BtTOEVLAzryR3bBVqK:hs1/send/m.room.message/17 => 200 OK (368.341596ms)\n
    room_timestamp_to_event_test.go:70: SendEventSynced waiting for event ID $Smu2_083Tx00QGtkcCmltTA8V170zskNzTNOj0at1Qk\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (2.028305552s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!XoxQW9VJdNFeN2SNV9:hs1/send/m.room.message/18 => 200 OK (661.803512ms)\n
    room_timestamp_to_event_test.go:90: SendEventSynced waiting for event ID $LyJQm74jGrJq6gimmPO_CcoADSjUN06FYjXq8ndjDus\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (8.636356568s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!5FnRNPG05XAdZzCDmL:hs1/timestamp_to_event => 200 OK (30.139989ms)\n
    room_timestamp_to_event_test.go:59: \u001b[31mJSONFieldStr: key 'event_id' missing from {}\u001b[39m\n
--- FAIL: TestJumpToDateEndpoint/parallel/should_find_nothing_before_the_earliest_timestmap (20.25s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (9.110019606s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/rooms/!CHQWUcIGXN4m3a8ALj:hs1/timestamp_to_event => 200 OK (16.006914ms)\n
    room_timestamp_to_event_test.go:52: \u001b[31mJSONFieldStr: key 'event_id' missing from {}\u001b[39m\n
--- FAIL: TestJumpToDateEndpoint/parallel/should_find_event_before_given_timestmap (21.40s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (8.360988675s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (7.659170754s)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!BtTOEVLAzryR3bBVqK:hs1/send/m.room.message/19 => 200 OK (154.586948ms)\n
    room_timestamp_to_event_test.go:70: SendEventSynced waiting for event ID $YCL69_uestTwHpVLd0HEQnVkwdNZouqbDqrJTve6gZM\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!XoxQW9VJdNFeN2SNV9:hs1/send/m.room.message/20 => 200 OK (259.001009ms)\n
    room_timestamp_to_event_test.go:90: SendEventSynced waiting for event ID $CUzNLmyAmCuXDrl-N_Ej43zlPAJrxyBOwNg3nT1Rhis\n
    txnid_test.go:119: Deploy times: 82.979641ms blueprints, 22.150720009s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (749.345403ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (616.257732ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (575.144155ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!TJqSnxsqXvaQebHR3M:hs1/send/m.room.message/abcdef => 200 OK (206.034826ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (680.967008ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!TJqSnxsqXvaQebHR3M:hs1/send/m.room.message/abcdef => 200 OK (9.085269ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.567041459s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!BtTOEVLAzryR3bBVqK:hs1 => 401 Unauthorized (2.509281ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:33211/_matrix/client/v3/join/%21BtTOEVLAzryR3bBVqK:hs1?server_name=hs1 returned non-2xx code: 401 Unauthorized - body: {"errcode":"M_UNKNOWN_TOKEN","error":"Unknown access token"}\u001b[39m\n
--- FAIL: TestJumpToDateEndpoint/parallel/should_find_next_event_topologically_before_given_timestamp_when_all_message_timestamps_are_the_same (14.48s)\n
null
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (3.479535721s)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!XoxQW9VJdNFeN2SNV9:hs1 => 401 Unauthorized (2.79479ms)\n
    client.go:830: \u001b[31mCSAPI.Must: POST http://127.0.0.1:33211/_matrix/client/v3/join/%21XoxQW9VJdNFeN2SNV9:hs1?server_name=hs1 returned non-2xx code: 401 Unauthorized - body: {"errcode":"M_UNKNOWN_TOKEN","error":"Unknown access token"}\u001b[39m\n
--- FAIL: TestJumpToDateEndpoint/parallel/should_find_next_event_topologically_after_given_timestmap_when_all_message_timestamps_are_the_same (14.10s)\n
null
--- FAIL: TestJumpToDateEndpoint/parallel (10.39s)\n
null
2025/02/23 07:47:28 ============================================\n
\n
\n
2025/02/23 07:47:28 6ee1bdabb2ad2d74418c41b9235f6eece8c320a44f5975a892a5c5fc216c14fa : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=6ee1bdabb2ad\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 6ee1bdabb2ad 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740268040.0345395,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740268040.039517,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740268040.03956,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
2025/02/23 07:47:28 ============== 6ee1bdabb2ad2d74418c41b9235f6eece8c320a44f5975a892a5c5fc216c14fa : END LOGS ==============\n
\n
\n
--- PASS: TestTxnIdempotencyScopedToDevice (26.61s)\n
null
null
=== RUN   TestTxnIdempotency\n
    txnid_test.go:160: WARNING: TestTxnIdempotency called runtime.SkipIf([conduit]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
2025/02/23 07:47:28 ============================================\n
\n
\n
2025/02/23 07:47:28 7647c01b6965f875c40ea0cb26877160d8e6dcb8a9873949139f854b669f81c8 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=7647c01b6965\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 7647c01b6965 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740268002.5086582,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740268002.5277312,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740268002.527975,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 17\n
To many layers, we have to go deeper frame_id: 18\n
To many layers, we have to go deeper frame_id: 19\n
To many layers, we have to go deeper frame_id: 20\n
To many layers, we have to go deeper frame_id: 41\n
To many layers, we have to go deeper frame_id: 42\n
To many layers, we have to go deeper frame_id: 43\n
To many layers, we have to go deeper frame_id: 44\n
To many layers, we have to go deeper frame_id: 57\n
To many layers, we have to go deeper frame_id: 58\n
To many layers, we have to go deeper frame_id: 68\n
To many layers, we have to go deeper frame_id: 71\n
2025/02/23 07:47:28 ============== 7647c01b6965f875c40ea0cb26877160d8e6dcb8a9873949139f854b669f81c8 : END LOGS ==============\n
\n
\n
2025/02/23 07:47:30 ============================================\n
\n
\n
2025/02/23 07:47:30 a7a140e3e8c289d2199392ab2340599dc6e62b1a371a1ae068d9c7afbff94233 : Server logs:\n
SERVER_NAME=hs2\n
HOSTNAME=a7a140e3e8c2\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux a7a140e3e8c2 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740268002.832144,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740268002.8464694,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740268002.846504,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
MMMMMMMMMM\n
rrrrrrrrrrrrrrremote_server: "hs1"  servername:"hs2"\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs1:8448/_matrix/federation/v1/make_join/!fCG30B7CGN8VTAa7Cr:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "989", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:46:55 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$hegnZe_GLKoWjNA36xOWRYNuvOvD58ZKD2eYPYOswu0","$IULYghQfrahoXwFC8yjf8EfoeVKmEqsVwLVrk8RTxWg","$e_FYQElyB9i3olm5F6m12Qrhn-7S1PGwShsG5OSUiU8"],"content":{"membership":"join"},"depth":9,"event_sn":80,"hashes":{"sha256":"caP+y0LZ7z/+/TZjUE+nkGFtZjOXW1nPcWG/RT9+VA0"},"origin":"hs1","origin_server_ts":1740268016553,"prev_events":["$0n_Lp37dAz9W7IheZQHDDdP3DRAmaeEprwy74KWMA4o","$IULYghQfrahoXwFC8yjf8EfoeVKmEqsVwLVrk8RTxWg","$SO73D8pFaHdMvH8SdsBw5JBCwmQPq69_OIuABqiqeG8","$_CLxs-pZzRL2l5_0XG0dc0s3hHUQjt5Zcuu-APxqc3s","$e_FYQElyB9i3olm5F6m12Qrhn-7S1PGwShsG5OSUiU8","$hegnZe_GLKoWjNA36xOWRYNuvOvD58ZKD2eYPYOswu0","$rgdotr7DfLStGQq8Gw9-18K7s7_o177orejt37iAV7U","$xQUFFUFpwBxgH1ctfkfRjWR8yVdpFrp0IPbQX4kS0tk"],"room_id":"!fCG30B7CGN8VTAa7Cr:hs1","sender":"@user-2:hs2","signatures":{"hs1":{"ed25519:ue9wk992":"lNwmwlW1j5MNos3k4w/sVuD13R/UIjXiAIlcv386wrY6511EC54gsSqZNXMsqJurL0woCB3BJoL02ndqUjqWAQ"}},"state_key":"@user-2:hs2","type":"m.roo
m.member"}) })\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs1:8448/_matrix/federation/v1/make_join/!1qGgwXZfHjjw2WcwCx:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "989", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:46:55 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$z7Mh3Kc3avRTxGXaut6X2xd-dyQWQ6APEeOVnx9V2yk","$Z2HwMUF-hHWSYwZWVu-fE55yyZ7m3Q1j9zVCPUfhI18","$jwGL23BgWZS1oJzct-KuY_Ji2ofwZwWvTRXWGJdTbXo"],"content":{"membership":"join"},"depth":9,"event_sn":81,"hashes":{"sha256":"cqCHZYMN9vqmifVIHOPa9WimlyHFAD3Wq2CKIfCZusg"},"origin":"hs1","origin_server_ts":1740268016612,"prev_events":["$7-KbKVIx84NnLklu5dQflIh8EqUjdeznQaUUHP-eBTY","$A2giFYSJJZwZlmLOOxIqHeJkAUjbLoq-VEdcyCjg9jc","$AbSYpbvpE5QhzwAaVyOa1kUqQVLqfNxw4egzQOZE_oQ","$GRHlTyO_rf2VDF8KrcsrT1yquFTd_be10KOgIHxOEvs","$Z2HwMUF-hHWSYwZWVu-fE55yyZ7m3Q1j9zVCPUfhI18","$jwGL23BgWZS1oJzct-KuY_Ji2ofwZwWvTRXWGJdTbXo","$yK7K70nnSJ7JhvfjtVUK_a6zNGIiCuVtCXtO9iSgF2o","$z7Mh3Kc3avRTxGXaut6X2xd-dyQWQ6APEeOVnx9V2yk"],"room_id":"!1qGgwXZfHjjw2WcwCx:hs1","sender":"@user-2:hs2","signatures":{"hs1":{"ed25519:ue9wk992":"KHzf/KzmPCyoWa2+S+U3ouixc6v8kN9TKFI+DxzFh5CPWEn/k7iI76XZ5ShPfuC4ofFKx9GV/Pkh2DsMm9AhDA"}},"state_key":"@user-2:hs2","type":"m.roo
m.member"}) })\n
rrrrrrrrmake_join_response: Ok(Response { url: "https://hs1:8448/_matrix/federation/v1/make_join/!YLpkhhodVvw74tN4af:hs1/@user-2:hs2?ver=[6,7,8,9,10,11,3,4,5]", status: 200, headers: {"access-control-allow-origin": "*", "alt-svc": "h3=\\":8448\\"; ma=2592000", "content-length": "989", "content-type": "application/json", "date": "Sat, 22 Feb 2025 23:46:56 GMT", "server": "Caddy", "vary": "origin", "vary": "access-control-request-method", "vary": "access-control-request-headers"} })\n
BBBBBBBBBody Ok(MakeJoinResBody { room_version: Some(V10), event: RawValue({"auth_events":["$0_4B6ioSx2p1ropr5qY82A2Dnp1pVG4OrHZtoT4S5tM","$BMU-BXmhXant5W2999dJLnQWtdTY2Y36ZNxAGUJ-5rQ","$yrYJwPexNA7Wxc_hXTu5Jgh-vGKOSbjXVntiNaXKu0c"],"content":{"membership":"join"},"depth":9,"event_sn":82,"hashes":{"sha256":"uuvz4ydsQ5XRIHqAp205rX0meFwh/joFlA89OEZj2QU"},"origin":"hs1","origin_server_ts":1740268016648,"prev_events":["$0_4B6ioSx2p1ropr5qY82A2Dnp1pVG4OrHZtoT4S5tM","$BMU-BXmhXant5W2999dJLnQWtdTY2Y36ZNxAGUJ-5rQ","$VnGYpKQ-H0RB4HpFd6XncbxPGSXAA9SvCAKnxsFmGkU","$YQWL0FFVbW3tbKgj_GampXD1cXuBoLv0iF0q0PdIsTQ","$fQV18MkMdT5vd47Cj6bnsNARVS3EQk7_yIEYbBjvi0g","$h-fM6vwNRljyR2qTJ2x4AgiKvZjqBTDi4oVIe0RTO1M","$sUzYOyIS6NyyHDP5m1BzDB43f7UdVxCqewu-OIMQn_w","$yrYJwPexNA7Wxc_hXTu5Jgh-vGKOSbjXVntiNaXKu0c"],"room_id":"!YLpkhhodVvw74tN4af:hs1","sender":"@user-2:hs2","signatures":{"hs1":{"ed25519:ue9wk992":"vB/gieT04qyfh3hvRl4S6nFg51YVFx1F6fGTBJMSXuhbyAUpVGQY9rBbOrGTQuUqgebhskE7OeDxVn8r4uNrCg"}},"state_key":"@user-2:hs2","type":"m.roo
m.member"}) })\n
  \u001b[2m2025-02-22T23:46:57.416437Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
  \u001b[2m2025-02-22T23:46:57.496247Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
  \u001b[2m2025-02-22T23:46:57.500507Z\u001b[0m \u001b[33m WARN\u001b[0m \u001b[1;33mpalpo::bl::server_key::acquire\u001b[0m\u001b[33m: \u001b[33mmissing 1 keys for 1 servers from all notaries first\u001b[0m\n
    \u001b[2;3mat\u001b[0m crates/server/src/bl/server_key/acquire.rs:76\n
\n
2025/02/23 07:47:30 ============== a7a140e3e8c289d2199392ab2340599dc6e62b1a371a1ae068d9c7afbff94233 : END LOGS ==============\n
\n
\n
--- FAIL: TestJumpToDateEndpoint (72.00s)\n
null
null
=== RUN   TestUnknownEndpoints\n
    txnid_test.go:162: Deploy times: 14.018383ms blueprints, 21.189515809s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (663.184075ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (590.489147ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (492.98329ms)\n
    unknown_endpoints_test.go:41: Deploy times: 12.62236ms blueprints, 20.735148248s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (546.70642ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!jop5J1BQieJp2RqANQ:hs1/send/m.room.message/abc => 200 OK (94.108284ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!jop5J1BQieJp2RqANQ:hs1/send/m.room.message/abc => 200 OK (8.146501ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!jop5J1BQieJp2RqANQ:hs1/send/m.room.message/abc => 200 OK (4.967757ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!tXGxrsfrhlIKdZB6IF:hs1/send/m.room.message/abc => 200 OK (6.760253ms)\n
    txnid_test.go:211: \u001b[31mNotEqual Expected eventID4 and eventID3 to be different, but they were not: got '$W4Hwaoy4jXSj3k8PyvQZ1Fqr3FFhEOuwWaSFAlWTdxg', want '$W4Hwaoy4jXSj3k8PyvQZ1Fqr3FFhEOuwWaSFAlWTdxg'\u001b[39m\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (649.162747ms)\n
null
=== RUN   TestUnknownEndpoints/Unknown_prefix\n
    client.go:706: [CSAPI] GET hs1/_matrix/unknown => 404 Not Found (1.589002ms)\n
--- PASS: TestUnknownEndpoints/Unknown_prefix (0.00s)\n
null
null
=== RUN   TestUnknownEndpoints/Client-server_endpoints\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/unknown => 404 Not Found (4.261699ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v1/unknown => 404 Not Found (2.714709ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/room/unknown => 404 Not Found (1.799607ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/login => 405 Method Not Allowed (942.353µs)\n
--- PASS: TestUnknownEndpoints/Client-server_endpoints (0.01s)\n
null
null
=== RUN   TestUnknownEndpoints/Server-server_endpoints\n
    client.go:706: [CSAPI] GET hs1/_matrix/federation/unknown => 404 Not Found (675.002µs)\n
    client.go:706: [CSAPI] GET hs1/_matrix/federation/v1/unknown => 404 Not Found (1.897985ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/federation/v1/version => 405 Method Not Allowed (944.765µs)\n
--- PASS: TestUnknownEndpoints/Server-server_endpoints (0.00s)\n
null
null
=== RUN   TestUnknownEndpoints/Key_endpoints\n
    client.go:706: [CSAPI] GET hs1/_matrix/key/unknown => 404 Not Found (703.725µs)\n
    client.go:706: [CSAPI] GET hs1/_matrix/key/v2/unknown => 404 Not Found (1.924365ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/key/v2/query => 405 Method Not Allowed (2.563552ms)\n
--- PASS: TestUnknownEndpoints/Key_endpoints (0.01s)\n
null
null
=== RUN   TestUnknownEndpoints/Media_endpoints\n
    client.go:706: [CSAPI] GET hs1/_matrix/media/unknown => 404 Not Found (4.017482ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/media/v3/unknown => 404 Not Found (1.766228ms)\n
    client.go:706: [CSAPI] PATCH hs1/_matrix/media/v3/upload => 405 Method Not Allowed (1.136002ms)\n
--- PASS: TestUnknownEndpoints/Media_endpoints (0.01s)\n
null
2025/02/23 07:47:53 ============================================\n
\n
\n
2025/02/23 07:47:53 8512cd44a4061a96b90cae6f79ca1912cc050568ab74c8d85520d052b818912b : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=8512cd44a406\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 8512cd44a406 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740268066.3733704,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740268066.37959,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740268066.3798623,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 11\n
2025/02/23 07:47:53 ============== 8512cd44a4061a96b90cae6f79ca1912cc050568ab74c8d85520d052b818912b : END LOGS ==============\n
\n
\n
2025/02/23 07:47:53 ============================================\n
\n
\n
2025/02/23 07:47:53 36d6d97ae984f4a992acd5515e654114ea26d799978a522476547cec0bad81dd : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=36d6d97ae984\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 36d6d97ae984 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740268068.0149903,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740268068.020537,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740268068.0205624,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:47:53 ============== 36d6d97ae984f4a992acd5515e654114ea26d799978a522476547cec0bad81dd : END LOGS ==============\n
\n
\n
--- FAIL: TestTxnIdempotency (25.31s)\n
null
null
=== RUN   TestTxnIdWithRefreshToken\n
    txnid_test.go:218: WARNING: TestTxnIdWithRefreshToken called runtime.SkipIf([dendrite conduit]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
--- PASS: TestUnknownEndpoints (23.17s)\n
null
FAIL\n
FAIL\tgithub.com/matrix-org/complement/tests\t2380.297s\n
null
    txnid_test.go:220: Deploy times: 16.042587ms blueprints, 22.153671671s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (737.278631ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/login => 200 OK (607.037024ms)\n
    txnid_test.go:233: \u001b[31mJSONFieldStr: key 'refresh_token' missing from {"user_id":"@user-1-alice:hs1","access_token":"qbkGGceESJCZWjspQRlFxCXhbJn03xNf","device_id":"3toX8VeZuW"}\u001b[39m\n
2025/02/23 07:48:18 ============================================\n
\n
\n
2025/02/23 07:48:18 3f21e73ed47f8c26751e90811944284bba499ce129b67fccbecdfbd50222f1d9 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=3f21e73ed47f\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 3f21e73ed47f 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740268092.5583417,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740268092.5640285,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740268092.5640614,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:48:18 ============== 3f21e73ed47f8c26751e90811944284bba499ce129b67fccbecdfbd50222f1d9 : END LOGS ==============\n
\n
\n
--- FAIL: TestTxnIdWithRefreshToken (25.07s)\n
null
null
=== RUN   TestUploadKey\n
    upload_keys_test.go:21: Deploy times: 13.813486ms blueprints, 14.340515269s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (561.001359ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (583.790751ms)\n
null
=== RUN   TestUploadKey/Parallel\n
null
=== RUN   TestUploadKey/Parallel/Can_upload_device_keys\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (21.540769ms)\n
--- PASS: TestUploadKey/Parallel/Can_upload_device_keys (0.02s)\n
null
null
=== RUN   TestUploadKey/Parallel/Rejects_invalid_device_keys\n
    upload_keys_test.go:59: WARNING: TestUploadKey/Parallel/Rejects_invalid_device_keys called runtime.SkipIf([dendrite synapse]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
=== PAUSE TestUploadKey/Parallel/Rejects_invalid_device_keys\n
null
null
=== RUN   TestUploadKey/Parallel/Should_reject_keys_claiming_to_belong_to_a_different_user\n
    upload_keys_test.go:80: WARNING: TestUploadKey/Parallel/Should_reject_keys_claiming_to_belong_to_a_different_user called runtime.SkipIf([synapse]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
=== PAUSE TestUploadKey/Parallel/Should_reject_keys_claiming_to_belong_to_a_different_user\n
null
null
=== RUN   TestUploadKey/Parallel/Can_query_device_keys_using_POST\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/query => 200 OK (17.388905ms)\n
--- PASS: TestUploadKey/Parallel/Can_query_device_keys_using_POST (0.02s)\n
null
null
=== RUN   TestUploadKey/Parallel/Can_query_specific_device_keys_using_POST\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/query => 200 OK (9.444647ms)\n
--- PASS: TestUploadKey/Parallel/Can_query_specific_device_keys_using_POST (0.01s)\n
null
null
=== RUN   TestUploadKey/Parallel/query_for_user_with_no_keys_returns_empty_key_dict\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/query => 200 OK (10.578396ms)\n
--- PASS: TestUploadKey/Parallel/query_for_user_with_no_keys_returns_empty_key_dict (0.01s)\n
null
null
=== RUN   TestUploadKey/Parallel/Can_claim_one_time_key_using_POST\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/claim => 200 OK (8.185499ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/claim => 200 OK (6.71195ms)\n
--- PASS: TestUploadKey/Parallel/Can_claim_one_time_key_using_POST (0.02s)\n
null
null
=== CONT  TestUploadKey/Parallel/Rejects_invalid_device_keys\n
null
=== CONT  TestUploadKey/Parallel/Should_reject_keys_claiming_to_belong_to_a_different_user\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 400 Bad Request (5.499955ms)\n
    upload_keys_test.go:69: \u001b[31mCSAPI.MustDo POST http://127.0.0.1:33225/_matrix/client/v3/keys/upload returned non-2xx code: 400 Bad Request - body: {"errcode":"M_BAD_JSON","error":"serde json error: missing field `algorithms` at line 1 column 65"}\u001b[39m\n
--- FAIL: TestUploadKey/Parallel/Rejects_invalid_device_keys (0.01s)\n
null
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 400 Bad Request (11.051786ms)\n
--- PASS: TestUploadKey/Parallel/Should_reject_keys_claiming_to_belong_to_a_different_user (0.01s)\n
null
--- FAIL: TestUploadKey/Parallel (0.08s)\n
null
2025/02/23 07:48:35 ============================================\n
\n
\n
2025/02/23 07:48:35 34462c55d2e287af82eab1a42415a4fc86fda37ed6d5d8f3a2a1c7747098c978 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=34462c55d2e2\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 34462c55d2e2 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740268109.868204,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740268109.873642,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740268109.8736744,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:48:35 ============== 34462c55d2e287af82eab1a42415a4fc86fda37ed6d5d8f3a2a1c7747098c978 : END LOGS ==============\n
\n
\n
--- FAIL: TestUploadKey (17.03s)\n
null
null
=== RUN   TestKeyClaimOrdering\n
    upload_keys_test.go:180: Deploy times: 9.2198ms blueprints, 15.360921193s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (581.997075ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (13.54308ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (28.122506ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/claim => 200 OK (17.713923ms)\n
    upload_keys_test.go:204: \u001b[31mMatchResponse key 'one_time_keys.@user-1:hs1.RawBJbZet7' got 'map[signed_curve25519:0:map[key:dGN0kzUx8eCV55U0VKobFrhYWnSBsPC49OpJnGRAmyM signatures:map[@user-1:hs1:map[ed25519:RawBJbZet7:MOpmaJJnvQnHUSmZZmomDFJ4OEUSUvObiAMcikqFohjM8C+kBIRvhE4AagbOuFssNtRtmlmaByQxWJeKx5QkDg]]]]' (type map[string]interface {}) want 'map[signed_curve25519:1:map[key:BpHW3x9DfErZZs9yk2jcO16qh+9aV2cr2wTyIev9gU0 signatures:map[@user-1:hs1:map[ed25519:RawBJbZet7:fod3jEGjjqiX4TNmqBHP1Nc/BpbacsYrKJGZEngZEYnbr31n+6uptchKebvhWYRJnChx0xAg2eBepo68dA9FCA]]]]' (type map[string]interface {}) - http://127.0.0.1:33227/_matrix/client/v3/keys/claim => {"one_time_keys":{"@user-1:hs1":{"RawBJbZet7":{"signed_curve25519:0":{"key":"dGN0kzUx8eCV55U0VKobFrhYWnSBsPC49OpJnGRAmyM","signatures":{"@user-1:hs1":{"ed25519:RawBJbZet7":"MOpmaJJnvQnHUSmZZmomDFJ4OEUSUvObiAMcikqFohjM8C+kBIRvhE4AagbOuFssNtRtmlmaByQxWJeKx5QkDg"}}}}}}}\u001b[39m\n
2025/02/23 07:48:54 ============================================\n
\n
\n
2025/02/23 07:48:54 66394ae271149aa0cd2923823271cabbe618a39a21f599d8766c10d76ca1c3fe : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=66394ae27114\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 66394ae27114 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740268127.7600417,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740268127.768509,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740268127.7685354,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:48:54 ============== 66394ae271149aa0cd2923823271cabbe618a39a21f599d8766c10d76ca1c3fe : END LOGS ==============\n
\n
\n
--- FAIL: TestKeyClaimOrdering (18.49s)\n
null
null
=== RUN   TestUploadKeyIdempotency\n
    upload_keys_test.go:218: Deploy times: 9.823676ms blueprints, 18.240200974s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (754.570727ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (68.020481ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (40.306267ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (19.195283ms)\n
2025/02/23 07:49:14 ============================================\n
\n
\n
2025/02/23 07:49:14 759eae9b03462fab9f47c015460dd8c718691b43fe12f9a9b26ae7fcf33b3912 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=759eae9b0346\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 759eae9b0346 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740268148.8383975,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740268148.8452663,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740268148.8452976,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:49:14 ============== 759eae9b03462fab9f47c015460dd8c718691b43fe12f9a9b26ae7fcf33b3912 : END LOGS ==============\n
\n
\n
--- PASS: TestUploadKeyIdempotency (20.96s)\n
null
null
=== RUN   TestUploadKeyIdempotencyOverlap\n
    upload_keys_test.go:260: Deploy times: 11.458316ms blueprints, 15.903859974s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (686.271851ms)\n
    upload_keys_test.go:280: OTKs ABC map[signed_curve25519:0:map[key:ZPPGGNVBSLQtVZAMVzWz5bgTBI7pa+dxtBjXjPD4Ek0 signatures:map[@user-1:hs1:map[ed25519:ZyRLGCuIR8:50Vu8hrzw19IWqVJWwvXOgg+BqkjLgEd86TV0blxvhqxcXt4nhcyI1aa5VAhTB/0R3JLT5Kzg8vrhCAtLNlhBQ]]] signed_curve25519:1:map[key:4cUO6b1cFICx2IiiS0xOMlchkHqN0QheTI7+jQeAGQY signatures:map[@user-1:hs1:map[ed25519:ZyRLGCuIR8:jCIwhY+0nY4hnqt+SbGyQFjHQxKCJTToNXoD8bpkXsYaDQpLwg8d5ytrC0+vLbFiFeah4hZXN4VEUzWrVhlJCw]]] signed_curve25519:3:map[key:hufpF2hxckq528gHbTAzuIy9Bo+jX2HZAl7akTiOCHw signatures:map[@user-1:hs1:map[ed25519:ZyRLGCuIR8:Gicb7crKcDIkXdw9JQ62z55GE4sVk2piw9wa8KpPWLeAUaIWdS/o9/DAo7afqj1HIhyZQIEgbUe5MCzMNI+aAQ]]]]\n
    upload_keys_test.go:281: OTKs BCD map[signed_curve25519:0:map[key:ZPPGGNVBSLQtVZAMVzWz5bgTBI7pa+dxtBjXjPD4Ek0 signatures:map[@user-1:hs1:map[ed25519:ZyRLGCuIR8:50Vu8hrzw19IWqVJWwvXOgg+BqkjLgEd86TV0blxvhqxcXt4nhcyI1aa5VAhTB/0R3JLT5Kzg8vrhCAtLNlhBQ]]] signed_curve25519:1:map[key:4cUO6b1cFICx2IiiS0xOMlchkHqN0QheTI7+jQeAGQY signatures:map[@user-1:hs1:map[ed25519:ZyRLGCuIR8:jCIwhY+0nY4hnqt+SbGyQFjHQxKCJTToNXoD8bpkXsYaDQpLwg8d5ytrC0+vLbFiFeah4hZXN4VEUzWrVhlJCw]]] signed_curve25519:2:map[key:xWX9Hx1NNwLtEntHzOp6XuTF7RsHd0GM8tTOkUoE5Vk signatures:map[@user-1:hs1:map[ed25519:ZyRLGCuIR8:8vLtAzz8XyYHxzQfa+l/KtgP+YrdS9o055fOTACiCvugFXIasaZ296cprlAB/zO+oKm4Mj5IPioItt9/i+xfAw]]]]\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (33.319264ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (59.377705ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/upload => 200 OK (27.145981ms)\n
2025/02/23 07:49:33 ============================================\n
\n
\n
2025/02/23 07:49:33 afa3c6c716231f603835ad7ca09bb2eb045b187631fa2d0972284c37f6e4121f : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=afa3c6c71623\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux afa3c6c71623 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740268167.504319,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740268167.5122926,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740268167.5123413,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:49:33 ============== afa3c6c716231f603835ad7ca09bb2eb045b187631fa2d0972284c37f6e4121f : END LOGS ==============\n
\n
\n
--- PASS: TestUploadKeyIdempotencyOverlap (18.53s)\n
null
null
=== RUN   TestUrlPreview\n
    url_preview_test.go:43: WARNING: TestUrlPreview called runtime.SkipIf([dendrite]) but Complement doesn't know which HS is running as it was run without a *_blacklist tag: executing test.\n
    url_preview_test.go:45: Deploy times: 11.996462ms blueprints, 16.570721654s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (700.022966ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/media/v3/preview_url => 200 OK (12.404293ms)\n
    url_preview_test.go:76: \u001b[31mMatchResponse key 'og:title' missing - http://127.0.0.1:33233/_matrix/media/v3/preview_url?url=http%!A(MISSING)%!F(MISSING)%!F(MISSING)host.docker.internal%!A(MISSING)32773%!F(MISSING)test.html => {}\u001b[39m\n
2025/02/23 07:49:52 ============================================\n
\n
\n
2025/02/23 07:49:52 b0ed4bfd79f5b2ef2977a1f55eeb93e9b751a778a5aaca6a505780f1a710a7ce : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=b0ed4bfd79f5\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux b0ed4bfd79f5 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740268186.6125891,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740268186.616941,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740268186.6170895,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:49:52 ============== b0ed4bfd79f5b2ef2977a1f55eeb93e9b751a778a5aaca6a505780f1a710a7ce : END LOGS ==============\n
\n
\n
--- FAIL: TestUrlPreview (18.83s)\n
null
null
=== RUN   TestRoomSpecificUsernameChange\n
    user_directory_display_names_test.go:46: OldDeploy times: 34.669499414s blueprints, 16.312531006s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (956.845439ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (685.073801ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (649.734537ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/profile/@user-1-alice:hs1/displayname => 200 OK (12.122592ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (582.940413ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (557.42758ms)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (124.828315ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!QoPr1OEcDv8KJaaArb:hs1 => 200 OK (132.182479ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!QoPr1OEcDv8KJaaArb:hs1/state/m.room.member/@user-1-alice:hs1 => 200 OK (240.495006ms)\n
null
=== RUN   TestRoomSpecificUsernameChange/Eve_can_find_Alice_by_profile_display_name\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user_directory/search => 200 OK (23.389591ms)\n
--- PASS: TestRoomSpecificUsernameChange/Eve_can_find_Alice_by_profile_display_name (0.02s)\n
null
null
=== RUN   TestRoomSpecificUsernameChange/Eve_can_find_Alice_by_mxid\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user_directory/search => 200 OK (34.597521ms)\n
--- PASS: TestRoomSpecificUsernameChange/Eve_can_find_Alice_by_mxid (0.03s)\n
null
null
=== RUN   TestRoomSpecificUsernameChange/Eve_cannot_find_Alice_by_room-specific_name_that_Eve_is_not_privy_to\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user_directory/search => 200 OK (8.307292ms)\n
--- PASS: TestRoomSpecificUsernameChange/Eve_cannot_find_Alice_by_room-specific_name_that_Eve_is_not_privy_to (0.01s)\n
null
null
=== RUN   TestRoomSpecificUsernameChange/Bob_can_find_Alice_by_profile_display_name\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user_directory/search => 200 OK (22.571895ms)\n
--- PASS: TestRoomSpecificUsernameChange/Bob_can_find_Alice_by_profile_display_name (0.02s)\n
null
null
=== RUN   TestRoomSpecificUsernameChange/Bob_can_find_Alice_by_mxid\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user_directory/search => 200 OK (26.872561ms)\n
--- PASS: TestRoomSpecificUsernameChange/Bob_can_find_Alice_by_mxid (0.03s)\n
null
2025/02/23 07:50:48 ============================================\n
\n
\n
2025/02/23 07:50:48 8b4c033642b33e4df3ddbcb69800226a7e47986f95fd1ab64f475c4576e46540 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=8b4c033642b3\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 8b4c033642b3 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740268239.9292972,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740268239.9403698,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740268239.940549,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 11\n
2025/02/23 07:50:48 ============== 8b4c033642b33e4df3ddbcb69800226a7e47986f95fd1ab64f475c4576e46540 : END LOGS ==============\n
\n
\n
--- PASS: TestRoomSpecificUsernameChange (56.54s)\n
null
null
=== RUN   TestRoomSpecificUsernameAtJoin\n
    user_directory_display_names_test.go:46: OldDeploy times: 20.004718ms blueprints, 18.115776348s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (704.67278ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (779.048228ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (701.521446ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/profile/@user-1-alice:hs1/displayname => 200 OK (22.993778ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (670.064063ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/createRoom => 200 OK (1.176324235s)\n
    client.go:706: [CSAPI] GET hs1/_matrix/client/v3/sync => 200 OK (176.364098ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/join/!Mq4hAHEpYHdRvCPxQt:hs1 => 200 OK (293.655003ms)\n
    client.go:706: [CSAPI] PUT hs1/_matrix/client/v3/rooms/!Mq4hAHEpYHdRvCPxQt:hs1/state/m.room.member/@user-1-alice:hs1 => 200 OK (314.827301ms)\n
null
=== RUN   TestRoomSpecificUsernameAtJoin/Eve_can_find_Alice_by_profile_display_name\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user_directory/search => 200 OK (15.787926ms)\n
--- PASS: TestRoomSpecificUsernameAtJoin/Eve_can_find_Alice_by_profile_display_name (0.02s)\n
null
null
=== RUN   TestRoomSpecificUsernameAtJoin/Eve_can_find_Alice_by_mxid\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user_directory/search => 200 OK (28.303367ms)\n
--- PASS: TestRoomSpecificUsernameAtJoin/Eve_can_find_Alice_by_mxid (0.03s)\n
null
null
=== RUN   TestRoomSpecificUsernameAtJoin/Eve_cannot_find_Alice_by_room-specific_name_that_Eve_is_not_privy_to\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user_directory/search => 200 OK (4.335529ms)\n
--- PASS: TestRoomSpecificUsernameAtJoin/Eve_cannot_find_Alice_by_room-specific_name_that_Eve_is_not_privy_to (0.00s)\n
null
null
=== RUN   TestRoomSpecificUsernameAtJoin/Bob_can_find_Alice_by_profile_display_name\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user_directory/search => 200 OK (15.27655ms)\n
--- PASS: TestRoomSpecificUsernameAtJoin/Bob_can_find_Alice_by_profile_display_name (0.02s)\n
null
null
=== RUN   TestRoomSpecificUsernameAtJoin/Bob_can_find_Alice_by_mxid\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/user_directory/search => 200 OK (21.040559ms)\n
--- PASS: TestRoomSpecificUsernameAtJoin/Bob_can_find_Alice_by_mxid (0.02s)\n
null
2025/02/23 07:51:13 ============================================\n
\n
\n
2025/02/23 07:51:13 75517b320a554b228e6c483ea76b2bcd9f537906aed00c9af4d16ba0f44f3237 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=75517b320a55\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux 75517b320a55 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740268263.3485112,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740268263.3581324,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740268263.3587666,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
To many layers, we have to go deeper frame_id: 5\n
To many layers, we have to go deeper frame_id: 11\n
2025/02/23 07:51:13 ============== 75517b320a554b228e6c483ea76b2bcd9f537906aed00c9af4d16ba0f44f3237 : END LOGS ==============\n
\n
\n
--- PASS: TestRoomSpecificUsernameAtJoin (24.88s)\n
null
null
=== RUN   TestKeysQueryWithDeviceIDAsObjectFails\n
    user_query_keys_test.go:19: Deploy times: 12.243182ms blueprints, 20.041899985s containers\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (678.517476ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/register => 200 OK (643.00979ms)\n
    client.go:706: [CSAPI] POST hs1/_matrix/client/v3/keys/query => 400 Bad Request (7.84523ms)\n
2025/02/23 07:51:36 ============================================\n
\n
\n
2025/02/23 07:51:36 c8287b6f02c5c3f4425e04e0bf70bac0ae87786277ee963decdb2ee7168b9d15 : Server logs:\n
SERVER_NAME=hs1\n
HOSTNAME=c8287b6f02c5\n
PWD=/work\n
HOME=/root\n
CARGO_HOME=/usr/local/cargo\n
PALPO_DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/palpo\n
RUSTUP_HOME=/usr/local/rustup\n
LOG_FORMAT=text\n
SHLVL=1\n
RUST_VERSION=1.85.0\n
PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n
RUST_LOG=palpo=warn,palpo_core=warn,salvo=error\n
PALPO_CONFIG=/work/palpo.toml\n
_=/usr/bin/printenv\n
Starting PostgreSQL 15 database server: main.\n
Linux c8287b6f02c5 6.8.0-53-generic #55-Ubuntu SMP PREEMPT_DYNAMIC Fri Jan 17 15:37:52 UTC 2025 x86_64 GNU/Linux\n
{"level":"info","ts":1740268290.2679021,"msg":"using config from file","file":"/work/caddy.json"}\n
{"level":"warn","ts":1740268290.2750342,"logger":"http","msg":"HTTP/2 skipped because it requires TLS","network":"tcp","addr":":80"}\n
{"level":"warn","ts":1740268290.275076,"logger":"http","msg":"HTTP/3 skipped because it requires TLS","network":"tcp","addr":":80"}\n
Has pending migration: false\n
2025/02/23 07:51:36 ============== c8287b6f02c5c3f4425e04e0bf70bac0ae87786277ee963decdb2ee7168b9d15 : END LOGS ==============\n
\n
\n
--- PASS: TestKeysQueryWithDeviceIDAsObjectFails (23.01s)\n
null
FAIL\n
FAIL\tgithub.com/matrix-org/complement/tests/csapi\t2598.175s\n
null
